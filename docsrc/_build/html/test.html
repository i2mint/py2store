
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>py2store.filesys &#8212; py2store 0.0.7 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Welcome to Mock Module’s documentation!" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="module-py2store.filesys">
<span id="py2store-filesys"></span><h1>py2store.filesys<a class="headerlink" href="#module-py2store.filesys" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.filesys.DirCollection">
<em class="property">class </em><code class="sig-prename descclassname">py2store.filesys.</code><code class="sig-name descname">DirCollection</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">rootdir</span></em>, <em class="sig-param"><span class="n">subpath</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">pattern_for_field</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/filesys.html#DirCollection"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.filesys.DirCollection" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.filesys.FileBytesPersister">
<em class="property">class </em><code class="sig-prename descclassname">py2store.filesys.</code><code class="sig-name descname">FileBytesPersister</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">rootdir</span></em>, <em class="sig-param"><span class="n">subpath</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">pattern_for_field</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/filesys.html#FileBytesPersister"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.filesys.FileBytesPersister" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.filesys.FileBytesReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.filesys.</code><code class="sig-name descname">FileBytesReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">rootdir</span></em>, <em class="sig-param"><span class="n">subpath</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">pattern_for_field</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/filesys.html#FileBytesReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.filesys.FileBytesReader" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.filesys.FileCollection">
<em class="property">class </em><code class="sig-prename descclassname">py2store.filesys.</code><code class="sig-name descname">FileCollection</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">rootdir</span></em>, <em class="sig-param"><span class="n">subpath</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">pattern_for_field</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/filesys.html#FileCollection"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.filesys.FileCollection" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.filesys.FileInfoReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.filesys.</code><code class="sig-name descname">FileInfoReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">rootdir</span></em>, <em class="sig-param"><span class="n">subpath</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">pattern_for_field</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/filesys.html#FileInfoReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.filesys.FileInfoReader" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.filesys.FileStringPersister">
<em class="property">class </em><code class="sig-prename descclassname">py2store.filesys.</code><code class="sig-name descname">FileStringPersister</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">rootdir</span></em>, <em class="sig-param"><span class="n">subpath</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">pattern_for_field</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/filesys.html#FileStringPersister"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.filesys.FileStringPersister" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.filesys.FileStringReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.filesys.</code><code class="sig-name descname">FileStringReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">rootdir</span></em>, <em class="sig-param"><span class="n">subpath</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">pattern_for_field</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/filesys.html#FileStringReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.filesys.FileStringReader" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.filesys.FileSysCollection">
<em class="property">class </em><code class="sig-prename descclassname">py2store.filesys.</code><code class="sig-name descname">FileSysCollection</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">rootdir</span></em>, <em class="sig-param"><span class="n">subpath</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">pattern_for_field</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/filesys.html#FileSysCollection"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.filesys.FileSysCollection" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py exception">
<dt id="py2store.filesys.KeyValidationError">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.filesys.</code><code class="sig-name descname">KeyValidationError</code><a class="reference internal" href="_modules/py2store/filesys.html#KeyValidationError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.filesys.KeyValidationError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.filesys.RelPathFileBytesReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.filesys.</code><code class="sig-name descname">RelPathFileBytesReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#py2store.filesys.RelPathFileBytesReader" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.filesys.RelPathFileStringReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.filesys.</code><code class="sig-name descname">RelPathFileStringReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#py2store.filesys.RelPathFileStringReader" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-py2store.misc">
<span id="py2store-misc"></span><h1>py2store.misc<a class="headerlink" href="#module-py2store.misc" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.misc.MiscGetter">
<em class="property">class </em><code class="sig-prename descclassname">py2store.misc.</code><code class="sig-name descname">MiscGetter</code><span class="sig-paren">(</span><em class="sig-param">store=&lt;py2store.persisters.local_files.PathFormatPersister object&gt;</em>, <em class="sig-param">incoming_val_trans_for_key={'.bin': &lt;function identity_method&gt;</em>, <em class="sig-param">'.cnf': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.conf': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.config': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.csv': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.gz': &lt;function decompress&gt;</em>, <em class="sig-param">'.gzip': &lt;function decompress&gt;</em>, <em class="sig-param">'.ini': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.json': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.pickle': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.pkl': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.txt': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.zip': &lt;class 'py2store.slib.s_zipfile.FilesOfZip'&gt;}</em>, <em class="sig-param">dflt_incoming_val_trans=&lt;function identity_method&gt;</em>, <em class="sig-param">func_key=&lt;function MiscGetter.&lt;lambda&gt;&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/misc.html#MiscGetter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.misc.MiscGetter" title="Permalink to this definition">¶</a></dt>
<dd><p>An object to write (and only write) to a store (default local files) with automatic deserialization
according to a property of the key (default: file extension).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store.misc</span> <span class="kn">import</span> <span class="n">get_obj</span><span class="p">,</span> <span class="n">misc_objs_get</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">json</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pjoin</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">p</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">),</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">path</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="s1">&#39;tmp.json&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">))</span>  <span class="c1"># putting a json file there, the normal way, so we can use it later</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span> <span class="o">=</span> <span class="n">path</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">get_obj</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>  <span class="c1"># if you&#39;d like to use a function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">t</span> <span class="o">==</span> <span class="n">d</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tt</span> <span class="o">=</span> <span class="n">misc_objs_get</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>  <span class="c1"># if you&#39;d like to use an object (note: can get, but nothing else (no list, set, del, etc))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">tt</span> <span class="o">==</span> <span class="n">d</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">{&#39;a&#39;: {&#39;b&#39;: {&#39;c&#39;: [1, 2, 3]}}}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.misc.MiscGetterAndSetter">
<em class="property">class </em><code class="sig-prename descclassname">py2store.misc.</code><code class="sig-name descname">MiscGetterAndSetter</code><span class="sig-paren">(</span><em class="sig-param">store=&lt;py2store.persisters.local_files.PathFormatPersister object&gt;</em>, <em class="sig-param">incoming_val_trans_for_key={'.bin': &lt;function identity_method&gt;</em>, <em class="sig-param">'.cnf': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.conf': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.config': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.csv': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.gz': &lt;function decompress&gt;</em>, <em class="sig-param">'.gzip': &lt;function decompress&gt;</em>, <em class="sig-param">'.ini': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.json': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.pickle': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.pkl': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.txt': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.zip': &lt;class 'py2store.slib.s_zipfile.FilesOfZip'&gt;}</em>, <em class="sig-param">outgoing_val_trans_for_key={'.bin': &lt;function identity_method&gt;</em>, <em class="sig-param">'.cnf': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.conf': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.config': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.csv': &lt;function csv_fileobj&gt;</em>, <em class="sig-param">'.gz': &lt;function compress&gt;</em>, <em class="sig-param">'.gzip': &lt;function compress&gt;</em>, <em class="sig-param">'.ini': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.json': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.pickle': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.pkl': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.txt': &lt;function &lt;lambda&gt;&gt;}</em>, <em class="sig-param">dflt_incoming_val_trans=&lt;function identity_method&gt;</em>, <em class="sig-param">func_key=&lt;function MiscGetterAndSetter.&lt;lambda&gt;&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/misc.html#MiscGetterAndSetter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.misc.MiscGetterAndSetter" title="Permalink to this definition">¶</a></dt>
<dd><p>An object to read and write (and nothing else) to a store (default local) with automatic (de)serialization
according to a property of the key (default: file extension).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store.misc</span> <span class="kn">import</span> <span class="n">set_obj</span><span class="p">,</span> <span class="n">misc_objs</span>  <span class="c1"># the function and the object</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pjoin</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">p</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">),</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">misc_objs</span><span class="p">[</span><span class="n">pjoin</span><span class="p">(</span><span class="s1">&#39;tmp.json&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">d</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">misc_objs</span><span class="p">[</span><span class="s1">&#39;/Users/twhalen/tmp.json&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">d</span>  <span class="c1"># yep, it&#39;s there, and can be retrieved</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/Users/twhalen/tmp.json&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="n">d</span>  <span class="c1"># in case you don&#39;t believe it&#39;s an actual json file</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># using pickle</span>
<span class="gp">... </span><span class="n">misc_objs</span><span class="p">[</span><span class="n">pjoin</span><span class="p">(</span><span class="s1">&#39;tmp.pkl&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">d</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">misc_objs</span><span class="p">[</span><span class="n">pjoin</span><span class="p">(</span><span class="s1">&#39;tmp.pkl&#39;</span><span class="p">)]</span> <span class="o">==</span> <span class="n">d</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># using txt</span>
<span class="gp">... </span><span class="n">misc_objs</span><span class="p">[</span><span class="n">pjoin</span><span class="p">(</span><span class="s1">&#39;tmp.txt&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="s1">&#39;hello world!&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">misc_objs</span><span class="p">[</span><span class="n">pjoin</span><span class="p">(</span><span class="s1">&#39;tmp.txt&#39;</span><span class="p">)]</span> <span class="o">==</span> <span class="s1">&#39;hello world!&#39;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># using csv</span>
<span class="gp">... </span><span class="n">misc_objs</span><span class="p">[</span><span class="n">pjoin</span><span class="p">(</span><span class="s1">&#39;tmp.csv&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">misc_objs</span><span class="p">[</span><span class="n">pjoin</span><span class="p">(</span><span class="s1">&#39;tmp.csv&#39;</span><span class="p">)]</span> <span class="o">==</span> <span class="p">[[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">]]</span>  <span class="c1"># yeah, well, not numbers, but you deal with it</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># using bin</span>
<span class="gp">... </span><span class="n">misc_objs</span><span class="p">[</span><span class="n">pjoin</span><span class="p">(</span><span class="s1">&#39;tmp.bin&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;let us pretend these are bytes of an audio waveform&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">misc_objs</span><span class="p">[</span><span class="n">pjoin</span><span class="p">(</span><span class="s1">&#39;tmp.bin&#39;</span><span class="p">)]</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;let us pretend these are bytes of an audio waveform&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.misc.MiscReaderMixin">
<em class="property">class </em><code class="sig-prename descclassname">py2store.misc.</code><code class="sig-name descname">MiscReaderMixin</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">incoming_val_trans_for_key</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">dflt_incoming_val_trans</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">func_key</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/misc.html#MiscReaderMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.misc.MiscReaderMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Mixin to transform incoming vals according to the key their under.
Warning: If used as a subclass, this mixin should (in general) be placed before the store</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># make a reader that will wrap a dict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MiscReader</span><span class="p">(</span><span class="n">MiscReaderMixin</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="n">incoming_val_trans_for_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="n">dflt_incoming_val_trans</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="n">func_key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">dict</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">MiscReaderMixin</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">incoming_val_trans_for_key</span><span class="p">,</span> <span class="n">dflt_incoming_val_trans</span><span class="p">,</span> <span class="n">func_key</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">incoming_val_trans_for_key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">MiscReaderMixin</span><span class="o">.</span><span class="n">_incoming_val_trans_for_key</span><span class="p">,</span>  <span class="c1"># take the existing defaults...</span>
<span class="gp">... </span>    <span class="o">**</span><span class="p">{</span><span class="s1">&#39;.bin&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">decode</span><span class="p">()],</span> <span class="c1"># ... override how to handle the .bin extension</span>
<span class="gp">... </span>     <span class="s1">&#39;.reverse_this&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># add a new extension (and how to handle it)</span>
<span class="gp">... </span>    <span class="p">})</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;a.bin&#39;</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;abc123&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;a.reverse_this&#39;</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;abc123&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;a.csv&#39;</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;event,year</span><span class="se">\n</span><span class="s1"> Magna Carta,1215</span><span class="se">\n</span><span class="s1"> Guido,1956&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;a.txt&#39;</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;this is not a text&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;a.pkl&#39;</span><span class="p">:</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">([</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">map</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;a list&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}]),</span>
<span class="gp">... </span>    <span class="s1">&#39;a.json&#39;</span><span class="p">:</span> <span class="s1">&#39;{&quot;str&quot;: &quot;field&quot;, &quot;int&quot;: 42, &quot;float&quot;: 3.14, &quot;array&quot;: [1, 2], &quot;nested&quot;: {&quot;a&quot;: 1, &quot;b&quot;: 2}}&#39;</span><span class="p">,</span>
<span class="gp">... </span><span class="p">}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">MiscReader</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">incoming_val_trans_for_key</span><span class="o">=</span><span class="n">incoming_val_trans_for_key</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[&#39;a.bin&#39;, &#39;a.reverse_this&#39;, &#39;a.csv&#39;, &#39;a.txt&#39;, &#39;a.pkl&#39;, &#39;a.json&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;a.bin&#39;</span><span class="p">]</span>
<span class="go">[97, 98, 99, 49, 50, 51]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;a.reverse_this&#39;</span><span class="p">]</span>
<span class="go">b&#39;321cba&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;a.csv&#39;</span><span class="p">]</span>
<span class="go">[[&#39;event&#39;, &#39;year&#39;], [&#39; Magna Carta&#39;, &#39;1215&#39;], [&#39; Guido&#39;, &#39;1956&#39;]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;a.pkl&#39;</span><span class="p">]</span>
<span class="go">[&#39;text&#39;, [&lt;class &#39;str&#39;&gt;, &lt;class &#39;map&#39;&gt;], {&#39;a list&#39;: [1, 2, 3]}]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;a.json&#39;</span><span class="p">]</span>
<span class="go">{&#39;str&#39;: &#39;field&#39;, &#39;int&#39;: 42, &#39;float&#39;: 3.14, &#39;array&#39;: [1, 2], &#39;nested&#39;: {&#39;a&#39;: 1, &#39;b&#39;: 2}}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.misc.MiscStoreMixin">
<em class="property">class </em><code class="sig-prename descclassname">py2store.misc.</code><code class="sig-name descname">MiscStoreMixin</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">incoming_val_trans_for_key</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">outgoing_val_trans_for_key</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">dflt_incoming_val_trans</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">dflt_outgoing_val_trans</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">func_key</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/misc.html#MiscStoreMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.misc.MiscStoreMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Mixin to transform incoming and outgoing vals according to the key their under.
Warning: If used as a subclass, this mixin should (in general) be placed before the store</p>
<p>See also: preset and postget args from wrap_kvs decorator from py2store.trans.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Make a class to wrap a dict with a layer that transforms written and read values</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MiscStore</span><span class="p">(</span><span class="n">MiscStoreMixin</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="n">incoming_val_trans_for_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outgoing_val_trans_for_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="n">dflt_incoming_val_trans</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dflt_outgoing_val_trans</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="n">func_key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">dict</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">MiscStoreMixin</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">incoming_val_trans_for_key</span><span class="p">,</span> <span class="n">outgoing_val_trans_for_key</span><span class="p">,</span>
<span class="gp">... </span>                                <span class="n">dflt_incoming_val_trans</span><span class="p">,</span> <span class="n">dflt_outgoing_val_trans</span><span class="p">,</span> <span class="n">func_key</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">outgoing_val_trans_for_key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">MiscStoreMixin</span><span class="o">.</span><span class="n">_outgoing_val_trans_for_key</span><span class="p">,</span>  <span class="c1"># take the existing defaults...</span>
<span class="gp">... </span>    <span class="o">**</span><span class="p">{</span><span class="s1">&#39;.bin&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="p">])</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="c1"># ... override how to handle the .bin extension</span>
<span class="gp">... </span>       <span class="s1">&#39;.reverse_this&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># add a new extension (and how to handle it)</span>
<span class="gp">... </span>    <span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ss</span> <span class="o">=</span> <span class="n">MiscStore</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="p">{},</span>  <span class="c1"># store starts empty</span>
<span class="gp">... </span>               <span class="n">incoming_val_trans_for_key</span><span class="o">=</span><span class="p">{},</span>  <span class="c1"># overriding incoming trans so we can see the raw data later</span>
<span class="gp">... </span>               <span class="n">outgoing_val_trans_for_key</span><span class="o">=</span><span class="n">outgoing_val_trans_for_key</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># here&#39;s what we&#39;re going to write in the store</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_to_write</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>     <span class="s1">&#39;a.bin&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">97</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">51</span><span class="p">],</span>
<span class="gp">... </span>     <span class="s1">&#39;a.reverse_this&#39;</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;321cba&#39;</span><span class="p">,</span>
<span class="gp">... </span>     <span class="s1">&#39;a.csv&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="s1">&#39;event&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39; Magna Carta&#39;</span><span class="p">,</span> <span class="s1">&#39;1215&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39; Guido&#39;</span><span class="p">,</span> <span class="s1">&#39;1956&#39;</span><span class="p">]],</span>
<span class="gp">... </span>     <span class="s1">&#39;a.txt&#39;</span><span class="p">:</span> <span class="s1">&#39;this is not a text&#39;</span><span class="p">,</span>
<span class="gp">... </span>     <span class="s1">&#39;a.pkl&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">map</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;a list&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}],</span>
<span class="gp">... </span>     <span class="s1">&#39;a.json&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;field&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">:</span> <span class="mf">3.14</span><span class="p">,</span> <span class="s1">&#39;array&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;nested&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># write this data in our store</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data_to_write</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">ss</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>
<span class="go">[&#39;a.bin&#39;, &#39;a.reverse_this&#39;, &#39;a.csv&#39;, &#39;a.txt&#39;, &#39;a.pkl&#39;, &#39;a.json&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Looking at the contents (what was actually stored/written)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ss</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;a.pkl&#39;</span><span class="p">:</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">else</span><span class="p">:</span>  <span class="c1"># need to verify pickle data differently, since printing contents is problematic in doctest</span>
<span class="gp">... </span>        <span class="k">assert</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="n">data_to_write</span><span class="p">[</span><span class="s1">&#39;a.pkl&#39;</span><span class="p">]</span>
<span class="go">a.bin: b&#39;abc123&#39;</span>
<span class="go">a.reverse_this: b&#39;abc123&#39;</span>
<span class="go">a.csv: b&#39;event,year\r\n Magna Carta,1215\r\n Guido,1956\r\n&#39;</span>
<span class="go">a.txt: b&#39;this is not a text&#39;</span>
<span class="go">a.json: b&#39;{&quot;str&quot;: &quot;field&quot;, &quot;int&quot;: 42, &quot;float&quot;: 3.14, &quot;array&quot;: [1, 2], &quot;nested&quot;: {&quot;a&quot;: 1, &quot;b&quot;: 2}}&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.misc.get_obj">
<code class="sig-prename descclassname">py2store.misc.</code><code class="sig-name descname">get_obj</code><span class="sig-paren">(</span><em class="sig-param">k</em>, <em class="sig-param">store=&lt;py2store.persisters.local_files.PathFormatPersister object&gt;</em>, <em class="sig-param">incoming_val_trans_for_key={'.bin': &lt;function identity_method&gt;</em>, <em class="sig-param">'.cnf': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.conf': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.config': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.csv': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.gz': &lt;function decompress&gt;</em>, <em class="sig-param">'.gzip': &lt;function decompress&gt;</em>, <em class="sig-param">'.ini': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.json': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.pickle': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.pkl': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.txt': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.zip': &lt;class 'py2store.slib.s_zipfile.FilesOfZip'&gt;}</em>, <em class="sig-param">dflt_incoming_val_trans=&lt;function identity_method&gt;</em>, <em class="sig-param">func_key=&lt;function &lt;lambda&gt;&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/misc.html#get_obj"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.misc.get_obj" title="Permalink to this definition">¶</a></dt>
<dd><p>A quick way to get an object, with default… everything (but the key, you know, a clue of what you want)</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.misc.set_obj">
<code class="sig-prename descclassname">py2store.misc.</code><code class="sig-name descname">set_obj</code><span class="sig-paren">(</span><em class="sig-param">k</em>, <em class="sig-param">v</em>, <em class="sig-param">store=&lt;py2store.persisters.local_files.PathFormatPersister object&gt;</em>, <em class="sig-param">outgoing_val_trans_for_key={'.bin': &lt;function identity_method&gt;</em>, <em class="sig-param">'.cnf': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.conf': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.config': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.csv': &lt;function csv_fileobj&gt;</em>, <em class="sig-param">'.gz': &lt;function compress&gt;</em>, <em class="sig-param">'.gzip': &lt;function compress&gt;</em>, <em class="sig-param">'.ini': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.json': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.pickle': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.pkl': &lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">'.txt': &lt;function &lt;lambda&gt;&gt;}</em>, <em class="sig-param">func_key=&lt;function &lt;lambda&gt;&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/misc.html#set_obj"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.misc.set_obj" title="Permalink to this definition">¶</a></dt>
<dd><p>A quick way to get an object, with default… everything (but the key, you know, a clue of what you want)</p>
</dd></dl>

</div>
<div class="section" id="module-py2store.mixins">
<span id="py2store-mixins"></span><h1>py2store.mixins<a class="headerlink" href="#module-py2store.mixins" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.mixins.FilteredKeysMixin">
<em class="property">class </em><code class="sig-prename descclassname">py2store.mixins.</code><code class="sig-name descname">FilteredKeysMixin</code><a class="reference internal" href="_modules/py2store/mixins.html#FilteredKeysMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.mixins.FilteredKeysMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Filters __iter__ and __contains__ with (the boolean filter function attribute) _key_filt.</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.mixins.IdentityKeysWrapMixin">
<em class="property">class </em><code class="sig-prename descclassname">py2store.mixins.</code><code class="sig-name descname">IdentityKeysWrapMixin</code><a class="reference internal" href="_modules/py2store/mixins.html#IdentityKeysWrapMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.mixins.IdentityKeysWrapMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Transparent KeysWrapABC. Often placed in the mro to satisfy the KeysWrapABC need in a neutral way.
This is useful in cases where the keys the persistence functions work with are the same as those you want to work
with.</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.mixins.IdentityKvWrapMixin">
<em class="property">class </em><code class="sig-prename descclassname">py2store.mixins.</code><code class="sig-name descname">IdentityKvWrapMixin</code><a class="reference internal" href="_modules/py2store/mixins.html#IdentityKvWrapMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.mixins.IdentityKvWrapMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Transparent Keys and Vals Wrap</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.mixins.IdentityValsWrapMixin">
<em class="property">class </em><code class="sig-prename descclassname">py2store.mixins.</code><code class="sig-name descname">IdentityValsWrapMixin</code><a class="reference internal" href="_modules/py2store/mixins.html#IdentityValsWrapMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.mixins.IdentityValsWrapMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Transparent ValsWrapABC. Often placed in the mro to satisfy the KeysWrapABC need in a neutral way.
This is useful in cases where the values can be persisted by __setitem__ as is (or the serialization is
handled somewhere in the __setitem__ method.</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.mixins.IterBasedSizedContainerMixin">
<em class="property">class </em><code class="sig-prename descclassname">py2store.mixins.</code><code class="sig-name descname">IterBasedSizedContainerMixin</code><a class="reference internal" href="_modules/py2store/mixins.html#IterBasedSizedContainerMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.mixins.IterBasedSizedContainerMixin" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>An ABC that defines</dt><dd><ol class="loweralpha simple">
<li><p>how to iterate over a collection of elements (keys) (__iter__)</p></li>
<li><p>check that a key is contained in the collection (__contains__), and</p></li>
<li><p>how to get the number of elements in the collection</p></li>
</ol>
</dd>
</dl>
<p>This is exactly what the collections.abc.Collection (from which Keys inherits) does.
The difference here, besides the “Keys” purpose-explicit name, is that Keys offers default</p>
<blockquote>
<div><p>__len__ and __contains__  definitions based on what ever __iter__ the concrete class defines.</p>
</div></blockquote>
<p>Keys is a collection (i.e. a Sized (has __len__), Iterable (has __iter__), Container (has __contains__).
It’s purpose is to serve as a collection of object identifiers in a key-&gt;obj mapping.
The Keys class doesn’t implement __iter__ (so needs to be subclassed with a concrete class), but
offers mixin __len__ and __contains__ methods based on a given __iter__ method.
Note that usually __len__ and __contains__ should be overridden to more, context-dependent, efficient methods.</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.mixins.OverWritesNotAllowedMixin">
<em class="property">class </em><code class="sig-prename descclassname">py2store.mixins.</code><code class="sig-name descname">OverWritesNotAllowedMixin</code><a class="reference internal" href="_modules/py2store/mixins.html#OverWritesNotAllowedMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.mixins.OverWritesNotAllowedMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Mixin for only allowing a write to a key if they key doesn’t already exist.
Note: Should be before the persister in the MRO.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">TestPersister</span><span class="p">(</span><span class="n">OverWritesNotAllowedMixin</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">TestPersister</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#p[&#39;foo&#39;] = &#39;bar2&#39;  # will raise error</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;this value should not be stored&#39;</span> 
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="gr">py2store.errors.OverWritesNotAllowedError</span>: <span class="n">key foo already exists and cannot be overwritten.</span>
<span class="go">    If you really want to write to that key, delete it before writing</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span>  <span class="c1"># foo is still bar</span>
<span class="go">&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;this value WILL be stored&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span>
<span class="go">&#39;this value WILL be stored&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.mixins.ReadOnlyMixin">
<em class="property">class </em><code class="sig-prename descclassname">py2store.mixins.</code><code class="sig-name descname">ReadOnlyMixin</code><a class="reference internal" href="_modules/py2store/mixins.html#ReadOnlyMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.mixins.ReadOnlyMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Put this as your first parent class to disallow write/delete operations</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.mixins.SimpleJsonMixin">
<em class="property">class </em><code class="sig-prename descclassname">py2store.mixins.</code><code class="sig-name descname">SimpleJsonMixin</code><a class="reference internal" href="_modules/py2store/mixins.html#SimpleJsonMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.mixins.SimpleJsonMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>simple json serialization.
Useful to store and retrieve</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.mixins.StringKvWrap">
<em class="property">class </em><code class="sig-prename descclassname">py2store.mixins.</code><code class="sig-name descname">StringKvWrap</code><a class="reference internal" href="_modules/py2store/mixins.html#StringKvWrap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.mixins.StringKvWrap" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-py2store.test.util">
<span id="py2store-test-util"></span><h1>py2store.test.util<a class="headerlink" href="#module-py2store.test.util" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt id="py2store.test.util.random_dict_gen">
<code class="sig-prename descclassname">py2store.test.util.</code><code class="sig-name descname">random_dict_gen</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fields</span><span class="o">=</span><span class="default_value">('a', 'b', 'c')</span></em>, <em class="sig-param"><span class="n">word_size_range</span><span class="o">=</span><span class="default_value">(1, 10)</span></em>, <em class="sig-param"><span class="n">alphabet</span><span class="o">=</span><span class="default_value">'abcdefghijklmnopqrstuvwxyz'</span></em>, <em class="sig-param"><span class="n">n</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">100</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/test/util.html#random_dict_gen"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.test.util.random_dict_gen" title="Permalink to this definition">¶</a></dt>
<dd><p>Random dict (of strings) generator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fields</strong> – Field names for the random dicts</p></li>
<li><p><strong>word_size_range</strong> – An int, 2-tuple of ints, or list-like object that defines the choices of word sizes</p></li>
<li><p><strong>alphabet</strong> – A string or iterable defining the alphabet to draw from</p></li>
<li><p><strong>n</strong> – The number of elements the generator will yield</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Random dict (of strings) generator</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="py2store.test.util.random_formatted_str_gen">
<code class="sig-prename descclassname">py2store.test.util.</code><code class="sig-name descname">random_formatted_str_gen</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">format_string</span><span class="o">=</span><span class="default_value">'root/{}/{}_{}.test'</span></em>, <em class="sig-param"><span class="n">word_size_range</span><span class="o">=</span><span class="default_value">(1, 10)</span></em>, <em class="sig-param"><span class="n">alphabet</span><span class="o">=</span><span class="default_value">'abcdefghijklmnopqrstuvwxyz'</span></em>, <em class="sig-param"><span class="n">n</span><span class="o">=</span><span class="default_value">100</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/test/util.html#random_formatted_str_gen"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.test.util.random_formatted_str_gen" title="Permalink to this definition">¶</a></dt>
<dd><p>Random formatted string generator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>format_string</strong> – A format string</p></li>
<li><p><strong>word_size_range</strong> – An int, 2-tuple of ints, or list-like object that defines the choices of word sizes</p></li>
<li><p><strong>alphabet</strong> – A string or iterable defining the alphabet to draw from</p></li>
<li><p><strong>n</strong> – The number of elements the generator will yield</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Yields random strings of the format defined by format_string</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p># &gt;&gt;&gt; list(random_formatted_str_gen(‘root/{}/{}_{}.test’, (2, 5), ‘abc’, n=5))
[(‘root/acba/bb_abc.test’,),</p>
<blockquote>
<div><p>(‘root/abcb/cbbc_ca.test’,),
(‘root/ac/ac_cc.test’,),
(‘root/aacc/ccbb_ab.test’,),
(‘root/aab/abb_cbab.test’,)]</p>
</div></blockquote>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># The following will be made not random (by restricting the constraints to &quot;no choice&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># ... this is so that we get consistent outputs to assert for the doc test.</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Example with automatic specification</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">random_formatted_str_gen</span><span class="p">(</span><span class="s1">&#39;root/</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.test&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="go">[(&#39;root/aaa/aaa_aaa.test&#39;,), (&#39;root/aaa/aaa_aaa.test&#39;,)]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Example with manual specification</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">random_formatted_str_gen</span><span class="p">(</span><span class="s1">&#39;indexed field: </span><span class="si">{0}</span><span class="s1">: named field: </span><span class="si">{name}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="go">[(&#39;indexed field: zz: named field: zz&#39;,)]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.test.util.random_string">
<code class="sig-prename descclassname">py2store.test.util.</code><code class="sig-name descname">random_string</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">length</span><span class="o">=</span><span class="default_value">7</span></em>, <em class="sig-param"><span class="n">alphabet</span><span class="o">=</span><span class="default_value">'abcdefghijklmnopqrstuvwxyz'</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/test/util.html#random_string"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.test.util.random_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as random_word, but it optimized for strings
(5-10% faster for words of length 7, 25-30% faster for words of size 1000)</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.test.util.random_tuple_gen">
<code class="sig-prename descclassname">py2store.test.util.</code><code class="sig-name descname">random_tuple_gen</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">tuple_length</span><span class="o">=</span><span class="default_value">3</span></em>, <em class="sig-param"><span class="n">word_size_range</span><span class="o">=</span><span class="default_value">(1, 10)</span></em>, <em class="sig-param"><span class="n">alphabet</span><span class="o">=</span><span class="default_value">'abcdefghijklmnopqrstuvwxyz'</span></em>, <em class="sig-param"><span class="n">n</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">100</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/test/util.html#random_tuple_gen"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.test.util.random_tuple_gen" title="Permalink to this definition">¶</a></dt>
<dd><p>Random tuple (of strings) generator</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tuple_length</strong> – The length of the tuples generated</p></li>
<li><p><strong>word_size_range</strong> – An int, 2-tuple of ints, or list-like object that defines the choices of word sizes</p></li>
<li><p><strong>alphabet</strong> – A string or iterable defining the alphabet to draw from</p></li>
<li><p><strong>n</strong> – The number of elements the generator will yield</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Random tuple (of strings) generator</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="py2store.test.util.random_word">
<code class="sig-prename descclassname">py2store.test.util.</code><code class="sig-name descname">random_word</code><span class="sig-paren">(</span><em class="sig-param">length</em>, <em class="sig-param">alphabet</em>, <em class="sig-param">concat_func=&lt;built-in function add&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/test/util.html#random_word"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.test.util.random_word" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a random word by concatenating randomly drawn elements from alphabet together
:param length: Length of the word
:param alphabet: Alphabet to draw from
:param concat_func: The concatenation function (e.g. + for strings and lists)</p>
<p>Note: Repeated elements in alphabet will have more chances of being drawn.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A word (whose type depends on what concatenating elements from alphabet produces).</p>
</dd>
</dl>
<p>Not making this a proper doctest because I don’t know how to seed the global random temporarily
&gt;&gt;&gt; t = random_word(4, ‘abcde’);  # e.g. ‘acae’
&gt;&gt;&gt; t = random_word(5, [‘a’, ‘b’, ‘c’]);  # e.g. ‘cabba’
&gt;&gt;&gt; t = random_word(4, [[1, 2, 3], [40, 50], [600], [7000]]);  # e.g. [40, 50, 7000, 7000, 1, 2, 3]
&gt;&gt;&gt; t = random_word(4, [1, 2, 3, 4]);  # e.g. 13 (because adding numbers…)
&gt;&gt;&gt; # … sometimes it’s what you want:
&gt;&gt;&gt; t = random_word(4, [2 ** x for x in range(8)]);  # e.g. 105 (binary combination)
&gt;&gt;&gt; t = random_word(4, [1, 2, 3, 4], concat_func=lambda x, y: str(x) + str(y));  # e.g. ‘4213’
&gt;&gt;&gt; t = random_word(4, [1, 2, 3, 4], concat_func=lambda x, y: int(str(x) + str(y)));  # e.g. 3432</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.test.util.random_word_gen">
<code class="sig-prename descclassname">py2store.test.util.</code><code class="sig-name descname">random_word_gen</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">word_size_range</span><span class="o">=</span><span class="default_value">(1, 10)</span></em>, <em class="sig-param"><span class="n">alphabet</span><span class="o">=</span><span class="default_value">'abcdefghijklmnopqrstuvwxyz'</span></em>, <em class="sig-param"><span class="n">n</span><span class="o">=</span><span class="default_value">100</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/test/util.html#random_word_gen"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.test.util.random_word_gen" title="Permalink to this definition">¶</a></dt>
<dd><p>Random string generator
:param word_size_range: An int, 2-tuple of ints, or list-like object that defines the choices of word sizes
:param alphabet: A string or iterable defining the alphabet to draw from
:param n: The number of elements the generator will yield</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Random string generator</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="py2store-test-quick">
<h1>py2store.test.quick<a class="headerlink" href="#py2store-test-quick" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.test">
<span id="py2store-test"></span><h1>py2store.test<a class="headerlink" href="#module-py2store.test" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="py2store-test-simple">
<h1>py2store.test.simple<a class="headerlink" href="#py2store-test-simple" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="py2store-test-scrap">
<h1>py2store.test.scrap<a class="headerlink" href="#py2store-test-scrap" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.util">
<span id="py2store-util"></span><h1>py2store.util<a class="headerlink" href="#module-py2store.util" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt id="py2store.util.add_attrs">
<code class="sig-prename descclassname">py2store.util.</code><code class="sig-name descname">add_attrs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">remember_added_attrs</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">if_attr_exists</span><span class="o">=</span><span class="default_value">'raise'</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">attrs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/util.html#add_attrs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.util.add_attrs" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a function that will add attributes to an obj.
Originally meant to be used as a decorator of a function, to inject
&gt;&gt;&gt; from py2store.util import add_attrs
&gt;&gt;&gt; &#64;add_attrs(bar=’bituate’, hello=’world’)
… def foo():
…     pass
&gt;&gt;&gt; [x for x in dir(foo) if not x.startswith(‘_’)]
[‘bar’, ‘hello’]
&gt;&gt;&gt; foo.bar
‘bituate’
&gt;&gt;&gt; foo.hello
‘world’
&gt;&gt;&gt; foo._added_attrs  # Another attr was added to hold the list of attributes added (in case we need to remove them
[‘bar’, ‘hello’]</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.util.copy_attrs">
<code class="sig-prename descclassname">py2store.util.</code><code class="sig-name descname">copy_attrs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">target</span></em>, <em class="sig-param"><span class="n">source</span></em>, <em class="sig-param"><span class="n">attrs</span></em>, <em class="sig-param"><span class="n">raise_error_if_an_attr_is_missing</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/util.html#copy_attrs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.util.copy_attrs" title="Permalink to this definition">¶</a></dt>
<dd><p>Copy attributes from one object to another.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">B</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">... </span>    <span class="n">yy</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">... </span>    <span class="n">zzz</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dict_of</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dict_of</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="go">{&#39;x&#39;: 0}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">copy_attrs</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="s1">&#39;yy&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dict_of</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="go">{&#39;x&#39;: 0, &#39;yy&#39;: 2}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">copy_attrs</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;zzz&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dict_of</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="go">{&#39;x&#39;: 1, &#39;yy&#39;: 2, &#39;zzz&#39;: 3}</span>
</pre></div>
</div>
<p>But if you try to copy something that <cite>B</cite> (the source) doesn’t have, copy_attrs will complain:
&gt;&gt;&gt; copy_attrs(A, B, ‘this_is_not_an_attr’)
Traceback (most recent call last):</p>
<blockquote>
<div><p>…</p>
</div></blockquote>
<p>AttributeError: type object ‘B’ has no attribute ‘this_is_not_an_attr’</p>
<p>If you tell it not to complain, it’ll just ignore attributes that are not in source.
&gt;&gt;&gt; copy_attrs(A, B, [‘nothing’, ‘here’, ‘exists’], raise_error_if_an_attr_is_missing=False)
&gt;&gt;&gt; dict_of(A)
{‘x’: 1, ‘yy’: 2, ‘zzz’: 3}</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.util.fill_with_dflts">
<code class="sig-prename descclassname">py2store.util.</code><code class="sig-name descname">fill_with_dflts</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">d</span></em>, <em class="sig-param"><span class="n">dflt_dict</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/util.html#fill_with_dflts"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.util.fill_with_dflts" title="Permalink to this definition">¶</a></dt>
<dd><p>Fed up with multiline handling of dict arguments?
Fed up of repeating the if d is None: d = {} lines ad nauseam (because defaults can’t be dicts as a default
because dicts are mutable blah blah, and the python kings don’t seem to think a mutable dict is useful enough)?
Well, my favorite solution would be a built-in handling of the problem of complex/smart defaults,
that is visible in the code and in the docs. But for now, here’s one of the tricks I use.</p>
<p>Main use is to handle defaults of function arguments. Say you have a function <cite>func(d=None)</cite> and you want
<cite>d</cite> to be a dict that has at least the keys <cite>foo</cite> and <cite>bar</cite> with default values 7 and 42 respectively.
Then, in the beginning of your function code you’ll say:</p>
<blockquote>
<div><p>d = fill_with_dflts(d, {‘a’: 7, ‘b’: 42})</p>
</div></blockquote>
<p>See examples to know how to use it.</p>
<p>ATTENTION: A shallow copy of the dict is made. Know how that affects you (or not).
ATTENTION: This is not recursive: It won’t be filling any nested fields with defaults.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>d</strong> – The dict you want to “fill”</p></li>
<li><p><strong>dflt_dict</strong> – What to fill it with (a {k: v, …} dict where if k is missing in d, you’ll get a new field k, with
value v.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>val entries (if the key was missing in d).</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>a dict with the new key</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fill_with_dflts</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="go">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fill_with_dflts</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">})</span>
<span class="go">{&#39;a&#39;: 7, &#39;b&#39;: 42}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fill_with_dflts</span><span class="p">({},</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">})</span>
<span class="go">{&#39;a&#39;: 7, &#39;b&#39;: 42}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fill_with_dflts</span><span class="p">({</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">})</span>
<span class="go">{&#39;a&#39;: 7, &#39;b&#39;: 1000}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.util.format_invocation">
<code class="sig-prename descclassname">py2store.util.</code><code class="sig-name descname">format_invocation</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">args</span><span class="o">=</span><span class="default_value">()</span></em>, <em class="sig-param"><span class="n">kwargs</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/util.html#format_invocation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.util.format_invocation" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a name, positional arguments, and keyword arguments, format
a basic Python-style function call.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">format_invocation</span><span class="p">(</span><span class="s1">&#39;func&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}))</span>
<span class="go">func(1, 2, c=3)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">format_invocation</span><span class="p">(</span><span class="s1">&#39;a_func&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,)))</span>
<span class="go">a_func(1)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">format_invocation</span><span class="p">(</span><span class="s1">&#39;kw_func&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]))</span>
<span class="go">kw_func(a=1, b=2)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.util.groupby">
<code class="sig-prename descclassname">py2store.util.</code><code class="sig-name descname">groupby</code><span class="sig-paren">(</span><em class="sig-param">items: Iterable[Any], key: Callable[[Any], Hashable], val: Optional[Callable[[Any], Any]] = None, group_factory=&lt;class 'list'&gt;</em><span class="sig-paren">)</span> &#x2192; dict<a class="reference internal" href="_modules/py2store/util.html#groupby"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.util.groupby" title="Permalink to this definition">¶</a></dt>
<dd><p>Groups items according to group keys updated from those items through the given (<a href="#id101"><span class="problematic" id="id102">item_to_</span></a>)key function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>items</strong> – iterable of items</p></li>
<li><p><strong>key</strong> – The function that computes a key from an item. Needs to return a hashable.</p></li>
<li><p><strong>val</strong> – An optional function that computes a val from an item. If not given, the item itself will be taken.</p></li>
<li><p><strong>group_factory</strong> – The function to make new (empty) group objects and accumulate group items.
group_items = group_collector() will be called to make a new empty group collection
group_items.append(x) will be called to add x to that collection
The default is <cite>list</cite></p></li>
</ul>
</dd>
</dl>
<p>Returns: A dict of {group_key: items_in_that_group, …}</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">groupby</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">{0: [0, 3, 6, 9], 1: [1, 4, 7, 10], 2: [2, 5, 8]}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;fox&#39;</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;box&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">groupby</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="nb">len</span><span class="p">)</span>
<span class="go">{3: [&#39;the&#39;, &#39;fox&#39;, &#39;box&#39;], 2: [&#39;is&#39;, &#39;in&#39;], 1: [&#39;a&#39;]}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">key_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;two&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">groupby</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">key_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;more&#39;</span><span class="p">))</span>
<span class="go">{&#39;more&#39;: [&#39;the&#39;, &#39;fox&#39;, &#39;box&#39;], &#39;two&#39;: [&#39;is&#39;, &#39;in&#39;], &#39;one&#39;: [&#39;a&#39;]}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stopwords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;on&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">groupby</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">stopwords</span><span class="p">)</span>
<span class="go">{True: [&#39;the&#39;, &#39;in&#39;, &#39;a&#39;], False: [&#39;fox&#39;, &#39;is&#39;, &#39;box&#39;]}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">groupby</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;words&#39;</span><span class="p">,</span> <span class="s1">&#39;stopwords&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">w</span> <span class="ow">in</span> <span class="n">stopwords</span><span class="p">)])</span>
<span class="go">{&#39;stopwords&#39;: [&#39;the&#39;, &#39;in&#39;, &#39;a&#39;], &#39;words&#39;: [&#39;fox&#39;, &#39;is&#39;, &#39;box&#39;]}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.util.igroupby">
<code class="sig-prename descclassname">py2store.util.</code><code class="sig-name descname">igroupby</code><span class="sig-paren">(</span><em class="sig-param">items: Iterable[Any], key: Callable[[Any], Hashable], val: Optional[Callable[[Any], Any]] = None, group_factory: Callable[[], Iterable[Any]] = &lt;class 'list'&gt;, group_release_cond: Callable[[Any, Any], bool] = &lt;function &lt;lambda&gt;&gt;, release_remainding=True, append_to_group_items: Callable[[Iterable[Any], Any], Any] = &lt;method 'append' of 'list' objects&gt;</em><span class="sig-paren">)</span> &#x2192; dict<a class="reference internal" href="_modules/py2store/util.html#igroupby"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.util.igroupby" title="Permalink to this definition">¶</a></dt>
<dd><p>The generator version of py2store groupby.
Groups items according to group keys updated from those items through the given (<a href="#id103"><span class="problematic" id="id104">item_to_</span></a>)key function,
yielding the groups according to a logic defined by <code class="docutils literal notranslate"><span class="pre">group_release_cond</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>items</strong> – iterable of items</p></li>
<li><p><strong>key</strong> – The function that computes a key from an item. Needs to return a hashable.</p></li>
<li><p><strong>val</strong> – An optional function that computes a val from an item. If not given, the item itself will be taken.</p></li>
<li><p><strong>group_factory</strong> – The function to make new (empty) group objects and accumulate group items.
group_items = group_collector() will be called to make a new empty group collection
group_items.append(x) will be called to add x to that collection
The default is <cite>list</cite></p></li>
<li><p><strong>group_release_cond</strong> – A boolean function that will be applied, at every iteration,
to the accumulated items of the group that was just updated,
and determines (if True) if the (group_key, group_items) should be yielded.
The default is False, which results in
<code class="docutils literal notranslate"><span class="pre">lambda</span> <span class="pre">group_key,</span> <span class="pre">group_items:</span> <span class="pre">False</span></code> being used.</p></li>
<li><p><strong>release_remainding</strong> – Once the input items have been consumed, there may still be some
items in the grouping “cache”. <code class="docutils literal notranslate"><span class="pre">release_remainding</span></code> is a boolean that indicates whether
the contents of this cache should be released or not.</p></li>
</ul>
</dd>
</dl>
<p>Yields: <code class="docutils literal notranslate"><span class="pre">(group_key,</span> <span class="pre">items_in_that_group)</span></code> pairs</p>
<p>The following will group numbers according to their parity (0 for even, 1 for odd),
releasing a list of numbers collected when that list reaches length 3:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">igroupby</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">group_release_cond</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="go">[(0, [0, 2, 4]), (1, [1, 3, 5]), (0, [6, 8, 10]), (1, [7, 9])]</span>
</pre></div>
</div>
<p>If we specify <code class="docutils literal notranslate"><span class="pre">release_remainding=False</span></code> though, we won’t get
&gt;&gt;&gt; g = igroupby(items=range(11),
…             key=lambda x: x % 2,
…             group_release_cond=lambda k, v: len(v) == 3,
…             release_remainding=False)
&gt;&gt;&gt; list(g)
[(0, [0, 2, 4]), (1, [1, 3, 5]), (0, [6, 8, 10])]</p>
<p># &gt;&gt;&gt; grps = partial(igroupby, group_release_cond=False, release_remainding=True)</p>
<p>Below we show that, with the default <code class="docutils literal notranslate"><span class="pre">group_release_cond</span> <span class="pre">=</span> <span class="pre">lambda</span> <span class="pre">k,</span> <span class="pre">v:</span> <span class="pre">False</span></code>
and release_remainding=True`` we have <code class="docutils literal notranslate"><span class="pre">dict(igroupby(...))</span> <span class="pre">==</span> <span class="pre">groupby(...)</span></code></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store</span> <span class="kn">import</span> <span class="n">groupby</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kws</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">igroupby</span><span class="p">(</span><span class="o">**</span><span class="n">kws</span><span class="p">))</span> <span class="o">==</span> <span class="n">groupby</span><span class="p">(</span><span class="o">**</span><span class="n">kws</span><span class="p">)</span>
<span class="gp">... </span>        <span class="o">==</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">]})</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;fox&#39;</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;box&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kws</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="n">tokens</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">igroupby</span><span class="p">(</span><span class="o">**</span><span class="n">kws</span><span class="p">))</span> <span class="o">==</span> <span class="n">groupby</span><span class="p">(</span><span class="o">**</span><span class="n">kws</span><span class="p">)</span>
<span class="gp">... </span>        <span class="o">==</span> <span class="p">{</span><span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;fox&#39;</span><span class="p">,</span> <span class="s1">&#39;box&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]})</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">key_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;two&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kws</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">key_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;more&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">igroupby</span><span class="p">(</span><span class="o">**</span><span class="n">kws</span><span class="p">))</span> <span class="o">==</span> <span class="n">groupby</span><span class="p">(</span><span class="o">**</span><span class="n">kws</span><span class="p">)</span>
<span class="gp">... </span>        <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;more&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;fox&#39;</span><span class="p">,</span> <span class="s1">&#39;box&#39;</span><span class="p">],</span> <span class="s1">&#39;two&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">],</span> <span class="s1">&#39;one&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]})</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stopwords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;on&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kws</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">stopwords</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">igroupby</span><span class="p">(</span><span class="o">**</span><span class="n">kws</span><span class="p">))</span> <span class="o">==</span> <span class="n">groupby</span><span class="p">(</span><span class="o">**</span><span class="n">kws</span><span class="p">)</span>
<span class="gp">... </span>        <span class="o">==</span> <span class="p">{</span><span class="kc">True</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;fox&#39;</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="s1">&#39;box&#39;</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kws</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;words&#39;</span><span class="p">,</span> <span class="s1">&#39;stopwords&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">w</span> <span class="ow">in</span> <span class="n">stopwords</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">igroupby</span><span class="p">(</span><span class="o">**</span><span class="n">kws</span><span class="p">))</span> <span class="o">==</span> <span class="n">groupby</span><span class="p">(</span><span class="o">**</span><span class="n">kws</span><span class="p">)</span>
<span class="gp">... </span>        <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;stopwords&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">],</span> <span class="s1">&#39;words&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;fox&#39;</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="s1">&#39;box&#39;</span><span class="p">]})</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.util.imdict">
<em class="property">class </em><code class="sig-prename descclassname">py2store.util.</code><code class="sig-name descname">imdict</code><a class="reference internal" href="_modules/py2store/util.html#imdict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.util.imdict" title="Permalink to this definition">¶</a></dt>
<dd><p>A frozen hashable dict</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.util.lazyprop">
<em class="property">class </em><code class="sig-prename descclassname">py2store.util.</code><code class="sig-name descname">lazyprop</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/util.html#lazyprop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.util.lazyprop" title="Permalink to this definition">¶</a></dt>
<dd><p>A descriptor implementation of lazyprop (cached property).
Made based on David Beazley’s “Python Cookbook” book and enhanced with boltons.cacheutils ideas.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Test</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
<span class="gp">... </span>    <span class="nd">@lazyprop</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;generating &quot;len&quot;&#39;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">Test</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="vm">__dict__</span>
<span class="go">{&#39;a&#39;: [0, 1, 2, 3, 4]}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">len</span>
<span class="go">generating &quot;len&quot;</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="vm">__dict__</span>
<span class="go">{&#39;a&#39;: [0, 1, 2, 3, 4], &#39;len&#39;: 5}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">len</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># But careful when using lazyprop that no one will change the value of a without deleting the property first</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># if we change a...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">len</span>  <span class="c1"># ... we still get the old cached value of len</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">t</span><span class="o">.</span><span class="n">len</span>  <span class="c1"># if we delete the len prop</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">len</span>  <span class="c1"># ... then len being recomputed again</span>
<span class="go">generating &quot;len&quot;</span>
<span class="go">3</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.util.lazyprop_w_sentinel">
<em class="property">class </em><code class="sig-prename descclassname">py2store.util.</code><code class="sig-name descname">lazyprop_w_sentinel</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/util.html#lazyprop_w_sentinel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.util.lazyprop_w_sentinel" title="Permalink to this definition">¶</a></dt>
<dd><p>A descriptor implementation of lazyprop (cached property).
Inserts a <cite>self.func.__name__ + ‘__cache_active’</cite> attribute</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Test</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
<span class="gp">... </span>    <span class="nd">@lazyprop_w_sentinel</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;generating &quot;len&quot;&#39;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">Test</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lazyprop_w_sentinel</span><span class="o">.</span><span class="n">cache_is_active</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s1">&#39;len&#39;</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="vm">__dict__</span>  <span class="c1"># let&#39;s look under the hood</span>
<span class="go">{&#39;a&#39;: [0, 1, 2, 3, 4]}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">len</span>
<span class="go">generating &quot;len&quot;</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lazyprop_w_sentinel</span><span class="o">.</span><span class="n">cache_is_active</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s1">&#39;len&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">len</span>  <span class="c1"># notice there&#39;s no &#39;generating &quot;len&quot;&#39; print this time!</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="vm">__dict__</span>  <span class="c1"># let&#39;s look under the hood</span>
<span class="go">{&#39;a&#39;: [0, 1, 2, 3, 4], &#39;len&#39;: 5, &#39;sentinel_of__len&#39;: True}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># But careful when using lazyprop that no one will change the value of a without deleting the property first</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># if we change a...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">len</span>  <span class="c1"># ... we still get the old cached value of len</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">t</span><span class="o">.</span><span class="n">len</span>  <span class="c1"># if we delete the len prop</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">len</span>  <span class="c1"># ... then len being recomputed again</span>
<span class="go">generating &quot;len&quot;</span>
<span class="go">3</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.util.max_common_prefix">
<code class="sig-prename descclassname">py2store.util.</code><code class="sig-name descname">max_common_prefix</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">a</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/util.html#max_common_prefix"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.util.max_common_prefix" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a list of strings (or other sliceable sequences), returns the longest common prefix
:param a: list-like of strings
:return: the smallest common prefix of all strings in a</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.util.norm_kv_filt">
<code class="sig-prename descclassname">py2store.util.</code><code class="sig-name descname">norm_kv_filt</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">kv_filt</span><span class="p">:</span> <span class="n">Callable<span class="p">[</span><span class="p">[</span>Any<span class="p">]</span><span class="p">, </span>bool<span class="p">]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/util.html#norm_kv_filt"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.util.norm_kv_filt" title="Permalink to this definition">¶</a></dt>
<dd><p>Prepare a boolean function to be used with <cite>filter</cite> when fed an iterable of (k, v) pairs.</p>
<p>So you have a mapping. Say a dict <cite>d</cite>. Now you want to go through d.items(),
filtering based on the keys, or the values, or both.</p>
<p>It’s not hard to do, really. If you’re using a dict you might use a dict comprehension,
or in the general case you might do a <cite>filter(lambda kv: my_filt(kv[0], kv[1]), d.items())</cite>
if you have a <cite>my_filt</cite> that works wiith k and v, etc.</p>
<p>But thought simple, it can become a bit muddled.
<cite>norm_kv_filt</cite> simplifies this by allowing you to bring your own filtering boolean function,
whether it’s a key-based, value-based, or key-value-based one, and it will make a
ready-to-use with <cite>filter</cite> function for you.</p>
<p>Only thing: Your function needs to call a key <cite>k</cite> and a value <cite>v</cite>.
But hey, it’s alright, if you have a function that calls things differently, just do
something like
<a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a></p>
<blockquote>
<div><p>new_filt_func = lambda k, v: your_filt_func(…, key=k, …, value=v, …)</p>
</div></blockquote>
<p><a href="#id5"><span class="problematic" id="id6">``</span></a>`
and all will be fine.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>kv_filt</strong> – callable (starting with signature (k), (v), or (k, v)), and returning  a boolean</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A normalized callable.</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">norm_kv_filt</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">}),</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<span class="go">[(&#39;b&#39;, 2), (&#39;d&#39;, 4)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">norm_kv_filt</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">),</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<span class="go">[(&#39;c&#39;, 3), (&#39;d&#39;, 4)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">norm_kv_filt</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="p">(</span><span class="n">v</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;c&#39;</span><span class="p">)),</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<span class="go">[(&#39;b&#39;, 2), (&#39;d&#39;, 4)]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.util.partialclass">
<code class="sig-prename descclassname">py2store.util.</code><code class="sig-name descname">partialclass</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">cls</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/util.html#partialclass"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.util.partialclass" title="Permalink to this definition">¶</a></dt>
<dd><p>What partial(cls, <a href="#id7"><span class="problematic" id="id8">*</span></a>args, <a href="#id9"><span class="problematic" id="id10">**</span></a>kwargs) does, but returning a class instead of an object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cls</strong> – Class to get the partial of</p></li>
<li><p><strong>kwargs</strong> – The kwargs to fix</p></li>
</ul>
</dd>
</dl>
<p>The raison d’être of partialclass is that it returns a type, so let’s have a look at that with
a useless class.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="o">==</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">partialclass</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="nb">type</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">mysum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(a=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="si">}</span><span class="s2">, b=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="si">}</span><span class="s2">)&quot;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="o">==</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">partialclass</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="nb">type</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">A</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;(a=0, b=1)&#39;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">a</span><span class="o">.</span><span class="n">mysum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;A(a=0, b=1)&#39;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">A</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">mysum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">11</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">A</span><span class="p">())</span> <span class="o">==</span> <span class="s1">&#39;A(a=0, b=1)&#39;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">AA</span> <span class="o">=</span> <span class="n">partialclass</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">AA</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;(a=0, *, b=2)&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aa</span> <span class="o">=</span> <span class="n">AA</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">aa</span><span class="o">.</span><span class="n">mysum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;A(a=0, b=2)&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">AA</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">mysum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">AA</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;A(a=3, b=2)&#39;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">AA</span> <span class="o">=</span> <span class="n">partialclass</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">AA</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;(*, a=7, b=1)&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">AA</span><span class="p">()</span><span class="o">.</span><span class="n">mysum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">AA</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;A(a=3, b=1)&#39;</span>
</pre></div>
</div>
<p>Note in the last partial that since <code class="docutils literal notranslate"><span class="pre">a</span></code> was fixed, you need to specify the keyword <code class="docutils literal notranslate"><span class="pre">AA(a=3)</span></code>.
<code class="docutils literal notranslate"><span class="pre">AA(3)</span></code> won’t work:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">AA</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">__init__() got multiple values for argument &#39;a&#39;</span>
</pre></div>
</div>
<p>On the other hand, you can use <a href="#id11"><span class="problematic" id="id12">*</span></a>args to specify the fixtures:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">AA</span> <span class="o">=</span> <span class="n">partialclass</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">AA</span><span class="p">())</span> <span class="o">==</span> <span class="s1">&#39;A(a=22, b=1)&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">AA</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;(b=1)&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">AA</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;A(a=22, b=3)&#39;</span>
</pre></div>
</div>
<p><a href="#id13"><span class="problematic" id="id14">``</span></a><a href="#id15"><span class="problematic" id="id16">`</span></a></p>
</dd></dl>

<dl class="py function">
<dt id="py2store.util.regroupby">
<code class="sig-prename descclassname">py2store.util.</code><code class="sig-name descname">regroupby</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">items</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">key_funcs</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">named_key_funcs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/util.html#regroupby"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.util.regroupby" title="Permalink to this definition">¶</a></dt>
<dd><p>REcursive groupby. Applies the groupby function recursively, using a sequence of key functions.</p>
<dl class="simple">
<dt>Note: The named_key_funcs argument names don’t have any external effect.</dt><dd><p>They just give a name to the key function, for code reading clarity purposes.</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># group by how big the number is, then by it&#39;s mod 3 value</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># note that named_key_funcs argument names doesn&#39;t have any external effect (but give a name to the function)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">regroupby</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;big&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="k">else</span> <span class="s1">&#39;small&#39;</span><span class="p">,</span> <span class="n">mod3</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">{&#39;small&#39;: {1: [1, 4], 2: [2, 5], 0: [3]}, &#39;big&#39;: {0: [6], 1: [7]}}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;fox&#39;</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;box&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stopwords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;on&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">word_category</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;stopwords&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">stopwords</span> <span class="k">else</span> <span class="s1">&#39;words&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">regroupby</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="n">word_category</span><span class="p">,</span> <span class="nb">len</span><span class="p">)</span>
<span class="go">{&#39;stopwords&#39;: {3: [&#39;the&#39;], 2: [&#39;in&#39;], 1: [&#39;a&#39;]}, &#39;words&#39;: {3: [&#39;fox&#39;, &#39;box&#39;], 2: [&#39;is&#39;]}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">regroupby</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="n">word_category</span><span class="p">)</span>
<span class="go">{3: {&#39;stopwords&#39;: [&#39;the&#39;], &#39;words&#39;: [&#39;fox&#39;, &#39;box&#39;]}, 2: {&#39;words&#39;: [&#39;is&#39;], &#39;stopwords&#39;: [&#39;in&#39;]}, 1: {&#39;stopwords&#39;: [&#39;a&#39;]}}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.util.str_to_var_str">
<code class="sig-prename descclassname">py2store.util.</code><code class="sig-name descname">str_to_var_str</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">s</span><span class="p">:</span> <span class="n">str</span></em><span class="sig-paren">)</span> &#x2192; str<a class="reference internal" href="_modules/py2store/util.html#str_to_var_str"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.util.str_to_var_str" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a valid python variable string from the input string.
Left untouched if already valid.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">str_to_var_str</span><span class="p">(</span><span class="s1">&#39;this_is_a_valid_var_name&#39;</span><span class="p">)</span>
<span class="go">&#39;this_is_a_valid_var_name&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">str_to_var_str</span><span class="p">(</span><span class="s1">&#39;not valid  #)*(&amp;434&#39;</span><span class="p">)</span>
<span class="go">&#39;not_valid_______434&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">str_to_var_str</span><span class="p">(</span><span class="s1">&#39;99_ballons&#39;</span><span class="p">)</span>
<span class="go">&#39;_99_ballons&#39;</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="py2store-ext-docx">
<h1>py2store.ext.docx<a class="headerlink" href="#py2store-ext-docx" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.ext.gitlab">
<span id="py2store-ext-gitlab"></span><h1>py2store.ext.gitlab<a class="headerlink" href="#module-py2store.ext.gitlab" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.ext.gitlab.GitlabProjectReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.ext.gitlab.</code><code class="sig-name descname">GitlabProjectReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">base_url</span></em>, <em class="sig-param"><span class="n">private_token</span><span class="o">=</span><span class="default_value">'2hpCjzrdxwSJrnfaS1s-'</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/ext/gitlab.html#GitlabProjectReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.ext.gitlab.GitlabProjectReader" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="py2store-ext-hdf">
<h1>py2store.ext.hdf<a class="headerlink" href="#py2store-ext-hdf" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.ext">
<span id="py2store-ext"></span><h1>py2store.ext<a class="headerlink" href="#module-py2store.ext" title="Permalink to this headline">¶</a></h1>
<p>py2store Extensions, Add-ons, etc.
We kept py2store purely dependency-less, using only built-ins for everything but storage system connectors.</p>
<p>That said, in order to provide the user with more power, and show him/her how py2store tools can be used to build
powerful data accessors, we provide specialized modules that do require more than builtins. These dependencies are
not listed in the setup.py module, but we wrap their imports with informative ImportError handlers.</p>
</div>
<div class="section" id="py2store-ext-matlab">
<h1>py2store.ext.matlab<a class="headerlink" href="#py2store-ext-matlab" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.ext.kaggle">
<span id="py2store-ext-kaggle"></span><h1>py2store.ext.kaggle<a class="headerlink" href="#module-py2store.ext.kaggle" title="Permalink to this headline">¶</a></h1>
<p>Moved to otosense/haggle
Made pip installable.</p>
</div>
<div class="section" id="py2store-ext-module-imports">
<h1>py2store.ext.module_imports<a class="headerlink" href="#py2store-ext-module-imports" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.ext.audio">
<span id="py2store-ext-audio"></span><h1>py2store.ext.audio<a class="headerlink" href="#module-py2store.ext.audio" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.ext.audio.PcmSourceSessionBlockStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.ext.audio.</code><code class="sig-name descname">PcmSourceSessionBlockStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path_format</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/ext/audio.html#PcmSourceSessionBlockStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.ext.audio.PcmSourceSessionBlockStore" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py exception">
<dt id="py2store.ext.audio.SampleRateAssertionError">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.ext.audio.</code><code class="sig-name descname">SampleRateAssertionError</code><a class="reference internal" href="_modules/py2store/ext/audio.html#SampleRateAssertionError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.ext.audio.SampleRateAssertionError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.ext.audio.WavLocalFileStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.ext.audio.</code><code class="sig-name descname">WavLocalFileStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path_format</span></em>, <em class="sig-param"><span class="n">assert_sr</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">dtype</span><span class="o">=</span><span class="default_value">'int16'</span></em>, <em class="sig-param"><span class="n">format</span><span class="o">=</span><span class="default_value">'WAV'</span></em>, <em class="sig-param"><span class="n">subtype</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">endian</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/ext/audio.html#WavLocalFileStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.ext.audio.WavLocalFileStore" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="py2store.ext.audio.WavLocalFileStore2">
<code class="sig-prename descclassname">py2store.ext.audio.</code><code class="sig-name descname">WavLocalFileStore2</code><a class="headerlink" href="#py2store.ext.audio.WavLocalFileStore2" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#py2store.ext.audio.WavLocalFileStore" title="py2store.ext.audio.WavLocalFileStore"><code class="xref py py-class docutils literal notranslate"><span class="pre">py2store.ext.audio.WavLocalFileStore</span></code></a></p>
</dd></dl>

</div>
<div class="section" id="py2store-ext-github">
<h1>py2store.ext.github<a class="headerlink" href="#py2store-ext-github" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.ext.dataframes">
<span id="py2store-ext-dataframes"></span><h1>py2store.ext.dataframes<a class="headerlink" href="#module-py2store.ext.dataframes" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.ext.dataframes.DfReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.ext.dataframes.</code><code class="sig-name descname">DfReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path_format</span></em>, <em class="sig-param"><span class="n">ext_specs</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/ext/dataframes.html#DfReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.ext.dataframes.DfReader" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-py2store.access">
<span id="py2store-access"></span><h1>py2store.access<a class="headerlink" href="#module-py2store.access" title="Permalink to this headline">¶</a></h1>
<p>Utils to load stores from store specifications.
Includes the logic to allow configurations (and defaults) to be parametrized by external environmental
variables and files.</p>
<p>Every data-sourced problem has it’s problem-relevant stores. Once you get your stores right, along with the
right access credentials, indexing, serialization, caching, filtering etc. you’d like to be able to name, save
and/or share this specification, and easily get access to it later on.</p>
<p>Here are tools to help you out.</p>
<p>There are two main key-value stores: One for configurations the user wants to reuse, and the other for the user’s
desired defaults. Both have the same structure:</p>
<blockquote>
<div><ul class="simple">
<li><p>first level key: Name of the resource (should be a valid python variable name)</p></li>
<li><p>The reminder is more or less free form (until the day we lay out some schemas for this)</p></li>
</ul>
</div></blockquote>
<p>The system will look for the specification of user_configs and user_defaults in a json file.
The filepath to this json file can specified in environment variables</p>
<blockquote>
<div><p>PY2STORE_CONFIGS_JSON_FILEPATH and PY2STORE_DEFAULTS_JSON_FILEPATH</p>
</div></blockquote>
<p>respectively.
By default, they are:</p>
<blockquote>
<div><p>~/.py2store_configs.json and ~/.py2store_defaults.json</p>
</div></blockquote>
<p>respectively.</p>
<dl class="py class">
<dt id="py2store.access.MyConfigs">
<em class="property">class </em><code class="sig-prename descclassname">py2store.access.</code><code class="sig-name descname">MyConfigs</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/access.html#MyConfigs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.access.MyConfigs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.access.MyStores">
<em class="property">class </em><code class="sig-prename descclassname">py2store.access.</code><code class="sig-name descname">MyStores</code><span class="sig-paren">(</span><em class="sig-param">store=&lt;class 'dict'&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/access.html#MyStores"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.access.MyStores" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt id="py2store.access.MyStores.func_loader">
<em class="property">static </em><code class="sig-name descname">func_loader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">f</span></em><span class="sig-paren">)</span> &#x2192; callable<a class="headerlink" href="#py2store.access.MyStores.func_loader" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads and returns the function referenced by f,
which could be a callable or a DOTPATH_TO_MODULE.FUNC_NAME dotpath string to one, or a pipeline of these</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="py2store.access.compose">
<code class="sig-prename descclassname">py2store.access.</code><code class="sig-name descname">compose</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">functions</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/access.html#compose"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.access.compose" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a function that is the composition of the input functions</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.access.dflt_func_loader">
<code class="sig-prename descclassname">py2store.access.</code><code class="sig-name descname">dflt_func_loader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">f</span></em><span class="sig-paren">)</span> &#x2192; callable<a class="reference internal" href="_modules/py2store/access.html#dflt_func_loader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.access.dflt_func_loader" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads and returns the function referenced by f,
which could be a callable or a DOTPATH_TO_MODULE.FUNC_NAME dotpath string to one, or a pipeline of these</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.access.dotpath_to_func">
<code class="sig-prename descclassname">py2store.access.</code><code class="sig-name descname">dotpath_to_func</code><span class="sig-paren">(</span><em class="sig-param">f: (&lt;class 'str'&gt;</em>, <em class="sig-param">&lt;built-in function callable&gt;)</em><span class="sig-paren">)</span> &#x2192; callable<a class="reference internal" href="_modules/py2store/access.html#dotpath_to_func"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.access.dotpath_to_func" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads and returns the function referenced by f,
which could be a callable or a DOTPATH_TO_MODULE.FUNC_NAME dotpath string to one.</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.access.dotpath_to_obj">
<code class="sig-prename descclassname">py2store.access.</code><code class="sig-name descname">dotpath_to_obj</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dotpath</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/access.html#dotpath_to_obj"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.access.dotpath_to_obj" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads and returns the object referenced by the string DOTPATH_TO_MODULE.OBJ_NAME</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.access.fakit">
<code class="sig-prename descclassname">py2store.access.</code><code class="sig-name descname">fakit</code><span class="sig-paren">(</span><em class="sig-param">fak</em>, <em class="sig-param">func_loader=&lt;function dflt_func_loader&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/access.html#fakit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.access.fakit" title="Permalink to this definition">¶</a></dt>
<dd><p>Execute a fak with given f, a, k and function loader.</p>
<p>Essentially returns func_loader(f)(<a href="#id17"><span class="problematic" id="id18">*</span></a>a, <a href="#id19"><span class="problematic" id="id20">**</span></a>k)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fak</strong> – A (f, a, k) specification. Could be a tuple or a dict (with ‘f’, ‘a’, ‘k’ keys). All but f are optional.</p></li>
<li><p><strong>func_loader</strong> – A function returning a function. This is where you specify any validation of func specification f,
and/or how to get a callable from it.</p></li>
</ul>
</dd>
</dl>
<p>Returns: A python object.</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.access.getenv">
<code class="sig-prename descclassname">py2store.access.</code><code class="sig-name descname">getenv</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">default</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/access.html#getenv"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.access.getenv" title="Permalink to this definition">¶</a></dt>
<dd><p>Like os.getenv, but removes a suffix r character if present (problem with some env var systems)</p>
</dd></dl>

</div>
<div class="section" id="module-py2store.__init__">
<span id="py2store-init"></span><h1>py2store.__init__<a class="headerlink" href="#module-py2store.__init__" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt id="py2store.__init__.ihead">
<code class="sig-prename descclassname">py2store.__init__.</code><code class="sig-name descname">ihead</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">store</span></em>, <em class="sig-param"><span class="n">n</span><span class="o">=</span><span class="default_value">1</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/__init__.html#ihead"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.__init__.ihead" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the first item of an iterable, or a list of the first n items</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.__init__.kvhead">
<code class="sig-prename descclassname">py2store.__init__.</code><code class="sig-name descname">kvhead</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">store</span></em>, <em class="sig-param"><span class="n">n</span><span class="o">=</span><span class="default_value">1</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/__init__.html#kvhead"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.__init__.kvhead" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the first item of a kv store, or a list of the first n items</p>
</dd></dl>

</div>
<div class="section" id="module-py2store.stores.s3_store">
<span id="py2store-stores-s3-store"></span><h1>py2store.stores.s3_store<a class="headerlink" href="#module-py2store.stores.s3_store" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.stores.s3_store.S3AbsPathBinaryStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.s3_store.</code><code class="sig-name descname">S3AbsPathBinaryStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">bucket_name</span></em>, <em class="sig-param"><span class="n">_prefix</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">''</span></em>, <em class="sig-param"><span class="n">resource_kwargs</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/stores/s3_store.html#S3AbsPathBinaryStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.s3_store.S3AbsPathBinaryStore" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.stores.s3_store.S3BinaryStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.s3_store.</code><code class="sig-name descname">S3BinaryStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#py2store.stores.s3_store.S3BinaryStore" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.stores.s3_store.S3PickleStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.s3_store.</code><code class="sig-name descname">S3PickleStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/stores/s3_store.html#S3PickleStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.s3_store.S3PickleStore" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="py2store.stores.s3_store.S3StringStore">
<code class="sig-prename descclassname">py2store.stores.s3_store.</code><code class="sig-name descname">S3StringStore</code><a class="headerlink" href="#py2store.stores.s3_store.S3StringStore" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#py2store.stores.s3_store.S3TextStore" title="py2store.stores.s3_store.S3TextStore"><code class="xref py py-class docutils literal notranslate"><span class="pre">py2store.stores.s3_store.S3TextStore</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt id="py2store.stores.s3_store.S3TextStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.s3_store.</code><code class="sig-name descname">S3TextStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/stores/s3_store.html#S3TextStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.s3_store.S3TextStore" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-py2store.stores.delegation_stores">
<span id="py2store-stores-delegation-stores"></span><h1>py2store.stores.delegation_stores<a class="headerlink" href="#module-py2store.stores.delegation_stores" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.stores.sql_w_sqlalchemy">
<span id="py2store-stores-sql-w-sqlalchemy"></span><h1>py2store.stores.sql_w_sqlalchemy<a class="headerlink" href="#module-py2store.stores.sql_w_sqlalchemy" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.stores.sql_w_sqlalchemy.DfSqlDbReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.sql_w_sqlalchemy.</code><code class="sig-name descname">DfSqlDbReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">connection</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/stores/sql_w_sqlalchemy.html#DfSqlDbReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.sql_w_sqlalchemy.DfSqlDbReader" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.stores.sql_w_sqlalchemy.SQLAlchemyStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.sql_w_sqlalchemy.</code><code class="sig-name descname">SQLAlchemyStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/stores/sql_w_sqlalchemy.html#SQLAlchemyStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.sql_w_sqlalchemy.SQLAlchemyStore" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.stores.sql_w_sqlalchemy.SQLAlchemyTupleStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.sql_w_sqlalchemy.</code><code class="sig-name descname">SQLAlchemyTupleStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/stores/sql_w_sqlalchemy.html#SQLAlchemyTupleStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.sql_w_sqlalchemy.SQLAlchemyTupleStore" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="py2store-stores-arangodb-store">
<h1>py2store.stores.arangodb_store<a class="headerlink" href="#py2store-stores-arangodb-store" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="py2store-stores-dropbox-store">
<h1>py2store.stores.dropbox_store<a class="headerlink" href="#py2store-stores-dropbox-store" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.stores.local_store">
<span id="py2store-stores-local-store"></span><h1>py2store.stores.local_store<a class="headerlink" href="#module-py2store.stores.local_store" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.stores.local_store.AutoMkDirsOnSetitemMixin">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.local_store.</code><code class="sig-name descname">AutoMkDirsOnSetitemMixin</code><a class="reference internal" href="_modules/py2store/stores/local_store.html#AutoMkDirsOnSetitemMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.local_store.AutoMkDirsOnSetitemMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>A mixin that will automatically create directories on setitem, when missing.</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.stores.local_store.AutoMkPathformatMixin">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.local_store.</code><code class="sig-name descname">AutoMkPathformatMixin</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path_format</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/stores/local_store.html#AutoMkPathformatMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.local_store.AutoMkPathformatMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>A mixin that will choose a path_format if none given</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.stores.local_store.DirStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.local_store.</code><code class="sig-name descname">DirStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">rootdir</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/stores/local_store.html#DirStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.local_store.DirStore" title="Permalink to this definition">¶</a></dt>
<dd><p>A store for local directories.
Keys are directory names and values are subdirectory DirStores.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store</span> <span class="kn">import</span> <span class="vm">__file__</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">DirStore</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">issuperset</span><span class="p">({</span><span class="s1">&#39;stores&#39;</span><span class="p">,</span> <span class="s1">&#39;persisters&#39;</span><span class="p">,</span> <span class="s1">&#39;serializers&#39;</span><span class="p">,</span> <span class="s1">&#39;key_mappers&#39;</span><span class="p">})</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.stores.local_store.LocalBinaryStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.local_store.</code><code class="sig-name descname">LocalBinaryStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path_format</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/stores/local_store.html#LocalBinaryStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.local_store.LocalBinaryStore" title="Permalink to this definition">¶</a></dt>
<dd><p>Local files store for binary data</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.stores.local_store.LocalJsonStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.local_store.</code><code class="sig-name descname">LocalJsonStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path_format</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/stores/local_store.html#LocalJsonStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.local_store.LocalJsonStore" title="Permalink to this definition">¶</a></dt>
<dd><p>Local files store for text dataData is assumed to be a JSON string, and is loaded with json.loads and dumped with json.dumps</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.stores.local_store.LocalPickleStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.local_store.</code><code class="sig-name descname">LocalPickleStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path_format</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">fix_imports</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">protocol</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">pickle_encoding</span><span class="o">=</span><span class="default_value">'ASCII'</span></em>, <em class="sig-param"><span class="n">pickle_errors</span><span class="o">=</span><span class="default_value">'strict'</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">open_kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/stores/local_store.html#LocalPickleStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.local_store.LocalPickleStore" title="Permalink to this definition">¶</a></dt>
<dd><p>Local files store with pickle serialization</p>
</dd></dl>

<dl class="py attribute">
<dt id="py2store.stores.local_store.LocalStore">
<code class="sig-prename descclassname">py2store.stores.local_store.</code><code class="sig-name descname">LocalStore</code><a class="headerlink" href="#py2store.stores.local_store.LocalStore" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#py2store.stores.local_store.QuickPickleStore" title="py2store.stores.local_store.QuickPickleStore"><code class="xref py py-class docutils literal notranslate"><span class="pre">py2store.stores.local_store.QuickPickleStore</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt id="py2store.stores.local_store.LocalTextStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.local_store.</code><code class="sig-name descname">LocalTextStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path_format</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/stores/local_store.html#LocalTextStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.local_store.LocalTextStore" title="Permalink to this definition">¶</a></dt>
<dd><p>Local files store for text data</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.stores.local_store.MakeMissingDirsStoreMixin">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.local_store.</code><code class="sig-name descname">MakeMissingDirsStoreMixin</code><a class="reference internal" href="_modules/py2store/stores/local_store.html#MakeMissingDirsStoreMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.local_store.MakeMissingDirsStoreMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Will make a local file store automatically create the directories needed to create a file.
Should be placed before the concrete perisister in the mro but in such a manner so that it receives full paths.</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.stores.local_store.PathFormatStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.local_store.</code><code class="sig-name descname">PathFormatStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path_format</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">inf</span></em>, <em class="sig-param"><span class="n">mode</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">open_kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/stores/local_store.html#PathFormatStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.local_store.PathFormatStore" title="Permalink to this definition">¶</a></dt>
<dd><p>Local file store using templated relative paths.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">tempfile</span> <span class="kn">import</span> <span class="n">gettempdir</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">write_to_key</span><span class="p">(</span><span class="n">fullpath_of_relative_path</span><span class="p">,</span> <span class="n">relative_path</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>  <span class="c1"># a function to write content in files</span>
<span class="gp">... </span>   <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fullpath_of_relative_path</span><span class="p">(</span><span class="n">relative_path</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
<span class="gp">... </span>       <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Preparation: Make a temporary rootdir and write two files in it</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rootdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gettempdir</span><span class="p">(),</span> <span class="s1">&#39;path_format_store_test&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">rootdir</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">rootdir</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># recreate directory (remove existing files, delete directory, and re-create it)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">rootdir</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">fullpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rootdir</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fullpath</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rootdir</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">rootdir</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="n">rootdir</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">rootdir</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">rootdir</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filepath_of</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rootdir</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>  <span class="c1"># a function to get a fullpath from a relative one</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># and make two files in this new dir, with some content</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">write_to_key</span><span class="p">(</span><span class="n">filepath_of</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">write_to_key</span><span class="p">(</span><span class="n">filepath_of</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># point the obj source to the rootdir</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">PathFormatStore</span><span class="p">(</span><span class="n">path_format</span><span class="o">=</span><span class="n">rootdir</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># assert things...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">_prefix</span> <span class="o">==</span> <span class="n">rootdir</span>  <span class="c1"># the _rootdir is the one given in constructor</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="n">filepath_of</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)]</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span>  <span class="c1"># (the filepath for) &#39;a&#39; contains &#39;foo&#39;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># two files under rootdir (as long as the OS didn&#39;t create it&#39;s own under the hood)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="n">filepath_of</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">),</span> <span class="n">filepath_of</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)]</span>  <span class="c1"># there&#39;s two files in s</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filepath_of</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">s</span>  <span class="c1"># rootdir/a is in s</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filepath_of</span><span class="p">(</span><span class="s1">&#39;not_there&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">s</span>  <span class="c1"># rootdir/not_there is not in s</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filepath_of</span><span class="p">(</span><span class="s1">&#39;not_there&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span>  <span class="c1"># rootdir/not_there is not in s</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="p">[</span><span class="n">filepath_of</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">),</span> <span class="n">filepath_of</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)]</span>  <span class="c1"># the keys (filepaths) of s</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="c1"># the values of s (contents of files)</span>
<span class="go">[&#39;bar&#39;, &#39;foo&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">==</span> <span class="p">[(</span><span class="n">filepath_of</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">),</span> <span class="s1">&#39;foo&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">filepath_of</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">),</span> <span class="s1">&#39;bar&#39;</span><span class="p">)]</span>  <span class="c1"># the (path, content) items</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;this key is not there&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>  <span class="c1"># trying to get the val of a non-existing key returns None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;this key is not there&#39;</span><span class="p">,</span> <span class="s1">&#39;some default value&#39;</span><span class="p">)</span>  <span class="c1"># ... or whatever you say</span>
<span class="go">&#39;some default value&#39;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># add more files to the same folder</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">write_to_key</span><span class="p">(</span><span class="n">filepath_of</span><span class="p">,</span> <span class="s1">&#39;this.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;this&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">write_to_key</span><span class="p">(</span><span class="n">filepath_of</span><span class="p">,</span> <span class="s1">&#39;that.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;blah&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">write_to_key</span><span class="p">(</span><span class="n">filepath_of</span><span class="p">,</span> <span class="s1">&#39;the_other.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;bloo&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># see that you now have 5 files</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># and these files contain values:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="go">[&#39;bar&#39;, &#39;blah&#39;, &#39;bloo&#39;, &#39;foo&#39;, &#39;this&#39;]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># but if we make an obj source to only take files whose extension is &#39;.txt&#39;...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">PathFormatStore</span><span class="p">(</span><span class="n">path_format</span><span class="o">=</span><span class="n">rootdir</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.txt&#39;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rootdir_2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gettempdir</span><span class="p">(),</span> <span class="s1">&#39;obj_source_test_2&#39;</span><span class="p">)</span> <span class="c1"># get another rootdir</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">rootdir_2</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">rootdir_2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filepath_of_2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rootdir_2</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># and make two files in this new dir, with some content</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">write_to_key</span><span class="p">(</span><span class="n">filepath_of</span><span class="p">,</span> <span class="s1">&#39;this.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;this&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">write_to_key</span><span class="p">(</span><span class="n">filepath_of</span><span class="p">,</span> <span class="s1">&#39;that.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;blah&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">write_to_key</span><span class="p">(</span><span class="n">filepath_of</span><span class="p">,</span> <span class="s1">&#39;the_other.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;bloo&#39;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ss</span> <span class="o">=</span> <span class="n">PathFormatStore</span><span class="p">(</span><span class="n">path_format</span><span class="o">=</span><span class="n">rootdir_2</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.txt&#39;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span> <span class="o">!=</span> <span class="n">ss</span>  <span class="c1"># though pointing to identical content, o and oo are not equal since the paths are not equal!</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.stores.local_store.PathFormatStoreWithPrefix">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.local_store.</code><code class="sig-name descname">PathFormatStoreWithPrefix</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/stores/local_store.html#PathFormatStoreWithPrefix"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.local_store.PathFormatStoreWithPrefix" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="py2store.stores.local_store.PickleStore">
<code class="sig-prename descclassname">py2store.stores.local_store.</code><code class="sig-name descname">PickleStore</code><a class="headerlink" href="#py2store.stores.local_store.PickleStore" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#py2store.stores.local_store.LocalPickleStore" title="py2store.stores.local_store.LocalPickleStore"><code class="xref py py-class docutils literal notranslate"><span class="pre">py2store.stores.local_store.LocalPickleStore</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt id="py2store.stores.local_store.QuickBinaryStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.local_store.</code><code class="sig-name descname">QuickBinaryStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path_format</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/stores/local_store.html#QuickBinaryStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.local_store.QuickBinaryStore" title="Permalink to this definition">¶</a></dt>
<dd><p>Local files store for binary data with default temp root and auto dir generation on write.</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.stores.local_store.QuickJsonStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.local_store.</code><code class="sig-name descname">QuickJsonStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path_format</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/stores/local_store.html#QuickJsonStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.local_store.QuickJsonStore" title="Permalink to this definition">¶</a></dt>
<dd><p>Local files store for text data with default temp root and auto dir generation on write.Data is assumed to be a JSON string, and is loaded with json.loads and dumped with json.dumps</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.stores.local_store.QuickLocalStoreMixin">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.local_store.</code><code class="sig-name descname">QuickLocalStoreMixin</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path_format</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/stores/local_store.html#QuickLocalStoreMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.local_store.QuickLocalStoreMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>A mixin that will choose a path_format if none given,
and will automatically create directories on setitem, when missing.</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.stores.local_store.QuickPickleStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.local_store.</code><code class="sig-name descname">QuickPickleStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path_format</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/stores/local_store.html#QuickPickleStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.local_store.QuickPickleStore" title="Permalink to this definition">¶</a></dt>
<dd><p>Local files store with pickle serialization with default temp root and auto dir generation on write.</p>
</dd></dl>

<dl class="py attribute">
<dt id="py2store.stores.local_store.QuickStore">
<code class="sig-prename descclassname">py2store.stores.local_store.</code><code class="sig-name descname">QuickStore</code><a class="headerlink" href="#py2store.stores.local_store.QuickStore" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#py2store.stores.local_store.QuickPickleStore" title="py2store.stores.local_store.QuickPickleStore"><code class="xref py py-class docutils literal notranslate"><span class="pre">py2store.stores.local_store.QuickPickleStore</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt id="py2store.stores.local_store.QuickTextStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.local_store.</code><code class="sig-name descname">QuickTextStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path_format</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/stores/local_store.html#QuickTextStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.local_store.QuickTextStore" title="Permalink to this definition">¶</a></dt>
<dd><p>Local files store for text data with default temp root and auto dir generation on write.</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.stores.local_store.RelativeDirPathFormatKeys">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.local_store.</code><code class="sig-name descname">RelativeDirPathFormatKeys</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/stores/local_store.html#RelativeDirPathFormatKeys"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.local_store.RelativeDirPathFormatKeys" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.stores.local_store.RelativePathFormatStore2">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.local_store.</code><code class="sig-name descname">RelativePathFormatStore2</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/stores/local_store.html#RelativePathFormatStore2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.local_store.RelativePathFormatStore2" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-py2store.stores">
<span id="py2store-stores"></span><h1>py2store.stores<a class="headerlink" href="#module-py2store.stores" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="py2store-stores-couchdb-store">
<h1>py2store.stores.couchdb_store<a class="headerlink" href="#py2store-stores-couchdb-store" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.stores.mongo_store">
<span id="py2store-stores-mongo-store"></span><h1>py2store.stores.mongo_store<a class="headerlink" href="#module-py2store.stores.mongo_store" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.stores.mongo_store.MongoAnyKeyStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.mongo_store.</code><code class="sig-name descname">MongoAnyKeyStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/stores/mongo_store.html#MongoAnyKeyStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.mongo_store.MongoAnyKeyStore" title="Permalink to this definition">¶</a></dt>
<dd><p>MongoStore using tuple keys.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">MongoAnyKeyStore</span><span class="p">(</span><span class="n">db_name</span><span class="o">=</span><span class="s1">&#39;py2store_tests&#39;</span><span class="p">,</span> <span class="n">collection_name</span><span class="o">=</span><span class="s1">&#39;tmp&#39;</span><span class="p">,</span> <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span> <span class="k">del</span> <span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;must&#39;</span><span class="p">:</span> <span class="s1">&#39;be&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;dict&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span>
<span class="go">{&#39;must&#39;: &#39;be&#39;, &#39;a&#39;: &#39;dict&#39;}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.stores.mongo_store.MongoStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.mongo_store.</code><code class="sig-name descname">MongoStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/stores/mongo_store.html#MongoStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.mongo_store.MongoStore" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.stores.mongo_store.MongoTupleKeyStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.stores.mongo_store.</code><code class="sig-name descname">MongoTupleKeyStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/stores/mongo_store.html#MongoTupleKeyStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.stores.mongo_store.MongoTupleKeyStore" title="Permalink to this definition">¶</a></dt>
<dd><p>MongoStore using tuple keys.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">MongoTupleKeyStore</span><span class="p">(</span><span class="n">db_name</span><span class="o">=</span><span class="s1">&#39;py2store_tests&#39;</span><span class="p">,</span> <span class="n">collection_name</span><span class="o">=</span><span class="s1">&#39;tmp&#39;</span><span class="p">,</span> <span class="n">key_fields</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_id&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span> <span class="k">del</span> <span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1234</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;bob&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>  <span class="c1"># deleting all docs in tmp</span>
<span class="gp">... </span>    <span class="k">del</span> <span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>  <span class="c1"># see that key is not in store (and testing __contains__)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">orig_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="n">orig_length</span> <span class="o">+</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">==</span> <span class="n">v</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span> <span class="c1"># testing __contains__ again</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="n">orig_length</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-py2store.core">
<span id="py2store-core"></span><h1>py2store.core<a class="headerlink" href="#module-py2store.core" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.core.PrefixRelativization">
<em class="property">class </em><code class="sig-prename descclassname">py2store.core.</code><code class="sig-name descname">PrefixRelativization</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">_prefix</span><span class="o">=</span><span class="default_value">''</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/core.html#PrefixRelativization"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.core.PrefixRelativization" title="Permalink to this definition">¶</a></dt>
<dd><p>A key wrap that allows one to interface with absolute paths through relative paths.
The original intent was for local files. Instead of referencing files through an absolute path such as</p>
<blockquote>
<div><p>/A/VERY/LONG/ROOT/FOLDER/the/file/we.want</p>
</div></blockquote>
<dl class="simple">
<dt>we can instead reference the file as</dt><dd><p>the/file/we.want</p>
</dd>
</dl>
<p>But PrefixRelativization can be used, not only for local paths, but when ever a string reference is involved.
In fact, not only strings, but any key object that has a __len__, __add__, and subscripting.</p>
</dd></dl>

</div>
<div class="section" id="module-py2store.utils.uri_utils">
<span id="py2store-utils-uri-utils"></span><h1>py2store.utils.uri_utils<a class="headerlink" href="#module-py2store.utils.uri_utils" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt id="py2store.utils.uri_utils.build_uri">
<code class="sig-prename descclassname">py2store.utils.uri_utils.</code><code class="sig-name descname">build_uri</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scheme</span></em>, <em class="sig-param"><span class="n">database</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">username</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">password</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">host</span><span class="o">=</span><span class="default_value">'localhost'</span></em>, <em class="sig-param"><span class="n">port</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/uri_utils.html#build_uri"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.uri_utils.build_uri" title="Permalink to this definition">¶</a></dt>
<dd><p>Reverse of <cite>parse_uri</cite> function.
Builds a URI string from provided params.</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.utils.uri_utils.parse_uri">
<code class="sig-prename descclassname">py2store.utils.uri_utils.</code><code class="sig-name descname">parse_uri</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">uri</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/uri_utils.html#parse_uri"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.uri_utils.parse_uri" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses DB URI string into a dict of params.
:param uri: string formatted as: “scheme://username:password&#64;host:port/database”
:return: a dict with these params parsed.</p>
</dd></dl>

</div>
<div class="section" id="module-py2store.utils.explicit">
<span id="py2store-utils-explicit"></span><h1>py2store.utils.explicit<a class="headerlink" href="#module-py2store.utils.explicit" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.utils.explicit.ExplicitKeymapReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.explicit.</code><code class="sig-name descname">ExplicitKeymapReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">store</span></em>, <em class="sig-param"><span class="n">key_of_id</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">id_of_key</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/explicit.html#ExplicitKeymapReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.explicit.ExplicitKeymapReader" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrap a store (instance) so that it gets it’s keys from an explicit iterable of keys.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">id_of_key</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="s1">&#39;c&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ss</span> <span class="o">=</span> <span class="n">ExplicitKeymapReader</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">id_of_key</span><span class="o">=</span><span class="n">id_of_key</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>
<span class="go">[&#39;A&#39;, &#39;C&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span>  <span class="c1"># will look up &#39;C&#39;, find &#39;c&#39;, and call the store on that.</span>
<span class="go">3</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.utils.explicit.ExplicitKeys">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.explicit.</code><code class="sig-name descname">ExplicitKeys</code><a class="reference internal" href="_modules/py2store/utils/explicit.html#ExplicitKeys"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.explicit.ExplicitKeys" title="Permalink to this definition">¶</a></dt>
<dd><p>py2store.base.Keys implementation that gets it’s keys explicitly from a collection given at initialization time.
The key_collection must be a collections.abc.Collection (such as list, tuple, set, etc.)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">keys</span> <span class="o">=</span> <span class="n">ExplicitKeys</span><span class="p">(</span><span class="n">key_collection</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;alice&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;foo&#39;</span> <span class="ow">in</span> <span class="n">keys</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;not there&#39;</span> <span class="ow">in</span> <span class="n">keys</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
<span class="go">[&#39;foo&#39;, &#39;bar&#39;, &#39;alice&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.utils.explicit.ExplicitKeysSource">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.explicit.</code><code class="sig-name descname">ExplicitKeysSource</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key_collection</span><span class="p">:</span> <span class="n">Collection</span></em>, <em class="sig-param"><span class="n">_obj_of_key</span><span class="p">:</span> <span class="n">Callable</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/explicit.html#ExplicitKeysSource"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.explicit.ExplicitKeysSource" title="Permalink to this definition">¶</a></dt>
<dd><p>An object source that uses an explicit keys collection and a specified function to read contents for a key.</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.utils.explicit.ExplicitKeysStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.explicit.</code><code class="sig-name descname">ExplicitKeysStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">store</span></em>, <em class="sig-param"><span class="n">key_collection</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/explicit.html#ExplicitKeysStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.explicit.ExplicitKeysStore" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrap a store (instance) so that it gets it’s keys from an explicit iterable of keys.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ss</span> <span class="o">=</span> <span class="n">ExplicitKeysStore</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>
<span class="go">[&#39;d&#39;, &#39;a&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ss</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="go">[4, 1]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ss</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="go">(&#39;d&#39;, 4)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.utils.explicit.ExplicitKeysWithPrefixRelativization">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.explicit.</code><code class="sig-name descname">ExplicitKeysWithPrefixRelativization</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key_collection</span></em>, <em class="sig-param"><span class="n">_prefix</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/explicit.html#ExplicitKeysWithPrefixRelativization"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.explicit.ExplicitKeysWithPrefixRelativization" title="Permalink to this definition">¶</a></dt>
<dd><p>py2store.base.Keys implementation that gets it’s keys explicitly from a collection given at initialization time.
The key_collection must be a collections.abc.Collection (such as list, tuple, set, etc.)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store.base</span> <span class="kn">import</span> <span class="n">Store</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ExplicitKeysWithPrefixRelativization</span><span class="p">(</span><span class="n">key_collection</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;/root/of/foo&#39;</span><span class="p">,</span> <span class="s1">&#39;/root/of/bar&#39;</span><span class="p">,</span> <span class="s1">&#39;/root/for/alice&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">keys</span> <span class="o">=</span> <span class="n">Store</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;of/foo&#39;</span> <span class="ow">in</span> <span class="n">keys</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;not there&#39;</span> <span class="ow">in</span> <span class="n">keys</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
<span class="go">[&#39;of/foo&#39;, &#39;of/bar&#39;, &#39;for/alice&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.utils.explicit.ObjReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.explicit.</code><code class="sig-name descname">ObjReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">_obj_of_key</span><span class="p">:</span> <span class="n">Callable</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/explicit.html#ObjReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.explicit.ObjReader" title="Permalink to this definition">¶</a></dt>
<dd><p>A reader that uses a specified function to get the contents for a given key.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># define a contents_of_key that reads stuff from a dict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="mi">42</span><span class="p">:</span> <span class="s2">&quot;everything&quot;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">read_dict</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pr</span> <span class="o">=</span> <span class="n">ObjReader</span><span class="p">(</span><span class="n">_obj_of_key</span><span class="o">=</span><span class="n">read_dict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pr</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span>
<span class="go">&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pr</span><span class="p">[</span><span class="mi">42</span><span class="p">]</span>
<span class="go">&#39;everything&#39;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># define contents_of_key that reads stuff from a file given it&#39;s path</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pr</span> <span class="o">=</span> <span class="n">ObjReader</span><span class="p">(</span><span class="n">_obj_of_key</span><span class="o">=</span><span class="n">read_file</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">file_where_this_code_is</span> <span class="o">=</span> <span class="vm">__file__</span>  <span class="c1"># it should be THIS file you&#39;re reading right now!</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">pr</span><span class="p">[</span><span class="n">file_where_this_code_is</span><span class="p">][:</span><span class="mi">100</span><span class="p">])</span>  <span class="c1"># print the first 100 characters of this file</span>
<span class="go">from collections.abc import Mapping</span>
<span class="go">from typing import Callable</span>
<span class="go">from typing import Collection as Col</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.utils.explicit.invertible_maps">
<code class="sig-prename descclassname">py2store.utils.explicit.</code><code class="sig-name descname">invertible_maps</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">mapping</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">inv_mapping</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/explicit.html#invertible_maps"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.explicit.invertible_maps" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns two maps that are inverse of each other.
Raises an AssertionError iif both maps are None, or if the maps are not inverse of each other</p>
<p>Get a pair of invertible maps
&gt;&gt;&gt; invertible_maps({1: 11, 2: 22})
({1: 11, 2: 22}, {11: 1, 22: 2})
&gt;&gt;&gt; invertible_maps(None, {11: 1, 22: 2})
({1: 11, 2: 22}, {11: 1, 22: 2})</p>
<p>If two maps are given and invertible, you just get them back
&gt;&gt;&gt; invertible_maps({1: 11, 2: 22}, {11: 1, 22: 2})
({1: 11, 2: 22}, {11: 1, 22: 2})</p>
<p>Or if they’re not invertible
&gt;&gt;&gt; invertible_maps({1: 11, 2: 22}, {11: 1, 22: ‘ha, not what you expected!’})
Traceback (most recent call last):</p>
<blockquote>
<div><p>…</p>
</div></blockquote>
<p>AssertionError: mapping and inv_mapping are not inverse of each other!</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">invertible_maps</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">You need to specify one or both maps</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-py2store.utils.timeseries_caching">
<span id="py2store-utils-timeseries-caching"></span><h1>py2store.utils.timeseries_caching<a class="headerlink" href="#module-py2store.utils.timeseries_caching" title="Permalink to this headline">¶</a></h1>
<p>Tools to cache time-series data.</p>
<dl class="py class">
<dt id="py2store.utils.timeseries_caching.RegularTimeseriesCache">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.timeseries_caching.</code><code class="sig-name descname">RegularTimeseriesCache</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data_rate</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">time_rate</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">maxlen</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/timeseries_caching.html#RegularTimeseriesCache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.timeseries_caching.RegularTimeseriesCache" title="Permalink to this definition">¶</a></dt>
<dd><p>A type that pretends to be a (possibly very large) list, but where contents of the list are populated as they are
needed. Further, the indexing of the list can be overwritten for the convenience of the user.</p>
<p>The canonical application is where we have segments of continuous waveform indexed by utc microseconds timestamps.</p>
<p>It is convenient to be able to read segments of this waveform as if it was one big waveform (handling the
discontinuities gracefully), and have the choice of using (relative or absolute) integer indices or utc indices.</p>
</dd></dl>

</div>
<div class="section" id="py2store-utils-attr-dict-py-attr-dict">
<h1>py2store.utils.attr_dict.py.attr_dict<a class="headerlink" href="#py2store-utils-attr-dict-py-attr-dict" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="py2store-utils-attr-dict-py">
<h1>py2store.utils.attr_dict.py<a class="headerlink" href="#py2store-utils-attr-dict-py" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.utils.cumul_aggreg_write">
<span id="py2store-utils-cumul-aggreg-write"></span><h1>py2store.utils.cumul_aggreg_write<a class="headerlink" href="#module-py2store.utils.cumul_aggreg_write" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.utils.cumul_aggreg_write.CumulAggregWrite">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.cumul_aggreg_write.</code><code class="sig-name descname">CumulAggregWrite</code><span class="sig-paren">(</span><em class="sig-param">store</em>, <em class="sig-param">cache_to_kv=&lt;function mk_kv_from_keygen.&lt;locals&gt;.aggregate&gt;</em>, <em class="sig-param">mk_cache=&lt;class 'list'&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/cumul_aggreg_write.html#CumulAggregWrite"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.cumul_aggreg_write.CumulAggregWrite" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.utils.cumul_aggreg_write.CumulAggregWriteKvItems">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.cumul_aggreg_write.</code><code class="sig-name descname">CumulAggregWriteKvItems</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">store</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/cumul_aggreg_write.html#CumulAggregWriteKvItems"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.cumul_aggreg_write.CumulAggregWriteKvItems" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.utils.cumul_aggreg_write.CumulAggregWriteWithAutoFlush">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.cumul_aggreg_write.</code><code class="sig-name descname">CumulAggregWriteWithAutoFlush</code><span class="sig-paren">(</span><em class="sig-param">store</em>, <em class="sig-param">cache_to_kv=&lt;function mk_kv_from_keygen.&lt;locals&gt;.aggregate&gt;</em>, <em class="sig-param">mk_cache=&lt;class 'list'&gt;</em>, <em class="sig-param">flush_cache_condition=&lt;function condition_flush_on_every_write&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/cumul_aggreg_write.html#CumulAggregWriteWithAutoFlush"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.cumul_aggreg_write.CumulAggregWriteWithAutoFlush" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="py2store.utils.cumul_aggreg_write.condition_flush_on_every_write">
<code class="sig-prename descclassname">py2store.utils.cumul_aggreg_write.</code><code class="sig-name descname">condition_flush_on_every_write</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">cache</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/cumul_aggreg_write.html#condition_flush_on_every_write"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.cumul_aggreg_write.condition_flush_on_every_write" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean function used as flush_cache_condition to anytime the cache is non-empty</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.utils.cumul_aggreg_write.mk_group_aggregator">
<code class="sig-prename descclassname">py2store.utils.cumul_aggreg_write.</code><code class="sig-name descname">mk_group_aggregator</code><span class="sig-paren">(</span><em class="sig-param">item_to_kv</em>, <em class="sig-param">aggregator_op=&lt;built-in function add&gt;</em>, <em class="sig-param">initial=&lt;py2store.utils.cumul_aggreg_write.NoInitial object&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/cumul_aggreg_write.html#mk_group_aggregator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.cumul_aggreg_write.mk_group_aggregator" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a generator transforming function that will
(a) make a key for each given item,
(b) group all items according to the key</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>item_to_kv</strong> – </p></li>
<li><p><strong>aggregator_op</strong> – </p></li>
<li><p><strong>initial</strong> – </p></li>
</ul>
</dd>
</dl>
<p>Returns:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Collect words (as a csv string), grouped by the lower case of the first letter</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ag</span> <span class="o">=</span> <span class="n">mk_group_aggregator</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">item</span><span class="p">),</span>
<span class="gp">... </span>                         <span class="n">aggregator_op</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ag</span><span class="p">([</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;bananna&#39;</span><span class="p">,</span> <span class="s1">&#39;Airplane&#39;</span><span class="p">]))</span>
<span class="go">[(&#39;a&#39;, &#39;apple, Airplane&#39;), (&#39;b&#39;, &#39;bananna&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Collect (and concatinate)  characters according to their ascii value modulo 3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ag</span> <span class="o">=</span> <span class="n">mk_group_aggregator</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;thing&#39;</span><span class="p">]),</span>
<span class="gp">... </span>                         <span class="n">aggregator_op</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="p">[</span><span class="n">y</span><span class="p">],</span>
<span class="gp">... </span>                         <span class="n">initial</span><span class="o">=</span><span class="p">[])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ag</span><span class="p">([{</span><span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;thing&#39;</span><span class="p">:</span> <span class="s1">&#39;new&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span> <span class="s1">&#39;thing&#39;</span><span class="p">:</span> <span class="s1">&#39;every&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;thing&#39;</span><span class="p">:</span> <span class="s1">&#39;just born&#39;</span><span class="p">}]))</span>
<span class="go">[(0, [&#39;new&#39;, &#39;just born&#39;]), (42, [&#39;every&#39;])]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.utils.cumul_aggreg_write.mk_group_aggregator_with_key_func">
<code class="sig-prename descclassname">py2store.utils.cumul_aggreg_write.</code><code class="sig-name descname">mk_group_aggregator_with_key_func</code><span class="sig-paren">(</span><em class="sig-param">item_to_key</em>, <em class="sig-param">aggregator_op=&lt;built-in function add&gt;</em>, <em class="sig-param">initial=&lt;py2store.utils.cumul_aggreg_write.NoInitial object&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/cumul_aggreg_write.html#mk_group_aggregator_with_key_func"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.cumul_aggreg_write.mk_group_aggregator_with_key_func" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a generator transforming function that will
(a) make a key for each given item,
(b) group all items according to the key</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>item_to_key</strong> – Function that takes an item of the generator and outputs the key that should be used to group items</p></li>
<li><p><strong>aggregator_op</strong> – The aggregation binary function that is used to aggregate two items together.
The function is used as is by the functools.reduce, applied to the sequence of items that were collected for
a given group</p></li>
<li><p><strong>initial</strong> – The “empty” element to start the reduce (aggregation) with, if necessary.</p></li>
</ul>
</dd>
</dl>
<p>Returns:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Collect words (as a csv string), grouped by the lower case of the first letter</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ag</span> <span class="o">=</span> <span class="n">mk_group_aggregator_with_key_func</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
<span class="gp">... </span>                         <span class="n">aggregator_op</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ag</span><span class="p">([</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;bananna&#39;</span><span class="p">,</span> <span class="s1">&#39;Airplane&#39;</span><span class="p">]))</span>
<span class="go">[(&#39;a&#39;, &#39;apple, Airplane&#39;), (&#39;b&#39;, &#39;bananna&#39;)]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Collect (and concatenate) characters according to their ascii value modulo 3</span>
<span class="gp">... </span><span class="n">ag</span> <span class="o">=</span> <span class="n">mk_group_aggregator_with_key_func</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ag</span><span class="p">(</span><span class="s1">&#39;abcdefghijklmnop&#39;</span><span class="p">))</span>
<span class="go">[(1, &#39;adgjmp&#39;), (2, &#39;behkn&#39;), (0, &#39;cfilo&#39;)]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># sum all even and odd number separately</span>
<span class="gp">... </span><span class="n">ag</span> <span class="o">=</span> <span class="n">mk_group_aggregator_with_key_func</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="p">(</span><span class="n">item</span> <span class="o">%</span> <span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ag</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]))</span>  <span class="c1"># sum of evens is 6, and sum of odds is 9</span>
<span class="go">[(1, 9), (0, 6)]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># if we wanted to collect all odds and evens, we&#39;d need a different aggregator and initial</span>
<span class="gp">... </span><span class="n">ag</span> <span class="o">=</span> <span class="n">mk_group_aggregator_with_key_func</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="p">(</span><span class="n">item</span> <span class="o">%</span> <span class="mi">2</span><span class="p">),</span> <span class="n">aggregator_op</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="p">[</span><span class="n">y</span><span class="p">],</span> <span class="n">initial</span><span class="o">=</span><span class="p">[])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ag</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]))</span>
<span class="go">[(1, [1, 3, 5]), (0, [2, 4])]</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-py2store.utils">
<span id="py2store-utils"></span><h1>py2store.utils<a class="headerlink" href="#module-py2store.utils" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.utils.cache_descriptors">
<span id="py2store-utils-cache-descriptors"></span><h1>py2store.utils.cache_descriptors<a class="headerlink" href="#module-py2store.utils.cache_descriptors" title="Permalink to this headline">¶</a></h1>
<p>Cached properties
See the CachedProperty class.</p>
<p>This module was taken from <a class="reference external" href="https://github.com/zopefoundation/zope.cachedescriptors">https://github.com/zopefoundation/zope.cachedescriptors</a>.</p>
<dl class="py function">
<dt id="py2store.utils.cache_descriptors.CachedProperty">
<code class="sig-prename descclassname">py2store.utils.cache_descriptors.</code><code class="sig-name descname">CachedProperty</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/cache_descriptors.html#CachedProperty"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.cache_descriptors.CachedProperty" title="Permalink to this definition">¶</a></dt>
<dd><p>CachedProperties.
This is usable directly as a decorator when given names, or when not. Any of these patterns
will work:
* <code class="docutils literal notranslate"><span class="pre">&#64;CachedProperty</span></code>
* <code class="docutils literal notranslate"><span class="pre">&#64;CachedProperty()</span></code>
* <code class="docutils literal notranslate"><span class="pre">&#64;CachedProperty('n','n2')</span></code>
* def thing(self: …; thing = CachedProperty(thing)
* def thing(self: …; thing = CachedProperty(thing, ‘n’)</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.utils.cache_descriptors.Lazy">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.cache_descriptors.</code><code class="sig-name descname">Lazy</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/cache_descriptors.html#Lazy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.cache_descriptors.Lazy" title="Permalink to this definition">¶</a></dt>
<dd><p>Lazy Attributes.</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.utils.cache_descriptors.cachedIn">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.cache_descriptors.</code><code class="sig-name descname">cachedIn</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">attribute_name</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/cache_descriptors.html#cachedIn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.cache_descriptors.cachedIn" title="Permalink to this definition">¶</a></dt>
<dd><p>Cached property with given cache attribute.</p>
</dd></dl>

</div>
<div class="section" id="module-py2store.utils.appendable">
<span id="py2store-utils-appendable"></span><h1>py2store.utils.appendable<a class="headerlink" href="#module-py2store.utils.appendable" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.utils.affine_conversion">
<span id="py2store-utils-affine-conversion"></span><h1>py2store.utils.affine_conversion<a class="headerlink" href="#module-py2store.utils.affine_conversion" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.utils.affine_conversion.AffineConverter">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.affine_conversion.</code><code class="sig-name descname">AffineConverter</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">offset</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">1.0</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/affine_conversion.html#AffineConverter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.affine_conversion.AffineConverter" title="Permalink to this definition">¶</a></dt>
<dd><p>Getting a callable that will perform an affine conversion.
Note, it does it as</p>
<blockquote>
<div><p>(val - offset) * scale</p>
</div></blockquote>
<p>(Note slope-intercept style (though there is the .from_slope_and_intercept constructor method for that)</p>
<dl class="simple">
<dt>Inverse is available through the inv method, performing:</dt><dd><p>val / scale + offset</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">convert</span> <span class="o">=</span> <span class="n">AffineConverter</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">convert</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">-0.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">convert</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="go">4.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">convert</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="go">9.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">convert</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="mf">4.5</span><span class="p">)</span>
<span class="go">10.0</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.utils.affine_conversion.get_affine_converter_and_inverse">
<code class="sig-prename descclassname">py2store.utils.affine_conversion.</code><code class="sig-name descname">get_affine_converter_and_inverse</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">offset</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">source_type_cast</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">target_type_cast</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/affine_conversion.html#get_affine_converter_and_inverse"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.affine_conversion.get_affine_converter_and_inverse" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Getting two affine functions with given scale and offset, that are inverse of each other. Namely (for input val):</dt><dd><p>(val - offset) * scale and val / scale + offset</p>
</dd>
</dl>
<p>Note this is not “slope intercept” style!!</p>
<p>The source_type_cast and target_type_case (optional), allow the user to specify if these transformations need to
be further cast to a given type.
:param scale:
:param offset:
:param source_type_cast: function to apply to input
:param target_type_cast: function to apply to output
:return: Two single val functions: affine_converter, inverse_affine_converter</p>
<p>Note: Code is a lot more complex than the basic operations it performs. The reason was a worry of efficiency since
the functions that are returned are intended to be used in long loops.</p>
<p>See also: ocore.utils.conversion.AffineConverter</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">affine_converter</span><span class="p">,</span> <span class="n">inverse_affine_converter</span> <span class="o">=</span> <span class="n">get_affine_converter_and_inverse</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">affine_converter</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">-0.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">affine_converter</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="go">4.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inverse_affine_converter</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="go">9.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inverse_affine_converter</span><span class="p">(</span><span class="mf">4.5</span><span class="p">)</span>
<span class="go">10.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">affine_converter</span><span class="p">,</span> <span class="n">inverse_affine_converter</span> <span class="o">=</span> <span class="n">get_affine_converter_and_inverse</span><span class="p">(</span>
<span class="gp">... </span>                                                <span class="n">offset</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">target_type_cast</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">affine_converter</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="go">4</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-py2store.utils.signatures">
<span id="py2store-utils-signatures"></span><h1>py2store.utils.signatures<a class="headerlink" href="#module-py2store.utils.signatures" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.utils.signatures.Command">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.signatures.</code><code class="sig-name descname">Command</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">caller</span><span class="p">:</span> <span class="n">callable</span></em>, <em class="sig-param"><span class="n">args</span><span class="p">:</span> <span class="n">Iterable</span> <span class="o">=</span> <span class="default_value">()</span></em>, <em class="sig-param"><span class="n">kwargs</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>dict<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/signatures.html#Command"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.Command" title="Permalink to this definition">¶</a></dt>
<dd><p>A dataclass that holds a <cite>(caller, args, kwargs)</cite> triple and allows one to execute <cite>caller(*args, **kwargs)</cite></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>caller</strong> – A callable that will be called with (<a href="#id21"><span class="problematic" id="id22">*</span></a>args, <a href="#id23"><span class="problematic" id="id24">**</span></a>kwargs) argument</p></li>
<li><p><strong>args</strong> – A tuple</p></li>
<li><p><strong>kwargs</strong> – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt id="py2store.utils.signatures.MissingArgValFor">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.signatures.</code><code class="sig-name descname">MissingArgValFor</code><span class="sig-paren">(</span><em class="sig-param">&quot;argname&quot;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/signatures.html#MissingArgValFor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.MissingArgValFor" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.utils.signatures.Param">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.signatures.</code><code class="sig-name descname">Param</code><span class="sig-paren">(</span><em class="sig-param">name</em>, <em class="sig-param">kind=&lt;_ParameterKind.POSITIONAL_OR_KEYWORD: 1&gt;</em>, <em class="sig-param">*</em>, <em class="sig-param">default</em>, <em class="sig-param">annotation</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/signatures.html#Param"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.Param" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.utils.signatures.Sig">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.signatures.</code><code class="sig-name descname">Sig</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">obj</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>Iterable<span class="p">[</span>inspect.Parameter<span class="p">]</span><span class="p">, </span>Mapping<span class="p">[</span>str<span class="p">, </span>inspect.Parameter<span class="p">]</span><span class="p">, </span>Callable<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">return_annotation</span></em>, <em class="sig-param"><span class="n">__validate_parameters__</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/signatures.html#Sig"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.Sig" title="Permalink to this definition">¶</a></dt>
<dd><p>A subclass of inspect.Signature that has some extra api sugar, such as a dict-like interface, merging, …</p>
<p>You can construct a <cite>Sig</cite> object from a callable,</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Sig</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="go">&lt;Sig (w, /, x: float = 1, y=1, *, z: int = 1)&gt;</span>
</pre></div>
</div>
<p>but also from any “ParamsAble” object. Such as…
an iterable of Parameter instances, strings, tuples, or dicts:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Sig</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
<span class="gp">... </span>               <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;special&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">Parameter</span><span class="o">.</span><span class="n">KEYWORD_ONLY</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)])</span>
<span class="go">&lt;Sig (a, b: int, c=2, d: float = 1.0, *, special=0)&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Sig</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;args&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">Parameter</span><span class="o">.</span><span class="n">VAR_POSITIONAL</span><span class="p">),</span>
<span class="gp">... </span>               <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;kwargs&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">Parameter</span><span class="o">.</span><span class="n">VAR_KEYWORD</span><span class="p">)]</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">&lt;Sig (a, b, *args, **kwargs)&gt;</span>
</pre></div>
</div>
<p>The parameters of a signature are like a matrix whose rows are the parameters,
and the 4 columns are their properties: name, kind, default, and annotation
(the two laste ones being optional).
You get a row view when doing <cite>Sig(…).parameters.values()</cite>,
but what if you want a column-view?
Here’s how:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span> <span class="o">...</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Sig</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">kinds</span>  
<span class="go">{&#39;w&#39;: &lt;_ParameterKind.POSITIONAL_ONLY: 0&gt;,</span>
<span class="go">&#39;x&#39;: &lt;_ParameterKind.POSITIONAL_OR_KEYWORD: 1&gt;,</span>
<span class="go">&#39;y&#39;: &lt;_ParameterKind.POSITIONAL_OR_KEYWORD: 1&gt;,</span>
<span class="go">&#39;z&#39;: &lt;_ParameterKind.KEYWORD_ONLY: 3&gt;}</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">annotations</span>
<span class="go">{&#39;x&#39;: &lt;class &#39;float&#39;&gt;, &#39;z&#39;: &lt;class &#39;int&#39;&gt;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">annotations</span> <span class="o">==</span> <span class="n">f</span><span class="o">.</span><span class="vm">__annotations__</span>  <span class="c1"># same as what you get in `__annotations__`</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">defaults</span>
<span class="go">{&#39;x&#39;: 1, &#39;y&#39;: 2, &#39;z&#39;: 3}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Note that it&#39;s not the same as you get in __defaults__ though:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">defaults</span> <span class="o">!=</span> <span class="n">f</span><span class="o">.</span><span class="vm">__defaults__</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># not 3, since __kwdefaults__ has that!</span>
</pre></div>
</div>
<p>We can sum (i.e. merge) and subtract (i.e. remove arguments) Sig instances.
Also, Sig instance is callable. It has the effect of inserting it’s signature in the input
(in <cite>__signature__</cite>, but also inserting the resulting <cite>__defaults__</cite> and <cite>__kwdefaults__</cite>).
One of the intents is to be able to do things like:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">inspect</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span> <span class="o">...</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@Sig</span><span class="o">.</span><span class="n">from_objs</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mf">3.14</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="nb">int</span><span class="p">)])</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">some_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>    <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">some_func</span><span class="p">)</span>
<span class="go">&lt;Signature (w, i, a, x: float = 1, y=1, z: int = 1, j=2, b=3.14, c: int = 42)&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sig</span> <span class="o">=</span> <span class="n">Sig</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">+</span> <span class="n">g</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mf">3.14</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="nb">int</span><span class="p">)]</span> <span class="o">-</span> <span class="s1">&#39;b&#39;</span> <span class="o">-</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@sig</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">some_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>    <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">some_func</span><span class="p">)</span>
<span class="go">&lt;Signature (w, i, x: float = 1, y=1, j=2, c: int = 42)&gt;</span>
</pre></div>
</div>
<dl class="py method">
<dt id="py2store.utils.signatures.Sig.annotations">
<em class="property">property </em><code class="sig-name descname">annotations</code><a class="headerlink" href="#py2store.utils.signatures.Sig.annotations" title="Permalink to this definition">¶</a></dt>
<dd><p>annotation, …} dict of annotations of the signature.
What <cite>func.__annotations__</cite> would give you.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>{arg_name</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="py2store.utils.signatures.Sig.args_and_kwargs_from_kwargs">
<code class="sig-name descname">args_and_kwargs_from_kwargs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">kwargs</span></em>, <em class="sig-param"><span class="n">apply_defaults</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">allow_partial</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">allow_excess</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">ignore_kind</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/signatures.html#Sig.args_and_kwargs_from_kwargs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.Sig.args_and_kwargs_from_kwargs" title="Permalink to this definition">¶</a></dt>
<dd><p>Get an (args, kwargs) tuple from the kwargs, where args contain the position only arguments.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">((</span><span class="n">w</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="n">z</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">Sig</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="o">.</span><span class="n">args_and_kwargs_from_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="p">((</span><span class="mi">4</span><span class="p">,),</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">foo</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="n">foo</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">14</span>
</pre></div>
</div>
<p>See kwargs_from_args_and_kwargs (namely for the description of the arguments.</p>
</dd></dl>

<dl class="py method">
<dt id="py2store.utils.signatures.Sig.extract_args_and_kwargs">
<code class="sig-name descname">extract_args_and_kwargs</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="n">_ignore_kind</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">_allow_partial</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">_apply_defaults</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/signatures.html#Sig.extract_args_and_kwargs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.Sig.extract_args_and_kwargs" title="Permalink to this definition">¶</a></dt>
<dd><p>Source the (args, kwargs) for the signature instance, ignoring excess arguments.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">w</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">**</span> <span class="n">z</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">Sig</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="o">.</span><span class="n">extract_args_and_kwargs</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="p">((</span><span class="mi">4</span><span class="p">,),</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
<span class="go">True</span>
</pre></div>
</div>
<p>The difference with extract_kwargs is that here the output is ready to be called by the
function whose signature we have, since the position-only arguments will be returned as
args.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="go">10</span>
</pre></div>
</div>
<p>Note that though <cite>w</cite> is a position only argument, you can specify <cite>w=4</cite> as a keyword argument too (by default):
&gt;&gt;&gt; args, kwargs = Sig(foo).extract_args_and_kwargs(w=4, x=3, y=2)
&gt;&gt;&gt; (args, kwargs) == ((4,), {‘x’: 3, ‘y’: 2})
True</p>
<p>If you don’t want to allow that, you can say <cite>_ignore_kind=False</cite>
&gt;&gt;&gt; Sig(foo).extract_args_and_kwargs(w=4, x=3, y=2, _ignore_kind=False)
Traceback (most recent call last):</p>
<blockquote>
<div><p>…</p>
</div></blockquote>
<p>TypeError: ‘w’ parameter is positional only, but was passed as a keyword</p>
<p>You can use <cite>_allow_partial</cite> that will allow you, if
set to <cite>True</cite>, to underspecify the params of a function (in view of being completed later).
&gt;&gt;&gt; Sig(foo).extract_args_and_kwargs(x=3, y=2)
Traceback (most recent call last):</p>
<blockquote>
<div><p>…</p>
</div></blockquote>
<p>TypeError: missing a required argument: ‘w’</p>
<p>But if you specify <cite>_allow_partial=True</cite>…
&gt;&gt;&gt; args, kwargs = Sig(foo).extract_args_and_kwargs(x=3, y=2, _allow_partial=True)
&gt;&gt;&gt; (args, kwargs) == ((), {‘x’: 3, ‘y’: 2})
True</p>
<p>By default, <cite>_apply_defaults=False</cite>, which will lead to only get those arguments you input.
&gt;&gt;&gt; args, kwargs = Sig(foo).extract_args_and_kwargs(4, x=3, y=2)
&gt;&gt;&gt; (args, kwargs) == ((4,), {‘x’: 3, ‘y’: 2})
True</p>
<p>But if you specify <cite>_apply_defaults=True</cite> non-specified non-require arguments
will be returned with their defaults:
&gt;&gt;&gt; args, kwargs = Sig(foo).extract_args_and_kwargs(4, x=3, y=2, _apply_defaults=True)
&gt;&gt;&gt; (args, kwargs) == ((4,), {‘x’: 3, ‘y’: 2, ‘z’: 1})
True</p>
</dd></dl>

<dl class="py method">
<dt id="py2store.utils.signatures.Sig.extract_kwargs">
<code class="sig-name descname">extract_kwargs</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="n">_ignore_kind</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">_allow_partial</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">_apply_defaults</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/signatures.html#Sig.extract_kwargs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.Sig.extract_kwargs" title="Permalink to this definition">¶</a></dt>
<dd><p>Convenience method that calls kwargs_from_args_and_kwargs with defaults, and ignore_kind=True.</p>
<p>Strict in the sense that the kwargs cannot contain any arguments that are not
valid argument names (as per the signature).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;YY&#39;</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ZZ&#39;</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sig</span> <span class="o">=</span> <span class="n">Sig</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="n">sig</span><span class="o">.</span><span class="n">extract_kwargs</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">... </span>    <span class="o">==</span> <span class="n">sig</span><span class="o">.</span><span class="n">extract_kwargs</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">... </span>    <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">})</span>
</pre></div>
</div>
<p>What about var positional and var keywords?
&gt;&gt;&gt; def bar(<a href="#id25"><span class="problematic" id="id26">*</span></a>args, <a href="#id27"><span class="problematic" id="id28">**</span></a>kwargs): …
&gt;&gt;&gt; Sig(bar).extract_kwargs(1, 2, y=3, z=4)
{‘args’: (1, 2), ‘kwargs’: {‘y’: 3, ‘z’: 4}}</p>
<p>Note that though <cite>w</cite> is a position only argument, you can specify <cite>w=11</cite> as a keyword argument too (by default):
&gt;&gt;&gt; Sig(foo).extract_kwargs(w=11, x=22)
{‘w’: 11, ‘x’: 22}</p>
<p>If you don’t want to allow that, you can say <cite>_ignore_kind=False</cite>
&gt;&gt;&gt; Sig(foo).extract_kwargs(w=11, x=22, _ignore_kind=False)
Traceback (most recent call last):</p>
<blockquote>
<div><p>…</p>
</div></blockquote>
<p>TypeError: ‘w’ parameter is positional only, but was passed as a keyword</p>
<p>You can use <cite>_allow_partial</cite> that will allow you, if
set to <cite>True</cite>, to underspecify the params of a function (in view of being completed later).
&gt;&gt;&gt; Sig(foo).extract_kwargs(x=3, y=2)
Traceback (most recent call last):</p>
<blockquote>
<div><p>…</p>
</div></blockquote>
<p>TypeError: missing a required argument: ‘w’</p>
<p>But if you specify <cite>_allow_partial=True</cite>…
&gt;&gt;&gt; Sig(foo).extract_kwargs(x=3, y=2, _allow_partial=True)
{‘x’: 3, ‘y’: 2}</p>
<p>By default, <cite>_apply_defaults=False</cite>, which will lead to only get those arguments you input.
&gt;&gt;&gt; Sig(foo).extract_kwargs(4, x=3, y=2)
{‘w’: 4, ‘x’: 3, ‘y’: 2}</p>
<p>But if you specify <cite>_apply_defaults=True</cite> non-specified non-require arguments
will be returned with their defaults:
&gt;&gt;&gt; Sig(foo).extract_kwargs(4, x=3, y=2, _apply_defaults=True)
{‘w’: 4, ‘x’: 3, ‘y’: 2, ‘z’: ‘ZZ’}</p>
</dd></dl>

<dl class="py method">
<dt id="py2store.utils.signatures.Sig.kwargs_from_args_and_kwargs">
<code class="sig-name descname">kwargs_from_args_and_kwargs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">args</span></em>, <em class="sig-param"><span class="n">kwargs</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">apply_defaults</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">allow_partial</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">allow_excess</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">ignore_kind</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/signatures.html#Sig.kwargs_from_args_and_kwargs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.Sig.kwargs_from_args_and_kwargs" title="Permalink to this definition">¶</a></dt>
<dd><p>Extracts a dict of input argument values for target signature, from args and kwargs.</p>
<p>When you need to manage how the arguments of a function are specified, you need to take care of
multiple cases depending on whether they were specified as positional arguments
(<cite>args</cite>) or keyword arguments (<cite>kwargs</cite>).</p>
<p>The <cite>kwargs_from_args_and_kwargs</cite> (and it’s sorta-inverse inverse, <cite>args_and_kwargs_from_kwargs</cite>)
are there to help you manage this.</p>
<p>If you could rely on the the fact that only <cite>kwargs</cite> were given it would reduce the complexity of your code.
This is why we have the <cite>ch_signature_to_all_pk</cite> function in <cite>signatures.py</cite>.</p>
<p>We also need to have a means to make a <cite>kwargs</cite> only from the actual <cite>(*args, **kwargs)</cite> used at runtime.
We have <cite>Signature.bind</cite> (and <cite>bind_partial</cite>) for that.</p>
<p>But these methods will fail if there is extra stuff in the <cite>kwargs</cite>.
Yet sometimes we’d like to have a <cite>dict</cite> that services several functions that will extract their needs from it.</p>
<p>That’s where  <cite>Sig.extract_kwargs(*args, **kwargs)</cite> is needed.
:param args: The args the function will be called with.
:param kwargs: The kwargs the function will be called with.
:param apply_defaults: (bool) Whether to apply signature defaults to the non-specified argument names
:param allow_partial: (bool) True iff you want to allow partial signature fulfillment.
:param allow_excess: (bool) Set to True iff you want to allow extra kwargs items to be ignored.
:param ignore_kind: (bool) Set to True iff you want to ignore the position and keyword only kinds,</p>
<blockquote>
<div><p>in order to be able to accept args and kwargs in such a way that there can be cross-over
(args that are supposed to be keyword only, and kwargs that are supposed to be positional only)</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>An {argname: argval, …} dict</p>
</dd>
</dl>
<p>See also the sorta-inverse of this function: args_and_kwargs_from_kwargs</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;YY&#39;</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ZZ&#39;</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sig</span> <span class="o">=</span> <span class="n">Sig</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="n">sig</span><span class="o">.</span><span class="n">kwargs_from_args_and_kwargs</span><span class="p">((</span><span class="mi">11</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="s1">&#39;you&#39;</span><span class="p">),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="s1">&#39;zoo&#39;</span><span class="p">))</span>
<span class="gp">... </span>    <span class="o">==</span> <span class="n">sig</span><span class="o">.</span><span class="n">kwargs_from_args_and_kwargs</span><span class="p">((</span><span class="mi">11</span><span class="p">,</span> <span class="mi">22</span><span class="p">),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;you&#39;</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="s1">&#39;zoo&#39;</span><span class="p">))</span>
<span class="gp">... </span>    <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="s1">&#39;you&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="s1">&#39;zoo&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>By default, <cite>apply_defaults=False</cite>, which will lead to only get those arguments you input.
&gt;&gt;&gt; sig.kwargs_from_args_and_kwargs(args=(11,), kwargs={‘x’: 22})
{‘w’: 11, ‘x’: 22}</p>
<p>But if you specify <cite>apply_defaults=True</cite> non-specified non-require arguments
will be returned with their defaults:
&gt;&gt;&gt; sig.kwargs_from_args_and_kwargs(args=(11,), kwargs={‘x’: 22}, apply_defaults=True)
{‘w’: 11, ‘x’: 22, ‘y’: ‘YY’, ‘z’: ‘ZZ’}</p>
<p>By default, <cite>ignore_excess=False</cite>, so specifying kwargs that are not in the signature will lead to an exception.
&gt;&gt;&gt; sig.kwargs_from_args_and_kwargs(args=(11,), kwargs={‘x’: 22, ‘not_in_sig’: -1})
Traceback (most recent call last):</p>
<blockquote>
<div><p>…</p>
</div></blockquote>
<p>TypeError: Got unexpected keyword arguments: not_in_sig</p>
<p>Specifying <cite>allow_excess=True</cite> will ignore such excess fields of kwargs.
This is useful when you want to source several functions from a same dict.
&gt;&gt;&gt; sig.kwargs_from_args_and_kwargs(args=(11,), kwargs={‘x’: 22, ‘not_in_sig’: -1}, allow_excess=True)
{‘w’: 11, ‘x’: 22}</p>
<p>On the other side of <cite>ignore_excess</cite> you have <cite>allow_partial</cite> that will allow you, if
set to <cite>True</cite>, to underspecify the params of a function (in view of being completed later).
&gt;&gt;&gt; sig.kwargs_from_args_and_kwargs(args=(), kwargs={‘x’: 22})
Traceback (most recent call last):</p>
<blockquote>
<div><p>…</p>
</div></blockquote>
<p>TypeError: missing a required argument: ‘w’</p>
<p>But if you specify <cite>allow_partial=True</cite>…
&gt;&gt;&gt; sig.kwargs_from_args_and_kwargs(args=(), kwargs={‘x’: 22}, allow_partial=True)
{‘x’: 22}</p>
<p>That’s a lot of control (eight combinations total), but not everything is controllable here:
Position only and keyword only kinds need to be respected:
&gt;&gt;&gt; sig.kwargs_from_args_and_kwargs(args=(1, 2, 3, 4), kwargs={})
Traceback (most recent call last):</p>
<blockquote>
<div><p>…</p>
</div></blockquote>
<p>TypeError: too many positional arguments
&gt;&gt;&gt; sig.kwargs_from_args_and_kwargs(args=(), kwargs=dict(w=1, x=2, y=3, z=4))
Traceback (most recent call last):</p>
<blockquote>
<div><p>…</p>
</div></blockquote>
<p>TypeError: ‘w’ parameter is positional only, but was passed as a keyword</p>
<p>But if you want to ignore the kind of parameter, just say so:
&gt;&gt;&gt; sig.kwargs_from_args_and_kwargs(args=(1, 2, 3, 4), kwargs={}, ignore_kind=True)
{‘w’: 1, ‘x’: 2, ‘y’: 3, ‘z’: 4}
&gt;&gt;&gt; sig.kwargs_from_args_and_kwargs(args=(), kwargs=dict(w=1, x=2, y=3, z=4), ignore_kind=True)
{‘w’: 1, ‘x’: 2, ‘y’: 3, ‘z’: 4}</p>
</dd></dl>

<dl class="py method">
<dt id="py2store.utils.signatures.Sig.merge_with_sig">
<code class="sig-name descname">merge_with_sig</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">sig</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>Iterable<span class="p">[</span>inspect.Parameter<span class="p">]</span><span class="p">, </span>Mapping<span class="p">[</span>str<span class="p">, </span>inspect.Parameter<span class="p">]</span><span class="p">, </span>Callable<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">ch_to_all_pk</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/signatures.html#Sig.merge_with_sig"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.Sig.merge_with_sig" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a signature obtained by merging self signature with another signature.
Insofar as it can, given the kind precedence rules, the arguments of self will appear first.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sig</strong> – The signature to merge with.</p></li>
<li><p><strong>ch_to_all_pk</strong> – Whether to change all kinds of both signatures to PK (POSITIONAL_OR_KEYWORD)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store.utils.signatures</span> <span class="kn">import</span> <span class="n">Sig</span><span class="p">,</span> <span class="n">KO</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">...</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Sig</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span>
<span class="go">&lt;Sig (a=None, *, b=1, c=2)&gt;</span>
</pre></div>
</div>
<p>Observe where the new arguments <code class="docutils literal notranslate"><span class="pre">d</span></code> and <code class="docutils literal notranslate"><span class="pre">e</span></code> are placed,
according to whether they have defaults and what their kind is:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">merge_with_sig</span><span class="p">([</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">])</span>
<span class="go">&lt;Sig (d, e, a=None, *, b=1, c=2)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">merge_with_sig</span><span class="p">([</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)])</span>
<span class="go">&lt;Sig (d, a=None, e=4, *, b=1, c=2)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">merge_with_sig</span><span class="p">([</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">KO</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">4</span><span class="p">)])</span>
<span class="go">&lt;Sig (d, a=None, *, b=1, c=2, e=4)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">merge_with_sig</span><span class="p">([</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">KO</span><span class="p">),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">KO</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">4</span><span class="p">)])</span>
<span class="go">&lt;Sig (a=None, *, d, b=1, c=2, e=4)&gt;</span>
</pre></div>
</div>
<p>If the kind of the params is not important, but order is, you can specify <code class="docutils literal notranslate"><span class="pre">ch_to_all_pk=True</span></code>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">merge_with_sig</span><span class="p">([</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">],</span> <span class="n">ch_to_all_pk</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&lt;Sig (d, e, a=None, b=1, c=2)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">merge_with_sig</span><span class="p">([(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)],</span> <span class="n">ch_to_all_pk</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&lt;Sig (a=None, b=1, c=2, d=3, e=4)&gt;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="py2store.utils.signatures.Sig.params">
<em class="property">property </em><code class="sig-name descname">params</code><a class="headerlink" href="#py2store.utils.signatures.Sig.params" title="Permalink to this definition">¶</a></dt>
<dd><p>Just list(self.parameters.values()), because that’s often what we want.
Why a Sig.params property when we already have a Sig.parameters property?</p>
<p>Well, as much as is boggles my mind, it so happens that the Signature.parameters
is a name-&gt;Parameter mapping, but the Signature argument <cite>parameters</cite>, though baring the same name,
is expected to be a list of Parameter instances.</p>
<p>So Sig.params is there to restore semantic consistence sanity.</p>
</dd></dl>

<dl class="py method">
<dt id="py2store.utils.signatures.Sig.sig_or_none">
<em class="property">classmethod </em><code class="sig-name descname">sig_or_none</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">obj</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/signatures.html#Sig.sig_or_none"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.Sig.sig_or_none" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a Sig instance, or None if there was a ValueError trying to construct it.
One use case is to be able to tell if an object has a signature or not.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">has_signature</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">Sig</span><span class="o">.</span><span class="n">sig_or_none</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">has_signature</span><span class="p">(</span><span class="nb">print</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">has_signature</span><span class="p">(</span><span class="n">Sig</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>This means we can more easily get signatures in bulk without having to write try/catches:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="n">Sig</span><span class="o">.</span><span class="n">sig_or_none</span><span class="p">,</span> <span class="p">(</span><span class="n">Sig</span><span class="p">,</span> <span class="nb">print</span><span class="p">,</span> <span class="nb">map</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">Sig</span><span class="o">.</span><span class="n">wrap</span><span class="p">)))))</span>
<span class="go">2</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="py2store.utils.signatures.Sig.source_args_and_kwargs">
<code class="sig-name descname">source_args_and_kwargs</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="n">_ignore_kind</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">_allow_partial</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">_apply_defaults</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/signatures.html#Sig.source_args_and_kwargs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.Sig.source_args_and_kwargs" title="Permalink to this definition">¶</a></dt>
<dd><p>Source the (args, kwargs) for the signature instance, ignoring excess arguments.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">w</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">**</span> <span class="n">z</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">Sig</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="o">.</span><span class="n">source_args_and_kwargs</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s1">&#39;keywords&#39;</span><span class="p">,</span> <span class="n">are</span><span class="o">=</span><span class="s1">&#39;ignored&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="p">((</span><span class="mi">4</span><span class="p">,),</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>The difference with source_kwargs is that here the output is ready to be called by the
function whose signature we have, since the position-only arguments will be returned as
args.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="go">10</span>
</pre></div>
</div>
<p>Note that though <cite>w</cite> is a position only argument, you can specify <cite>w=4</cite> as a keyword argument too (by default):
&gt;&gt;&gt; args, kwargs = Sig(foo).source_args_and_kwargs(w=4, x=3, y=2, extra=’keywords’, are=’ignored’)
&gt;&gt;&gt; assert (args, kwargs) == ((4,), {‘x’: 3, ‘y’: 2})</p>
<p>If you don’t want to allow that, you can say <cite>_ignore_kind=False</cite>
&gt;&gt;&gt; Sig(foo).source_args_and_kwargs(w=4, x=3, y=2, extra=’keywords’, are=’ignored’, _ignore_kind=False)
Traceback (most recent call last):</p>
<blockquote>
<div><p>…</p>
</div></blockquote>
<p>TypeError: ‘w’ parameter is positional only, but was passed as a keyword</p>
<p>You can use <cite>_allow_partial</cite> that will allow you, if
set to <cite>True</cite>, to underspecify the params of a function (in view of being completed later).
&gt;&gt;&gt; Sig(foo).source_args_and_kwargs(x=3, y=2, extra=’keywords’, are=’ignored’)
Traceback (most recent call last):</p>
<blockquote>
<div><p>…</p>
</div></blockquote>
<p>TypeError: missing a required argument: ‘w’</p>
<p>But if you specify <cite>_allow_partial=True</cite>…
&gt;&gt;&gt; args, kwargs = Sig(foo).source_args_and_kwargs(x=3, y=2, extra=’keywords’, are=’ignored’, _allow_partial=True)
&gt;&gt;&gt; (args, kwargs) == ((), {‘x’: 3, ‘y’: 2})
True</p>
<p>By default, <cite>_apply_defaults=False</cite>, which will lead to only get those arguments you input.
&gt;&gt;&gt; args, kwargs = Sig(foo).source_args_and_kwargs(4, x=3, y=2, extra=’keywords’, are=’ignored’)
&gt;&gt;&gt; (args, kwargs) == ((4,), {‘x’: 3, ‘y’: 2})
True</p>
<p>But if you specify <cite>_apply_defaults=True</cite> non-specified non-require arguments
will be returned with their defaults:
&gt;&gt;&gt; args, kwargs = Sig(foo).source_args_and_kwargs(4, x=3, y=2, extra=’keywords’, are=’ignored’, _apply_defaults=True)
&gt;&gt;&gt; (args, kwargs) == ((4,), {‘x’: 3, ‘y’: 2, ‘z’: 1})
True</p>
</dd></dl>

<dl class="py method">
<dt id="py2store.utils.signatures.Sig.source_kwargs">
<code class="sig-name descname">source_kwargs</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="n">_ignore_kind</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">_allow_partial</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">_apply_defaults</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/signatures.html#Sig.source_kwargs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.Sig.source_kwargs" title="Permalink to this definition">¶</a></dt>
<dd><p>Source the kwargs for the signature instance, ignoring excess arguments.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;YY&#39;</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ZZ&#39;</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Sig</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="o">.</span><span class="n">source_kwargs</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s1">&#39;keywords&#39;</span><span class="p">,</span> <span class="n">are</span><span class="o">=</span><span class="s1">&#39;ignored&#39;</span><span class="p">)</span>
<span class="go">{&#39;w&#39;: 11, &#39;x&#39;: 22}</span>
</pre></div>
</div>
<p>Note that though <cite>w</cite> is a position only argument, you can specify <cite>w=11</cite> as a keyword argument too (by default):
&gt;&gt;&gt; Sig(foo).source_kwargs(w=11, x=22, extra=’keywords’, are=’ignored’)
{‘w’: 11, ‘x’: 22}</p>
<p>If you don’t want to allow that, you can say <cite>_ignore_kind=False</cite>
&gt;&gt;&gt; Sig(foo).source_kwargs(w=11, x=22, extra=’keywords’, are=’ignored’, _ignore_kind=False)
Traceback (most recent call last):</p>
<blockquote>
<div><p>…</p>
</div></blockquote>
<p>TypeError: ‘w’ parameter is positional only, but was passed as a keyword</p>
<p>You can use <cite>_allow_partial</cite> that will allow you, if
set to <cite>True</cite>, to underspecify the params of a function (in view of being completed later).
&gt;&gt;&gt; Sig(foo).source_kwargs(x=3, y=2, extra=’keywords’, are=’ignored’)
Traceback (most recent call last):</p>
<blockquote>
<div><p>…</p>
</div></blockquote>
<p>TypeError: missing a required argument: ‘w’</p>
<p>But if you specify <cite>_allow_partial=True</cite>…
&gt;&gt;&gt; Sig(foo).source_kwargs(x=3, y=2, extra=’keywords’, are=’ignored’, _allow_partial=True)
{‘x’: 3, ‘y’: 2}</p>
<p>By default, <cite>_apply_defaults=False</cite>, which will lead to only get those arguments you input.
&gt;&gt;&gt; Sig(foo).source_kwargs(4, x=3, y=2, extra=’keywords’, are=’ignored’)
{‘w’: 4, ‘x’: 3, ‘y’: 2}</p>
<p>But if you specify <cite>_apply_defaults=True</cite> non-specified non-require arguments
will be returned with their defaults:
&gt;&gt;&gt; Sig(foo).source_kwargs(4, x=3, y=2, extra=’keywords’, are=’ignored’, _apply_defaults=True)
{‘w’: 4, ‘x’: 3, ‘y’: 2, ‘z’: ‘ZZ’}</p>
</dd></dl>

<dl class="py method">
<dt id="py2store.utils.signatures.Sig.to_signature_kwargs">
<code class="sig-name descname">to_signature_kwargs</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/signatures.html#Sig.to_signature_kwargs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.Sig.to_signature_kwargs" title="Permalink to this definition">¶</a></dt>
<dd><p>The dict of keyword arguments to make this signature instance.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Sig</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">to_signature_kwargs</span><span class="p">()</span>  
<span class="go">{&#39;parameters&#39;:</span>
<span class="go">    [&lt;Parameter &quot;w&quot;&gt;,</span>
<span class="go">    &lt;Parameter &quot;x: float = 2&quot;&gt;,</span>
<span class="go">    &lt;Parameter &quot;y=1&quot;&gt;,</span>
<span class="go">    &lt;Parameter &quot;z: int = 0&quot;&gt;],</span>
<span class="go">&#39;return_annotation&#39;: &lt;class &#39;float&#39;&gt;}</span>
</pre></div>
</div>
<p>Note that this does NOT return:
<a href="#id29"><span class="problematic" id="id30">``</span></a><a href="#id31"><span class="problematic" id="id32">`</span></a></p>
<blockquote>
<div><p>{‘parameters’: self.parameters,
‘return_annotation’: self.return_annotation}</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">which</span> <span class="pre">would</span> <span class="pre">not</span> <span class="pre">actually</span> <span class="pre">work</span> <span class="pre">as</span> <span class="pre">keyword</span> <span class="pre">arguments</span> <span class="pre">of</span> <span class="pre">``Signature</span></code>.
Yeah, I know. Don’t ask me, ask the authors of <cite>Signature</cite>!</p>
<p>Instead, <cite>parammeters</cite> will be <code class="docutils literal notranslate"><span class="pre">list(self.parameters.values())</span></code>, which does work.</p>
</dd></dl>

<dl class="py method">
<dt id="py2store.utils.signatures.Sig.to_simple_signature">
<code class="sig-name descname">to_simple_signature</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/signatures.html#Sig.to_simple_signature"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.Sig.to_simple_signature" title="Permalink to this definition">¶</a></dt>
<dd><p>A builtin <code class="docutils literal notranslate"><span class="pre">inspect.Signature</span></code> instance equivalent (i.e. without the extra properties and methods)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Sig</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">to_simple_signature</span><span class="p">()</span>
<span class="go">&lt;Signature (w, /, x: float = 2, y=1, *, z: int = 0)&gt;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="py2store.utils.signatures.Sig.with_defaults">
<em class="property">property </em><code class="sig-name descname">with_defaults</code><a class="headerlink" href="#py2store.utils.signatures.Sig.with_defaults" title="Permalink to this definition">¶</a></dt>
<dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">i2.signatures</span> <span class="kn">import</span> <span class="n">Sig</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">Sig</span><span class="p">(</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="n">with_defaults</span><span class="p">)</span>
<span class="go">[&#39;args&#39;, &#39;x&#39;, &#39;y&#39;, &#39;kwargs&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="py2store.utils.signatures.Sig.without_defaults">
<em class="property">property </em><code class="sig-name descname">without_defaults</code><a class="headerlink" href="#py2store.utils.signatures.Sig.without_defaults" title="Permalink to this definition">¶</a></dt>
<dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">i2.signatures</span> <span class="kn">import</span> <span class="n">Sig</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">Sig</span><span class="p">(</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="n">without_defaults</span><span class="p">)</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="py2store.utils.signatures.Sig.wrap">
<code class="sig-name descname">wrap</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/signatures.html#Sig.wrap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.Sig.wrap" title="Permalink to this definition">¶</a></dt>
<dd><p>Gives the input function the signature.
This is similar to the <cite>functools.wraps</cite> function, but parametrized by a signature
(not a callable). Also, where as both write to the input func’s <cite>__signature__</cite>
attribute, here we also write to
- <cite>__defaults__</cite> and <cite>__kwdefaults__</cite>, extracting these from <cite>__signature__</cite></p>
<blockquote>
<div><p>(functools.wraps doesn’t do that at the time of writing this
(see <a class="reference external" href="https://github.com/python/cpython/pull/21379">https://github.com/python/cpython/pull/21379</a>)).</p>
</div></blockquote>
<ul class="simple">
<li><p><cite>__annotations__</cite> (also extracted from <cite>__signature__</cite>)</p></li>
<li><dl class="simple">
<dt>does not write to <cite>__module__</cite>, <cite>__name__</cite>, <cite>__qualname__</cite>, <cite>__doc__</cite></dt><dd><p>(because again, we’re basinig the injecton on a signature, not a function,
so we have no name, doc, etc…)</p>
</dd>
</dl>
</li>
</ul>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">w</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">**</span> <span class="n">z</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># 0 + 1 * 2 ** 3</span>
<span class="go">8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="vm">__defaults__</span>
<span class="go">(1, 2, 3)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="mi">8</span> <span class="o">==</span> <span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Now let’s create a very similar function to f, but where:
- w is not position-only
- x annot is int instead of float, and doesn’t have a default
- z’s default changes to 10
&gt;&gt;&gt; def g(w, x: int, y=2, z: int = 10):
…     return w + x * y ** z
&gt;&gt;&gt; s = Sig(g)
&gt;&gt;&gt; f = s.wrap(f)
&gt;&gt;&gt; import inspect
&gt;&gt;&gt; inspect.signature(f)  # see that
&lt;Signature (w, x: int, y=2, z: int = 10)&gt;
&gt;&gt;&gt; # But (unlike with functools.wraps) here we get __defaults__ and __kwdefault__
&gt;&gt;&gt; f.__defaults__  # see that x has no more default, and z’s default changed to 10
(2, 10)
&gt;&gt;&gt; f(0, 1)  # see that now we get a different output because using different defaults
1024</p>
<dl class="simple">
<dt>TODO: Something goes wrong when using keyword only arguments.</dt><dd><p>Note that the same problem occurs with functools.wraps, and even boltons.funcutils.wraps.</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">w</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">**</span> <span class="n">z</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># 0 + 1 * 2 ** 3</span>
<span class="go">8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># error expected!</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">f() takes from 1 to 3 positional arguments but 4 were given</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">w</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">**</span> <span class="n">z</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Sig</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="vm">__defaults__</span>
<span class="go">(2,)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="vm">__kwdefaults__</span>
<span class="go">{&#39;z&#39;: 10}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># error not expected! TODO: Make it work!!</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">f() takes from 2 to 3 positional arguments but 4 were given</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="py2store.utils.signatures.assure_params">
<code class="sig-prename descclassname">py2store.utils.signatures.</code><code class="sig-name descname">assure_params</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">obj</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>Iterable<span class="p">[</span>inspect.Parameter<span class="p">]</span><span class="p">, </span>Mapping<span class="p">[</span>str<span class="p">, </span>inspect.Parameter<span class="p">]</span><span class="p">, </span>Callable<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#py2store.utils.signatures.assure_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Get an interable of Parameter instances from an object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>obj</strong> – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
<p>From a callable:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ensure_params</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="go">[&lt;Parameter &quot;w&quot;&gt;, &lt;Parameter &quot;x: float = 1&quot;&gt;, &lt;Parameter &quot;y=1&quot;&gt;, &lt;Parameter &quot;z: int = 1&quot;&gt;]</span>
</pre></div>
</div>
<p>From an iterable of strings, dicts, or tuples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ensure_params</span><span class="p">([</span><span class="s1">&#39;xyz&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="c1"># if you want an annotation without a default use Parameter.empty</span>
<span class="gp">... </span>    <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>  <span class="c1"># if you just want a default, make it the second element of your tuple</span>
<span class="gp">... </span>    <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">Parameter</span><span class="o">.</span><span class="n">VAR_KEYWORD</span><span class="p">)])</span>  <span class="c1"># all kinds are by default PK: Use dict to specify otherwise.</span>
<span class="go">[&lt;Parameter &quot;xyz&quot;&gt;, &lt;Parameter &quot;b: int&quot;&gt;, &lt;Parameter &quot;c=2&quot;&gt;, &lt;Parameter &quot;**d&quot;&gt;]</span>
</pre></div>
</div>
<p>If no input is given, an empty list is returned.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ensure_params</span><span class="p">()</span>  <span class="c1"># equivalent to ensure_params(None)</span>
<span class="go">[]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.utils.signatures.call_forgivingly">
<code class="sig-prename descclassname">py2store.utils.signatures.</code><code class="sig-name descname">call_forgivingly</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/signatures.html#call_forgivingly"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.call_forgivingly" title="Permalink to this definition">¶</a></dt>
<dd><p>Call function on giben args and kwargs, but only taking what the function needs
(not choking if they’re extras variables)</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.utils.signatures.commands_dict">
<code class="sig-prename descclassname">py2store.utils.signatures.</code><code class="sig-name descname">commands_dict</code><span class="sig-paren">(</span><em class="sig-param">funcs, *, mk_command: Callable[[Callable, tuple, dict], Any] = &lt;class 'py2store.utils.signatures.Command'&gt;, what_to_do_with_remainding='ignore', **kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/signatures.html#commands_dict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.commands_dict" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>funcs</strong> – </p></li>
<li><p><strong>mk_command</strong> – </p></li>
<li><p><strong>kwargs</strong> – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">mult</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">formula1</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">((</span><span class="n">w</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="n">z</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">commands_dict</span><span class="p">((</span><span class="n">add</span><span class="p">,</span> <span class="n">mult</span><span class="p">,</span> <span class="n">formula1</span><span class="p">),</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="n">add</span><span class="p">]()</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="n">mult</span><span class="p">]()</span>
<span class="go">7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="n">formula1</span><span class="p">]()</span>
<span class="go">13</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.utils.signatures.common_and_diff_argnames">
<code class="sig-prename descclassname">py2store.utils.signatures.</code><code class="sig-name descname">common_and_diff_argnames</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func1</span><span class="p">:</span> <span class="n">callable</span></em>, <em class="sig-param"><span class="n">func2</span><span class="p">:</span> <span class="n">callable</span></em><span class="sig-paren">)</span> &#x2192; dict<a class="reference internal" href="_modules/py2store/utils/signatures.html#common_and_diff_argnames"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.common_and_diff_argnames" title="Permalink to this definition">¶</a></dt>
<dd><p>Get list of argument names that are common to two functions, as well as the two lists of names that are different</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func1</strong> – First function</p></li>
<li><p><strong>func2</strong> – Second function</p></li>
</ul>
</dd>
</dl>
<p>Returns: A dict with fields ‘common’, ‘func1_not_func2’, and ‘func2_not_func1’</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">common_and_diff_argnames</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
<span class="go">{&#39;common&#39;: [&#39;t&#39;, &#39;i&#39;], &#39;func1_not_func2&#39;: [&#39;h&#39;, &#39;n&#39;, &#39;k&#39;], &#39;func2_not_func1&#39;: [&#39;w&#39;, &#39;c&#39;, &#39;e&#39;]}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">common_and_diff_argnames</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
<span class="go">{&#39;common&#39;: [&#39;t&#39;, &#39;i&#39;], &#39;func1_not_func2&#39;: [&#39;w&#39;, &#39;c&#39;, &#39;e&#39;], &#39;func2_not_func1&#39;: [&#39;h&#39;, &#39;n&#39;, &#39;k&#39;]}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.utils.signatures.ensure_params">
<code class="sig-prename descclassname">py2store.utils.signatures.</code><code class="sig-name descname">ensure_params</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">obj</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>Iterable<span class="p">[</span>inspect.Parameter<span class="p">]</span><span class="p">, </span>Mapping<span class="p">[</span>str<span class="p">, </span>inspect.Parameter<span class="p">]</span><span class="p">, </span>Callable<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/signatures.html#ensure_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.ensure_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Get an interable of Parameter instances from an object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>obj</strong> – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
<p>From a callable:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ensure_params</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="go">[&lt;Parameter &quot;w&quot;&gt;, &lt;Parameter &quot;x: float = 1&quot;&gt;, &lt;Parameter &quot;y=1&quot;&gt;, &lt;Parameter &quot;z: int = 1&quot;&gt;]</span>
</pre></div>
</div>
<p>From an iterable of strings, dicts, or tuples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ensure_params</span><span class="p">([</span><span class="s1">&#39;xyz&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="c1"># if you want an annotation without a default use Parameter.empty</span>
<span class="gp">... </span>    <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>  <span class="c1"># if you just want a default, make it the second element of your tuple</span>
<span class="gp">... </span>    <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">Parameter</span><span class="o">.</span><span class="n">VAR_KEYWORD</span><span class="p">)])</span>  <span class="c1"># all kinds are by default PK: Use dict to specify otherwise.</span>
<span class="go">[&lt;Parameter &quot;xyz&quot;&gt;, &lt;Parameter &quot;b: int&quot;&gt;, &lt;Parameter &quot;c=2&quot;&gt;, &lt;Parameter &quot;**d&quot;&gt;]</span>
</pre></div>
</div>
<p>If no input is given, an empty list is returned.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ensure_params</span><span class="p">()</span>  <span class="c1"># equivalent to ensure_params(None)</span>
<span class="go">[]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.utils.signatures.extract_arguments">
<code class="sig-prename descclassname">py2store.utils.signatures.</code><code class="sig-name descname">extract_arguments</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">params</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>Iterable<span class="p">[</span>inspect.Parameter<span class="p">]</span><span class="p">, </span>Mapping<span class="p">[</span>str<span class="p">, </span>inspect.Parameter<span class="p">]</span><span class="p">, </span>Callable<span class="p">]</span></span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">what_to_do_with_remainding</span><span class="o">=</span><span class="default_value">'return'</span></em>, <em class="sig-param"><span class="n">include_all_when_var_keywords_in_params</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">assert_no_missing_position_only_args</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/signatures.html#extract_arguments"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.extract_arguments" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract arguments needed to satisfy the params of a callable, dealing with the dirty details.</p>
<p>Returns an (param_args, param_kwargs, remaining_kwargs) tuple where
- param_args are the values of kwargs that are PO (POSITION_ONLY) as defined by params,
- param_kwargs are those names that are both in params and not in param_args, and
- remaining_kwargs are the remaining.</p>
<p>Intended usage: When you need to call a function <cite>func</cite> that has some position-only arguments,
but you have a kwargs dict of arguments in your hand. You can’t just to <cite>func(**kwargs)</cite>.
But you can (now) do
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">args,</span> <span class="pre">kwargs,</span> <span class="pre">remaining</span> <span class="pre">=</span> <span class="pre">extract_arguments(kwargs,</span> <span class="pre">func)</span>&#160; <span class="pre">#</span> <span class="pre">extract</span> <span class="pre">from</span> <span class="pre">kwargs</span> <span class="pre">what</span> <span class="pre">you</span> <span class="pre">need</span> <span class="pre">for</span> <span class="pre">func</span>
<span class="pre">#</span> <span class="pre">...</span> <span class="pre">check</span> <span class="pre">if</span> <span class="pre">remaing</span> <span class="pre">is</span> <span class="pre">empty</span> <span class="pre">(or</span> <span class="pre">not,</span> <span class="pre">depending</span> <span class="pre">on</span> <span class="pre">your</span> <span class="pre">paranoia),</span> <span class="pre">and</span> <span class="pre">then</span> <span class="pre">call</span> <span class="pre">the</span> <span class="pre">func:</span>
<span class="pre">func(*args,</span> <span class="pre">**kwargs)</span>
<span class="pre">`</span></code>
(And if you doing that a lot: Do put it in a decorator!)</p>
<p>See Also: extract_arguments.without_remainding</p>
<p>The most frequent case you’ll encounter is when there’s no POSITION_ONLY args, your param_args will be empty
and you param_kwargs will contain all the arguments that match params, in the order of these params.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">signature</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">extract_arguments</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s1">&#39;stuff&#39;</span><span class="p">)</span>
<span class="go">((), {&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;c&#39;: 3, &#39;d&#39;: 4}, {&#39;extra&#39;: &#39;stuff&#39;})</span>
</pre></div>
</div>
<p>But sometimes you do have POSITION_ONLY arguments.
What extract_arguments will do for you is return the value of these as the first element of
the triple.
&gt;&gt;&gt; def f(a, b, c=None, /, d=0): …
&gt;&gt;&gt; extract_arguments(f, b=2, a=1, c=3, d=4, extra=’stuff’)
((1, 2, 3), {‘d’: 4}, {‘extra’: ‘stuff’})</p>
<p>Note above how we get <cite>(1, 2, 3)</cite>, the order defined by the func’s signature,
instead of <cite>(2, 1, 3)</cite>, the order defined by the kwargs.
So it’s the params (e.g. function signature) that determine the order, not kwargs.
When using to call a function, this is especially crucial if we use POSITION_ONLY arguments.</p>
<p>See also that the third output, the remaining_kwargs, as <cite>{‘extra’: ‘stuff’}</cite> since
it was not in the params of the function.
Even if you include a VAR_KEYWORD kind of argument in the function, it won’t change
this behavior.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">extract_arguments</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s1">&#39;stuff&#39;</span><span class="p">)</span>
<span class="go">((1, 2, 3), {&#39;d&#39;: 4}, {&#39;extra&#39;: &#39;stuff&#39;})</span>
</pre></div>
</div>
<p>This is because we don’t want to assume that all the kwargs can actually be
included in a call to the function behind the params.
Instead, the user can chose whether to include the remainder by doing a:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">param_kwargs.update(remaining_kwargs)</span>
<span class="pre">`</span></code>
et voilà.</p>
<p>That said, we do understand that it may be a common pattern, so we’ll do that extra step for you
if you specify <cite>include_all_when_var_keywords_in_params=True</cite>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">extract_arguments</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s1">&#39;stuff&#39;</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="n">include_all_when_var_keywords_in_params</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">((1, 2, 3), {&#39;d&#39;: 4, &#39;extra&#39;: &#39;stuff&#39;}, {})</span>
</pre></div>
</div>
<p>If you’re expecting no remainder you might want to just get the args and kwargs (not this third
expected-to-be-empty remainder). You have two ways to do that, specifying:</p>
<blockquote>
<div><p><cite>what_to_do_with_remainding=’ignore’</cite>, which will just return the (args, kwargs) pair
<cite>what_to_do_with_remainding=’assert_empty’</cite>, which will do the same, but first assert the remainder is empty</p>
</div></blockquote>
<p>We suggest to use <cite>functools.partial</cite> to configure the <cite>argument_argument</cite> you need.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arg_extractor</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">extract_arguments</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">what_to_do_with_remainding</span><span class="o">=</span><span class="s1">&#39;assert_empty&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">include_all_when_var_keywords_in_params</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arg_extractor</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s1">&#39;stuff&#39;</span><span class="p">)</span>
<span class="go">((1, 2, 3), {&#39;d&#39;: 4, &#39;extra&#39;: &#39;stuff&#39;})</span>
</pre></div>
</div>
<p>And what happens if the kwargs doesn’t contain all the POSITION_ONLY arguments?</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">extract_arguments</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s1">&#39;is a kw arg&#39;</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="s1">&#39;is not an arg at all&#39;</span><span class="p">)</span>
<span class="go">((MissingArgValFor(&quot;a&quot;), 2, MissingArgValFor(&quot;c&quot;)), {&#39;d&#39;: &#39;is a kw arg&#39;}, {&#39;e&#39;: &#39;is not an arg at all&#39;})</span>
</pre></div>
</div>
<p>A few more examples…</p>
<p>Let’s call <cite>extract_arguments</cite> with params being not a function,
but, a Signature instance, a mapping whose values are Parameter instances,
or an iterable of Parameter instances…</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span>  <span class="o">/</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sig</span> <span class="o">=</span> <span class="n">Signature</span><span class="o">.</span><span class="n">from_callable</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">param_map</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">parameters</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">param_iterable</span> <span class="o">=</span> <span class="n">param_map</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s1">&#39;stuff&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">extract_arguments</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="n">extract_arguments</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">extract_arguments</span><span class="p">(</span><span class="n">param_map</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="n">extract_arguments</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">extract_arguments</span><span class="p">(</span><span class="n">param_iterable</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="n">extract_arguments</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>Edge case:
No params specified? No problem. You’ll just get empty args and kwargs. Everything in the remainder
&gt;&gt;&gt; extract_arguments(params=(), b=2, a=1, c=3, d=0)
((), {}, {‘b’: 2, ‘a’: 1, ‘c’: 3, ‘d’: 0})</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>params</strong> – Specifies what PO arguments should be extracted.
Could be a callable, Signature, iterable of Parameters…</p></li>
<li><p><strong>what_to_do_with_remainding</strong> – ‘return’ (default): function will return <cite>param_args</cite>, <cite>param_kwargs</cite>, <cite>remaining_kwargs</cite>
‘ignore’: function will return <cite>param_args</cite>, <cite>param_kwargs</cite>
‘assert_empty’: function will assert that <cite>remaining_kwargs</cite> is empty and then return <cite>param_args</cite>, <cite>param_kwargs</cite></p></li>
</ul>
</dd>
</dl>
<p>:param include_all_when_var_keywords_in_params=False,
:param assert_no_missing_position_only_args=False,
:param kwargs: The kwargs to extract the args from
:return: A (param_args, param_kwargs, remaining_kwargs) tuple.</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.utils.signatures.extract_arguments_asserting_no_remainder">
<code class="sig-prename descclassname">py2store.utils.signatures.</code><code class="sig-name descname">extract_arguments_asserting_no_remainder</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">params</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>Iterable<span class="p">[</span>inspect.Parameter<span class="p">]</span><span class="p">, </span>Mapping<span class="p">[</span>str<span class="p">, </span>inspect.Parameter<span class="p">]</span><span class="p">, </span>Callable<span class="p">]</span></span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">what_to_do_with_remainding</span><span class="o">=</span><span class="default_value">'assert_empty'</span></em>, <em class="sig-param"><span class="n">include_all_when_var_keywords_in_params</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">assert_no_missing_position_only_args</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#py2store.utils.signatures.extract_arguments_asserting_no_remainder" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract arguments needed to satisfy the params of a callable, dealing with the dirty details.</p>
<p>Returns an (param_args, param_kwargs, remaining_kwargs) tuple where
- param_args are the values of kwargs that are PO (POSITION_ONLY) as defined by params,
- param_kwargs are those names that are both in params and not in param_args, and
- remaining_kwargs are the remaining.</p>
<p>Intended usage: When you need to call a function <cite>func</cite> that has some position-only arguments,
but you have a kwargs dict of arguments in your hand. You can’t just to <cite>func(**kwargs)</cite>.
But you can (now) do
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">args,</span> <span class="pre">kwargs,</span> <span class="pre">remaining</span> <span class="pre">=</span> <span class="pre">extract_arguments(kwargs,</span> <span class="pre">func)</span>&#160; <span class="pre">#</span> <span class="pre">extract</span> <span class="pre">from</span> <span class="pre">kwargs</span> <span class="pre">what</span> <span class="pre">you</span> <span class="pre">need</span> <span class="pre">for</span> <span class="pre">func</span>
<span class="pre">#</span> <span class="pre">...</span> <span class="pre">check</span> <span class="pre">if</span> <span class="pre">remaing</span> <span class="pre">is</span> <span class="pre">empty</span> <span class="pre">(or</span> <span class="pre">not,</span> <span class="pre">depending</span> <span class="pre">on</span> <span class="pre">your</span> <span class="pre">paranoia),</span> <span class="pre">and</span> <span class="pre">then</span> <span class="pre">call</span> <span class="pre">the</span> <span class="pre">func:</span>
<span class="pre">func(*args,</span> <span class="pre">**kwargs)</span>
<span class="pre">`</span></code>
(And if you doing that a lot: Do put it in a decorator!)</p>
<p>See Also: extract_arguments.without_remainding</p>
<p>The most frequent case you’ll encounter is when there’s no POSITION_ONLY args, your param_args will be empty
and you param_kwargs will contain all the arguments that match params, in the order of these params.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">signature</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">extract_arguments</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s1">&#39;stuff&#39;</span><span class="p">)</span>
<span class="go">((), {&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;c&#39;: 3, &#39;d&#39;: 4}, {&#39;extra&#39;: &#39;stuff&#39;})</span>
</pre></div>
</div>
<p>But sometimes you do have POSITION_ONLY arguments.
What extract_arguments will do for you is return the value of these as the first element of
the triple.
&gt;&gt;&gt; def f(a, b, c=None, /, d=0): …
&gt;&gt;&gt; extract_arguments(f, b=2, a=1, c=3, d=4, extra=’stuff’)
((1, 2, 3), {‘d’: 4}, {‘extra’: ‘stuff’})</p>
<p>Note above how we get <cite>(1, 2, 3)</cite>, the order defined by the func’s signature,
instead of <cite>(2, 1, 3)</cite>, the order defined by the kwargs.
So it’s the params (e.g. function signature) that determine the order, not kwargs.
When using to call a function, this is especially crucial if we use POSITION_ONLY arguments.</p>
<p>See also that the third output, the remaining_kwargs, as <cite>{‘extra’: ‘stuff’}</cite> since
it was not in the params of the function.
Even if you include a VAR_KEYWORD kind of argument in the function, it won’t change
this behavior.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">extract_arguments</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s1">&#39;stuff&#39;</span><span class="p">)</span>
<span class="go">((1, 2, 3), {&#39;d&#39;: 4}, {&#39;extra&#39;: &#39;stuff&#39;})</span>
</pre></div>
</div>
<p>This is because we don’t want to assume that all the kwargs can actually be
included in a call to the function behind the params.
Instead, the user can chose whether to include the remainder by doing a:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">param_kwargs.update(remaining_kwargs)</span>
<span class="pre">`</span></code>
et voilà.</p>
<p>That said, we do understand that it may be a common pattern, so we’ll do that extra step for you
if you specify <cite>include_all_when_var_keywords_in_params=True</cite>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">extract_arguments</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s1">&#39;stuff&#39;</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="n">include_all_when_var_keywords_in_params</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">((1, 2, 3), {&#39;d&#39;: 4, &#39;extra&#39;: &#39;stuff&#39;}, {})</span>
</pre></div>
</div>
<p>If you’re expecting no remainder you might want to just get the args and kwargs (not this third
expected-to-be-empty remainder). You have two ways to do that, specifying:</p>
<blockquote>
<div><p><cite>what_to_do_with_remainding=’ignore’</cite>, which will just return the (args, kwargs) pair
<cite>what_to_do_with_remainding=’assert_empty’</cite>, which will do the same, but first assert the remainder is empty</p>
</div></blockquote>
<p>We suggest to use <cite>functools.partial</cite> to configure the <cite>argument_argument</cite> you need.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arg_extractor</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">extract_arguments</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">what_to_do_with_remainding</span><span class="o">=</span><span class="s1">&#39;assert_empty&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">include_all_when_var_keywords_in_params</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arg_extractor</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s1">&#39;stuff&#39;</span><span class="p">)</span>
<span class="go">((1, 2, 3), {&#39;d&#39;: 4, &#39;extra&#39;: &#39;stuff&#39;})</span>
</pre></div>
</div>
<p>And what happens if the kwargs doesn’t contain all the POSITION_ONLY arguments?</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">extract_arguments</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s1">&#39;is a kw arg&#39;</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="s1">&#39;is not an arg at all&#39;</span><span class="p">)</span>
<span class="go">((MissingArgValFor(&quot;a&quot;), 2, MissingArgValFor(&quot;c&quot;)), {&#39;d&#39;: &#39;is a kw arg&#39;}, {&#39;e&#39;: &#39;is not an arg at all&#39;})</span>
</pre></div>
</div>
<p>A few more examples…</p>
<p>Let’s call <cite>extract_arguments</cite> with params being not a function,
but, a Signature instance, a mapping whose values are Parameter instances,
or an iterable of Parameter instances…</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span>  <span class="o">/</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sig</span> <span class="o">=</span> <span class="n">Signature</span><span class="o">.</span><span class="n">from_callable</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">param_map</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">parameters</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">param_iterable</span> <span class="o">=</span> <span class="n">param_map</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s1">&#39;stuff&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">extract_arguments</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="n">extract_arguments</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">extract_arguments</span><span class="p">(</span><span class="n">param_map</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="n">extract_arguments</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">extract_arguments</span><span class="p">(</span><span class="n">param_iterable</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="n">extract_arguments</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>Edge case:
No params specified? No problem. You’ll just get empty args and kwargs. Everything in the remainder
&gt;&gt;&gt; extract_arguments(params=(), b=2, a=1, c=3, d=0)
((), {}, {‘b’: 2, ‘a’: 1, ‘c’: 3, ‘d’: 0})</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>params</strong> – Specifies what PO arguments should be extracted.
Could be a callable, Signature, iterable of Parameters…</p></li>
<li><p><strong>what_to_do_with_remainding</strong> – ‘return’ (default): function will return <cite>param_args</cite>, <cite>param_kwargs</cite>, <cite>remaining_kwargs</cite>
‘ignore’: function will return <cite>param_args</cite>, <cite>param_kwargs</cite>
‘assert_empty’: function will assert that <cite>remaining_kwargs</cite> is empty and then return <cite>param_args</cite>, <cite>param_kwargs</cite></p></li>
</ul>
</dd>
</dl>
<p>:param include_all_when_var_keywords_in_params=False,
:param assert_no_missing_position_only_args=False,
:param kwargs: The kwargs to extract the args from
:return: A (param_args, param_kwargs, remaining_kwargs) tuple.</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.utils.signatures.extract_arguments_ignoring_remainder">
<code class="sig-prename descclassname">py2store.utils.signatures.</code><code class="sig-name descname">extract_arguments_ignoring_remainder</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">params</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>Iterable<span class="p">[</span>inspect.Parameter<span class="p">]</span><span class="p">, </span>Mapping<span class="p">[</span>str<span class="p">, </span>inspect.Parameter<span class="p">]</span><span class="p">, </span>Callable<span class="p">]</span></span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">what_to_do_with_remainding</span><span class="o">=</span><span class="default_value">'ignore'</span></em>, <em class="sig-param"><span class="n">include_all_when_var_keywords_in_params</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">assert_no_missing_position_only_args</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#py2store.utils.signatures.extract_arguments_ignoring_remainder" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract arguments needed to satisfy the params of a callable, dealing with the dirty details.</p>
<p>Returns an (param_args, param_kwargs, remaining_kwargs) tuple where
- param_args are the values of kwargs that are PO (POSITION_ONLY) as defined by params,
- param_kwargs are those names that are both in params and not in param_args, and
- remaining_kwargs are the remaining.</p>
<p>Intended usage: When you need to call a function <cite>func</cite> that has some position-only arguments,
but you have a kwargs dict of arguments in your hand. You can’t just to <cite>func(**kwargs)</cite>.
But you can (now) do
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">args,</span> <span class="pre">kwargs,</span> <span class="pre">remaining</span> <span class="pre">=</span> <span class="pre">extract_arguments(kwargs,</span> <span class="pre">func)</span>&#160; <span class="pre">#</span> <span class="pre">extract</span> <span class="pre">from</span> <span class="pre">kwargs</span> <span class="pre">what</span> <span class="pre">you</span> <span class="pre">need</span> <span class="pre">for</span> <span class="pre">func</span>
<span class="pre">#</span> <span class="pre">...</span> <span class="pre">check</span> <span class="pre">if</span> <span class="pre">remaing</span> <span class="pre">is</span> <span class="pre">empty</span> <span class="pre">(or</span> <span class="pre">not,</span> <span class="pre">depending</span> <span class="pre">on</span> <span class="pre">your</span> <span class="pre">paranoia),</span> <span class="pre">and</span> <span class="pre">then</span> <span class="pre">call</span> <span class="pre">the</span> <span class="pre">func:</span>
<span class="pre">func(*args,</span> <span class="pre">**kwargs)</span>
<span class="pre">`</span></code>
(And if you doing that a lot: Do put it in a decorator!)</p>
<p>See Also: extract_arguments.without_remainding</p>
<p>The most frequent case you’ll encounter is when there’s no POSITION_ONLY args, your param_args will be empty
and you param_kwargs will contain all the arguments that match params, in the order of these params.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">signature</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">extract_arguments</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s1">&#39;stuff&#39;</span><span class="p">)</span>
<span class="go">((), {&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;c&#39;: 3, &#39;d&#39;: 4}, {&#39;extra&#39;: &#39;stuff&#39;})</span>
</pre></div>
</div>
<p>But sometimes you do have POSITION_ONLY arguments.
What extract_arguments will do for you is return the value of these as the first element of
the triple.
&gt;&gt;&gt; def f(a, b, c=None, /, d=0): …
&gt;&gt;&gt; extract_arguments(f, b=2, a=1, c=3, d=4, extra=’stuff’)
((1, 2, 3), {‘d’: 4}, {‘extra’: ‘stuff’})</p>
<p>Note above how we get <cite>(1, 2, 3)</cite>, the order defined by the func’s signature,
instead of <cite>(2, 1, 3)</cite>, the order defined by the kwargs.
So it’s the params (e.g. function signature) that determine the order, not kwargs.
When using to call a function, this is especially crucial if we use POSITION_ONLY arguments.</p>
<p>See also that the third output, the remaining_kwargs, as <cite>{‘extra’: ‘stuff’}</cite> since
it was not in the params of the function.
Even if you include a VAR_KEYWORD kind of argument in the function, it won’t change
this behavior.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">extract_arguments</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s1">&#39;stuff&#39;</span><span class="p">)</span>
<span class="go">((1, 2, 3), {&#39;d&#39;: 4}, {&#39;extra&#39;: &#39;stuff&#39;})</span>
</pre></div>
</div>
<p>This is because we don’t want to assume that all the kwargs can actually be
included in a call to the function behind the params.
Instead, the user can chose whether to include the remainder by doing a:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">param_kwargs.update(remaining_kwargs)</span>
<span class="pre">`</span></code>
et voilà.</p>
<p>That said, we do understand that it may be a common pattern, so we’ll do that extra step for you
if you specify <cite>include_all_when_var_keywords_in_params=True</cite>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">extract_arguments</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s1">&#39;stuff&#39;</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="n">include_all_when_var_keywords_in_params</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">((1, 2, 3), {&#39;d&#39;: 4, &#39;extra&#39;: &#39;stuff&#39;}, {})</span>
</pre></div>
</div>
<p>If you’re expecting no remainder you might want to just get the args and kwargs (not this third
expected-to-be-empty remainder). You have two ways to do that, specifying:</p>
<blockquote>
<div><p><cite>what_to_do_with_remainding=’ignore’</cite>, which will just return the (args, kwargs) pair
<cite>what_to_do_with_remainding=’assert_empty’</cite>, which will do the same, but first assert the remainder is empty</p>
</div></blockquote>
<p>We suggest to use <cite>functools.partial</cite> to configure the <cite>argument_argument</cite> you need.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arg_extractor</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">extract_arguments</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">what_to_do_with_remainding</span><span class="o">=</span><span class="s1">&#39;assert_empty&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">include_all_when_var_keywords_in_params</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arg_extractor</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s1">&#39;stuff&#39;</span><span class="p">)</span>
<span class="go">((1, 2, 3), {&#39;d&#39;: 4, &#39;extra&#39;: &#39;stuff&#39;})</span>
</pre></div>
</div>
<p>And what happens if the kwargs doesn’t contain all the POSITION_ONLY arguments?</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">extract_arguments</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s1">&#39;is a kw arg&#39;</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="s1">&#39;is not an arg at all&#39;</span><span class="p">)</span>
<span class="go">((MissingArgValFor(&quot;a&quot;), 2, MissingArgValFor(&quot;c&quot;)), {&#39;d&#39;: &#39;is a kw arg&#39;}, {&#39;e&#39;: &#39;is not an arg at all&#39;})</span>
</pre></div>
</div>
<p>A few more examples…</p>
<p>Let’s call <cite>extract_arguments</cite> with params being not a function,
but, a Signature instance, a mapping whose values are Parameter instances,
or an iterable of Parameter instances…</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span>  <span class="o">/</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sig</span> <span class="o">=</span> <span class="n">Signature</span><span class="o">.</span><span class="n">from_callable</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">param_map</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">parameters</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">param_iterable</span> <span class="o">=</span> <span class="n">param_map</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s1">&#39;stuff&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">extract_arguments</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="n">extract_arguments</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">extract_arguments</span><span class="p">(</span><span class="n">param_map</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="n">extract_arguments</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">extract_arguments</span><span class="p">(</span><span class="n">param_iterable</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="n">extract_arguments</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>Edge case:
No params specified? No problem. You’ll just get empty args and kwargs. Everything in the remainder
&gt;&gt;&gt; extract_arguments(params=(), b=2, a=1, c=3, d=0)
((), {}, {‘b’: 2, ‘a’: 1, ‘c’: 3, ‘d’: 0})</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>params</strong> – Specifies what PO arguments should be extracted.
Could be a callable, Signature, iterable of Parameters…</p></li>
<li><p><strong>what_to_do_with_remainding</strong> – ‘return’ (default): function will return <cite>param_args</cite>, <cite>param_kwargs</cite>, <cite>remaining_kwargs</cite>
‘ignore’: function will return <cite>param_args</cite>, <cite>param_kwargs</cite>
‘assert_empty’: function will assert that <cite>remaining_kwargs</cite> is empty and then return <cite>param_args</cite>, <cite>param_kwargs</cite></p></li>
</ul>
</dd>
</dl>
<p>:param include_all_when_var_keywords_in_params=False,
:param assert_no_missing_position_only_args=False,
:param kwargs: The kwargs to extract the args from
:return: A (param_args, param_kwargs, remaining_kwargs) tuple.</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.utils.signatures.extract_commands">
<code class="sig-prename descclassname">py2store.utils.signatures.</code><code class="sig-name descname">extract_commands</code><span class="sig-paren">(</span><em class="sig-param">funcs, *, mk_command: Callable[[Callable, tuple, dict], Any] = &lt;class 'py2store.utils.signatures.Command'&gt;, what_to_do_with_remainding='ignore', **kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/signatures.html#extract_commands"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.extract_commands" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>funcs</strong> – </p></li>
<li><p><strong>mk_command</strong> – </p></li>
<li><p><strong>kwargs</strong> – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">mult</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">formula1</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">((</span><span class="n">w</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="n">z</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">commands</span> <span class="o">=</span> <span class="n">extract_commands</span><span class="p">((</span><span class="n">add</span><span class="p">,</span> <span class="n">mult</span><span class="p">,</span> <span class="n">formula1</span><span class="p">),</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Calling </span><span class="si">{</span><span class="n">command</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> with args=</span><span class="si">{</span><span class="n">command</span><span class="o">.</span><span class="n">args</span><span class="si">}</span><span class="s2"> and kwargs=</span><span class="si">{</span><span class="n">command</span><span class="o">.</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">command</span><span class="p">())</span>
<span class="gp">...</span>
<span class="go">Calling add with args=() and kwargs={&#39;a&#39;: 1, &#39;b&#39;: 2}</span>
<span class="go">3</span>
<span class="go">Calling mult with args=() and kwargs={&#39;x&#39;: 7}</span>
<span class="go">7</span>
<span class="go">Calling formula1 with args=(6,) and kwargs={&#39;x&#39;: 7}</span>
<span class="go">13</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.utils.signatures.insert_annotations">
<code class="sig-prename descclassname">py2store.utils.signatures.</code><code class="sig-name descname">insert_annotations</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">s</span><span class="p">:</span> <span class="n">inspect.Signature</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">return_annotation</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">annotations</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/signatures.html#insert_annotations"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.insert_annotations" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert annotations in a signature.
(Note: not really insert but returns a copy of input signature)
&gt;&gt;&gt; from inspect import signature
&gt;&gt;&gt; s = signature(lambda a, b, c=1, d=’bar’: 0)
&gt;&gt;&gt; s
&lt;Signature (a, b, c=1, d=’bar’)&gt;
&gt;&gt;&gt; ss = insert_annotations(s, b=int, d=str)
&gt;&gt;&gt; ss
&lt;Signature (a, b: int, c=1, d: str = ‘bar’)&gt;
&gt;&gt;&gt; insert_annotations(s, b=int, d=str, e=list)  # doctest: +IGNORE_EXCEPTION_DETAIL
Traceback (most recent call last):
…
AssertionError: These argument names weren’t found in the signature: {‘e’}</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.utils.signatures.mk_sig_from_args">
<code class="sig-prename descclassname">py2store.utils.signatures.</code><code class="sig-name descname">mk_sig_from_args</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args_without_default</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">args_with_defaults</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/signatures.html#mk_sig_from_args"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.mk_sig_from_args" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a Signature instance by specifying args_without_default and args_with_defaults.
&gt;&gt;&gt; mk_sig_from_args(‘a’, ‘b’, c=1, d=’bar’)
&lt;Signature (a, b, c=1, d=’bar’)&gt;</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.utils.signatures.param_for_kind">
<code class="sig-prename descclassname">py2store.utils.signatures.</code><code class="sig-name descname">param_for_kind</code><span class="sig-paren">(</span><em class="sig-param">name=None</em>, <em class="sig-param">kind='positional_or_keyword'</em>, <em class="sig-param">with_default=False</em>, <em class="sig-param">annotation</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/signatures.html#param_for_kind"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.param_for_kind" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to easily and flexibly make inspect.Parameter objects for testing.</p>
<p>It’s annoying to have to compose parameters from scratch to testing things.
This tool should help making it less annoying.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">i2.signatures</span> <span class="kn">import</span> <span class="n">param_kinds</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">param_for_kind</span><span class="p">,</span> <span class="n">param_kinds</span><span class="p">))</span>
<span class="go">[&lt;Parameter &quot;POSITIONAL_ONLY&quot;&gt;, &lt;Parameter &quot;POSITIONAL_OR_KEYWORD&quot;&gt;, &lt;Parameter &quot;VAR_POSITIONAL&quot;&gt;, &lt;Parameter &quot;KEYWORD_ONLY&quot;&gt;, &lt;Parameter &quot;VAR_KEYWORD&quot;&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">param_for_kind</span><span class="o">.</span><span class="n">positional_or_keyword</span><span class="p">()</span>
<span class="go">&lt;Parameter &quot;POSITIONAL_OR_KEYWORD&quot;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">param_for_kind</span><span class="o">.</span><span class="n">positional_or_keyword</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="go">&lt;Parameter &quot;foo&quot;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">param_for_kind</span><span class="o">.</span><span class="n">keyword_only</span><span class="p">()</span>
<span class="go">&lt;Parameter &quot;KEYWORD_ONLY&quot;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">param_for_kind</span><span class="o">.</span><span class="n">keyword_only</span><span class="p">(</span><span class="s1">&#39;baz&#39;</span><span class="p">,</span> <span class="n">with_default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&lt;Parameter &quot;baz=&#39;dflt_keyword_only&#39;&quot;&gt;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.utils.signatures.set_signature_of_func">
<code class="sig-prename descclassname">py2store.utils.signatures.</code><code class="sig-name descname">set_signature_of_func</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em>, <em class="sig-param"><span class="n">parameters</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">return_annotation</span></em>, <em class="sig-param"><span class="n">__validate_parameters__</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/signatures.html#set_signature_of_func"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.signatures.set_signature_of_func" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the signature of a function, with sugar.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> – Function whose signature you want to set</p></li>
<li><p><strong>signature</strong> – A list of parameter specifications. This could be an inspect.Parameter object or anything that
the mk_param function can resolve into an inspect.Parameter object.</p></li>
<li><p><strong>return_annotation</strong> – Passed on to inspect.Signature.</p></li>
<li><p><strong>__validate_parameters__</strong> – Passed on to inspect.Signature.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>None (but sets the signature of the input function)</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">inspect</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="go">&lt;Signature (*args, **kwargs)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">set_signature_of_func</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="go">&lt;Signature (a, b, c)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">set_signature_of_func</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="nb">int</span><span class="p">)])</span>  <span class="c1"># specifying defaults and annotations</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="go">&lt;Signature (a, b=None, c: int = 42)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">set_signature_of_func</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="n">return_annotation</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>  <span class="c1"># specifying return annotation</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="go">&lt;Signature (a, b, c) -&gt; str&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># But you can always specify parameters the &quot;long&quot; way</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">set_signature_of_func</span><span class="p">(</span>
<span class="gp">... </span> <span class="n">foo</span><span class="p">,</span>
<span class="gp">... </span> <span class="p">[</span><span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;kws&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">VAR_KEYWORD</span><span class="p">)],</span> <span class="n">return_annotation</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="go">&lt;Signature (**kws) -&gt; str&gt;</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-py2store.utils.sliceable">
<span id="py2store-utils-sliceable"></span><h1>py2store.utils.sliceable<a class="headerlink" href="#module-py2store.utils.sliceable" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.utils.sliceable.iSliceStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.sliceable.</code><code class="sig-name descname">iSliceStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">store</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/sliceable.html#iSliceStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.sliceable.iSliceStore" title="Permalink to this definition">¶</a></dt>
<dd><p>Wraps a store to make a reader that acts as if the store was a list (with integer keys, and that can be sliced).
I say “list”, but it should be noted that the behavior is more that of range, that outputs an element of the list
when keying with an integer, but returns an iterable object (a range) if sliced.</p>
<p>Here, a map object is returned when the sliceable store is sliced.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">:</span> <span class="s1">&#39;world&#39;</span><span class="p">,</span> <span class="s1">&#39;alice&#39;</span><span class="p">:</span> <span class="s1">&#39;bob&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sliceable_s</span> <span class="o">=</span> <span class="n">iSliceStore</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sliceable_s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="go">&#39;world&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">sliceable_s</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
<span class="go">[&#39;bar&#39;, &#39;world&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">sliceable_s</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>
<span class="go">[&#39;world&#39;, &#39;bob&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">sliceable_s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="go">[&#39;bar&#39;, &#39;world&#39;]</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-py2store.utils.mappify">
<span id="py2store-utils-mappify"></span><h1>py2store.utils.mappify<a class="headerlink" href="#module-py2store.utils.mappify" title="Permalink to this headline">¶</a></h1>
<p>Utils to wrap any object into a mapping interface</p>
<dl class="py class">
<dt id="py2store.utils.mappify.LeafMappify">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.mappify.</code><code class="sig-name descname">LeafMappify</code><span class="sig-paren">(</span><em class="sig-param">target</em>, <em class="sig-param">node_types=(&lt;class 'dict'&gt;</em>, <em class="sig-param">)</em>, <em class="sig-param">key_concat=&lt;function Mappify.&lt;lambda&gt;&gt;</em>, <em class="sig-param">names_of_literals=()</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/mappify.html#LeafMappify"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.mappify.LeafMappify" title="Permalink to this definition">¶</a></dt>
<dd><p>A dict-like interface to glom. Here, only leaf keys are taken into account.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;simple&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;is&#39;</span><span class="p">:</span> <span class="s1">&#39;nested&#39;</span><span class="p">},</span>
<span class="gp">... </span>    <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;is&#39;</span><span class="p">:</span> <span class="s1">&#39;nested&#39;</span><span class="p">,</span> <span class="s1">&#39;and&#39;</span><span class="p">:</span> <span class="s1">&#39;has&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">LeafMappify</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b.is&#39;</span><span class="p">,</span> <span class="s1">&#39;c.is&#39;</span><span class="p">,</span> <span class="s1">&#39;c.and&#39;</span><span class="p">,</span> <span class="s1">&#39;c.a&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">g</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;simple&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">g</span><span class="p">[</span><span class="s1">&#39;b.is&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;nested&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">g</span><span class="p">[</span><span class="s1">&#39;c.a&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">a: simple</span>
<span class="go">b.is: nested</span>
<span class="go">c.is: nested</span>
<span class="go">c.and: has</span>
<span class="go">c.a: [1, 2, 3]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.utils.mappify.Mappify">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.mappify.</code><code class="sig-name descname">Mappify</code><span class="sig-paren">(</span><em class="sig-param">target</em>, <em class="sig-param">node_types=(&lt;class 'dict'&gt;</em>, <em class="sig-param">)</em>, <em class="sig-param">key_concat=&lt;function Mappify.&lt;lambda&gt;&gt;</em>, <em class="sig-param">names_of_literals=()</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/mappify.html#Mappify"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.mappify.Mappify" title="Permalink to this definition">¶</a></dt>
<dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;simple&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;is&#39;</span><span class="p">:</span> <span class="s1">&#39;nested&#39;</span><span class="p">},</span>
<span class="gp">... </span>    <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;is&#39;</span><span class="p">:</span> <span class="s1">&#39;nested&#39;</span><span class="p">,</span> <span class="s1">&#39;and&#39;</span><span class="p">:</span> <span class="s1">&#39;has&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">Mappify</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b.is&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c.is&#39;</span><span class="p">,</span> <span class="s1">&#39;c.and&#39;</span><span class="p">,</span> <span class="s1">&#39;c.a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">g</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;simple&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">g</span><span class="p">[</span><span class="s1">&#39;b.is&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;nested&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">g</span><span class="p">[</span><span class="s1">&#39;c.a&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">a: simple</span>
<span class="go">b.is: nested</span>
<span class="go">b: {&#39;is&#39;: &#39;nested&#39;}</span>
<span class="go">c.is: nested</span>
<span class="go">c.and: has</span>
<span class="go">c.a: [1, 2, 3]</span>
<span class="go">c: {&#39;is&#39;: &#39;nested&#39;, &#39;and&#39;: &#39;has&#39;, &#39;a&#39;: [1, 2, 3]}</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-py2store.utils.glom">
<span id="py2store-utils-glom"></span><h1>py2store.utils.glom<a class="headerlink" href="#module-py2store.utils.glom" title="Permalink to this headline">¶</a></h1>
<p><em>glom is a util to extract stuff from nested structures.</em>
It’s one of those excellent utils that I’ve written many times, but never got quite right.
Mahmoud Hashemi got it right.</p>
<dl class="field-list simple">
<dt class="field-odd">BEGIN LICENSE</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>Copyright (c) 2018, Mahmoud Hashemi</p>
<p>Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:</p>
<blockquote>
<div><ul class="simple">
<li><p>Redistributions of source code must retain the above copyright
notice, this list of conditions and the following disclaimer.</p></li>
<li><p>Redistributions in binary form must reproduce the above
copyright notice, this list of conditions and the following
disclaimer in the documentation and/or other materials provided
with the distribution.</p></li>
<li><p>The names of the contributors may not be used to endorse or
promote products derived from this software without specific
prior written permission.</p></li>
</ul>
</div></blockquote>
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
“AS IS” AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
<dl class="field-list simple">
<dt class="field-odd">END LICENSE</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>Now, at the time of writing this, I’ve already transformed it to bend it to my liking.
At some point it may become something else, but I wanted there to be a trace of what my seed was.
Though I can’t promise I’ll maintain the same functionality as I transform this module, here’s
a tutorial on how to use it in it’s original form:</p>
<blockquote>
<div><p><a class="reference external" href="https://glom.readthedocs.io/en/latest/">https://glom.readthedocs.io/en/latest/</a></p>
</div></blockquote>
<p>I only took the main (core) module from the glom project.
Here’s the original docs of this glom module.</p>
<p>If there was ever a Python example of “big things come in small
packages”, <code class="docutils literal notranslate"><span class="pre">glom</span></code> might be it.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">glom</span></code> package has one central entrypoint,
<code class="xref py py-func docutils literal notranslate"><span class="pre">glom.glom()</span></code>. Everything else in the package revolves around that
one function.</p>
<p>A couple of conventional terms you’ll see repeated many times below:</p>
<ul class="simple">
<li><p><strong>target</strong> - glom is built to work on any data, so we simply
refer to the object being accessed as the <em>“target”</em></p></li>
<li><p><strong>spec</strong> - <em>(aka “glomspec”, short for specification)</em> The
accompanying template used to specify the structure of the return
value.</p></li>
</ul>
<p>Now that you know the terms, let’s take a look around glom’s powerful
semantics.</p>
<dl class="py class">
<dt id="py2store.utils.glom.Auto">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.glom.</code><code class="sig-name descname">Auto</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">spec</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#Auto"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.Auto" title="Permalink to this definition">¶</a></dt>
<dd><p>Switch to Auto mode (the default)</p>
<p>TODO: this seems like it should be a sub-class of class Spec() –
if Spec() could help define the interface for new “modes” or dialects
that would also help make match mode feel less duct-taped on</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.utils.glom.Call">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.glom.</code><code class="sig-name descname">Call</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">args</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">kwargs</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#Call"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.Call" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#py2store.utils.glom.Call" title="py2store.utils.glom.Call"><code class="xref py py-class docutils literal notranslate"><span class="pre">Call</span></code></a> specifies when a target should be passed to a function,
<em>func</em>.</p>
<p><a class="reference internal" href="#py2store.utils.glom.Call" title="py2store.utils.glom.Call"><code class="xref py py-class docutils literal notranslate"><span class="pre">Call</span></code></a> is similar to <code class="xref py py-func docutils literal notranslate"><span class="pre">partial()</span></code> in that
it is no more powerful than <code class="docutils literal notranslate"><span class="pre">lambda</span></code> or other functions, but
it is designed to be more readable, with a better <code class="docutils literal notranslate"><span class="pre">repr</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>func</strong> (<em>callable</em>) – a function or other callable to be called with
the target</p>
</dd>
</dl>
<p><a class="reference internal" href="#py2store.utils.glom.Call" title="py2store.utils.glom.Call"><code class="xref py py-class docutils literal notranslate"><span class="pre">Call</span></code></a> combines well with <code class="xref py py-attr docutils literal notranslate"><span class="pre">T</span></code> to construct objects. For
instance, to generate a dict and then pass it to a constructor:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">ExampleClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">... </span>   <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
<span class="gp">... </span>       <span class="bp">self</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="n">attr</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;attr&#39;</span><span class="p">:</span> <span class="mf">3.14</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Call</span><span class="p">(</span><span class="n">ExampleClass</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">T</span><span class="p">))</span><span class="o">.</span><span class="n">attr</span>
<span class="go">3.14</span>
</pre></div>
</div>
<p>This does the same as <code class="docutils literal notranslate"><span class="pre">glom(target,</span> <span class="pre">lambda</span> <span class="pre">target:</span>
<span class="pre">ExampleClass(**target))</span></code>, but it’s easy to see which one reads
better.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">Call</span></code> is mostly for functions. Use a <code class="xref py py-attr docutils literal notranslate"><span class="pre">T</span></code> object
if you need to call a method.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><a class="reference internal" href="#py2store.utils.glom.Call" title="py2store.utils.glom.Call"><code class="xref py py-class docutils literal notranslate"><span class="pre">Call</span></code></a> has a successor with a fuller-featured API, new
in 19.3.0: the <a class="reference internal" href="#py2store.utils.glom.Invoke" title="py2store.utils.glom.Invoke"><code class="xref py py-class docutils literal notranslate"><span class="pre">Invoke</span></code></a> specifier type.</p>
</div>
<dl class="py method">
<dt id="py2store.utils.glom.Call.glomit">
<code class="sig-name descname">glomit</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">target</span></em>, <em class="sig-param"><span class="n">scope</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#Call.glomit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.Call.glomit" title="Permalink to this definition">¶</a></dt>
<dd><p>run against the current target</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="py2store.utils.glom.Check">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.glom.</code><code class="sig-name descname">Check</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">spec</span><span class="o">=</span><span class="default_value">T</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#Check"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.Check" title="Permalink to this definition">¶</a></dt>
<dd><p>Check objects are used to make assertions about the target data,
and either pass through the data or raise exceptions if there is a
problem.</p>
<p>If any check condition fails, a <code class="xref py py-class docutils literal notranslate"><span class="pre">CheckError</span></code> is raised.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>spec</strong> – a sub-spec to extract the data to which other assertions will
be checked (defaults to applying checks to the target itself)</p></li>
<li><p><strong>type</strong> – a type or sequence of types to be checked for exact match</p></li>
<li><p><strong>equal_to</strong> – a value to be checked for equality match (“==”)</p></li>
<li><p><strong>validate</strong> – a callable or list of callables, each representing a
check condition. If one or more return False or raise an
exception, the Check will fail.</p></li>
<li><p><strong>instance_of</strong> – a type or sequence of types to be checked with isinstance()</p></li>
<li><p><strong>one_of</strong> – an iterable of values, any of which can match the target (“in”)</p></li>
<li><p><strong>default</strong> – an optional default value to replace the value when the check fails
(if default is not specified, GlomCheckError will be raised)</p></li>
</ul>
</dd>
</dl>
<p>Aside from <em>spec</em>, all arguments are keyword arguments. Each
argument, except for <em>default</em>, represent a check
condition. Multiple checks can be passed, and if all check
conditions are left unset, Check defaults to performing a basic
truthy check on the value.</p>
</dd></dl>

<dl class="py exception">
<dt id="py2store.utils.glom.CheckError">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.utils.glom.</code><code class="sig-name descname">CheckError</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">msgs</span></em>, <em class="sig-param"><span class="n">check</span></em>, <em class="sig-param"><span class="n">path</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#CheckError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.CheckError" title="Permalink to this definition">¶</a></dt>
<dd><p>This <a class="reference internal" href="#py2store.utils.glom.GlomError" title="py2store.utils.glom.GlomError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">GlomError</span></code></a> subtype is raised when target data fails to
pass a <a class="reference internal" href="#py2store.utils.glom.Check" title="py2store.utils.glom.Check"><code class="xref py py-class docutils literal notranslate"><span class="pre">Check</span></code></a>’s specified validation.</p>
<p>An uncaught <code class="docutils literal notranslate"><span class="pre">CheckError</span></code> looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;c&#39;</span><span class="p">}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;a.b&#39;</span><span class="p">,</span> <span class="n">Check</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">))})</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">CheckError</span>: <span class="n">target at path [&#39;a.b&#39;] failed check, got error: &quot;expected type to be &#39;int&#39;, found type &#39;str&#39;&quot;</span>
</pre></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">Check</span></code> contains more than one condition, there may be
more than one error message. The string rendition of the
<code class="docutils literal notranslate"><span class="pre">CheckError</span></code> will include all messages.</p>
<p>You can also catch the <code class="docutils literal notranslate"><span class="pre">CheckError</span></code> and programmatically access
messages through the <code class="docutils literal notranslate"><span class="pre">msgs</span></code> attribute on the <code class="docutils literal notranslate"><span class="pre">CheckError</span></code>
instance.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As of 2018-07-05 (glom v18.2.0), the validation subsystem is
still very new. Exact error message formatting may be enhanced
in future releases.</p>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.utils.glom.Coalesce">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.glom.</code><code class="sig-name descname">Coalesce</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">subspecs</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#Coalesce"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.Coalesce" title="Permalink to this definition">¶</a></dt>
<dd><p>Coalesce objects specify fallback behavior for a list of
subspecs.</p>
<p>Subspecs are passed as positional arguments, and keyword arguments
control defaults. Each subspec is evaluated in turn, and if none
match, a <a class="reference internal" href="#py2store.utils.glom.CoalesceError" title="py2store.utils.glom.CoalesceError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">CoalesceError</span></code></a> is raised, or a default is returned,
depending on the options used.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This operation may seem very familar if you have experience with
<a class="reference external" href="https://en.wikipedia.org/w/index.php?title=Null_(SQL)&amp;oldid=833093792#COALESCE">SQL</a> or even <a class="reference external" href="https://en.wikipedia.org/w/index.php?title=Null_coalescing_operator&amp;oldid=839493322#C#">C# and others</a>.</p>
</div>
<p>In practice, this fallback behavior’s simplicity is only surpassed
by its utility:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="s1">&#39;d&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Coalesce</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">))</span>
<span class="go">&#39;d&#39;</span>
</pre></div>
</div>
<p>glom tries to get <code class="docutils literal notranslate"><span class="pre">'a'</span></code> from <code class="docutils literal notranslate"><span class="pre">target</span></code>, but gets a
KeyError. Rather than raise a <code class="xref py py-exc docutils literal notranslate"><span class="pre">PathAccessError</span></code> as usual,
glom <em>coalesces</em> into the next subspec, <code class="docutils literal notranslate"><span class="pre">'b'</span></code>. The process
repeats until it gets to <code class="docutils literal notranslate"><span class="pre">'c'</span></code>, which returns our value,
<code class="docutils literal notranslate"><span class="pre">'d'</span></code>. If our value weren’t present, we’d see:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Coalesce</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">))</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">CoalesceError</span>: <span class="n">no valid values found. Tried (&#39;a&#39;, &#39;b&#39;) and got (PathAccessError, PathAccessError) ...</span>
</pre></div>
</div>
<p>Same process, but because <code class="docutils literal notranslate"><span class="pre">target</span></code> is empty, we get a
<a class="reference internal" href="#py2store.utils.glom.CoalesceError" title="py2store.utils.glom.CoalesceError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">CoalesceError</span></code></a>. If we want to avoid an exception, and we
know which value we want by default, we can set <em>default</em>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Coalesce</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;d-fault&#39;</span><span class="p">)</span>
<span class="go">&#39;d-fault&#39;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">'a'</span></code>, <code class="docutils literal notranslate"><span class="pre">'b'</span></code>, and <code class="docutils literal notranslate"><span class="pre">'c'</span></code> weren’t present so we got <code class="docutils literal notranslate"><span class="pre">'d-fault'</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>subspecs</strong> – One or more glommable subspecs</p></li>
<li><p><strong>default</strong> – A value to return if no subspec results in a valid value</p></li>
<li><p><strong>default_factory</strong> – A callable whose result will be returned as a default</p></li>
<li><p><strong>skip</strong> – A value, tuple of values, or predicate function
representing values to ignore</p></li>
<li><p><strong>skip_exc</strong> – An exception or tuple of exception types to catch and
move on to the next subspec. Defaults to <a class="reference internal" href="#py2store.utils.glom.GlomError" title="py2store.utils.glom.GlomError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">GlomError</span></code></a>, the
parent type of all glom runtime exceptions.</p></li>
</ul>
</dd>
</dl>
<p>If all subspecs produce skipped values or exceptions, a
<a class="reference internal" href="#py2store.utils.glom.CoalesceError" title="py2store.utils.glom.CoalesceError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">CoalesceError</span></code></a> will be raised. For more examples, check out
the <span class="xref std std-doc">tutorial</span>, which makes extensive use of Coalesce.</p>
</dd></dl>

<dl class="py exception">
<dt id="py2store.utils.glom.CoalesceError">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.utils.glom.</code><code class="sig-name descname">CoalesceError</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">coal_obj</span></em>, <em class="sig-param"><span class="n">skipped</span></em>, <em class="sig-param"><span class="n">path</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#CoalesceError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.CoalesceError" title="Permalink to this definition">¶</a></dt>
<dd><p>This <a class="reference internal" href="#py2store.utils.glom.GlomError" title="py2store.utils.glom.GlomError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">GlomError</span></code></a> subtype is raised from within a
<a class="reference internal" href="#py2store.utils.glom.Coalesce" title="py2store.utils.glom.Coalesce"><code class="xref py py-class docutils literal notranslate"><span class="pre">Coalesce</span></code></a> spec’s processing, when none of the subspecs
match and no default is provided.</p>
<p>The exception object itself keeps track of several values which
may be useful for processing:</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>coal_obj</strong> (<a class="reference internal" href="#py2store.utils.glom.Coalesce" title="py2store.utils.glom.Coalesce"><em>Coalesce</em></a>) – The original failing spec, see
<a class="reference internal" href="#py2store.utils.glom.Coalesce" title="py2store.utils.glom.Coalesce"><code class="xref py py-class docutils literal notranslate"><span class="pre">Coalesce</span></code></a>’s docs for details.</p></li>
<li><p><strong>skipped</strong> (<em>list</em>) – A list of ignored values and exceptions, in the
order that their respective subspecs appear in the original
<em>coal_obj</em>.</p></li>
<li><p><strong>path</strong> – Like many GlomErrors, this exception knows the path at
which it occurred.</p></li>
</ul>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Coalesce</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">))</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">CoalesceError</span>: <span class="n">no valid values found. Tried (&#39;a&#39;, &#39;b&#39;) and got (PathAccessError, PathAccessError) ...</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.utils.glom.Fill">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.glom.</code><code class="sig-name descname">Fill</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">spec</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#Fill"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.Fill" title="Permalink to this definition">¶</a></dt>
<dd><p>A specifier type which switches to glom into “fill-mode”. For the
spec contained within the Fill, glom will only interpret explicit
specifier types (including T objects). Whereas the default mode
has special interpretations for each of these builtins, fill-mode
takes a lighter touch, making Fill great for “filling out” Python
literals, like tuples, dicts, sets, and lists.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spec</span> <span class="o">=</span> <span class="n">Fill</span><span class="p">((</span><span class="n">T</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">T</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
<span class="go">(4, 0)</span>
</pre></div>
</div>
<p>As you can see, glom’s usual built-in tuple item chaining behavior
has switched into a simple tuple constructor.</p>
<p>(Sidenote for Lisp fans: Fill is like glom’s quasi-quoting.)</p>
</dd></dl>

<dl class="py exception">
<dt id="py2store.utils.glom.GlomError">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.utils.glom.</code><code class="sig-name descname">GlomError</code><a class="reference internal" href="_modules/py2store/utils/glom.html#GlomError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.GlomError" title="Permalink to this definition">¶</a></dt>
<dd><p>The base exception for all the errors that might be raised from
<a class="reference internal" href="#py2store.utils.glom.glom" title="py2store.utils.glom.glom"><code class="xref py py-func docutils literal notranslate"><span class="pre">glom()</span></code></a> processing logic.</p>
<p>By default, exceptions raised from within functions passed to glom
(e.g., <code class="docutils literal notranslate"><span class="pre">len</span></code>, <code class="docutils literal notranslate"><span class="pre">sum</span></code>, any <code class="docutils literal notranslate"><span class="pre">lambda</span></code>) will not be wrapped in a
GlomError.</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.utils.glom.Glommer">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.glom.</code><code class="sig-name descname">Glommer</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#Glommer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.Glommer" title="Permalink to this definition">¶</a></dt>
<dd><p>All the wholesome goodness that it takes to make glom work. This
type mostly serves to encapsulate the type registration context so
that advanced uses of glom don’t need to worry about stepping on
each other’s toes.</p>
<p>Glommer objects are lightweight and, once instantiated, provide
the <a class="reference internal" href="#py2store.utils.glom.glom" title="py2store.utils.glom.glom"><code class="xref py py-func docutils literal notranslate"><span class="pre">glom()</span></code></a> method we know and love:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">glommer</span> <span class="o">=</span> <span class="n">Glommer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glommer</span><span class="o">.</span><span class="n">glom</span><span class="p">({},</span> <span class="s1">&#39;a.b.c&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
<span class="go">&#39;d&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Glommer</span><span class="p">()</span><span class="o">.</span><span class="n">glom</span><span class="p">({</span><span class="s1">&#39;vals&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))},</span> <span class="p">(</span><span class="s1">&#39;vals&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">))</span>
<span class="go">3</span>
</pre></div>
</div>
<p>Instances also provide <a class="reference internal" href="#py2store.utils.glom.Glommer.register" title="py2store.utils.glom.Glommer.register"><code class="xref py py-meth docutils literal notranslate"><span class="pre">register()</span></code></a> method for
localized control over type handling.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>register_default_types</strong> (<em>bool</em>) – Whether or not to enable the
handling behaviors of the default <a class="reference internal" href="#py2store.utils.glom.glom" title="py2store.utils.glom.glom"><code class="xref py py-func docutils literal notranslate"><span class="pre">glom()</span></code></a>. These
default actions include dict access, list and iterable
iteration, and generic object attribute access. Defaults to
True.</p>
</dd>
</dl>
<dl class="py method">
<dt id="py2store.utils.glom.Glommer.register">
<code class="sig-name descname">register</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">target_type</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#Glommer.register"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.Glommer.register" title="Permalink to this definition">¶</a></dt>
<dd><p>Register <em>target_type</em> so <code class="xref py py-meth docutils literal notranslate"><span class="pre">glom()</span></code> will
know how to handle instances of that type as targets.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>target_type</strong> (<em>type</em>) – A type expected to appear in a glom()
call target</p></li>
<li><p><strong>get</strong> (<em>callable</em>) – A function which takes a target object and
a name, acting as a default accessor. Defaults to
<code class="xref py py-func docutils literal notranslate"><span class="pre">getattr()</span></code>.</p></li>
<li><p><strong>iterate</strong> (<em>callable</em>) – A function which takes a target object
and returns an iterator. Defaults to <code class="xref py py-func docutils literal notranslate"><span class="pre">iter()</span></code> if
<em>target_type</em> appears to be iterable.</p></li>
<li><p><strong>exact</strong> (<em>bool</em>) – Whether or not to match instances of subtypes
of <em>target_type</em>.</p></li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The module-level <a class="reference internal" href="#py2store.utils.glom.register" title="py2store.utils.glom.register"><code class="xref py py-func docutils literal notranslate"><span class="pre">register()</span></code></a> function affects the
module-level <a class="reference internal" href="#py2store.utils.glom.glom" title="py2store.utils.glom.glom"><code class="xref py py-func docutils literal notranslate"><span class="pre">glom()</span></code></a> function’s behavior. If this
global effect is undesirable for your application, or
you’re implementing a library, consider instantiating a
<a class="reference internal" href="#py2store.utils.glom.Glommer" title="py2store.utils.glom.Glommer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Glommer</span></code></a> instance, and using the
<a class="reference internal" href="#py2store.utils.glom.Glommer.register" title="py2store.utils.glom.Glommer.register"><code class="xref py py-meth docutils literal notranslate"><span class="pre">register()</span></code></a> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">Glommer.glom()</span></code>
methods instead.</p>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="py2store.utils.glom.Inspect">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.glom.</code><code class="sig-name descname">Inspect</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">a</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kw</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#Inspect"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.Inspect" title="Permalink to this definition">¶</a></dt>
<dd><p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">Inspect</span></code> specifier type provides a way to get
visibility into glom’s evaluation of a specification, enabling
debugging of those tricky problems that may arise with unexpected
data.</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">Inspect</span></code> can be inserted into an existing spec in one of two
ways. First, as a wrapper around the spec in question, or second,
as an argument-less placeholder wherever a spec could be.</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">Inspect</span></code> supports several modes, controlled by
keyword arguments. Its default, no-argument mode, simply echos the
state of the glom at the point where it appears:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{}}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">val</span> <span class="o">=</span> <span class="n">glom</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Inspect</span><span class="p">(</span><span class="s1">&#39;a.b&#39;</span><span class="p">))</span>  <span class="c1"># wrapping a spec</span>
<span class="go">---</span>
<span class="go">path:   [&#39;a.b&#39;]</span>
<span class="go">target: {&#39;a&#39;: {&#39;b&#39;: {}}}</span>
<span class="go">output: {}</span>
<span class="go">---</span>
</pre></div>
</div>
<p>Debugging behavior aside, <code class="xref py py-class docutils literal notranslate"><span class="pre">Inspect</span></code> has no effect on
values in the target, spec, or result.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>echo</strong> (<em>bool</em>) – Whether to print the path, target, and output of
each inspected glom. Defaults to True.</p></li>
<li><p><strong>recursive</strong> (<em>bool</em>) – Whether or not the Inspect should be applied
at every level, at or below the spec that it wraps. Defaults
to False.</p></li>
<li><p><strong>breakpoint</strong> (<em>bool</em>) – This flag controls whether a debugging prompt
should appear before evaluating each inspected spec. Can also
take a callable. Defaults to False.</p></li>
<li><p><strong>post_mortem</strong> (<em>bool</em>) – This flag controls whether exceptions
should be caught and interactively debugged with <code class="xref py py-mod docutils literal notranslate"><span class="pre">pdb</span></code> on
inspected specs.</p></li>
</ul>
</dd>
</dl>
<p>All arguments above are keyword-only to avoid overlap with a
wrapped spec.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Just like <code class="docutils literal notranslate"><span class="pre">pdb.set_trace()</span></code>, be careful about leaving stray
<code class="docutils literal notranslate"><span class="pre">Inspect()</span></code> instances in production glom specs.</p>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.utils.glom.Invoke">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.glom.</code><code class="sig-name descname">Invoke</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#Invoke"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.Invoke" title="Permalink to this definition">¶</a></dt>
<dd><p>Specifier type designed for easy invocation of callables from glom.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>func</strong> (<em>callable</em>) – A function or other callable object.</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">Invoke</span></code> is similar to <code class="xref py py-func docutils literal notranslate"><span class="pre">functools.partial()</span></code>, but with the
ability to set up a “templated” call which interleaves constants and
glom specs.</p>
<p>For example, the following creates a spec which can be used to
check if targets are integers:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">is_int</span> <span class="o">=</span> <span class="n">Invoke</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">)</span><span class="o">.</span><span class="n">specs</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">constants</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">is_int</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>And this composes like any other glom spec:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="nb">object</span><span class="p">(),</span> <span class="mi">9</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="p">[</span><span class="n">is_int</span><span class="p">])</span>
<span class="go">[True, False, True]</span>
</pre></div>
</div>
<p>Another example, mixing positional and keyword arguments:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">spec</span> <span class="o">=</span> <span class="n">Invoke</span><span class="p">(</span><span class="nb">sorted</span><span class="p">)</span><span class="o">.</span><span class="n">specs</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">constants</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
<span class="go">[&#39;20&#39;, &#39;10&#39;, &#39;5&#39;, &#39;1&#39;]</span>
</pre></div>
</div>
<p>Invoke also helps with evaluating zero-argument functions:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="p">{},</span> <span class="n">spec</span><span class="o">=</span><span class="n">Invoke</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
<span class="go">0</span>
</pre></div>
</div>
<p>(A trivial example, but from timestamps to UUIDs, zero-arg calls do come up!)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">Invoke</span></code> is mostly for functions, object construction, and callable
objects. For calling methods, consider the <code class="xref py py-attr docutils literal notranslate"><span class="pre">T</span></code> object.</p>
</div>
<dl class="py method">
<dt id="py2store.utils.glom.Invoke.constants">
<code class="sig-name descname">constants</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">a</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kw</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#Invoke.constants"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.Invoke.constants" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a new <a class="reference internal" href="#py2store.utils.glom.Invoke" title="py2store.utils.glom.Invoke"><code class="xref py py-class docutils literal notranslate"><span class="pre">Invoke</span></code></a> spec, with the provided positional
and keyword argument values stored for passing to the
underlying function.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">spec</span> <span class="o">=</span> <span class="n">Invoke</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">constants</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="nb">range</span><span class="p">,</span> <span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span>
<span class="go">[0, 1, 2, 3, 4]</span>
</pre></div>
</div>
<p>Subsequent positional arguments are appended:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">spec</span> <span class="o">=</span> <span class="n">Invoke</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">constants</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">constants</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="nb">range</span><span class="p">,</span> <span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span>
<span class="go">[2, 4, 6, 8]</span>
</pre></div>
</div>
<p>Keyword arguments also work as one might expect:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">round_2</span> <span class="o">=</span> <span class="n">Invoke</span><span class="p">(</span><span class="nb">round</span><span class="p">)</span><span class="o">.</span><span class="n">constants</span><span class="p">(</span><span class="n">ndigits</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">specs</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="mf">3.14159</span><span class="p">,</span> <span class="n">round_2</span><span class="p">)</span>
<span class="go">3.14</span>
</pre></div>
</div>
<p><a class="reference internal" href="#py2store.utils.glom.Invoke.constants" title="py2store.utils.glom.Invoke.constants"><code class="xref py py-meth docutils literal notranslate"><span class="pre">constants()</span></code></a> and other <a class="reference internal" href="#py2store.utils.glom.Invoke" title="py2store.utils.glom.Invoke"><code class="xref py py-class docutils literal notranslate"><span class="pre">Invoke</span></code></a>
methods may be called multiple times, just remember that every
call returns a new spec.</p>
</dd></dl>

<dl class="py method">
<dt id="py2store.utils.glom.Invoke.specfunc">
<em class="property">classmethod </em><code class="sig-name descname">specfunc</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">spec</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#Invoke.specfunc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.Invoke.specfunc" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates an <a class="reference internal" href="#py2store.utils.glom.Invoke" title="py2store.utils.glom.Invoke"><code class="xref py py-class docutils literal notranslate"><span class="pre">Invoke</span></code></a> instance where the function is
indicated by a spec.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">spec</span> <span class="o">=</span> <span class="n">Invoke</span><span class="o">.</span><span class="n">specfunc</span><span class="p">(</span><span class="s1">&#39;func&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">constants</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">({</span><span class="s1">&#39;func&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">},</span> <span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span>
<span class="go">[0, 1, 2, 3, 4]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="py2store.utils.glom.Invoke.specs">
<code class="sig-name descname">specs</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">a</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kw</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#Invoke.specs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.Invoke.specs" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a new <a class="reference internal" href="#py2store.utils.glom.Invoke" title="py2store.utils.glom.Invoke"><code class="xref py py-class docutils literal notranslate"><span class="pre">Invoke</span></code></a> spec, with the provided positional
and keyword arguments stored to be interpreted as specs, with
the results passed to the underlying function.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">spec</span> <span class="o">=</span> <span class="n">Invoke</span><span class="p">(</span><span class="nb">range</span><span class="p">)</span><span class="o">.</span><span class="n">specs</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span> <span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span>
<span class="go">[0, 1, 2, 3, 4]</span>
</pre></div>
</div>
<p>Subsequent positional arguments are appended:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">spec</span> <span class="o">=</span> <span class="n">Invoke</span><span class="p">(</span><span class="nb">range</span><span class="p">)</span><span class="o">.</span><span class="n">specs</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">specs</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="s1">&#39;step&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;step&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span>
<span class="go">[2, 4, 6, 8]</span>
</pre></div>
</div>
<p>Keyword arguments also work as one might expect:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">multiply</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">times_3</span> <span class="o">=</span> <span class="n">Invoke</span><span class="p">(</span><span class="n">multiply</span><span class="p">)</span><span class="o">.</span><span class="n">constants</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">specs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span> <span class="n">times_3</span><span class="p">)</span>
<span class="go">15</span>
</pre></div>
</div>
<p><a class="reference internal" href="#py2store.utils.glom.Invoke.specs" title="py2store.utils.glom.Invoke.specs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">specs()</span></code></a> and other <a class="reference internal" href="#py2store.utils.glom.Invoke" title="py2store.utils.glom.Invoke"><code class="xref py py-class docutils literal notranslate"><span class="pre">Invoke</span></code></a>
methods may be called multiple times, just remember that every
call returns a new spec.</p>
</dd></dl>

<dl class="py method">
<dt id="py2store.utils.glom.Invoke.star">
<code class="sig-name descname">star</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">args</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">kwargs</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#Invoke.star"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.Invoke.star" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a new <a class="reference internal" href="#py2store.utils.glom.Invoke" title="py2store.utils.glom.Invoke"><code class="xref py py-class docutils literal notranslate"><span class="pre">Invoke</span></code></a> spec, with <em>args</em> and/or <em>kwargs</em>
specs set to be “starred” or “star-starred” (respectively)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os.path</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spec</span> <span class="o">=</span> <span class="n">Invoke</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">)</span><span class="o">.</span><span class="n">star</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="s1">&#39;path&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">,</span> <span class="s1">&#39;dir&#39;</span><span class="p">]}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
<span class="go">&#39;path/to/dir&#39;</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>args</strong> (<em>spec</em>) – A spec to be evaluated and “starred” into the
underlying function.</p></li>
<li><p><strong>kwargs</strong> (<em>spec</em>) – A spec to be evaluated and “star-starred” into
the underlying function.</p></li>
</ul>
</dd>
</dl>
<p>One or both of the above arguments should be set.</p>
<p>The <a class="reference internal" href="#py2store.utils.glom.Invoke.star" title="py2store.utils.glom.Invoke.star"><code class="xref py py-meth docutils literal notranslate"><span class="pre">star()</span></code></a>, like other <a class="reference internal" href="#py2store.utils.glom.Invoke" title="py2store.utils.glom.Invoke"><code class="xref py py-class docutils literal notranslate"><span class="pre">Invoke</span></code></a>
methods, may be called multiple times. The <em>args</em> and <em>kwargs</em>
will be stacked in the order in which they are provided.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="py2store.utils.glom.Let">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.glom.</code><code class="sig-name descname">Let</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">**</span><span class="n">kw</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#Let"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.Let" title="Permalink to this definition">¶</a></dt>
<dd><p>This specifier type assigns variables to the scope.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spec</span> <span class="o">=</span> <span class="p">(</span><span class="n">Let</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">T</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;val&#39;</span><span class="p">]),</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span> <span class="n">S</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
<span class="go">{&#39;val&#39;: 9}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.utils.glom.Literal">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.glom.</code><code class="sig-name descname">Literal</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#Literal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.Literal" title="Permalink to this definition">¶</a></dt>
<dd><p>Literal objects specify literal values in rare cases when part of
the spec should not be interpreted as a glommable
subspec. Wherever a Literal object is encountered in a spec, it is
replaced with its wrapped <em>value</em> in the output.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;c&#39;</span><span class="p">}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;a.b&#39;</span><span class="p">,</span> <span class="s1">&#39;readability&#39;</span><span class="p">:</span> <span class="n">Literal</span><span class="p">(</span><span class="s1">&#39;counts&#39;</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">glom</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">spec</span><span class="p">))</span>
<span class="go">{&#39;a&#39;: &#39;c&#39;, &#39;readability&#39;: &#39;counts&#39;}</span>
</pre></div>
</div>
<p>Instead of accessing <code class="docutils literal notranslate"><span class="pre">'counts'</span></code> as a key like it did with
<code class="docutils literal notranslate"><span class="pre">'a.b'</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">glom()</span></code> just unwrapped the literal and
included the value.</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">Literal</span></code> takes one argument, the literal value that should appear
in the glom output.</p>
<p>This could also be achieved with a callable, e.g., <code class="docutils literal notranslate"><span class="pre">lambda</span> <span class="pre">x:</span>
<span class="pre">'literal_string'</span></code> in the spec, but using a <code class="xref py py-class docutils literal notranslate"><span class="pre">Literal</span></code>
object adds explicitness, code clarity, and a clean <code class="xref py py-func docutils literal notranslate"><span class="pre">repr()</span></code>.</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.utils.glom.Path">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.glom.</code><code class="sig-name descname">Path</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">path_parts</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#Path"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.Path" title="Permalink to this definition">¶</a></dt>
<dd><p>Path objects specify explicit paths when the default
<code class="docutils literal notranslate"><span class="pre">'a.b.c'</span></code>-style general access syntax won’t work or isn’t
desirable. Use this to wrap ints, datetimes, and other valid
keys, as well as strings with dots that shouldn’t be expanded.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d.e&#39;</span><span class="p">:</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">3</span><span class="p">}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;d.e&#39;</span><span class="p">))</span>
<span class="go">&#39;f&#39;</span>
</pre></div>
</div>
<p>Paths can be used to join together other Path objects, as
well as <code class="xref py py-data docutils literal notranslate"><span class="pre">T</span></code> objects:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Path</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">],</span> <span class="n">T</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">])</span>
<span class="go">T[&#39;a&#39;][&#39;b&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Path</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">),</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">))</span>
<span class="go">Path(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;)</span>
</pre></div>
</div>
<p>Paths also support indexing and slicing, with each access
returning a new Path object:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">Path(&#39;a&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
<span class="go">Path(1, 2)</span>
</pre></div>
</div>
<dl class="py method">
<dt id="py2store.utils.glom.Path.from_t">
<code class="sig-name descname">from_t</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#Path.from_t"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.Path.from_t" title="Permalink to this definition">¶</a></dt>
<dd><p>return the same path but starting from T</p>
</dd></dl>

<dl class="py method">
<dt id="py2store.utils.glom.Path.from_text">
<em class="property">classmethod </em><code class="sig-name descname">from_text</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">text</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#Path.from_text"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.Path.from_text" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a Path from .-delimited text:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Path</span><span class="o">.</span><span class="n">from_text</span><span class="p">(</span><span class="s1">&#39;a.b.c&#39;</span><span class="p">)</span>
<span class="go">Path(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="py2store.utils.glom.Path.items">
<code class="sig-name descname">items</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#Path.items"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.Path.items" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a tuple of (operation, value) pairs.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Path</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="go">((&#39;.&#39;, &#39;a&#39;), (&#39;.&#39;, &#39;b&#39;), (&#39;P&#39;, &#39;c&#39;), (&#39;[&#39;, &#39;d&#39;))</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="py2store.utils.glom.Path.values">
<code class="sig-name descname">values</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#Path.values"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.Path.values" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a tuple of values referenced in this path.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Path</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<span class="go">(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py exception">
<dt id="py2store.utils.glom.PathAccessError">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.utils.glom.</code><code class="sig-name descname">PathAccessError</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">exc</span></em>, <em class="sig-param"><span class="n">path</span></em>, <em class="sig-param"><span class="n">part_idx</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#PathAccessError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.PathAccessError" title="Permalink to this definition">¶</a></dt>
<dd><p>This <a class="reference internal" href="#py2store.utils.glom.GlomError" title="py2store.utils.glom.GlomError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">GlomError</span></code></a> subtype represents a failure to access an
attribute as dictated by the spec. The most commonly-seen error
when using glom, it maintains a copy of the original exception and
produces a readable error message for easy debugging.</p>
<p>If you see this error, you may want to:</p>
<blockquote>
<div><ul class="simple">
<li><p>Check the target data is accurate using <code class="xref py py-class docutils literal notranslate"><span class="pre">Inspect</span></code></p></li>
<li><p>Catch the exception and return a semantically meaningful error message</p></li>
<li><p>Use <code class="xref py py-class docutils literal notranslate"><span class="pre">glom.Coalesce</span></code> to specify a default</p></li>
<li><p>Use the top-level <code class="docutils literal notranslate"><span class="pre">default</span></code> kwarg on <code class="xref py py-func docutils literal notranslate"><span class="pre">glom()</span></code></p></li>
</ul>
</div></blockquote>
<p>In any case, be glad you got this error and not the one it was
wrapping!</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>exc</strong> (<em>Exception</em>) – The error that arose when we tried to access
<em>path</em>. Typically an instance of KeyError, AttributeError,
IndexError, or TypeError, and sometimes others.</p></li>
<li><p><strong>path</strong> (<a class="reference internal" href="#py2store.utils.glom.Path" title="py2store.utils.glom.Path"><em>Path</em></a>) – The full Path glom was in the middle of accessing
when the error occurred.</p></li>
<li><p><strong>part_idx</strong> (<em>int</em>) – The index of the part of the <em>path</em> that caused
the error.</p></li>
</ul>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s1">&#39;a.b.c&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">PathAccessError</span>: <span class="n">could not access &#39;c&#39;, part 2 of Path(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;), got error: ...</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.utils.glom.Spec">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.glom.</code><code class="sig-name descname">Spec</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">spec</span></em>, <em class="sig-param"><span class="n">scope</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#Spec"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.Spec" title="Permalink to this definition">¶</a></dt>
<dd><p>Spec objects serve three purposes, here they are, roughly ordered
by utility:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>As a form of compiled or “curried” glom call, similar to
Python’s built-in <code class="xref py py-func docutils literal notranslate"><span class="pre">re.compile()</span></code>.</p></li>
<li><p>A marker as an object as representing a spec rather than a
literal value in certain cases where that might be ambiguous.</p></li>
<li><p>A way to update the scope within another Spec.</p></li>
</ol>
</div></blockquote>
<p>In the second usage, Spec objects are the complement to
<code class="xref py py-class docutils literal notranslate"><span class="pre">Literal</span></code>, wrapping a value and marking that it
should be interpreted as a glom spec, rather than a literal value.
This is useful in places where it would be interpreted as a value
by default. (Such as T[key], Call(func) where key and func are
assumed to be literal values and not specs.)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>spec</strong> – The glom spec.</p></li>
<li><p><strong>scope</strong> (<em>dict</em>) – additional values to add to the scope when
evaluating this Spec</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt id="py2store.utils.glom.TType">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.glom.</code><code class="sig-name descname">TType</code><a class="reference internal" href="_modules/py2store/utils/glom.html#TType"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.TType" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">T</span></code>, short for “target”. A singleton object that enables
object-oriented expression of a glom specification.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">T</span></code> is a singleton, and does not need to be constructed.</p>
</div>
<p>Basically, think of <code class="docutils literal notranslate"><span class="pre">T</span></code> as your data’s stunt double. Everything
that you do to <code class="docutils literal notranslate"><span class="pre">T</span></code> will be recorded and executed during the
<a class="reference internal" href="#py2store.utils.glom.glom" title="py2store.utils.glom.glom"><code class="xref py py-func docutils literal notranslate"><span class="pre">glom()</span></code></a> call. Take this example:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">spec</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="s1">&#39;b&#39;</span><span class="p">][</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="s1">&#39;d&#39;</span><span class="p">}}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
<span class="go">&#39;d&#39;</span>
</pre></div>
</div>
<p>So far, we’ve relied on the <code class="docutils literal notranslate"><span class="pre">'a.b.c'</span></code>-style shorthand for
access, or used the <code class="xref py py-class docutils literal notranslate"><span class="pre">Path</span></code> objects, but if you want
to explicitly do attribute and key lookups, look no further than
<code class="docutils literal notranslate"><span class="pre">T</span></code>.</p>
<p>But T doesn’t stop with unambiguous access. You can also call
methods and perform almost any action you would with a normal
object:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">spec</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="nb">list</span><span class="p">))</span>  <span class="c1"># reviewed below</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
<span class="go">[(&#39;c&#39;, &#39;d&#39;)]</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">T</span></code> object can go anywhere in the spec. As seen in the example
above, we access <code class="docutils literal notranslate"><span class="pre">'a'</span></code>, use a <code class="docutils literal notranslate"><span class="pre">T</span></code> to get <code class="docutils literal notranslate"><span class="pre">'b'</span></code> and iterate
over its <code class="docutils literal notranslate"><span class="pre">items</span></code>, turning them into a <code class="docutils literal notranslate"><span class="pre">list</span></code>.</p>
<p>You can even use <code class="docutils literal notranslate"><span class="pre">T</span></code> with <code class="xref py py-class docutils literal notranslate"><span class="pre">Call</span></code> to construct objects:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">ExampleClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">... </span>   <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
<span class="gp">... </span>       <span class="bp">self</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="n">attr</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;attr&#39;</span><span class="p">:</span> <span class="mf">3.14</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Call</span><span class="p">(</span><span class="n">ExampleClass</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">T</span><span class="p">))</span><span class="o">.</span><span class="n">attr</span>
<span class="go">3.14</span>
</pre></div>
</div>
<p>On a further note, while <code class="docutils literal notranslate"><span class="pre">lambda</span></code> works great in glom specs, and
can be very handy at times, <code class="docutils literal notranslate"><span class="pre">T</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">Call</span></code>
eliminate the need for the vast majority of <code class="docutils literal notranslate"><span class="pre">lambda</span></code> usage with
glom.</p>
<p>Unlike <code class="docutils literal notranslate"><span class="pre">lambda</span></code> and other functions, <code class="docutils literal notranslate"><span class="pre">T</span></code> roundtrips
beautifully and transparently:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">T</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">b</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">](</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>
<span class="go">T[&#39;a&#39;].b[&#39;c&#39;](&#39;success&#39;)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">T</span></code>-related access errors raise a <code class="xref py py-exc docutils literal notranslate"><span class="pre">PathAccessError</span></code>
during the <code class="xref py py-func docutils literal notranslate"><span class="pre">glom()</span></code> call.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While <code class="docutils literal notranslate"><span class="pre">T</span></code> is clearly useful, powerful, and here to stay, its
semantics are still being refined. Currently, operations beyond
method calls and attribute/item access are considered
experimental and should not be relied upon.</p>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.utils.glom.TargetRegistry">
<em class="property">class </em><code class="sig-prename descclassname">py2store.utils.glom.</code><code class="sig-name descname">TargetRegistry</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">register_default_types</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#TargetRegistry"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.TargetRegistry" title="Permalink to this definition">¶</a></dt>
<dd><p>responsible for registration of target types for iteration
and attribute walking</p>
<dl class="py method">
<dt id="py2store.utils.glom.TargetRegistry.get_handler">
<code class="sig-name descname">get_handler</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">op</span></em>, <em class="sig-param"><span class="n">obj</span></em>, <em class="sig-param"><span class="n">path</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">raise_exc</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#TargetRegistry.get_handler"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.TargetRegistry.get_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>for an operation and object <strong>instance</strong>, obj, return the
closest-matching handler function, raising UnregisteredTarget
if no handler can be found for <em>obj</em> (or False if
raise_exc=False)</p>
</dd></dl>

<dl class="py method">
<dt id="py2store.utils.glom.TargetRegistry.register_op">
<code class="sig-name descname">register_op</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">op_name</span></em>, <em class="sig-param"><span class="n">auto_func</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">exact</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#TargetRegistry.register_op"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.TargetRegistry.register_op" title="Permalink to this definition">¶</a></dt>
<dd><p>add operations beyond the builtins (‘get’ and ‘iterate’ at the time
of writing).</p>
<p>auto_func is a function that when passed a type, returns a
handler associated with op_name if it’s supported, or False if
it’s not.</p>
<p>See glom.core.register_op() for the global version used by
extensions.</p>
</dd></dl>

</dd></dl>

<dl class="py exception">
<dt id="py2store.utils.glom.UnregisteredTarget">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.utils.glom.</code><code class="sig-name descname">UnregisteredTarget</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">op</span></em>, <em class="sig-param"><span class="n">target_type</span></em>, <em class="sig-param"><span class="n">type_map</span></em>, <em class="sig-param"><span class="n">path</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#UnregisteredTarget"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.UnregisteredTarget" title="Permalink to this definition">¶</a></dt>
<dd><p>This <a class="reference internal" href="#py2store.utils.glom.GlomError" title="py2store.utils.glom.GlomError"><code class="xref py py-class docutils literal notranslate"><span class="pre">GlomError</span></code></a> subtype is raised when a spec calls for an
unsupported action on a target type. For instance, trying to
iterate on an non-iterable target:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="nb">object</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;a.b.c&#39;</span><span class="p">])</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">UnregisteredTarget</span>: <span class="n">target type &#39;object&#39; not registered for &#39;iterate&#39;, expected one of registered types: (...)</span>
</pre></div>
</div>
<p>It should be noted that this is a pretty uncommon occurrence in
production glom usage. See the <span class="xref std std-ref">setup-and-registration</span>
section for details on how to avoid this error.</p>
<p>An UnregisteredTarget takes and tracks a few values:</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>op</strong> (<em>str</em>) – The name of the operation being performed (‘get’ or ‘iterate’)</p></li>
<li><p><strong>target_type</strong> (<em>type</em>) – The type of the target being processed.</p></li>
<li><p><strong>type_map</strong> (<em>dict</em>) – A mapping of target types that do support this operation</p></li>
<li><p><strong>path</strong> – The path at which the error occurred.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="py2store.utils.glom.glom">
<code class="sig-prename descclassname">py2store.utils.glom.</code><code class="sig-name descname">glom</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">target</span></em>, <em class="sig-param"><span class="n">spec</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#glom"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.glom" title="Permalink to this definition">¶</a></dt>
<dd><p>Access or construct a value from a given <em>target</em> based on the
specification declared by <em>spec</em>.</p>
<p>Accessing nested data, aka deep-get:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;c&#39;</span><span class="p">}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s1">&#39;a.b&#39;</span><span class="p">)</span>
<span class="go">&#39;c&#39;</span>
</pre></div>
</div>
<p>Here the <em>spec</em> was just a string denoting a path,
<code class="docutils literal notranslate"><span class="pre">'a.b.</span></code>. As simple as it should be. The next example shows
how to use nested data to access many fields at once, and make
a new nested structure.</p>
<p>Constructing, or restructuring more-complicated nested data:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="s1">&#39;e&#39;</span><span class="p">},</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;a.b&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="s1">&#39;a.d&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">])}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">output</span> <span class="o">=</span> <span class="n">glom</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
<span class="go">{&#39;a&#39;: &#39;c&#39;, &#39;d&#39;: &#39;e&#39;, &#39;h&#39;: [0, 2, 4]}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">glom</span></code> also takes a keyword-argument, <em>default</em>. When set,
if a <code class="docutils literal notranslate"><span class="pre">glom</span></code> operation fails with a <a class="reference internal" href="#py2store.utils.glom.GlomError" title="py2store.utils.glom.GlomError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">GlomError</span></code></a>, the
<em>default</em> will be returned, very much like
<code class="xref py py-meth docutils literal notranslate"><span class="pre">dict.get()</span></code>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s1">&#39;a.xx&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;nada&#39;</span><span class="p">)</span>
<span class="go">&#39;nada&#39;</span>
</pre></div>
</div>
<p>The <em>skip_exc</em> keyword argument controls which errors should
be ignored.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">glom</span><span class="p">({},</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">100.0</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">skip_exc</span><span class="o">=</span><span class="ne">ZeroDivisionError</span><span class="p">)</span>
<span class="go">0.0</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>target</strong> (<em>object</em>) – the object on which the glom will operate.</p></li>
<li><p><strong>spec</strong> (<em>object</em>) – Specification of the output object in the form
of a dict, list, tuple, string, other glom construct, or
any composition of these.</p></li>
<li><p><strong>default</strong> (<em>object</em>) – An optional default to return in the case
an exception, specified by <em>skip_exc</em>, is raised.</p></li>
<li><p><strong>skip_exc</strong> (<em>Exception</em>) – An optional exception or tuple of
exceptions to ignore and return <em>default</em> (None if
omitted). If <em>skip_exc</em> and <em>default</em> are both not set,
glom raises errors through.</p></li>
<li><p><strong>scope</strong> (<em>dict</em>) – Additional data that can be accessed
via S inside the glom-spec.</p></li>
</ul>
</dd>
</dl>
<p>It’s a small API with big functionality, and glom’s power is
only surpassed by its intuitiveness. Give it a whirl!</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.utils.glom.is_iterable">
<code class="sig-prename descclassname">py2store.utils.glom.</code><code class="sig-name descname">is_iterable</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#is_iterable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.is_iterable" title="Permalink to this definition">¶</a></dt>
<dd><p>Similar in nature to <code class="xref py py-func docutils literal notranslate"><span class="pre">callable()</span></code>, <code class="docutils literal notranslate"><span class="pre">is_iterable</span></code> returns
<code class="docutils literal notranslate"><span class="pre">True</span></code> if an object is <a href="#id105"><span class="problematic" id="id106">`iterable`_</span></a>, <code class="docutils literal notranslate"><span class="pre">False</span></code> if not.
&gt;&gt;&gt; is_iterable([])
True
&gt;&gt;&gt; is_iterable(1)
False</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.utils.glom.make_sentinel">
<code class="sig-prename descclassname">py2store.utils.glom.</code><code class="sig-name descname">make_sentinel</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">'_MISSING'</span></em>, <em class="sig-param"><span class="n">var_name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#make_sentinel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.make_sentinel" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates and returns a new <strong>instance</strong> of a new class, suitable for
usage as a “sentinel”, a kind of singleton often used to indicate
a value is missing when <code class="docutils literal notranslate"><span class="pre">None</span></code> is a valid input.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<em>str</em>) – Name of the Sentinel</p></li>
<li><p><strong>var_name</strong> (<em>str</em>) – Set this name to the name of the variable in
its respective module enable pickleability.</p></li>
</ul>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">make_sentinel</span><span class="p">(</span><span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;_MISSING&#39;</span><span class="p">)</span>
<span class="go">_MISSING</span>
</pre></div>
</div>
<p>The most common use cases here in boltons are as default values
for optional function arguments, partly because of its
less-confusing appearance in automatically generated
documentation. Sentinels also function well as placeholders in queues
and linked lists.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By design, additional calls to <code class="docutils literal notranslate"><span class="pre">make_sentinel</span></code> with the same
values will not produce equivalent objects.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">make_sentinel</span><span class="p">(</span><span class="s1">&#39;TEST&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">make_sentinel</span><span class="p">(</span><span class="s1">&#39;TEST&#39;</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">make_sentinel</span><span class="p">(</span><span class="s1">&#39;TEST&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="n">make_sentinel</span><span class="p">(</span><span class="s1">&#39;TEST&#39;</span><span class="p">))</span>
<span class="go">False</span>
</pre></div>
</div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.utils.glom.register">
<code class="sig-prename descclassname">py2store.utils.glom.</code><code class="sig-name descname">register</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">target_type</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#register"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.register" title="Permalink to this definition">¶</a></dt>
<dd><p>Register <em>target_type</em> so <code class="xref py py-meth docutils literal notranslate"><span class="pre">glom()</span></code> will
know how to handle instances of that type as targets.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>target_type</strong> (<em>type</em>) – A type expected to appear in a glom()
call target</p></li>
<li><p><strong>get</strong> (<em>callable</em>) – A function which takes a target object and
a name, acting as a default accessor. Defaults to
<code class="xref py py-func docutils literal notranslate"><span class="pre">getattr()</span></code>.</p></li>
<li><p><strong>iterate</strong> (<em>callable</em>) – A function which takes a target object
and returns an iterator. Defaults to <code class="xref py py-func docutils literal notranslate"><span class="pre">iter()</span></code> if
<em>target_type</em> appears to be iterable.</p></li>
<li><p><strong>exact</strong> (<em>bool</em>) – Whether or not to match instances of subtypes
of <em>target_type</em>.</p></li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The module-level <a class="reference internal" href="#py2store.utils.glom.register" title="py2store.utils.glom.register"><code class="xref py py-func docutils literal notranslate"><span class="pre">register()</span></code></a> function affects the
module-level <a class="reference internal" href="#py2store.utils.glom.glom" title="py2store.utils.glom.glom"><code class="xref py py-func docutils literal notranslate"><span class="pre">glom()</span></code></a> function’s behavior. If this
global effect is undesirable for your application, or
you’re implementing a library, consider instantiating a
<a class="reference internal" href="#py2store.utils.glom.Glommer" title="py2store.utils.glom.Glommer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Glommer</span></code></a> instance, and using the
<a class="reference internal" href="#py2store.utils.glom.Glommer.register" title="py2store.utils.glom.Glommer.register"><code class="xref py py-meth docutils literal notranslate"><span class="pre">register()</span></code></a> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">Glommer.glom()</span></code>
methods instead.</p>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.utils.glom.register_op">
<code class="sig-prename descclassname">py2store.utils.glom.</code><code class="sig-name descname">register_op</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">op_name</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/utils/glom.html#register_op"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.utils.glom.register_op" title="Permalink to this definition">¶</a></dt>
<dd><p>For extension authors needing to add operations beyond the builtin
‘get’ and ‘iterate’ to the default scope. See TargetRegistry for more details.</p>
</dd></dl>

</div>
<div class="section" id="py2store-persisters-sql-w-odbc">
<h1>py2store.persisters.sql_w_odbc<a class="headerlink" href="#py2store-persisters-sql-w-odbc" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.persisters.dynamodb_w_boto3">
<span id="py2store-persisters-dynamodb-w-boto3"></span><h1>py2store.persisters.dynamodb_w_boto3<a class="headerlink" href="#module-py2store.persisters.dynamodb_w_boto3" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.persisters.dynamodb_w_boto3.DynamoDbPersister">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.dynamodb_w_boto3.</code><code class="sig-name descname">DynamoDbPersister</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">aws_access_key_id</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">aws_secret_access_key</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">region_name</span><span class="o">=</span><span class="default_value">'us-west-2'</span></em>, <em class="sig-param"><span class="n">endpoint_url</span><span class="o">=</span><span class="default_value">'http://localhost:8000'</span></em>, <em class="sig-param"><span class="n">table_name</span><span class="o">=</span><span class="default_value">'py2store'</span></em>, <em class="sig-param"><span class="n">key_fields</span><span class="o">=</span><span class="default_value">('key')</span></em>, <em class="sig-param"><span class="n">data_fields</span><span class="o">=</span><span class="default_value">('data')</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/dynamodb_w_boto3.html#DynamoDbPersister"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.dynamodb_w_boto3.DynamoDbPersister" title="Permalink to this definition">¶</a></dt>
<dd><p>A basic DynamoDb via Boto3 persister.
&gt;&gt;&gt; from py2store.persisters.dynamodb_w_boto3 import DynamoDbPersister
&gt;&gt;&gt; s = DynamoDbPersister()
&gt;&gt;&gt; k = {‘key’: ‘777’} # Each collection will happily accept user-defined _key values.
&gt;&gt;&gt; v = {‘val’: ‘bar’}
&gt;&gt;&gt; for _key in s:
…     del s[_key]
…
&gt;&gt;&gt; k in s
False
&gt;&gt;&gt; len(s)
0
&gt;&gt;&gt; s[k] = v
&gt;&gt;&gt; len(s)
1
&gt;&gt;&gt; s[k]
{‘val’: ‘bar’}
&gt;&gt;&gt; s.get(k)
{‘val’: ‘bar’}
&gt;&gt;&gt; s.get({‘not’: ‘a key’}, {‘default’: ‘val’})  # testing s.get with default
{‘default’: ‘val’}
&gt;&gt;&gt; list(s.values())
[{‘val’: ‘bar’}]
&gt;&gt;&gt; k in s  # testing __contains__ again
True
&gt;&gt;&gt; del s[k]
&gt;&gt;&gt; len(s)
0
&gt;&gt;&gt; s = DynamoDbPersister(table_name=’py2store2’, key_fields=(‘name’,))
&gt;&gt;&gt; for _key in s:
…   del s[_key]
&gt;&gt;&gt; len(s)
0
&gt;&gt;&gt; s[{‘name’: ‘guido’}] = {‘yob’: 1956, ‘proj’: ‘python’, ‘bdfl’: False}
&gt;&gt;&gt; s[{‘name’: ‘guido’}]
{‘proj’: ‘python’, ‘yob’: Decimal(‘1956’), ‘bdfl’: False}
&gt;&gt;&gt; s[{‘name’: ‘vitalik’}] = {‘yob’: 1994, ‘proj’: ‘ethereum’, ‘bdfl’: True}
&gt;&gt;&gt; s[{‘name’: ‘vitalik’}]
{‘proj’: ‘ethereum’, ‘yob’: Decimal(‘1994’), ‘bdfl’: True}
&gt;&gt;&gt; for key, val in s.items():
…   print(f”{key}: {val}”)
{‘name’: ‘vitalik’}: {‘proj’: ‘ethereum’, ‘yob’: Decimal(‘1994’), ‘bdfl’: True}
{‘name’: ‘guido’}: {‘proj’: ‘python’, ‘yob’: Decimal(‘1956’), ‘bdfl’: False}</p>
</dd></dl>

<dl class="py exception">
<dt id="py2store.persisters.dynamodb_w_boto3.NoSuchKeyError">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.persisters.dynamodb_w_boto3.</code><code class="sig-name descname">NoSuchKeyError</code><a class="reference internal" href="_modules/py2store/persisters/dynamodb_w_boto3.html#NoSuchKeyError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.dynamodb_w_boto3.NoSuchKeyError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="py2store-persisters-couchdb-w-couchdb">
<h1>py2store.persisters.couchdb_w_couchdb<a class="headerlink" href="#py2store-persisters-couchdb-w-couchdb" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.persisters.ftp_persister">
<span id="py2store-persisters-ftp-persister"></span><h1>py2store.persisters.ftp_persister<a class="headerlink" href="#module-py2store.persisters.ftp_persister" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.persisters.ftp_persister.FtpPersister">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.ftp_persister.</code><code class="sig-name descname">FtpPersister</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">user</span><span class="o">=</span><span class="default_value">'dlpuser&#64;dlptest.com'</span></em>, <em class="sig-param"><span class="n">password</span><span class="o">=</span><span class="default_value">'fLDScD4Ynth0p4OJ6bW6qCxjh'</span></em>, <em class="sig-param"><span class="n">url</span><span class="o">=</span><span class="default_value">'ftp.dlptest.com'</span></em>, <em class="sig-param"><span class="n">rootdir</span><span class="o">=</span><span class="default_value">'./py2store'</span></em>, <em class="sig-param"><span class="n">encoding</span><span class="o">=</span><span class="default_value">'utf8'</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/ftp_persister.html#FtpPersister"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.ftp_persister.FtpPersister" title="Permalink to this definition">¶</a></dt>
<dd><p>A basic ftp persister.
Keys must be names of files.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store.persisters.ftp_persister</span> <span class="kn">import</span> <span class="n">FtpPersister</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">FtpPersister</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">_key</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">del</span> <span class="n">s</span><span class="p">[</span><span class="n">_key</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="go">&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="go">&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="go">[&#39;bar&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span> <span class="ow">in</span> <span class="n">s</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span> <span class="ow">in</span> <span class="n">s</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">0</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.persisters.ftp_persister.remote_mkdir">
<code class="sig-prename descclassname">py2store.persisters.ftp_persister.</code><code class="sig-name descname">remote_mkdir</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ftp</span></em>, <em class="sig-param"><span class="n">remote_directory</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/ftp_persister.html#remote_mkdir"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.ftp_persister.remote_mkdir" title="Permalink to this definition">¶</a></dt>
<dd><p>Change to this directory, recursively making new folders if needed.
returns: True if any folders were created.</p>
</dd></dl>

</div>
<div class="section" id="module-py2store.persisters.dropbox_w_urllib">
<span id="py2store-persisters-dropbox-w-urllib"></span><h1>py2store.persisters.dropbox_w_urllib<a class="headerlink" href="#module-py2store.persisters.dropbox_w_urllib" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.persisters.dropbox_w_urllib.DropboxFileCopyReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.dropbox_w_urllib.</code><code class="sig-name descname">DropboxFileCopyReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">url</span></em>, <em class="sig-param"><span class="n">path</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/dropbox_w_urllib.html#DropboxFileCopyReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.dropbox_w_urllib.DropboxFileCopyReader" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.persisters.dropbox_w_urllib.DropboxFolderCopyReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.dropbox_w_urllib.</code><code class="sig-name descname">DropboxFolderCopyReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">url</span></em>, <em class="sig-param"><span class="n">path</span><span class="o">=</span><span class="default_value">'/var/folders/j5/brqb67791slb1f04g53vcb780000gp/T'</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/dropbox_w_urllib.html#DropboxFolderCopyReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.dropbox_w_urllib.DropboxFolderCopyReader" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes a full local copy of the folder (by default, to a local temp folder) and gives access to it.</p>
</dd></dl>

</div>
<div class="section" id="module-py2store.persisters._google_drive_in_progress">
<span id="py2store-persisters-google-drive-in-progress"></span><h1>py2store.persisters._google_drive_in_progress<a class="headerlink" href="#module-py2store.persisters._google_drive_in_progress" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="py2store-persisters-dropbox-w-dropbox">
<h1>py2store.persisters.dropbox_w_dropbox<a class="headerlink" href="#py2store-persisters-dropbox-w-dropbox" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="py2store-persisters-redis-w-redis">
<h1>py2store.persisters.redis_w_redis<a class="headerlink" href="#py2store-persisters-redis-w-redis" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.persisters.sql_w_sqlalchemy">
<span id="py2store-persisters-sql-w-sqlalchemy"></span><h1>py2store.persisters.sql_w_sqlalchemy<a class="headerlink" href="#module-py2store.persisters.sql_w_sqlalchemy" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.persisters.sql_w_sqlalchemy.SQLAlchemyPersister">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.sql_w_sqlalchemy.</code><code class="sig-name descname">SQLAlchemyPersister</code><span class="sig-paren">(</span><em class="sig-param">uri='sqlite:///my_sqlite.db'</em>, <em class="sig-param">collection_name='py2store_default_table'</em>, <em class="sig-param">key_fields={'_id': &lt;class 'sqlalchemy.sql.sqltypes.INTEGER'&gt;}</em>, <em class="sig-param">data_fields={'data': &lt;class 'sqlalchemy.sql.sqltypes.String'&gt;}</em>, <em class="sig-param">autocommit=True</em>, <em class="sig-param">**db_kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/sql_w_sqlalchemy.html#SQLAlchemyPersister"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.sql_w_sqlalchemy.SQLAlchemyPersister" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py attribute">
<dt id="py2store.persisters.sql_w_sqlalchemy.SQLAlchemyPersister.TYPE_BLOB">
<code class="sig-name descname">TYPE_BLOB</code><a class="headerlink" href="#py2store.persisters.sql_w_sqlalchemy.SQLAlchemyPersister.TYPE_BLOB" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.sql.sqltypes.BLOB</span></code></p>
</dd></dl>

<dl class="py attribute">
<dt id="py2store.persisters.sql_w_sqlalchemy.SQLAlchemyPersister.TYPE_BOOLEAN">
<code class="sig-name descname">TYPE_BOOLEAN</code><a class="headerlink" href="#py2store.persisters.sql_w_sqlalchemy.SQLAlchemyPersister.TYPE_BOOLEAN" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.sql.sqltypes.BOOLEAN</span></code></p>
</dd></dl>

<dl class="py attribute">
<dt id="py2store.persisters.sql_w_sqlalchemy.SQLAlchemyPersister.TYPE_INTEGER">
<code class="sig-name descname">TYPE_INTEGER</code><a class="headerlink" href="#py2store.persisters.sql_w_sqlalchemy.SQLAlchemyPersister.TYPE_INTEGER" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.sql.sqltypes.INTEGER</span></code></p>
</dd></dl>

<dl class="py attribute">
<dt id="py2store.persisters.sql_w_sqlalchemy.SQLAlchemyPersister.TYPE_STRING">
<code class="sig-name descname">TYPE_STRING</code><a class="headerlink" href="#py2store.persisters.sql_w_sqlalchemy.SQLAlchemyPersister.TYPE_STRING" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.sql.sqltypes.String</span></code></p>
</dd></dl>

<dl class="py attribute">
<dt id="py2store.persisters.sql_w_sqlalchemy.SQLAlchemyPersister.TYPE_TEXT">
<code class="sig-name descname">TYPE_TEXT</code><a class="headerlink" href="#py2store.persisters.sql_w_sqlalchemy.SQLAlchemyPersister.TYPE_TEXT" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.sql.sqltypes.TEXT</span></code></p>
</dd></dl>

</dd></dl>

<dl class="py attribute">
<dt id="py2store.persisters.sql_w_sqlalchemy.SqlAlchemyDatabaseCollection">
<code class="sig-prename descclassname">py2store.persisters.sql_w_sqlalchemy.</code><code class="sig-name descname">SqlAlchemyDatabaseCollection</code><a class="headerlink" href="#py2store.persisters.sql_w_sqlalchemy.SqlAlchemyDatabaseCollection" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#py2store.persisters.sql_w_sqlalchemy.SqlDbCollection" title="py2store.persisters.sql_w_sqlalchemy.SqlDbCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">py2store.persisters.sql_w_sqlalchemy.SqlDbCollection</span></code></a></p>
</dd></dl>

<dl class="py attribute">
<dt id="py2store.persisters.sql_w_sqlalchemy.SqlAlchemyReader">
<code class="sig-prename descclassname">py2store.persisters.sql_w_sqlalchemy.</code><code class="sig-name descname">SqlAlchemyReader</code><a class="headerlink" href="#py2store.persisters.sql_w_sqlalchemy.SqlAlchemyReader" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#py2store.persisters.sql_w_sqlalchemy.SqlDbReader" title="py2store.persisters.sql_w_sqlalchemy.SqlDbReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">py2store.persisters.sql_w_sqlalchemy.SqlDbReader</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt id="py2store.persisters.sql_w_sqlalchemy.SqlDbCollection">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.sql_w_sqlalchemy.</code><code class="sig-name descname">SqlDbCollection</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">connection</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/sql_w_sqlalchemy.html#SqlDbCollection"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.sql_w_sqlalchemy.SqlDbCollection" title="Permalink to this definition">¶</a></dt>
<dd><p>A collection of sql tables names.</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.persisters.sql_w_sqlalchemy.SqlDbReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.sql_w_sqlalchemy.</code><code class="sig-name descname">SqlDbReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">connection</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/sql_w_sqlalchemy.html#SqlDbReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.sql_w_sqlalchemy.SqlDbReader" title="Permalink to this definition">¶</a></dt>
<dd><p>A KvReader of sql tables. Keys are table names and values are SqlTable objects</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.persisters.sql_w_sqlalchemy.SqlTableRowsCollection">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.sql_w_sqlalchemy.</code><code class="sig-name descname">SqlTableRowsCollection</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">connection</span></em>, <em class="sig-param"><span class="n">table_name</span></em>, <em class="sig-param"><span class="n">batch_size</span><span class="o">=</span><span class="default_value">2000</span></em>, <em class="sig-param"><span class="n">limit</span><span class="o">=</span><span class="default_value">10000000000000000</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/sql_w_sqlalchemy.html#SqlTableRowsCollection"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.sql_w_sqlalchemy.SqlTableRowsCollection" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class wrapping an sql table.
It is Iterable (yields rows (as tuples)) and Sized (i.e. you can call len on it).
It’s also a container, but brute-forced: should probably subclass if you want to perform <cite>row in table</cite> efficiently.</p>
<p>Note: Be aware of how this object works if you’re (1) talking to a table whose contents are changing dynamically.
* count_rows() will return the current count every time
* len returns the value of the _row_count lazyprop
* _row_count returns the length of the _rows cache if it exists, and if not, will return the live count_rows
* if len (therefore _row_count) is called before the object listed the rows (therefore filling it’s cache),</p>
<blockquote>
<div><p>it will return the current number of rows, but if at the time of listing rows, the number of different,
the number of rows will be updated to match number of rows cached.</p>
</div></blockquote>
<ul class="simple">
<li><p>column_names is a cached property</p></li>
</ul>
</dd></dl>

<dl class="py class">
<dt id="py2store.persisters.sql_w_sqlalchemy.SqlTableRowsSequence">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.sql_w_sqlalchemy.</code><code class="sig-name descname">SqlTableRowsSequence</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">connection</span></em>, <em class="sig-param"><span class="n">table_name</span></em>, <em class="sig-param"><span class="n">batch_size</span><span class="o">=</span><span class="default_value">2000</span></em>, <em class="sig-param"><span class="n">limit</span><span class="o">=</span><span class="default_value">10000000000000000</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/sql_w_sqlalchemy.html#SqlTableRowsSequence"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.sql_w_sqlalchemy.SqlTableRowsSequence" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="py2store.persisters.sql_w_sqlalchemy.iter_rows">
<code class="sig-prename descclassname">py2store.persisters.sql_w_sqlalchemy.</code><code class="sig-name descname">iter_rows</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">connection</span></em>, <em class="sig-param"><span class="n">table_name</span></em>, <em class="sig-param"><span class="n">batch_size</span><span class="o">=</span><span class="default_value">1000</span></em>, <em class="sig-param"><span class="n">offset</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">limit</span><span class="o">=</span><span class="default_value">1000000000000</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/sql_w_sqlalchemy.html#iter_rows"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.sql_w_sqlalchemy.iter_rows" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterate the over the rows of a table.
The limit argument is mostly there to avoid an infinite loop, but can also be used to get ranges.</p>
</dd></dl>

</div>
<div class="section" id="module-py2store.persisters.new_s3">
<span id="py2store-persisters-new-s3"></span><h1>py2store.persisters.new_s3<a class="headerlink" href="#module-py2store.persisters.new_s3" title="Permalink to this headline">¶</a></h1>
<dl class="py exception">
<dt id="py2store.persisters.new_s3.GetItemForKeyError">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.persisters.new_s3.</code><code class="sig-name descname">GetItemForKeyError</code><a class="reference internal" href="_modules/py2store/persisters/new_s3.html#GetItemForKeyError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.new_s3.GetItemForKeyError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py exception">
<dt id="py2store.persisters.new_s3.KeyNotValidError">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.persisters.new_s3.</code><code class="sig-name descname">KeyNotValidError</code><a class="reference internal" href="_modules/py2store/persisters/new_s3.html#KeyNotValidError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.new_s3.KeyNotValidError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py exception">
<dt id="py2store.persisters.new_s3.NoSuchKeyError">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.persisters.new_s3.</code><code class="sig-name descname">NoSuchKeyError</code><a class="reference internal" href="_modules/py2store/persisters/new_s3.html#NoSuchKeyError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.new_s3.NoSuchKeyError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.persisters.new_s3.S3BaseReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.new_s3.</code><code class="sig-name descname">S3BaseReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">client</span><span class="p">:</span> <span class="n">botocore.client.BaseClient</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/new_s3.html#S3BaseReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.new_s3.S3BaseReader" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.persisters.new_s3.S3BucketBasePersister">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.new_s3.</code><code class="sig-name descname">S3BucketBasePersister</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">client</span><span class="p">:</span> <span class="n">botocore.client.BaseClient</span></em>, <em class="sig-param"><span class="n">bucket</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">prefix</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">''</span></em>, <em class="sig-param"><span class="n">with_files</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em>, <em class="sig-param"><span class="n">with_directories</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/new_s3.html#S3BucketBasePersister"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.new_s3.S3BucketBasePersister" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.persisters.new_s3.S3BucketBaseReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.new_s3.</code><code class="sig-name descname">S3BucketBaseReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">client</span><span class="p">:</span> <span class="n">botocore.client.BaseClient</span></em>, <em class="sig-param"><span class="n">bucket</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">prefix</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">''</span></em>, <em class="sig-param"><span class="n">with_files</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em>, <em class="sig-param"><span class="n">with_directories</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/new_s3.html#S3BucketBaseReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.new_s3.S3BucketBaseReader" title="Permalink to this definition">¶</a></dt>
<dd><p>Base bucket reader. Keys are strings, values are http responses (dicts).</p>
<p>To get the actual contents from the response <cite>v</cite> you can do <cite>v[‘Body’].read()</cite>, or more sophisticated-ly:
<a href="#id33"><span class="problematic" id="id34">``</span></a>`
if v[‘ResponseMetadata’][‘HTTPStatusCode’] == 200:</p>
<blockquote>
<div><p>return v[‘Body’].read()</p>
</div></blockquote>
<dl class="simple">
<dt>else:</dt><dd><p>raise RuntimeError(f”HttpError (code {v[‘ResponseMetadata’][‘HTTPStatusCode’]})”)</p>
</dd>
</dl>
<p><a href="#id35"><span class="problematic" id="id36">``</span></a><a href="#id37"><span class="problematic" id="id38">`</span></a></p>
<p>But know that <cite>body = v[‘Body’]</cite> is a <cite>botocore.response.StreamingBody</cite> instance, and as such, you have not
only the <cite>body.read(amt=None)</cite> but also
- <cite>body.iter_chunks(chunk_size=1024)</cite> that may be useful for large binary data, or
- <cite>body.iter_lines(chunk_size=1024)</cite> that may be useful for large text data.</p>
<p>S3BucketBaseReader is really meant to be wrapped and/or subclassed into interfaces that do that for you.</p>
<p>Example use:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">client_kwargs</span> <span class="pre">=</span> <span class="pre">get_configs()</span>&#160; <span class="pre">#</span> <span class="pre">get</span> <span class="pre">(at</span> <span class="pre">least)</span> <span class="pre">aws_access_key_id</span> <span class="pre">and</span> <span class="pre">aws_secret_access_key</span>
<span class="pre">r</span> <span class="pre">=</span> <span class="pre">S3BucketBaseReader(S3BucketBaseReader.mk_client(**resources_kwargs),</span> <span class="pre">bucket='bucket_name',</span> <span class="pre">prefix='my_stuff/')</span>
<span class="pre">list(r)</span>&#160; <span class="pre">#</span> <span class="pre">will</span> <span class="pre">list</span> <span class="pre">file</span> <span class="pre">and</span> <span class="pre">folder</span> <span class="pre">names</span>
<span class="pre">r['my_stuff/music/']</span>&#160; <span class="pre">#</span> <span class="pre">will</span> <span class="pre">give</span> <span class="pre">you</span> <span class="pre">another</span> <span class="pre">S3BucketBaseReader</span> <span class="pre">for</span> <span class="pre">that</span> <span class="pre">&quot;subfolder&quot;</span>
<span class="pre">r['my_stuff/music/with_meaning.mp3']</span>&#160; <span class="pre">#</span> <span class="pre">will</span> <span class="pre">give</span> <span class="pre">you</span> <span class="pre">the</span> <span class="pre">response</span> <span class="pre">object</span> <span class="pre">for</span> <span class="pre">the</span> <span class="pre">contents</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">file</span>
<span class="pre">`</span></code></p>
</dd></dl>

<dl class="py class">
<dt id="py2store.persisters.new_s3.S3BucketPersister">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.new_s3.</code><code class="sig-name descname">S3BucketPersister</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">client</span><span class="p">:</span> <span class="n">botocore.client.BaseClient</span></em>, <em class="sig-param"><span class="n">bucket</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">prefix</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">''</span></em>, <em class="sig-param"><span class="n">with_files</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em>, <em class="sig-param"><span class="n">with_directories</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/new_s3.html#S3BucketPersister"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.new_s3.S3BucketPersister" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.persisters.new_s3.S3BucketReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.new_s3.</code><code class="sig-name descname">S3BucketReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">client</span><span class="p">:</span> <span class="n">botocore.client.BaseClient</span></em>, <em class="sig-param"><span class="n">bucket</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">prefix</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">''</span></em>, <em class="sig-param"><span class="n">with_files</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em>, <em class="sig-param"><span class="n">with_directories</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/new_s3.html#S3BucketReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.new_s3.S3BucketReader" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.persisters.new_s3.S3Collection">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.new_s3.</code><code class="sig-name descname">S3Collection</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">client</span><span class="p">:</span> <span class="n">botocore.client.BaseClient</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/new_s3.html#S3Collection"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.new_s3.S3Collection" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py exception">
<dt id="py2store.persisters.new_s3.S3HttpError">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.persisters.new_s3.</code><code class="sig-name descname">S3HttpError</code><a class="reference internal" href="_modules/py2store/persisters/new_s3.html#S3HttpError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.new_s3.S3HttpError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py exception">
<dt id="py2store.persisters.new_s3.S3KeyError">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.persisters.new_s3.</code><code class="sig-name descname">S3KeyError</code><a class="reference internal" href="_modules/py2store/persisters/new_s3.html#S3KeyError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.new_s3.S3KeyError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py exception">
<dt id="py2store.persisters.new_s3.S3Not200StatusCodeError">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.persisters.new_s3.</code><code class="sig-name descname">S3Not200StatusCodeError</code><a class="reference internal" href="_modules/py2store/persisters/new_s3.html#S3Not200StatusCodeError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.new_s3.S3Not200StatusCodeError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.persisters.new_s3.S3PickleStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.new_s3.</code><code class="sig-name descname">S3PickleStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/new_s3.html#S3PickleStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.new_s3.S3PickleStore" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="py2store.persisters.new_s3.S3StringStore">
<code class="sig-prename descclassname">py2store.persisters.new_s3.</code><code class="sig-name descname">S3StringStore</code><a class="headerlink" href="#py2store.persisters.new_s3.S3StringStore" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#py2store.persisters.new_s3.S3TextStore" title="py2store.persisters.new_s3.S3TextStore"><code class="xref py py-class docutils literal notranslate"><span class="pre">py2store.persisters.new_s3.S3TextStore</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt id="py2store.persisters.new_s3.S3TextStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.new_s3.</code><code class="sig-name descname">S3TextStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/new_s3.html#S3TextStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.new_s3.S3TextStore" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="py2store.persisters.new_s3.ensure_client">
<code class="sig-prename descclassname">py2store.persisters.new_s3.</code><code class="sig-name descname">ensure_client</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">candidate_client</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/new_s3.html#ensure_client"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.new_s3.ensure_client" title="Permalink to this definition">¶</a></dt>
<dd><p>Ensure input is a BaseClient (either kwargs to make one, or already a BaseClient instance.</p>
</dd></dl>

</div>
<div class="section" id="module-py2store.persisters">
<span id="py2store-persisters"></span><h1>py2store.persisters<a class="headerlink" href="#module-py2store.persisters" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.persisters.dropbox_w_requests">
<span id="py2store-persisters-dropbox-w-requests"></span><h1>py2store.persisters.dropbox_w_requests<a class="headerlink" href="#module-py2store.persisters.dropbox_w_requests" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.persisters.w_aiofile">
<span id="py2store-persisters-w-aiofile"></span><h1>py2store.persisters.w_aiofile<a class="headerlink" href="#module-py2store.persisters.w_aiofile" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.persisters.w_aiofile.AioFileBytesPersister">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.w_aiofile.</code><code class="sig-name descname">AioFileBytesPersister</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">rootdir</span></em>, <em class="sig-param"><span class="n">subpath</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">pattern_for_field</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/w_aiofile.html#AioFileBytesPersister"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.w_aiofile.AioFileBytesPersister" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt id="py2store.persisters.w_aiofile.AioFileBytesPersister.asetitem">
<code class="sig-name descname">asetitem</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">k</span></em>, <em class="sig-param"><span class="n">v</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/w_aiofile.html#AioFileBytesPersister.asetitem"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.w_aiofile.AioFileBytesPersister.asetitem" title="Permalink to this definition">¶</a></dt>
<dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store.persisters.w_aiofile</span> <span class="kn">import</span> <span class="n">AioFileBytesPersister</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store.filesys</span> <span class="kn">import</span> <span class="n">mk_tmp_py2store_dir</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rootdir</span> <span class="o">=</span> <span class="n">mk_tmp_py2store_dir</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rpath</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">p</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rootdir</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">AioFileBytesPersister</span><span class="p">(</span><span class="n">rootdir</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span> <span class="o">=</span> <span class="n">rpath</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">del</span> <span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>  <span class="c1"># delete key if present</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># number of items in store</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">await</span> <span class="n">s</span><span class="o">.</span><span class="n">asetitem</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># there&#39;s one more item in store</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">s</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="p">(</span><span class="k">await</span> <span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;bar&#39;</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="py2store.persisters.w_aiofile.AioFileBytesReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.w_aiofile.</code><code class="sig-name descname">AioFileBytesReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">rootdir</span></em>, <em class="sig-param"><span class="n">subpath</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">pattern_for_field</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/w_aiofile.html#AioFileBytesReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.w_aiofile.AioFileBytesReader" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt id="py2store.persisters.w_aiofile.AioFileBytesReader.aget">
<em class="property">async </em><code class="sig-name descname">aget</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">k</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/w_aiofile.html#AioFileBytesReader.aget"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.w_aiofile.AioFileBytesReader.aget" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets the bytes contents of the file k.
&gt;&gt;&gt; import os
&gt;&gt;&gt; filepath = __file__
&gt;&gt;&gt; dirpath = os.path.dirname(__file__)  # path of the directory where I (the module file) am
&gt;&gt;&gt; s = AioFileBytesReader(dirpath, max_levels=0)
&gt;&gt;&gt;
&gt;&gt;&gt; ####### Get the first 9 characters (as bytes) of this module #####################
&gt;&gt;&gt; t = await s.aget(filepath)
&gt;&gt;&gt; t[:14]
b’import asyncio’
&gt;&gt;&gt;
&gt;&gt;&gt; ####### Test key validation #####################
&gt;&gt;&gt; await s.aget(‘not_a_valid_key’)  # this key is not valid since not under the dirpath folder
Traceback (most recent call last):</p>
<blockquote>
<div><p>…</p>
</div></blockquote>
<p>filesys.KeyValidationError: ‘Key not valid (usually because does not exist or access not permitted): not_a_valid_key’
&gt;&gt;&gt;
&gt;&gt;&gt; ####### Test further exceptions (that should be wrapped in KeyError) #####################
&gt;&gt;&gt; # this key is valid, since under dirpath, but the file itself doesn’t exist (hopefully for this test)
&gt;&gt;&gt; non_existing_file = os.path.join(dirpath, ‘non_existing_file’)
&gt;&gt;&gt; try:
…     await s.aget(non_existing_file)
… except KeyError:
…     print(“KeyError (not FileNotFoundError) was raised.”)
KeyError (not FileNotFoundError) was raised.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="py2store.persisters.w_aiofile.AioFileStringPersister">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.w_aiofile.</code><code class="sig-name descname">AioFileStringPersister</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">rootdir</span></em>, <em class="sig-param"><span class="n">subpath</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">pattern_for_field</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/w_aiofile.html#AioFileStringPersister"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.w_aiofile.AioFileStringPersister" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.persisters.w_aiofile.AioFileStringReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.w_aiofile.</code><code class="sig-name descname">AioFileStringReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">rootdir</span></em>, <em class="sig-param"><span class="n">subpath</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">pattern_for_field</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/w_aiofile.html#AioFileStringReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.w_aiofile.AioFileStringReader" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.persisters.w_aiofile.RelPathAioFileBytesReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.w_aiofile.</code><code class="sig-name descname">RelPathAioFileBytesReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#py2store.persisters.w_aiofile.RelPathAioFileBytesReader" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.persisters.w_aiofile.RelPathFileStringReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.w_aiofile.</code><code class="sig-name descname">RelPathFileStringReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#py2store.persisters.w_aiofile.RelPathFileStringReader" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-py2store.persisters.local_files">
<span id="py2store-persisters-local-files"></span><h1>py2store.persisters.local_files<a class="headerlink" href="#module-py2store.persisters.local_files" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.persisters.local_files.DirReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.local_files.</code><code class="sig-name descname">DirReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">rootdir</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/local_files.html#DirReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.local_files.DirReader" title="Permalink to this definition">¶</a></dt>
<dd><p>KV Reader whose keys (AND VALUES) are directory full paths of the subdirectories of rootdir.</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.persisters.local_files.DirpathFormatKeys">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.local_files.</code><code class="sig-name descname">DirpathFormatKeys</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path_format</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">inf</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/local_files.html#DirpathFormatKeys"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.local_files.DirpathFormatKeys" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.persisters.local_files.FileReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.local_files.</code><code class="sig-name descname">FileReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">rootdir</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/local_files.html#FileReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.local_files.FileReader" title="Permalink to this definition">¶</a></dt>
<dd><p>KV Reader whose keys are paths and values are:
- Another FileReader if a path points to a directory
- The bytes of the file if the path points to a file.</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.persisters.local_files.FilepathFormatKeys">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.local_files.</code><code class="sig-name descname">FilepathFormatKeys</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path_format</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">inf</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/local_files.html#FilepathFormatKeys"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.local_files.FilepathFormatKeys" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py exception">
<dt id="py2store.persisters.local_files.FolderNotFoundError">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.persisters.local_files.</code><code class="sig-name descname">FolderNotFoundError</code><a class="reference internal" href="_modules/py2store/persisters/local_files.html#FolderNotFoundError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.local_files.FolderNotFoundError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.persisters.local_files.LocalFileRWD">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.local_files.</code><code class="sig-name descname">LocalFileRWD</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">mode</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">open_kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/local_files.html#LocalFileRWD"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.local_files.LocalFileRWD" title="Permalink to this definition">¶</a></dt>
<dd><p>A class providing get, set and delete functionality using local files as the storage backend.</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.persisters.local_files.LocalFileStreamGetter">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.local_files.</code><code class="sig-name descname">LocalFileStreamGetter</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">**</span><span class="n">open_kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/local_files.html#LocalFileStreamGetter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.local_files.LocalFileStreamGetter" title="Permalink to this definition">¶</a></dt>
<dd><p>A class to get stream objects of local open files.
The class can only get keys, and only to read, write (destructive or append).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">tempfile</span> <span class="kn">import</span> <span class="n">mkdtemp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rootdir</span> <span class="o">=</span> <span class="n">mkdtemp</span><span class="p">()</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">appendable_stream</span> <span class="o">=</span> <span class="n">LocalFileStreamGetter</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a+&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reader</span> <span class="o">=</span> <span class="n">PathFormatPersister</span><span class="p">(</span><span class="n">rootdir</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rootdir</span><span class="p">,</span> <span class="s1">&#39;tmp.txt&#39;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">appendable_stream</span><span class="p">[</span><span class="n">filepath</span><span class="p">]</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">filepath</span><span class="p">])</span>
<span class="go">hello</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">appendable_stream</span><span class="p">[</span><span class="n">filepath</span><span class="p">]</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; world&#39;</span><span class="p">)</span>
<span class="go">6</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="n">filepath</span><span class="p">])</span>
<span class="go">hello world</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.persisters.local_files.PathFormatPersister">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.local_files.</code><code class="sig-name descname">PathFormatPersister</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path_format</span></em>, <em class="sig-param"><span class="n">max_levels</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">inf</span></em>, <em class="sig-param"><span class="n">mode</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">open_kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/local_files.html#PathFormatPersister"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.local_files.PathFormatPersister" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.persisters.local_files.PrefixedDirpathsRecursive">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.local_files.</code><code class="sig-name descname">PrefixedDirpathsRecursive</code><a class="reference internal" href="_modules/py2store/persisters/local_files.html#PrefixedDirpathsRecursive"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.local_files.PrefixedDirpathsRecursive" title="Permalink to this definition">¶</a></dt>
<dd><p>Keys collection for local files, where the keys are full filepaths RECURSIVELY under a given root dir _prefix.
This mixin adds iteration (__iter__), length (__len__), and containment (__contains__(k)).</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.persisters.local_files.PrefixedFilepaths">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.local_files.</code><code class="sig-name descname">PrefixedFilepaths</code><a class="reference internal" href="_modules/py2store/persisters/local_files.html#PrefixedFilepaths"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.local_files.PrefixedFilepaths" title="Permalink to this definition">¶</a></dt>
<dd><p>Keys collection for local files, where the keys are full filepaths DIRECTLY under a given root dir _prefix.
This mixin adds iteration (__iter__), length (__len__), and containment (__contains__(k)).</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.persisters.local_files.PrefixedFilepathsRecursive">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.local_files.</code><code class="sig-name descname">PrefixedFilepathsRecursive</code><a class="reference internal" href="_modules/py2store/persisters/local_files.html#PrefixedFilepathsRecursive"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.local_files.PrefixedFilepathsRecursive" title="Permalink to this definition">¶</a></dt>
<dd><p>Keys collection for local files, where the keys are full filepaths RECURSIVELY under a given root dir _prefix.
This mixin adds iteration (__iter__), length (__len__), and containment (__contains__(k)).</p>
</dd></dl>

</div>
<div class="section" id="py2store-persisters-arangodb-w-pyarango">
<h1>py2store.persisters.arangodb_w_pyarango<a class="headerlink" href="#py2store-persisters-arangodb-w-pyarango" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.persisters._cassandra_in_progress">
<span id="py2store-persisters-cassandra-in-progress"></span><h1>py2store.persisters._cassandra_in_progress<a class="headerlink" href="#module-py2store.persisters._cassandra_in_progress" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.persisters._couchdb_in_progress">
<span id="py2store-persisters-couchdb-in-progress"></span><h1>py2store.persisters._couchdb_in_progress<a class="headerlink" href="#module-py2store.persisters._couchdb_in_progress" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.persisters.s3_w_boto3">
<span id="py2store-persisters-s3-w-boto3"></span><h1>py2store.persisters.s3_w_boto3<a class="headerlink" href="#module-py2store.persisters.s3_w_boto3" title="Permalink to this headline">¶</a></h1>
<dl class="py exception">
<dt id="py2store.persisters.s3_w_boto3.NoSuchKeyError">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.persisters.s3_w_boto3.</code><code class="sig-name descname">NoSuchKeyError</code><a class="reference internal" href="_modules/py2store/persisters/s3_w_boto3.html#NoSuchKeyError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.s3_w_boto3.NoSuchKeyError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.persisters.s3_w_boto3.S3BucketPersister">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.s3_w_boto3.</code><code class="sig-name descname">S3BucketPersister</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">bucket_name</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">_s3_bucket</span></em>, <em class="sig-param"><span class="n">_prefix</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">''</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/s3_w_boto3.html#S3BucketPersister"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.s3_w_boto3.S3BucketPersister" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.persisters.s3_w_boto3.S3BucketRW">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.s3_w_boto3.</code><code class="sig-name descname">S3BucketRW</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">s3_bucket</span></em>, <em class="sig-param"><span class="n">filt</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/s3_w_boto3.html#S3BucketRW"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.s3_w_boto3.S3BucketRW" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.persisters.s3_w_boto3.S3BucketReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.s3_w_boto3.</code><code class="sig-name descname">S3BucketReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">s3_bucket</span></em>, <em class="sig-param"><span class="n">filt</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/s3_w_boto3.html#S3BucketReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.s3_w_boto3.S3BucketReader" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.persisters.s3_w_boto3.S3ResourceCollection">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.s3_w_boto3.</code><code class="sig-name descname">S3ResourceCollection</code><span class="sig-paren">(</span><em class="sig-param">aws_access_key_id</em>, <em class="sig-param">aws_secret_access_key</em>, <em class="sig-param">endpoint_url='https://s3.amazonaws.com'</em>, <em class="sig-param">verify=None</em>, <em class="sig-param">config=&lt;botocore.config.Config object&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/s3_w_boto3.html#S3ResourceCollection"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.s3_w_boto3.S3ResourceCollection" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt id="py2store.persisters.s3_w_boto3.S3ResourceCollection.update_keys_cache">
<code class="sig-name descname">update_keys_cache</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">keys</span></em><span class="sig-paren">)</span><a class="headerlink" href="#py2store.persisters.s3_w_boto3.S3ResourceCollection.update_keys_cache" title="Permalink to this definition">¶</a></dt>
<dd><p>Updates the _keys_cache by deleting the attribute</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="py2store.persisters.s3_w_boto3.S3ResourceReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.s3_w_boto3.</code><code class="sig-name descname">S3ResourceReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/s3_w_boto3.html#S3ResourceReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.s3_w_boto3.S3ResourceReader" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="py2store.persisters.s3_w_boto3.get_s3_resource">
<code class="sig-prename descclassname">py2store.persisters.s3_w_boto3.</code><code class="sig-name descname">get_s3_resource</code><span class="sig-paren">(</span><em class="sig-param">aws_access_key_id</em>, <em class="sig-param">aws_secret_access_key</em>, <em class="sig-param">endpoint_url='https://s3.amazonaws.com'</em>, <em class="sig-param">verify=None</em>, <em class="sig-param">config=&lt;botocore.config.Config object&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/s3_w_boto3.html#get_s3_resource"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.s3_w_boto3.get_s3_resource" title="Permalink to this definition">¶</a></dt>
<dd><p>Get boto3 s3 resource.
:param aws_access_key_id:
:param aws_secret_access_key:
:param endpoint_url:
:param verify:
:param signature_version:
:return:</p>
</dd></dl>

</div>
<div class="section" id="py2store-persisters-postgres-w-psycopg2-in-progress">
<h1>py2store.persisters._postgres_w_psycopg2_in_progress<a class="headerlink" href="#py2store-persisters-postgres-w-psycopg2-in-progress" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="py2store-persisters-ssh-persister">
<h1>py2store.persisters.ssh_persister<a class="headerlink" href="#py2store-persisters-ssh-persister" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.persisters.mongo_w_pymongo">
<span id="py2store-persisters-mongo-w-pymongo"></span><h1>py2store.persisters.mongo_w_pymongo<a class="headerlink" href="#module-py2store.persisters.mongo_w_pymongo" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.persisters.mongo_w_pymongo.MongoAppendablePersister">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.mongo_w_pymongo.</code><code class="sig-name descname">MongoAppendablePersister</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">mgc</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">key_fields</span><span class="o">=</span><span class="default_value">('_id')</span></em>, <em class="sig-param"><span class="n">data_fields</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/mongo_w_pymongo.html#MongoAppendablePersister"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.mongo_w_pymongo.MongoAppendablePersister" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.persisters.mongo_w_pymongo.MongoClientReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.mongo_w_pymongo.</code><code class="sig-name descname">MongoClientReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">**</span><span class="n">mongo_client_kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/mongo_w_pymongo.html#MongoClientReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.mongo_w_pymongo.MongoClientReader" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.persisters.mongo_w_pymongo.MongoCollectionPersister">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.mongo_w_pymongo.</code><code class="sig-name descname">MongoCollectionPersister</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">mgc</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">key_fields</span><span class="o">=</span><span class="default_value">('_id')</span></em>, <em class="sig-param"><span class="n">data_fields</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/mongo_w_pymongo.html#MongoCollectionPersister"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.mongo_w_pymongo.MongoCollectionPersister" title="Permalink to this definition">¶</a></dt>
<dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">MongoPersister</span><span class="p">()</span>  <span class="c1"># just use defaults</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">_id</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>  <span class="c1"># deleting all docs in tmp</span>
<span class="gp">... </span>    <span class="k">del</span> <span class="n">s</span><span class="p">[</span><span class="n">_id</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span> <span class="ow">in</span> <span class="n">s</span>  <span class="c1"># see that key is not in store (and testing __contains__)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[{&#39;_id&#39;: &#39;foo&#39;}]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="go">{&#39;val&#39;: &#39;bar&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="go">{&#39;val&#39;: &#39;bar&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">({</span><span class="s1">&#39;not&#39;</span><span class="p">:</span> <span class="s1">&#39;a key&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;val&#39;</span><span class="p">})</span>  <span class="c1"># testing s.get with default</span>
<span class="go">{&#39;default&#39;: &#39;val&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="go">[{&#39;val&#39;: &#39;bar&#39;}]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span> <span class="ow">in</span> <span class="n">s</span>  <span class="c1"># testing __contains__ again</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">0</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Making a persister whose keys are 2-dimensional and values are 3-dimensional</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">MongoPersister</span><span class="p">(</span><span class="n">db_name</span><span class="o">=</span><span class="s1">&#39;py2store&#39;</span><span class="p">,</span> <span class="n">collection_name</span><span class="o">=</span><span class="s1">&#39;tmp&#39;</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="n">key_fields</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;last&#39;</span><span class="p">),</span> <span class="n">data_fields</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;yob&#39;</span><span class="p">,</span> <span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;bdfl&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">_id</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>  <span class="c1"># deleting all docs in tmp</span>
<span class="gp">... </span>    <span class="k">del</span> <span class="n">s</span><span class="p">[</span><span class="n">_id</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># writing two items</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[{</span><span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="s1">&#39;Guido&#39;</span><span class="p">,</span> <span class="s1">&#39;last&#39;</span><span class="p">:</span> <span class="s1">&#39;van Rossum&#39;</span><span class="p">}]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;yob&#39;</span><span class="p">:</span> <span class="mi">1956</span><span class="p">,</span> <span class="s1">&#39;proj&#39;</span><span class="p">:</span> <span class="s1">&#39;python&#39;</span><span class="p">,</span> <span class="s1">&#39;bdfl&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[{</span><span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="s1">&#39;Vitalik&#39;</span><span class="p">,</span> <span class="s1">&#39;last&#39;</span><span class="p">:</span> <span class="s1">&#39;Buterin&#39;</span><span class="p">}]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;yob&#39;</span><span class="p">:</span> <span class="mi">1994</span><span class="p">,</span> <span class="s1">&#39;proj&#39;</span><span class="p">:</span> <span class="s1">&#39;ethereum&#39;</span><span class="p">,</span> <span class="s1">&#39;bdfl&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Seeing that those two items are there</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> --&gt; </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">{&#39;first&#39;: &#39;Guido&#39;, &#39;last&#39;: &#39;van Rossum&#39;} --&gt; {&#39;yob&#39;: 1956, &#39;proj&#39;: &#39;python&#39;, &#39;bdfl&#39;: False}</span>
<span class="go">{&#39;first&#39;: &#39;Vitalik&#39;, &#39;last&#39;: &#39;Buterin&#39;} --&gt; {&#39;yob&#39;: 1994, &#39;proj&#39;: &#39;ethereum&#39;, &#39;bdfl&#39;: True}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.persisters.mongo_w_pymongo.MongoCollectionReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.mongo_w_pymongo.</code><code class="sig-name descname">MongoCollectionReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">mgc</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">key_fields</span><span class="o">=</span><span class="default_value">('_id')</span></em>, <em class="sig-param"><span class="n">data_fields</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/mongo_w_pymongo.html#MongoCollectionReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.mongo_w_pymongo.MongoCollectionReader" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.persisters.mongo_w_pymongo.MongoDbReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.mongo_w_pymongo.</code><code class="sig-name descname">MongoDbReader</code><span class="sig-paren">(</span><em class="sig-param">db_name='py2store'</em>, <em class="sig-param">collection_store_cls=&lt;class 'py2store.persisters.mongo_w_pymongo.MongoCollectionReader'&gt;</em>, <em class="sig-param">mongo_client=None</em>, <em class="sig-param">**mongo_client_kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/mongo_w_pymongo.html#MongoDbReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.mongo_w_pymongo.MongoDbReader" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.persisters.mongo_w_pymongo.OldMongoInsertPersister">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.mongo_w_pymongo.</code><code class="sig-name descname">OldMongoInsertPersister</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">db_name</span><span class="o">=</span><span class="default_value">'py2store'</span></em>, <em class="sig-param"><span class="n">collection_name</span><span class="o">=</span><span class="default_value">'test'</span></em>, <em class="sig-param"><span class="n">data_fields</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">mongo_client_kwargs</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/mongo_w_pymongo.html#OldMongoInsertPersister"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.mongo_w_pymongo.OldMongoInsertPersister" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.persisters.mongo_w_pymongo.OldMongoPersister">
<em class="property">class </em><code class="sig-prename descclassname">py2store.persisters.mongo_w_pymongo.</code><code class="sig-name descname">OldMongoPersister</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">db_name</span><span class="o">=</span><span class="default_value">'py2store'</span></em>, <em class="sig-param"><span class="n">collection_name</span><span class="o">=</span><span class="default_value">'test'</span></em>, <em class="sig-param"><span class="n">key_fields</span><span class="o">=</span><span class="default_value">('_id')</span></em>, <em class="sig-param"><span class="n">data_fields</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">mongo_client_kwargs</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/persisters/mongo_w_pymongo.html#OldMongoPersister"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.persisters.mongo_w_pymongo.OldMongoPersister" title="Permalink to this definition">¶</a></dt>
<dd><p>A basic mongo persister.
Note that the mongo persister is designed not to overwrite the value of a key if the key already exists.
You can subclass it and use update_one instead of insert_one if you want to be able to overwrite data.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">OldMongoPersister</span><span class="p">()</span>  <span class="c1"># just use defaults</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">_id</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>  <span class="c1"># deleting all docs in tmp</span>
<span class="gp">... </span>    <span class="k">del</span> <span class="n">s</span><span class="p">[</span><span class="n">_id</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span> <span class="ow">in</span> <span class="n">s</span>  <span class="c1"># see that key is not in store (and testing __contains__)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[{&#39;_id&#39;: &#39;foo&#39;}]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="go">{&#39;val&#39;: &#39;bar&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="go">{&#39;val&#39;: &#39;bar&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">({</span><span class="s1">&#39;not&#39;</span><span class="p">:</span> <span class="s1">&#39;a key&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;val&#39;</span><span class="p">})</span>  <span class="c1"># testing s.get with default</span>
<span class="go">{&#39;default&#39;: &#39;val&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="go">[{&#39;val&#39;: &#39;bar&#39;}]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span> <span class="ow">in</span> <span class="n">s</span>  <span class="c1"># testing __contains__ again</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">0</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Making a persister whose keys are 2-dimensional and values are 3-dimensional</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">OldMongoPersister</span><span class="p">(</span><span class="n">db_name</span><span class="o">=</span><span class="s1">&#39;py2store&#39;</span><span class="p">,</span> <span class="n">collection_name</span><span class="o">=</span><span class="s1">&#39;tmp&#39;</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="n">key_fields</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;last&#39;</span><span class="p">),</span> <span class="n">data_fields</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;yob&#39;</span><span class="p">,</span> <span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;bdfl&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">_id</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>  <span class="c1"># deleting all docs in tmp</span>
<span class="gp">... </span>    <span class="k">del</span> <span class="n">s</span><span class="p">[</span><span class="n">_id</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># writing two items</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[{</span><span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="s1">&#39;Guido&#39;</span><span class="p">,</span> <span class="s1">&#39;last&#39;</span><span class="p">:</span> <span class="s1">&#39;van Rossum&#39;</span><span class="p">}]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;yob&#39;</span><span class="p">:</span> <span class="mi">1956</span><span class="p">,</span> <span class="s1">&#39;proj&#39;</span><span class="p">:</span> <span class="s1">&#39;python&#39;</span><span class="p">,</span> <span class="s1">&#39;bdfl&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[{</span><span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="s1">&#39;Vitalik&#39;</span><span class="p">,</span> <span class="s1">&#39;last&#39;</span><span class="p">:</span> <span class="s1">&#39;Buterin&#39;</span><span class="p">}]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;yob&#39;</span><span class="p">:</span> <span class="mi">1994</span><span class="p">,</span> <span class="s1">&#39;proj&#39;</span><span class="p">:</span> <span class="s1">&#39;ethereum&#39;</span><span class="p">,</span> <span class="s1">&#39;bdfl&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Seeing that those two items are there</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> --&gt; </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">{&#39;first&#39;: &#39;Guido&#39;, &#39;last&#39;: &#39;van Rossum&#39;} --&gt; {&#39;yob&#39;: 1956, &#39;proj&#39;: &#39;python&#39;, &#39;bdfl&#39;: False}</span>
<span class="go">{&#39;first&#39;: &#39;Vitalik&#39;, &#39;last&#39;: &#39;Buterin&#39;} --&gt; {&#39;yob&#39;: 1994, &#39;proj&#39;: &#39;ethereum&#39;, &#39;bdfl&#39;: True}</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="py2store-persisters-googledrive-w-pydrive">
<h1>py2store.persisters.googledrive_w_pydrive<a class="headerlink" href="#py2store-persisters-googledrive-w-pydrive" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.sources">
<span id="py2store-sources"></span><h1>py2store.sources<a class="headerlink" href="#module-py2store.sources" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.sources.Attrs">
<em class="property">class </em><code class="sig-prename descclassname">py2store.sources.</code><code class="sig-name descname">Attrs</code><span class="sig-paren">(</span><em class="sig-param">obj</em>, <em class="sig-param">key_filt=&lt;function not_underscore_prefixed&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/sources.html#Attrs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.sources.Attrs" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt id="py2store.sources.Attrs.update_keys_cache">
<code class="sig-name descname">update_keys_cache</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">keys</span></em><span class="sig-paren">)</span><a class="headerlink" href="#py2store.sources.Attrs.update_keys_cache" title="Permalink to this definition">¶</a></dt>
<dd><p>Updates the _keys_cache by calling its {} method</p>
</dd></dl>

</dd></dl>

<dl class="py attribute">
<dt id="py2store.sources.Ddir">
<code class="sig-prename descclassname">py2store.sources.</code><code class="sig-name descname">Ddir</code><a class="headerlink" href="#py2store.sources.Ddir" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#py2store.sources.Attrs" title="py2store.sources.Attrs"><code class="xref py py-class docutils literal notranslate"><span class="pre">py2store.sources.Attrs</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt id="py2store.sources.DictAttr">
<em class="property">class </em><code class="sig-prename descclassname">py2store.sources.</code><code class="sig-name descname">DictAttr</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">_source</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Mapping<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">keys_and_values</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/sources.html#DictAttr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.sources.DictAttr" title="Permalink to this definition">¶</a></dt>
<dd><p>Convenience class to hold Key-Val pairs with both a dict-like and struct-like interface.
The dict-like interface has just the basic get/set/del/iter/len
(all “dunders”: none visible as methods). There is no get, update, etc.
This is on purpose, so that the only visible attributes (those you get by tab-completion for instance)
are the those you injected.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">da</span> <span class="o">=</span> <span class="n">DictAttr</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">life</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">da</span><span class="o">.</span><span class="n">foo</span>
<span class="go">&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">da</span><span class="p">[</span><span class="s1">&#39;life&#39;</span><span class="p">]</span>
<span class="go">42</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">da</span><span class="o">.</span><span class="n">true</span> <span class="o">=</span> <span class="s1">&#39;love&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">da</span><span class="p">)</span>  <span class="c1"># count the number of fields</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">da</span><span class="p">[</span><span class="s1">&#39;friends&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;forever&#39;</span>  <span class="c1"># write as dict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">da</span><span class="o">.</span><span class="n">friends</span>  <span class="c1"># read as attribute</span>
<span class="go">&#39;forever&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">da</span><span class="p">)</span>  <span class="c1"># list fields (i.e. keys i.e. attributes)</span>
<span class="go">[&#39;foo&#39;, &#39;life&#39;, &#39;true&#39;, &#39;friends&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;foo&#39;, &#39;bar&#39;), (&#39;life&#39;, 42), (&#39;true&#39;, &#39;love&#39;), (&#39;friends&#39;, &#39;forever&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">da</span><span class="p">[</span><span class="s1">&#39;friends&#39;</span><span class="p">]</span>  <span class="c1"># delete as dict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">da</span><span class="o">.</span><span class="n">foo</span> <span class="c1"># delete as attribute</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">da</span><span class="p">)</span>
<span class="go">[&#39;life&#39;, &#39;true&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">da</span><span class="o">.</span><span class="n">_source</span>  <span class="c1"># the hidden dict that is wrapped</span>
<span class="go">{&#39;life&#39;: 42, &#39;true&#39;: &#39;love&#39;}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.sources.FuncDag">
<em class="property">class </em><code class="sig-prename descclassname">py2store.sources.</code><code class="sig-name descname">FuncDag</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">funcs</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/sources.html#FuncDag"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.sources.FuncDag" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.sources.FuncReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.sources.</code><code class="sig-name descname">FuncReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">funcs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/sources.html#FuncReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.sources.FuncReader" title="Permalink to this definition">¶</a></dt>
<dd><p>Reader that seeds itself from a data fetching function list
Uses the function list names as the keys, and their returned value as the values.</p>
<p>For example: You have a list of urls that contain the data you want to have access to.
You can write functions that bare the names you want to give to each dataset, and have the function
fetch the data from the url, extract the data from the response and possibly prepare it
(we advise minimally, since you can always transform from the raw source, but the opposite can be impossible).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="s1">&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">pi</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="mf">3.14159</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">FuncReader</span><span class="p">([</span><span class="n">foo</span><span class="p">,</span> <span class="n">pi</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[&#39;foo&#39;, &#39;pi&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span>
<span class="go">&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span>
<span class="go">3.14159</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.sources.ObjReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.sources.</code><code class="sig-name descname">ObjReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">obj</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/sources.html#ObjReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.sources.ObjReader" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-py2store.dig">
<span id="py2store-dig"></span><h1>py2store.dig<a class="headerlink" href="#module-py2store.dig" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.serializers.pickled">
<span id="py2store-serializers-pickled"></span><h1>py2store.serializers.pickled<a class="headerlink" href="#module-py2store.serializers.pickled" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt id="py2store.serializers.pickled.mk_dill_rw_funcs">
<code class="sig-prename descclassname">py2store.serializers.pickled.</code><code class="sig-name descname">mk_dill_rw_funcs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ignore</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">protocol</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">byref</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">fmode</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">recurse</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/serializers/pickled.html#mk_dill_rw_funcs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.serializers.pickled.mk_dill_rw_funcs" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a reader and writer using dill. That is, a pair of parametrized loads and dumps</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">read</span><span class="p">,</span> <span class="n">write</span> <span class="o">=</span> <span class="n">mk_dill_rw_funcs</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;simple&#39;</span><span class="p">,</span> <span class="s1">&#39;and&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;more&#39;</span><span class="p">,</span> <span class="s1">&#39;complex&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">serialized_d</span> <span class="o">=</span> <span class="n">write</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">deserialized_d</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">serialized_d</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">d</span> <span class="o">==</span> <span class="n">deserialized_d</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.serializers.pickled.mk_marshal_rw_funcs">
<code class="sig-prename descclassname">py2store.serializers.pickled.</code><code class="sig-name descname">mk_marshal_rw_funcs</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/serializers/pickled.html#mk_marshal_rw_funcs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.serializers.pickled.mk_marshal_rw_funcs" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a reader and writer using marshal. That is, a pair of parametrized loads and dumps</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">read</span><span class="p">,</span> <span class="n">write</span> <span class="o">=</span> <span class="n">mk_marshal_rw_funcs</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;simple&#39;</span><span class="p">,</span> <span class="s1">&#39;and&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;more&#39;</span><span class="p">,</span> <span class="s1">&#39;complex&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">serialized_d</span> <span class="o">=</span> <span class="n">write</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">deserialized_d</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">serialized_d</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">d</span> <span class="o">==</span> <span class="n">deserialized_d</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.serializers.pickled.mk_pickle_rw_funcs">
<code class="sig-prename descclassname">py2store.serializers.pickled.</code><code class="sig-name descname">mk_pickle_rw_funcs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fix_imports</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">protocol</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">pickle_encoding</span><span class="o">=</span><span class="default_value">'ASCII'</span></em>, <em class="sig-param"><span class="n">pickle_errors</span><span class="o">=</span><span class="default_value">'strict'</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/serializers/pickled.html#mk_pickle_rw_funcs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.serializers.pickled.mk_pickle_rw_funcs" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a reader and writer using pickle. That is, a pair of parametrized loads and dumps</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">read</span><span class="p">,</span> <span class="n">write</span> <span class="o">=</span> <span class="n">mk_pickle_rw_funcs</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;simple&#39;</span><span class="p">,</span> <span class="s1">&#39;and&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;more&#39;</span><span class="p">,</span> <span class="s1">&#39;complex&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">serialized_d</span> <span class="o">=</span> <span class="n">write</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">deserialized_d</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">serialized_d</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">d</span> <span class="o">==</span> <span class="n">deserialized_d</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-py2store.serializers.jsonization">
<span id="py2store-serializers-jsonization"></span><h1>py2store.serializers.jsonization<a class="headerlink" href="#module-py2store.serializers.jsonization" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt id="py2store.serializers.jsonization.mk_marshal_rw_funcs">
<code class="sig-prename descclassname">py2store.serializers.jsonization.</code><code class="sig-name descname">mk_marshal_rw_funcs</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/serializers/jsonization.html#mk_marshal_rw_funcs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.serializers.jsonization.mk_marshal_rw_funcs" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a reader and writer using marshal. That is, a pair of parametrized loads and dumps</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">read</span><span class="p">,</span> <span class="n">write</span> <span class="o">=</span> <span class="n">mk_marshal_rw_funcs</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;simple&#39;</span><span class="p">,</span> <span class="s1">&#39;and&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;more&#39;</span><span class="p">,</span> <span class="s1">&#39;complex&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">serialized_d</span> <span class="o">=</span> <span class="n">write</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">deserialized_d</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">serialized_d</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">d</span> <span class="o">==</span> <span class="n">deserialized_d</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-py2store.serializers">
<span id="py2store-serializers"></span><h1>py2store.serializers<a class="headerlink" href="#module-py2store.serializers" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.serializers.sequential">
<span id="py2store-serializers-sequential"></span><h1>py2store.serializers.sequential<a class="headerlink" href="#module-py2store.serializers.sequential" title="Permalink to this headline">¶</a></h1>
<p>A place to find the main functions for serialization of sequential data (time series, panel data, streams, etc.)</p>
</div>
<div class="section" id="module-py2store.serializers.regular_panel_data">
<span id="py2store-serializers-regular-panel-data"></span><h1>py2store.serializers.regular_panel_data<a class="headerlink" href="#module-py2store.serializers.regular_panel_data" title="Permalink to this headline">¶</a></h1>
<p>Serialization for regular panel data (audio, regular-tick time-series, etc.).</p>
<dl class="py exception">
<dt id="py2store.serializers.regular_panel_data.WrongSampleRate">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.serializers.regular_panel_data.</code><code class="sig-name descname">WrongSampleRate</code><a class="reference internal" href="_modules/py2store/serializers/regular_panel_data.html#WrongSampleRate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.serializers.regular_panel_data.WrongSampleRate" title="Permalink to this definition">¶</a></dt>
<dd><p>To be raised when the sample rate is not the one that’s expected.</p>
</dd></dl>

<dl class="py exception">
<dt id="py2store.serializers.regular_panel_data.WrongSerializationParams">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.serializers.regular_panel_data.</code><code class="sig-name descname">WrongSerializationParams</code><a class="reference internal" href="_modules/py2store/serializers/regular_panel_data.html#WrongSerializationParams"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.serializers.regular_panel_data.WrongSerializationParams" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="py2store.serializers.regular_panel_data.mk_reader_and_writer">
<code class="sig-prename descclassname">py2store.serializers.regular_panel_data.</code><code class="sig-name descname">mk_reader_and_writer</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">sr</span><span class="p">:</span> <span class="n">int</span></em>, <em class="sig-param"><span class="n">format</span><span class="o">=</span><span class="default_value">'RAW'</span></em>, <em class="sig-param"><span class="n">subtype</span><span class="o">=</span><span class="default_value">'PCM_16'</span></em>, <em class="sig-param"><span class="n">dtype</span><span class="o">=</span><span class="default_value">'int16'</span></em>, <em class="sig-param"><span class="n">channels</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">1</span></em>, <em class="sig-param"><span class="n">endian</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">always_2d</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/serializers/regular_panel_data.html#mk_reader_and_writer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.serializers.regular_panel_data.mk_reader_and_writer" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes a (bijective) pair of numerical arrays serializer and deserializer functions.
A function returning bijective panel data reader and writer functions with simple interfaces (all parametrizations
are fixed): <cite>read(source)</cite> and <cite>write(source, data)</cite>.
The writer and reader are essentially matrix (or array) serializers and deserializers respectively,
using the same serialization protocols as waveform (into PCM, WAV, etc.)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sr</strong> – Sample rate. When the serialization format handles this information (e.g. WAV format)
the sample rate is actually written (in WAV, in the header bytes), and asserted on reads
(that is, if you read a WAV file that doesn’t have that exact sample rate in it’s header, a
WrongSampleRate error will be raised.
When the serialization format doesn’t (e.g. RAW format (a.k.a. PCM)), it is ignored both on reads and writes</p></li>
<li><p><strong>format</strong> – ‘RAW’, ‘WAV’ and others (see soundfile.available_formats() for a full list)</p></li>
<li><p><strong>subtype</strong> – ‘FLOAT’, ‘PCM_16’ and others (see soundfile.available_subtypes() for a full list)</p></li>
<li><p><strong>dtype</strong> – ‘float64’, ‘float32’, ‘int32’, ‘int16’</p></li>
<li><p><strong>channels</strong> – Number of channels (should equal the number of columns of the data matrices that will be
serialized – or 1 if the data is flat)</p></li>
<li><p><strong>endian</strong> – see soundfile documentation ({‘FILE’, ‘LITTLE’, ‘BIG’, ‘CPU’}, sometimes optional)</p></li>
<li><p><strong>always_2d</strong> – By default, reading a mono sound file will return a one-dimensional array. With always_2d=True,
data is always returned as a two-dimensional array, even if the data has only one channel.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>read(k), write(k, v) functions</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">n_channels</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">read</span><span class="p">,</span> <span class="n">write</span> <span class="o">=</span> <span class="n">mk_reader_and_writer</span><span class="p">(</span><span class="n">sr</span><span class="o">=</span><span class="mi">44100</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="n">n_channels</span><span class="p">,</span> <span class="n">subtype</span><span class="o">=</span><span class="s1">&#39;FLOAT&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;RAW&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">_random_matrix</span><span class="p">(</span><span class="n">n_channels</span><span class="o">=</span><span class="n">n_channels</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_test_data_write_read</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">writer</span><span class="o">=</span><span class="n">write</span><span class="p">,</span> <span class="n">reader</span><span class="o">=</span><span class="n">read</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">n_channels</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;int16&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">read</span><span class="p">,</span> <span class="n">write</span> <span class="o">=</span> <span class="n">mk_reader_and_writer</span><span class="p">(</span><span class="n">sr</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="n">n_channels</span><span class="p">,</span> <span class="n">subtype</span><span class="o">=</span><span class="s1">&#39;PCM_16&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;RAW&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">_random_matrix</span><span class="p">(</span><span class="n">n_channels</span><span class="o">=</span><span class="n">n_channels</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_test_data_write_read</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">writer</span><span class="o">=</span><span class="n">write</span><span class="p">,</span> <span class="n">reader</span><span class="o">=</span><span class="n">read</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-py2store.serializers.audio">
<span id="py2store-serializers-audio"></span><h1>py2store.serializers.audio<a class="headerlink" href="#module-py2store.serializers.audio" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.caching">
<span id="py2store-caching"></span><h1>py2store.caching<a class="headerlink" href="#module-py2store.caching" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt id="py2store.caching.mk_cached_store">
<code class="sig-prename descclassname">py2store.caching.</code><code class="sig-name descname">mk_cached_store</code><span class="sig-paren">(</span><em class="sig-param">store=None</em>, <em class="sig-param">*</em>, <em class="sig-param">cache=&lt;class 'dict'&gt;</em>, <em class="sig-param">__module__=None</em>, <em class="sig-param">__name__=None</em>, <em class="sig-param">__qualname__=None</em>, <em class="sig-param">__doc__=None</em>, <em class="sig-param">__annotations__=None</em>, <em class="sig-param">__defaults__=None</em>, <em class="sig-param">__kwdefaults__=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/caching.html#mk_cached_store"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.caching.mk_cached_store" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store</strong> – The class of the store you want to cache</p></li>
<li><p><strong>cache</strong> – The store you want to use to cache. Anything with a __setitem__(k, v) and a __getitem__(k).
By default, it will use a dict</p></li>
</ul>
</dd>
</dl>
<p>Returns: A subclass of the input store, but with caching (to the cache store)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store.caching</span> <span class="kn">import</span> <span class="n">mk_cached_store</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">time</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">SlowDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">sleep_s</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_s</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">SlowDict</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>  <span class="c1"># Wow! Takes a long time to get &#39;a&#39;</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cache</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CachedSlowDict</span> <span class="o">=</span> <span class="n">mk_cached_store</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="n">SlowDict</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">CachedSlowDict</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;store: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">cache: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="go">cache: []</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># This will take a LONG time because it&#39;s the first time we ask for &#39;a&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;store: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">cache: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="go">cache: [&#39;a&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># This will take very little time because we have &#39;a&#39; in the cache</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;store: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">cache: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="go">cache: [&#39;a&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># But we don&#39;t have &#39;b&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;store: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">cache: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="go">cache: [&#39;a&#39;, &#39;b&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># But now we have &#39;b&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;store: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">cache: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="go">cache: [&#39;a&#39;, &#39;b&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># and we can do things normally (like put stuff in the store)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;store: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">cache: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;]</span>
<span class="go">cache: [&#39;a&#39;, &#39;b&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span>  <span class="c1"># if we ask for it again though, it will take time (the first time)</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;store: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">cache: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;]</span>
<span class="go">cache: [&#39;a&#39;, &#39;b&#39;, &#39;d&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Of course, we could write &#39;d&#39; in the cache as well, to get it quicker,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># but that&#39;s another story: The story of write caches!</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># And by the way, your &quot;cache wrapped&quot; store hold a pointer to the cache it&#39;s using,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># so you can take a peep there if needed:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">_cache</span>
<span class="go">{&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;d&#39;: 4}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.caching.mk_sourced_store">
<code class="sig-prename descclassname">py2store.caching.</code><code class="sig-name descname">mk_sourced_store</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">store</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">source</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">return_source_data</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">__module__</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">__name__</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">__qualname__</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">__doc__</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">__annotations__</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">__defaults__</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">__kwdefaults__</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/caching.html#mk_sourced_store"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.caching.mk_sourced_store" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store</strong> – The class of the store you want to cache</p></li>
<li><p><strong>cache</strong> – The store you want to use to cache. Anything with a __setitem__(k, v) and a __getitem__(k).
By default, it will use a dict</p></li>
<li><p><strong>return_source_data</strong> – </p></li>
</ul>
</dd>
</dl>
<p>Returns: A subclass of the input store, but with caching (to the cache store)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store</strong> – The class of the store you’re talking to. This store acts as the cache</p></li>
<li><p><strong>source</strong> – The store that is used to populate the store (cache) when a key is missing there.</p></li>
<li><p><strong>return_source_data</strong> – If True, will return <code class="docutils literal notranslate"><span class="pre">source[k]</span></code> as is. This should be used only if <code class="docutils literal notranslate"><span class="pre">store[k]</span></code> would return the same.
If False, will first write to cache (<code class="docutils literal notranslate"><span class="pre">store[k]</span> <span class="pre">=</span> <span class="pre">source[k]</span></code>) then return <code class="docutils literal notranslate"><span class="pre">store[k]</span></code>.
The latter introduces a performance hit (we write and then read again from the cache),
but ensures consistency (and is useful if the writing or the reading to/from store
transforms the data in some way.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A decorated store</p>
</dd>
</dl>
<p>Here are two stores pretending to be local and remote data stores respectively.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store.caching</span> <span class="kn">import</span> <span class="n">mk_sourced_store</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Local</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;looking for </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> in Local&quot;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Remote</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;looking for </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> in Remote&quot;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s make a remote store with two elements in it, and a local store class that asks the remote store for stuff
if it can’t find it locally.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">remote</span> <span class="o">=</span> <span class="n">Remote</span><span class="p">({</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">:</span> <span class="s1">&#39;world&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">SourcedLocal</span> <span class="o">=</span> <span class="n">mk_sourced_store</span><span class="p">(</span><span class="n">Local</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">remote</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SourcedLocal</span><span class="p">({</span><span class="s1">&#39;some&#39;</span><span class="p">:</span> <span class="s1">&#39;local stuff&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># the local store has one key</span>
<span class="go">[&#39;some&#39;]</span>
</pre></div>
</div>
<p># but if we ask for a key that is in the remote store, it provides it
&gt;&gt;&gt; assert s[‘foo’] == ‘bar’
looking for foo in Local
looking for foo in Remote</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[&#39;some&#39;, &#39;foo&#39;]</span>
</pre></div>
</div>
<p>See that next time we ask for the ‘foo’ key, the local store provides it:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;bar&#39;</span>
<span class="go">looking for foo in Local</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;hello&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;world&#39;</span>
<span class="go">looking for hello in Local</span>
<span class="go">looking for hello in Remote</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[&#39;some&#39;, &#39;foo&#39;, &#39;hello&#39;]</span>
</pre></div>
</div>
<p>We can still add stuff (locally)…</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;something&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;else&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[&#39;some&#39;, &#39;foo&#39;, &#39;hello&#39;, &#39;something&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.caching.mk_write_cached_store">
<code class="sig-prename descclassname">py2store.caching.</code><code class="sig-name descname">mk_write_cached_store</code><span class="sig-paren">(</span><em class="sig-param">store</em>, <em class="sig-param">*</em>, <em class="sig-param">w_cache=&lt;class 'dict'&gt;</em>, <em class="sig-param">flush_cache_condition=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/caching.html#mk_write_cached_store"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.caching.mk_write_cached_store" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrap a write cache around a store.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>w_cache</strong> – The store to (write) cache to</p></li>
<li><p><strong>flush_cache_condition</strong> – The condition to apply to the cache
to decide whether it’s contents should be flushed or not</p></li>
</ul>
</dd>
</dl>
<p>A <code class="docutils literal notranslate"><span class="pre">w_cache</span></code> must have a clear method (that clears the cache’s contents).
If you know what you’re doing and want to add one to your input kv store,
you can do so by calling <code class="docutils literal notranslate"><span class="pre">ensure_clear_to_kv_store(store)</span></code>
– this will add a <code class="docutils literal notranslate"><span class="pre">clear</span></code> method inplace AND return the resulting store as well.</p>
<p>We didn’t add this automatically because the first thing <code class="docutils literal notranslate"><span class="pre">mk_write_cached_store</span></code> will do is call clear,
to remove all the contents of the store.
You don’t want to do this unwittingly and delete a bunch of precious data!!</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store.caching</span> <span class="kn">import</span> <span class="n">mk_write_cached_store</span><span class="p">,</span> <span class="n">ensure_clear_to_kv_store</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store</span> <span class="kn">import</span> <span class="n">Store</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">print_state</span><span class="p">(</span><span class="n">store</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;store: </span><span class="si">{</span><span class="n">store</span><span class="si">}</span><span class="s2"> ----- store._w_cache: </span><span class="si">{</span><span class="n">store</span><span class="o">.</span><span class="n">_w_cache</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyStore</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">MyCachedStore</span> <span class="o">=</span> <span class="n">mk_write_cached_store</span><span class="p">(</span><span class="n">MyStore</span><span class="p">,</span> <span class="n">w_cache</span><span class="o">=</span><span class="p">{})</span>  <span class="c1"># wrap MyStore with a (dict) write cache</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">MyCachedStore</span><span class="p">()</span>  <span class="c1"># make a MyCachedStore instance</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># print the contents (both store and cache), see that it&#39;s empty</span>
<span class="go">store: {} ----- store._w_cache: {}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;hello&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;world&#39;</span>  <span class="c1"># write &#39;world&#39; in &#39;hello&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># see that it hasn&#39;t been written</span>
<span class="go">store: {} ----- store._w_cache: {&#39;hello&#39;: &#39;world&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;ding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dong&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">store: {} ----- store._w_cache: {&#39;hello&#39;: &#39;world&#39;, &#39;ding&#39;: &#39;dong&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">flush_cache</span><span class="p">()</span>  <span class="c1"># manually flush the cache</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># note that store._w_cache is empty, but store has the data now</span>
<span class="go">store: {&#39;hello&#39;: &#39;world&#39;, &#39;ding&#39;: &#39;dong&#39;} ----- store._w_cache: {}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># But you usually want to use the store as a context manager</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">MyCachedStore</span> <span class="o">=</span> <span class="n">mk_write_cached_store</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">MyStore</span><span class="p">,</span> <span class="n">w_cache</span><span class="o">=</span><span class="p">{},</span>
<span class="gp">... </span>    <span class="n">flush_cache_condition</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">the_persistent_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">MyCachedStore</span><span class="p">(</span><span class="n">the_persistent_dict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">s</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===&gt; Before writing data:&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">s</span><span class="p">[</span><span class="s1">&#39;hello&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;world&#39;</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===&gt; Before exiting the with block:&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">===&gt; Before writing data:</span>
<span class="go">store: {} ----- store._w_cache: {}</span>
<span class="go">===&gt; Before exiting the with block:</span>
<span class="go">store: {} ----- store._w_cache: {&#39;hello&#39;: &#39;world&#39;}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===&gt; After exiting the with block:&quot;</span><span class="p">);</span> <span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># Note that the cache store flushed!</span>
<span class="go">===&gt; After exiting the with block:</span>
<span class="go">store: {&#39;hello&#39;: &#39;world&#39;} ----- store._w_cache: {}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Example of auto-flushing when there&#39;s at least two elements</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyStore</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">MyCachedStore</span> <span class="o">=</span> <span class="n">mk_write_cached_store</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">MyStore</span><span class="p">,</span> <span class="n">w_cache</span><span class="o">=</span><span class="p">{},</span>
<span class="gp">... </span>    <span class="n">flush_cache_condition</span><span class="o">=</span><span class="k">lambda</span> <span class="n">w_cache</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">w_cache</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">MyCachedStore</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">s</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">10</span>
<span class="gp">... </span>        <span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">store: {} ----- store._w_cache: {0: 0}</span>
<span class="go">store: {} ----- store._w_cache: {0: 0, 1: 10}</span>
<span class="go">store: {0: 0, 1: 10, 2: 20} ----- store._w_cache: {}</span>
<span class="go">store: {0: 0, 1: 10, 2: 20} ----- store._w_cache: {3: 30}</span>
<span class="go">store: {0: 0, 1: 10, 2: 20} ----- store._w_cache: {3: 30, 4: 40}</span>
<span class="go">store: {0: 0, 1: 10, 2: 20, 3: 30, 4: 40, 5: 50} ----- store._w_cache: {}</span>
<span class="go">store: {0: 0, 1: 10, 2: 20, 3: 30, 4: 40, 5: 50} ----- store._w_cache: {6: 60}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># There was still something left in the cache before exiting the with block. But now...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">store: {0: 0, 1: 10, 2: 20, 3: 30, 4: 40, 5: 50, 6: 60} ----- store._w_cache: {}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.caching.store_cached">
<code class="sig-prename descclassname">py2store.caching.</code><code class="sig-name descname">store_cached</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">store</span></em>, <em class="sig-param"><span class="n">key_func</span><span class="p">:</span> <span class="n">Callable</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/caching.html#store_cached"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.caching.store_cached" title="Permalink to this definition">¶</a></dt>
<dd><p>Function output memorizer but using a specific (usually persisting) store as it’s memory and a key_func to
compute the key under which to store the output.</p>
<p>The key can be
- a single value under which the output should be stored, regardless of the input.
- a key function that is called on the inputs to create a hash under which the function’s output should be stored.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store</strong> – The key-value store to use for caching. Must support __getitem__ and __setitem__.</p></li>
<li><p><strong>key_func</strong> – The key function that is called on the input of the function to create the key value.</p></li>
</ul>
</dd>
</dl>
<p>Note: Union[Callable, Any] is equivalent to just Any, but reveals the two cases of a key more clearly.
Note: No, Union[Callable, Hashable] is not better. For one, general store keys are not restricted to hashable keys.
Note: No, they shouldn’t.</p>
<p>See Also: store_cached_with_single_key (for a version where the cache store key doesn’t depend on function’s args)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Note: Our doc test will use dict as the store, but to make the functionality useful beyond existing</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># RAM-memorizer, you should use actual &quot;persisting&quot; stores that store in local files, or DBs, etc.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">store</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@store_cached</span><span class="p">(</span><span class="n">store</span><span class="p">,</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">args</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">my_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pretend this is a long computation&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">my_data</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># note the print below (because the function is called</span>
<span class="go">Pretend this is a long computation</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tt</span> <span class="o">=</span> <span class="n">my_data</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># note there&#39;s no print (because the function is NOT called)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">t</span> <span class="o">==</span> <span class="n">tt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tt</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_data</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>  <span class="c1"># but different inputs will trigger the actual function again</span>
<span class="go">Pretend this is a long computation</span>
<span class="go">7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_data</span><span class="o">.</span><span class="n">_cache</span>
<span class="go">{(1, 2): 3, (3, 4): 7}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.caching.store_cached_with_single_key">
<code class="sig-prename descclassname">py2store.caching.</code><code class="sig-name descname">store_cached_with_single_key</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">store</span></em>, <em class="sig-param"><span class="n">key</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/caching.html#store_cached_with_single_key"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.caching.store_cached_with_single_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Function output memorizer but using a specific store and key as it’s memory.</p>
<p>Use in situations where you have a argument-less function or bound method that computes some data whose dependencies
are static enough that there’s enough advantage to make the data refresh explicit (by deleting the cache entry)
instead of making it implicit (recomputing/refetching the data every time).</p>
<p>The key should be a single value under which the output should be stored, regardless of the input.</p>
<p>Note: The wrapped function comes with a empty_cache attribute, which when called, empties the cache (i.e. removes
the key from the store)</p>
<p>Note: The wrapped function has a hidden <cite>_cache</cite> attribute pointing to the store in case you need to peep into it.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store</strong> – The cache. The key-value store to use for caching. Must support __getitem__ and __setitem__.</p></li>
<li><p><strong>key</strong> – The store key under which to store the output of the function.</p></li>
</ul>
</dd>
</dl>
<p>Note: Union[Callable, Any] is equivalent to just Any, but reveals the two cases of a key more clearly.
Note: No, Union[Callable, Hashable] is not better. For one, general store keys are not restricted to hashable keys.
Note: No, they shouldn’t.</p>
<p>See Also: store_cached (for a version whose keys are computed from the wrapped function’s input.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Note: Our doc test will use dict as the store, but to make the functionality useful beyond existing</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># RAM-memorizer, you should use actual &quot;persisting&quot; stores that store in local files, or DBs, etc.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">store</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@store_cached_with_single_key</span><span class="p">(</span><span class="n">store</span><span class="p">,</span> <span class="s1">&#39;whatevs&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">my_data</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pretend this is a long computation&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">my_data</span><span class="p">()</span>  <span class="c1"># note the print below (because the function is called</span>
<span class="go">Pretend this is a long computation</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tt</span> <span class="o">=</span> <span class="n">my_data</span><span class="p">()</span>  <span class="c1"># note there&#39;s no print (because the function is NOT called)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">t</span> <span class="o">==</span> <span class="n">tt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tt</span>
<span class="go">[1, 2, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_data</span><span class="o">.</span><span class="n">_cache</span>  <span class="c1"># peep in the cache</span>
<span class="go">{&#39;whatevs&#39;: [1, 2, 3]}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># let&#39;s empty the cache</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_data</span><span class="o">.</span><span class="n">empty_cache_entry</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="s1">&#39;whatevs&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">my_data</span><span class="o">.</span><span class="n">_cache</span>  <span class="c1"># see that the cache entry is gone.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">my_data</span><span class="p">()</span>  <span class="c1"># so when you call the function again, it prints again!d</span>
<span class="go">Pretend this is a long computation</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-py2store.scrap">
<span id="py2store-scrap"></span><h1>py2store.scrap<a class="headerlink" href="#module-py2store.scrap" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.scrap.new_gen_local">
<span id="py2store-scrap-new-gen-local"></span><h1>py2store.scrap.new_gen_local<a class="headerlink" href="#module-py2store.scrap.new_gen_local" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.scrap.new_gen_local.Local">
<em class="property">class </em><code class="sig-prename descclassname">py2store.scrap.new_gen_local.</code><code class="sig-name descname">Local</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">rootdir</span></em>, <em class="sig-param"><span class="n">subpath</span><span class="o">=</span><span class="default_value">'{subpath}'</span></em>, <em class="sig-param"><span class="n">open_kwargs</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">keymap_kws</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/scrap/new_gen_local.html#Local"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.scrap.new_gen_local.Local" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.scrap.new_gen_local.ParametrizedPath">
<em class="property">class </em><code class="sig-prename descclassname">py2store.scrap.new_gen_local.</code><code class="sig-name descname">ParametrizedPath</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">rootdir</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">''</span></em>, <em class="sig-param"><span class="n">subpath</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'{subpath}'</span></em>, <em class="sig-param"><span class="n">format_dict</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">process_kwargs</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">process_info_dict</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/scrap/new_gen_local.html#ParametrizedPath"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.scrap.new_gen_local.ParametrizedPath" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-py2store.examples.write_caches">
<span id="py2store-examples-write-caches"></span><h1>py2store.examples.write_caches<a class="headerlink" href="#module-py2store.examples.write_caches" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt id="py2store.examples.write_caches.timestamp_on_cache_and_concatenate_all_values">
<code class="sig-prename descclassname">py2store.examples.write_caches.</code><code class="sig-name descname">timestamp_on_cache_and_concatenate_all_values</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/examples/write_caches.html#timestamp_on_cache_and_concatenate_all_values"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.examples.write_caches.timestamp_on_cache_and_concatenate_all_values" title="Permalink to this definition">¶</a></dt>
<dd><p>The cache timestamps (with system clock) every item on insertion (append) and uses the min timestamp as
a key for storage.</p>
</dd></dl>

</div>
<div class="section" id="module-py2store.examples">
<span id="py2store-examples"></span><h1>py2store.examples<a class="headerlink" href="#module-py2store.examples" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.examples.python_code_stats">
<span id="py2store-examples-python-code-stats"></span><h1>py2store.examples.python_code_stats<a class="headerlink" href="#module-py2store.examples.python_code_stats" title="Permalink to this headline">¶</a></h1>
<p>Get stats about packages. Your own, or other’s.
Things like…</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">collections</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">modules_info_df</span><span class="p">(</span><span class="n">collections</span><span class="p">)</span>
<span class="go">                      lines  empty_lines  ...  num_of_functions  num_of_classes</span>
<span class="go">collections.__init__   1273          189  ...                 1               9</span>
<span class="go">collections.abc           3            1  ...                 0              25</span>

<span class="go">[2 rows x 7 columns]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">modules_info_df_stats</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="p">)</span>
<span class="go">lines                      1276.000000</span>
<span class="go">empty_lines                 190.000000</span>
<span class="go">comment_lines                73.000000</span>
<span class="go">docs_lines                  133.000000</span>
<span class="go">function_lines              138.000000</span>
<span class="go">num_of_functions              1.000000</span>
<span class="go">num_of_classes               34.000000</span>
<span class="go">empty_lines_ratio             0.148903</span>
<span class="go">comment_lines_ratio           0.057210</span>
<span class="go">function_lines_ratio          0.108150</span>
<span class="go">mean_lines_per_function     138.000000</span>
<span class="go">dtype: float64</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stats_of</span><span class="p">([</span><span class="s1">&#39;urllib&#39;</span><span class="p">,</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="s1">&#39;collections&#39;</span><span class="p">])</span>
<span class="go">                              urllib         json  collections</span>
<span class="go">empty_lines_ratio           0.157034     0.136818     0.148903</span>
<span class="go">comment_lines_ratio         0.074142     0.038432     0.057210</span>
<span class="go">function_lines_ratio        0.213907     0.449654     0.108150</span>
<span class="go">mean_lines_per_function    13.463768    41.785714   138.000000</span>
<span class="go">lines                    4343.000000  1301.000000  1276.000000</span>
<span class="go">empty_lines               682.000000   178.000000   190.000000</span>
<span class="go">comment_lines             322.000000    50.000000    73.000000</span>
<span class="go">docs_lines                425.000000   218.000000   133.000000</span>
<span class="go">function_lines            929.000000   585.000000   138.000000</span>
<span class="go">num_of_functions           69.000000    14.000000     1.000000</span>
<span class="go">num_of_classes             55.000000     3.000000    34.000000</span>
</pre></div>
</div>
<dl class="py function">
<dt id="py2store.examples.python_code_stats.modules_info_df">
<code class="sig-prename descclassname">py2store.examples.python_code_stats.</code><code class="sig-name descname">modules_info_df</code><span class="sig-paren">(</span><em class="sig-param">root</em>, <em class="sig-param">filepath_filt=&lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">index_field=None</em>, <em class="sig-param">on_error='ignore'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/examples/python_code_stats.html#modules_info_df"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.examples.python_code_stats.modules_info_df" title="Permalink to this definition">¶</a></dt>
<dd><p>A pandas DataFrame of stats of the root (package or directory thereof).
:param root: module or directory path
:param filepath_filt: filepath filter function or regular expression
:param index_field: function or field string that should be used for the indexing of modules
:param on_error: What to do when an error occurs when extracting information from a module.</p>
<blockquote>
<div><p>Values are ‘ignore’, ‘print’, or ‘raise’</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A DataFrame whose rows contain information for each module</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">urllib</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">modules_info_df</span><span class="p">(</span><span class="n">urllib</span><span class="p">)</span>
<span class="go">                    lines  empty_lines  ...  num_of_functions  num_of_classes</span>
<span class="go">urllib.error           78           18  ...                 0               3</span>
<span class="go">urllib.request       2743          404  ...                23              28</span>
<span class="go">urllib.__init__         1            1  ...                 0               0</span>
<span class="go">urllib.response        81           24  ...                 0               4</span>
<span class="go">urllib.robotparser    274           36  ...                 0               4</span>
<span class="go">urllib.parse         1166          199  ...                46              16</span>

<span class="go">[6 rows x 7 columns]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.examples.python_code_stats.modules_info_df_stats">
<code class="sig-prename descclassname">py2store.examples.python_code_stats.</code><code class="sig-name descname">modules_info_df_stats</code><span class="sig-paren">(</span><em class="sig-param">root</em>, <em class="sig-param">filepath_filt=&lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">index_field=None</em>, <em class="sig-param">on_error='ignore'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/examples/python_code_stats.html#modules_info_df_stats"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.examples.python_code_stats.modules_info_df_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>A pandas Series of statistics over all modules of some root (package or directory thereof).
:param root: module or directory path
:param filepath_filt: filepath filter function or regular expression
:param index_field: function or field string that should be used for the indexing of modules
:param on_error: What to do when an error occurs when extracting information from a module.</p>
<blockquote>
<div><p>Values are ‘ignore’, ‘print’, or ‘raise’</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A Series whose rows containing statistics</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">modules_info_df_stats</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
<span class="go">lines                      1301.000000</span>
<span class="go">empty_lines                 178.000000</span>
<span class="go">comment_lines                50.000000</span>
<span class="go">docs_lines                  218.000000</span>
<span class="go">function_lines              585.000000</span>
<span class="go">num_of_functions             14.000000</span>
<span class="go">num_of_classes                3.000000</span>
<span class="go">empty_lines_ratio             0.136818</span>
<span class="go">comment_lines_ratio           0.038432</span>
<span class="go">function_lines_ratio          0.449654</span>
<span class="go">mean_lines_per_function      41.785714</span>
<span class="go">dtype: float64</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">modules_info_df_stats</span><span class="p">(</span><span class="s1">&#39;collections.abc&#39;</span><span class="p">)</span>
<span class="go">lines                      1276.000000</span>
<span class="go">empty_lines                 190.000000</span>
<span class="go">comment_lines                73.000000</span>
<span class="go">docs_lines                  133.000000</span>
<span class="go">function_lines              138.000000</span>
<span class="go">num_of_functions              1.000000</span>
<span class="go">num_of_classes               34.000000</span>
<span class="go">empty_lines_ratio             0.148903</span>
<span class="go">comment_lines_ratio           0.057210</span>
<span class="go">function_lines_ratio          0.108150</span>
<span class="go">mean_lines_per_function     138.000000</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.examples.python_code_stats.modules_info_gen">
<code class="sig-prename descclassname">py2store.examples.python_code_stats.</code><code class="sig-name descname">modules_info_gen</code><span class="sig-paren">(</span><em class="sig-param">root</em>, <em class="sig-param">filepath_filt=&lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">on_error='ignore'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/examples/python_code_stats.html#modules_info_gen"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.examples.python_code_stats.modules_info_gen" title="Permalink to this definition">¶</a></dt>
<dd><p>Yields statistics (as dicts) of modules under the root module or directory of a python package.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>root</strong> – module instance, dot path, or directory path</p></li>
<li><p><strong>filepath_filt</strong> – filepath filter function or regular expression</p></li>
<li><p><strong>on_error</strong> – What to do when an error occurs when extracting information from a module.
Values are ‘ignore’, ‘print’, ‘raise’, or ‘yield’</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A generator of dicts</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="py2store.examples.python_code_stats.stats_of">
<code class="sig-prename descclassname">py2store.examples.python_code_stats.</code><code class="sig-name descname">stats_of</code><span class="sig-paren">(</span><em class="sig-param">modules</em>, <em class="sig-param">filepath_filt=&lt;function &lt;lambda&gt;&gt;</em>, <em class="sig-param">index_field=None</em>, <em class="sig-param">on_error='ignore'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/examples/python_code_stats.html#stats_of"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.examples.python_code_stats.stats_of" title="Permalink to this definition">¶</a></dt>
<dd><p>A dataframe of stats of the input modules.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>modules</strong> – list of importable names</p></li>
<li><p><strong>root</strong> – module or directory path</p></li>
<li><p><strong>filepath_filt</strong> – filepath filter function or regular expression</p></li>
<li><p><strong>index_field</strong> – function or field string that should be used for the indexing of modules</p></li>
<li><p><strong>on_error</strong> – What to do when an error occurs when extracting information from a module.
Values are ‘ignore’, ‘print’, or ‘raise’</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stats_of</span><span class="p">([</span><span class="s1">&#39;urllib&#39;</span><span class="p">,</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="s1">&#39;collections&#39;</span><span class="p">])</span>
<span class="go">                              urllib         json  collections</span>
<span class="go">empty_lines_ratio           0.157034     0.136818     0.148903</span>
<span class="go">comment_lines_ratio         0.074142     0.038432     0.057210</span>
<span class="go">function_lines_ratio        0.213907     0.449654     0.108150</span>
<span class="go">mean_lines_per_function    13.463768    41.785714   138.000000</span>
<span class="go">lines                    4343.000000  1301.000000  1276.000000</span>
<span class="go">empty_lines               682.000000   178.000000   190.000000</span>
<span class="go">comment_lines             322.000000    50.000000    73.000000</span>
<span class="go">docs_lines                425.000000   218.000000   133.000000</span>
<span class="go">function_lines            929.000000   585.000000   138.000000</span>
<span class="go">num_of_functions           69.000000    14.000000     1.000000</span>
<span class="go">num_of_classes             55.000000     3.000000    34.000000</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-py2store.examples.kv_walking">
<span id="py2store-examples-kv-walking"></span><h1>py2store.examples.kv_walking<a class="headerlink" href="#module-py2store.examples.kv_walking" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.examples.kv_walking.SrcReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.examples.kv_walking.</code><code class="sig-name descname">SrcReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">src</span></em>, <em class="sig-param"><span class="n">src_to_keys</span></em>, <em class="sig-param"><span class="n">key_to_obj</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/examples/kv_walking.html#SrcReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.examples.kv_walking.SrcReader" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt id="py2store.examples.kv_walking.SrcReader.update_keys_cache">
<code class="sig-name descname">update_keys_cache</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">keys</span></em><span class="sig-paren">)</span><a class="headerlink" href="#py2store.examples.kv_walking.SrcReader.update_keys_cache" title="Permalink to this definition">¶</a></dt>
<dd><p>Updates the _keys_cache by calling its {} method</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="py2store.examples.kv_walking.conjunction">
<code class="sig-prename descclassname">py2store.examples.kv_walking.</code><code class="sig-name descname">conjunction</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/examples/kv_walking.html#conjunction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.examples.kv_walking.conjunction" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">will</span> <span class="pre">be</span> <span class="pre">equal</span> <span class="pre">to</span>
<span class="pre">`</span></code>
func_1(<a href="#id39"><span class="problematic" id="id40">*</span></a>args, <a href="#id41"><span class="problematic" id="id42">**</span></a>kwargs) &amp; … &amp; func_n(<a href="#id43"><span class="problematic" id="id44">*</span></a>args, <a href="#id45"><span class="problematic" id="id46">**</span></a>kwargs)
<a href="#id47"><span class="problematic" id="id48">``</span></a>`
for all <cite>args, kwargs</cite>.</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.examples.kv_walking.kv_walk">
<code class="sig-prename descclassname">py2store.examples.kv_walking.</code><code class="sig-name descname">kv_walk</code><span class="sig-paren">(</span><em class="sig-param">v: collections.abc.Mapping</em>, <em class="sig-param">yield_func=&lt;function asis&gt;</em>, <em class="sig-param">walk_filt=&lt;function val_is_mapping&gt;</em>, <em class="sig-param">pkv_to_pv=&lt;function tuple_keypath_and_val&gt;</em>, <em class="sig-param">p=()</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/examples/kv_walking.html#kv_walk"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.examples.kv_walking.kv_walk" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>v</strong> – </p></li>
<li><p><strong>yield_func</strong> – (pp, k, vv) -&gt; what ever you want the gen to yield</p></li>
<li><p><strong>walk_filt</strong> – (p, k, vv) -&gt; (bool) whether to explore the nested structure v further</p></li>
<li><p><strong>pkv_to_pv</strong> – (p, k, v) -&gt; (pp, vv)
where pp is a form of p + k (update of the path with the new node k)
and vv is the value that will be used by both walk_filt and yield_func</p></li>
<li><p><strong>p</strong> – The path to v</p></li>
</ul>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">kv_walk</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
<span class="go">[((&#39;a&#39;,), &#39;a&#39;, 1), ((&#39;b&#39;,), &#39;b&#39;, {&#39;c&#39;: 2, &#39;d&#39;: 3}), ((&#39;b&#39;, &#39;c&#39;), &#39;c&#39;, 2), ((&#39;b&#39;, &#39;d&#39;), &#39;d&#39;, 3)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">kv_walk</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="p">)))</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;b.c&#39;, &#39;b.d&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">kv_walk</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="p">)))</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;b.c&#39;, &#39;b.d&#39;]</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-py2store.my">
<span id="py2store-my"></span><h1>py2store.my<a class="headerlink" href="#module-py2store.my" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.my.grabbers">
<span id="py2store-my-grabbers"></span><h1>py2store.my.grabbers<a class="headerlink" href="#module-py2store.my.grabbers" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.trans">
<span id="py2store-trans"></span><h1>py2store.trans<a class="headerlink" href="#module-py2store.trans" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.trans.OverWritesNotAllowedMixin">
<em class="property">class </em><code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">OverWritesNotAllowedMixin</code><a class="reference internal" href="_modules/py2store/trans.html#OverWritesNotAllowedMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.OverWritesNotAllowedMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Mixin for only allowing a write to a key if they key doesn’t already exist.
Note: Should be before the persister in the MRO.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">TestPersister</span><span class="p">(</span><span class="n">OverWritesNotAllowedMixin</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">TestPersister</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#p[&#39;foo&#39;] = &#39;bar2&#39;  # will raise error</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;this value should not be stored&#39;</span> 
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="gr">py2store.errors.OverWritesNotAllowedError</span>: <span class="n">key foo already exists and cannot be overwritten.</span>
<span class="go">    If you really want to write to that key, delete it before writing</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span>  <span class="c1"># foo is still bar</span>
<span class="go">&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;this value WILL be stored&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span>
<span class="go">&#39;this value WILL be stored&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.trans.add_ipython_key_completions">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">add_ipython_key_completions</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">store</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/trans.html#add_ipython_key_completions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.add_ipython_key_completions" title="Permalink to this definition">¶</a></dt>
<dd><p>Add tab completion that shows you the keys of the store.
Note: ipython already adds local path listing automatically,</p>
<blockquote>
<div><p>so you’ll still get those along with your valid store keys.</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt id="py2store.trans.add_path_get">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">add_path_get</code><span class="sig-paren">(</span><em class="sig-param">store=None</em>, <em class="sig-param">name=None</em>, <em class="sig-param">path_type: type = &lt;class 'tuple'&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/trans.html#add_path_get"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.add_path_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Make nested stores accessible through key paths.</p>
<p>Say you have some nested stores.
You know… like a <cite>ZipFileReader</cite> store whose values are <a href="#id49"><span class="problematic" id="id50">`</span></a>ZipReader`s,
whose values are bytes of the zipped files (and you can go on… whose (json) values are…).</p>
<p>Well, you can access any node of this nested tree of stores like this:
<a href="#id51"><span class="problematic" id="id52">``</span></a><a href="#id53"><span class="problematic" id="id54">`</span></a></p>
<blockquote>
<div><p>MyStore[key_1][key_2][key_3]</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">And</span> <span class="pre">that's</span> <span class="pre">fine.</span> <span class="pre">But</span> <span class="pre">maybe</span> <span class="pre">you'd</span> <span class="pre">like</span> <span class="pre">to</span> <span class="pre">do</span> <span class="pre">it</span> <span class="pre">this</span> <span class="pre">way</span> <span class="pre">instead:</span>
<span class="pre">`</span></code></p>
<blockquote>
<div><p>MyStore[key_1, key_2, key_3]</p>
</div></blockquote>
<p><a href="#id55"><span class="problematic" id="id56">``</span></a>`
Or like this:</p>
<blockquote>
<div><p>MyStore[‘key_1/key_2/key_3’]</p>
</div></blockquote>
<p>Or this:</p>
<blockquote>
<div><p>MyStore[‘key_1.key_2.key_3’]</p>
</div></blockquote>
<p>You get the point. This is what <cite>add_path_get</cite> is meant for.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store</strong> – The store (class or instance) you’re wrapping.
If not specified, the function will return a decorator.</p></li>
<li><p><strong>name</strong> – The name to give the class (not applicable to instance wrapping)</p></li>
<li><p><strong>path_type</strong> – The type that paths are expressed as. Needs to be an Iterable type. By default, a tuple.
This is used to decide whether the key should be taken as a “normal” key of the store,
or should be used to iterate through, recursively getting values.</p></li>
</ul>
</dd>
</dl>
<p>Returns: A wrapped store (class or instance), or a store wrapping decorator (if store is not specified)</p>
<p>See Also: <cite>py2store.key_mappers.paths.PathGetMixin</cite>, <cite>py2store.key_mappers.paths.KeyPath</cite></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># wrapping an instance</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">add_path_get</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">}}})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="go">{&#39;b&#39;: {&#39;c&#39;: 42}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="go">{&#39;c&#39;: 42}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span>
<span class="go">42</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># wrapping a class</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S</span> <span class="o">=</span> <span class="n">add_path_get</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">}})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">}};</span> <span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">};</span> <span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">42</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># using add_path_get as a decorator</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@add_path_get</span>
<span class="gp">... </span><span class="k">class</span> <span class="nc">S</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<span class="gp">... </span>   <span class="k">pass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">}})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">}};</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="s1">&#39;b&#39;</span><span class="p">];</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="s1">&#39;b&#39;</span><span class="p">][</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># a different kind of path?</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># You can choose a different path_type, but sometimes (say both keys and key paths are strings)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># you need to involve more tools. Like py2store.key_mappers.paths.KeyPath...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store.key_mappers.paths</span> <span class="kn">import</span> <span class="n">KeyPath</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store</span> <span class="kn">import</span> <span class="n">kv_wrap</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">SS</span> <span class="o">=</span> <span class="n">kv_wrap</span><span class="p">(</span><span class="n">KeyPath</span><span class="p">(</span><span class="n">path_sep</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">))(</span><span class="n">S</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SS</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">}}})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">}};</span> <span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a.b&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="s1">&#39;b&#39;</span><span class="p">];</span> <span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a.b.c&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="s1">&#39;b&#39;</span><span class="p">][</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.trans.add_wrapper_method">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">add_wrapper_method</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">wrap_cls</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">method_name</span><span class="o">=</span><span class="default_value">'wrapper'</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/trans.html#add_wrapper_method"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.add_wrapper_method" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator that adds a wrapper method (itself a decorator) to a wrapping class
Clear?
See <cite>mk_wrapper</cite> function and doctest example if not.</p>
<p>What <cite>add_wrapper_method</cite> does is just to add a <cite>“wrapper”</cite> method
(or another name if you ask for it) to <cite>wrap_cls</cite>, so that you can use that
class for it’s purpose of transforming stores more conveniently.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wrap_cls</strong> – The wrapper class (the definitioin of the transformation.
If None, the functiion will make a decorator to decorate wrap_cls later</p></li>
<li><p><strong>method_name</strong> – The method name you want to use (default is ‘wrapper’)</p></li>
</ul>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@add_wrapper_method</span>
<span class="gp">... </span><span class="k">class</span> <span class="nc">RelPath</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_root_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_key_of_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_id</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">_id</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_root_length</span><span class="p">:]</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_id_of_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="n">k</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">RelDict</span> <span class="o">=</span> <span class="n">RelPath</span><span class="o">.</span><span class="n">wrapper</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s1">&#39;foo/&#39;</span><span class="p">)(</span><span class="nb">dict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">RelDict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">42</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;{&#39;foo/bar&#39;: 42}&quot;</span>  <span class="c1"># reveals that actually, behind the scenes, there&#39;s a &quot;foo/&quot; prefix</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.trans.cache_iter">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">cache_iter</code><span class="sig-paren">(</span><em class="sig-param">store=None</em>, <em class="sig-param">*</em>, <em class="sig-param">keys_cache: Union[callable</em>, <em class="sig-param">Collection] = &lt;class 'list'&gt;</em>, <em class="sig-param">iter_to_container=None</em>, <em class="sig-param">cache_update_method='update'</em>, <em class="sig-param">name: str = None</em>, <em class="sig-param">__module__=None</em>, <em class="sig-param">__name__=None</em>, <em class="sig-param">__qualname__=None</em>, <em class="sig-param">__doc__=None</em>, <em class="sig-param">__annotations__=None</em>, <em class="sig-param">__defaults__=None</em>, <em class="sig-param">__kwdefaults__=None</em><span class="sig-paren">)</span> &#x2192; Union<span class="p">[</span>callable<span class="p">, </span><a class="reference internal" href="#py2store.base.KvReader" title="py2store.base.KvReader">py2store.base.KvReader</a><span class="p">]</span><a class="headerlink" href="#py2store.trans.cache_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a class that wraps input class’s __iter__ becomes cached.</p>
<p>Quite often we have a lot of keys, that we get from a remote data source, and don’t want to have to ask for
them again and again, having them be fetched, sent over the network, etc.
So we need caching.</p>
<p>But this caching is not the typical read caching, since it’s __iter__ we want to cache, and that’s a generator.
So we’ll implement a store class decorator specialized for this.</p>
<p>The following decorator, when applied to a class (that has an __iter__), will perform the __iter__ code, consuming
all items of the generator and storing them in _keys_cache, and then will yield from there every subsequent call.</p>
<p>It is assumed, if you’re using the cached_keys transformation, that you’re dealing with static data
(or data that can be considered static for the life of the store – for example, when conducting analytics).
If you ever need to refresh the cache during the life of the store, you can to delete _keys_cache like this:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">del</span> <span class="pre">your_store._keys_cache</span>
<span class="pre">`</span></code>
Once you do that, the next time you try to ask something about the contents of the store, it will actually do
a live query again, as for the first time.</p>
<p>Note: The default keys_cache is list though in many cases, you’d probably should use set, or an explicitly
computer set instead. The reason list is used as the default is because (1) we didn’t want to assume that
order did not matter (maybe it does to you) and (2) we didn’t want to assume that your keys were hashable.
That said, if you’re keys are hashable, and order does not matter, use set. That’ll give you two things:
(a) your <cite>key in store</cite> checks will be faster (O(1) instead of O(n)) and (b) you’ll enforce unicity of keys.</p>
<p>Know also that if you precompute the keys you want to cache with a container that has an update
method (by default <cite>update</cite>) your cache updates will be faster and if the container you use has
a <cite>remove</cite> method, you’ll be able to delete as well.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store</strong> – The store instance or class to wrap (must have an __iter__), or None if you want a decorator.</p></li>
<li><p><strong>keys_cache</strong> – An explicit collection of keys</p></li>
<li><p><strong>iter_to_container</strong> – The function that will be applied to existing __iter__() and assigned to cache.
The default is list. Another useful one is the sorted function.</p></li>
<li><p><strong>cache_update_method</strong> – <p>Name of the keys_cache update method to use, if it is an attribute of keys_cache.
Note that this cache_update_method will be used only</p>
<blockquote>
<div><p>if keys_cache is an explicit iterable and has that attribute
if keys_cache is a callable and has that attribute.</p>
</div></blockquote>
<p>The default None</p>
</p></li>
<li><p><strong>name</strong> – The name of the new class</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>None: Will return a decorator that can be applied to a store</dt><dd><p>a store class: Will return a wrapped class that caches it’s keys
a store instance: Will return a wrapped instance that caches it’s keys</p>
</dd>
<dt>The instances of such key-cached classes have some extra attributes:</dt><dd><p>_explicit_keys: The actual cache. An iterable container
update_keys_cache: Is called if a user uses the instance to mutate the store (i.e. write or delete).</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>If store is</p>
</dd>
</dl>
<p>You have two ways of caching keys:
- By providing the explicit list of keys you want cache (and use)
- By providing a callable that will iterate through your store and collect an explicit list of keys</p>
<p>Let’s take a simple dict as our original store.
&gt;&gt;&gt; source = dict(c=3, b=2, a=1)</p>
<p>Specify an iterable, and it will be used as the cached keys
&gt;&gt;&gt; cached = cached_keys(source, keys_cache=’bc’)
&gt;&gt;&gt; list(cached.items())  # notice that the order you get things is also ruled by the cache
[(‘b’, 2), (‘c’, 3)]</p>
<p>Specify a callable, and it will apply it to the existing keys to make your cache
&gt;&gt;&gt; list(cached_keys(source, keys_cache=sorted))
[‘a’, ‘b’, ‘c’]</p>
<p>You can use the callable keys_cache specification to filter as well!
Oh, and let’s demo the fact that if you don’t specify the store, it will make a store decorator for you:
&gt;&gt;&gt; cache_my_keys = cached_keys(keys_cache=lambda keys: list(filter(lambda k: k &gt;= ‘b’, keys)))
&gt;&gt;&gt; d = cache_my_keys(source)  # used as to transform an instance
&gt;&gt;&gt; list(d)
[‘c’, ‘b’]</p>
<p>Let’s use that same <cite>cache_my_keys</cite> to decorate a class instead:
&gt;&gt;&gt; cached_dict = cache_my_keys(dict)
&gt;&gt;&gt; d = cached_dict(c=3, b=2, a=1)
&gt;&gt;&gt; list(d)
[‘c’, ‘b’]</p>
<p>Note that there’s still an underlying store (dict) that has the data:
&gt;&gt;&gt; repr(d)  # repr isn’t wrapped, so you can still see your underlying dict
“{‘c’: 3, ‘b’: 2, ‘a’: 1}”</p>
<p>And yes, you can still add elements,
&gt;&gt;&gt; d[‘z’] = 26
&gt;&gt;&gt; list(d.items())
[(‘c’, 3), (‘b’, 2), (‘z’, 26)]</p>
<p>do bulk updates,
&gt;&gt;&gt; d.update({‘more’: ‘of this’}, more_of=’that’)
&gt;&gt;&gt; list(d.items())
[(‘c’, 3), (‘b’, 2), (‘z’, 26), (‘more’, ‘of this’), (‘more_of’, ‘that’)]</p>
<p>and delete…
&gt;&gt;&gt; del d[‘more’]
&gt;&gt;&gt; list(d.items())
[(‘c’, 3), (‘b’, 2), (‘z’, 26), (‘more_of’, ‘that’)]</p>
<p>But careful! Know what you’re doing if you try to get creative. Have a look at this:
&gt;&gt;&gt; d[‘a’] = 100  # add an ‘a’ item
&gt;&gt;&gt; d.update(and_more=’of that’)  # update to add yet another item
&gt;&gt;&gt; list(d.items())
[(‘c’, 3), (‘b’, 2), (‘z’, 26), (‘more_of’, ‘that’)]</p>
<p>Indeed: No ‘a’ or ‘and_more’.</p>
<p>Now… they were indeed added. Or to be more precise, the value of the already existing a was changed,
and a new (‘and_more’, ‘of that’) item was indeed added in the underlying store:
&gt;&gt;&gt; repr(d)
“{‘c’: 3, ‘b’: 2, ‘a’: 100, ‘z’: 26, ‘more_of’: ‘that’, ‘and_more’: ‘of that’}”</p>
<p>But you’re not seeing it.</p>
<p>Why?</p>
<p>Because you chose to use a callable keys_cache that doesn’t have an ‘update’ method.
When your _keys_cache attribute (the iterable cache) is not updatable itself, the
way updates work is that we iterate through the underlying store (where the updates actually took place),
and apply the keys_cache (callable) to that iterable.</p>
<p>So what happened here was that you have your new ‘a’ and ‘and_more’ items, but your cached version of the
store doesn’t see it because it’s filtered out. On the other hand, check out what happens if you have
an updateable cache.</p>
<p>Using <cite>set</cite> instead of <cite>list</cite>, after the <cite>filter</cite>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cache_my_keys</span> <span class="o">=</span> <span class="n">cached_keys</span><span class="p">(</span><span class="n">keys_cache</span><span class="o">=</span><span class="nb">set</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">cache_my_keys</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>  <span class="c1"># used as to transform an instance</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>  <span class="c1"># using sorted because a set&#39;s order is not always the same</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">and_more</span><span class="o">=</span><span class="s1">&#39;of that&#39;</span><span class="p">)</span>  <span class="c1"># update to add yet another item</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;a&#39;, 100), (&#39;and_more&#39;, &#39;of that&#39;), (&#39;b&#39;, 2), (&#39;c&#39;, 3)]</span>
</pre></div>
</div>
<p>This example was to illustrate a more subtle aspect of cached_keys. You would probably deal with
the filter concern in a different way in this case. But the rope is there – it’s your choice on how
to use it.</p>
<p>And here’s some more examples if that wasn’t enough!</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Lets cache the keys of a dict.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cached_dict</span> <span class="o">=</span> <span class="n">cached_keys</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">cached_dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># And you get a store that behaves as expected (but more speed and RAM)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>  <span class="c1"># whether you iterate with .keys(), .values(), or .items()</span>
<span class="go">[(&#39;a&#39;, 1), (&#39;b&#39;, 2), (&#39;c&#39;, 3)]</span>
</pre></div>
</div>
<p>This is where the keys are stored:
&gt;&gt;&gt; d._keys_cache
[‘a’, ‘b’, ‘c’]</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Let&#39;s demo the iter_to_container argument. The default is &quot;list&quot;, which will just consume the iter in order</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sorted_dict</span> <span class="o">=</span> <span class="n">cached_keys</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">keys_cache</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">sorted_dict</span><span class="p">({</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># keys will be in the order they were defined</span>
<span class="go">[&#39;b&#39;, &#39;a&#39;, &#39;c&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sorted_dict</span> <span class="o">=</span> <span class="n">cached_keys</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">keys_cache</span><span class="o">=</span><span class="nb">sorted</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">sorted_dict</span><span class="p">({</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># keys will be sorted</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sorted_dict</span> <span class="o">=</span> <span class="n">cached_keys</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">keys_cache</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">sorted_dict</span><span class="p">({</span><span class="s1">&#39;bbb&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;aa&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># keys will be sorted according to their length</span>
<span class="go">[&#39;c&#39;, &#39;aa&#39;, &#39;bbb&#39;]</span>
</pre></div>
</div>
<p>If you change the keys (adding new ones with __setitem__ or update, or removing with pop or popitem)
then the cache is recomputed (the first time you use an operation that iterates over keys)
&gt;&gt;&gt; d.update(d=4)  # let’s add an element (try d[‘d’] = 4 as well)
&gt;&gt;&gt; list(d)
[‘a’, ‘b’, ‘c’, ‘d’]
&gt;&gt;&gt; d[‘e’] = 5
&gt;&gt;&gt; list(d.items())  # whether you iterate with .keys(), .values(), or .items()
[(‘a’, 1), (‘b’, 2), (‘c’, 3), (‘d’, 4), (‘e’, 5)]</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@cached_keys</span>
<span class="gp">... </span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">yield from</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Note, could have also used this form: AA = cached_keys(A)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">[1, 2, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">_keys_cache</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span>  <span class="c1"># changing the cache, to prove that subsequent listing will read from there</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># proof:</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Let&#39;s demo the iter_to_container argument. The default is &quot;list&quot;, which will just consume the iter in order</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sorted_dict</span> <span class="o">=</span> <span class="n">cached_keys</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">keys_cache</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">sorted_dict</span><span class="p">({</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># keys will be in the order they were defined</span>
<span class="go">[&#39;b&#39;, &#39;a&#39;, &#39;c&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sorted_dict</span> <span class="o">=</span> <span class="n">cached_keys</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">keys_cache</span><span class="o">=</span><span class="nb">sorted</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">sorted_dict</span><span class="p">({</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># keys will be sorted</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sorted_dict</span> <span class="o">=</span> <span class="n">cached_keys</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">keys_cache</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">sorted_dict</span><span class="p">({</span><span class="s1">&#39;bbb&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;aa&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># keys will be sorted according to their length</span>
<span class="go">[&#39;c&#39;, &#39;aa&#39;, &#39;bbb&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.trans.cached_keys">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">cached_keys</code><span class="sig-paren">(</span><em class="sig-param">store=None</em>, <em class="sig-param">*</em>, <em class="sig-param">keys_cache: Union[callable</em>, <em class="sig-param">Collection] = &lt;class 'list'&gt;</em>, <em class="sig-param">iter_to_container=None</em>, <em class="sig-param">cache_update_method='update'</em>, <em class="sig-param">name: str = None</em>, <em class="sig-param">__module__=None</em>, <em class="sig-param">__name__=None</em>, <em class="sig-param">__qualname__=None</em>, <em class="sig-param">__doc__=None</em>, <em class="sig-param">__annotations__=None</em>, <em class="sig-param">__defaults__=None</em>, <em class="sig-param">__kwdefaults__=None</em><span class="sig-paren">)</span> &#x2192; Union<span class="p">[</span>callable<span class="p">, </span><a class="reference internal" href="#py2store.base.KvReader" title="py2store.base.KvReader">py2store.base.KvReader</a><span class="p">]</span><a class="reference internal" href="_modules/py2store/trans.html#cached_keys"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.cached_keys" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a class that wraps input class’s __iter__ becomes cached.</p>
<p>Quite often we have a lot of keys, that we get from a remote data source, and don’t want to have to ask for
them again and again, having them be fetched, sent over the network, etc.
So we need caching.</p>
<p>But this caching is not the typical read caching, since it’s __iter__ we want to cache, and that’s a generator.
So we’ll implement a store class decorator specialized for this.</p>
<p>The following decorator, when applied to a class (that has an __iter__), will perform the __iter__ code, consuming
all items of the generator and storing them in _keys_cache, and then will yield from there every subsequent call.</p>
<p>It is assumed, if you’re using the cached_keys transformation, that you’re dealing with static data
(or data that can be considered static for the life of the store – for example, when conducting analytics).
If you ever need to refresh the cache during the life of the store, you can to delete _keys_cache like this:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">del</span> <span class="pre">your_store._keys_cache</span>
<span class="pre">`</span></code>
Once you do that, the next time you try to ask something about the contents of the store, it will actually do
a live query again, as for the first time.</p>
<p>Note: The default keys_cache is list though in many cases, you’d probably should use set, or an explicitly
computer set instead. The reason list is used as the default is because (1) we didn’t want to assume that
order did not matter (maybe it does to you) and (2) we didn’t want to assume that your keys were hashable.
That said, if you’re keys are hashable, and order does not matter, use set. That’ll give you two things:
(a) your <cite>key in store</cite> checks will be faster (O(1) instead of O(n)) and (b) you’ll enforce unicity of keys.</p>
<p>Know also that if you precompute the keys you want to cache with a container that has an update
method (by default <cite>update</cite>) your cache updates will be faster and if the container you use has
a <cite>remove</cite> method, you’ll be able to delete as well.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store</strong> – The store instance or class to wrap (must have an __iter__), or None if you want a decorator.</p></li>
<li><p><strong>keys_cache</strong> – An explicit collection of keys</p></li>
<li><p><strong>iter_to_container</strong> – The function that will be applied to existing __iter__() and assigned to cache.
The default is list. Another useful one is the sorted function.</p></li>
<li><p><strong>cache_update_method</strong> – <p>Name of the keys_cache update method to use, if it is an attribute of keys_cache.
Note that this cache_update_method will be used only</p>
<blockquote>
<div><p>if keys_cache is an explicit iterable and has that attribute
if keys_cache is a callable and has that attribute.</p>
</div></blockquote>
<p>The default None</p>
</p></li>
<li><p><strong>name</strong> – The name of the new class</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>None: Will return a decorator that can be applied to a store</dt><dd><p>a store class: Will return a wrapped class that caches it’s keys
a store instance: Will return a wrapped instance that caches it’s keys</p>
</dd>
<dt>The instances of such key-cached classes have some extra attributes:</dt><dd><p>_explicit_keys: The actual cache. An iterable container
update_keys_cache: Is called if a user uses the instance to mutate the store (i.e. write or delete).</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>If store is</p>
</dd>
</dl>
<p>You have two ways of caching keys:
- By providing the explicit list of keys you want cache (and use)
- By providing a callable that will iterate through your store and collect an explicit list of keys</p>
<p>Let’s take a simple dict as our original store.
&gt;&gt;&gt; source = dict(c=3, b=2, a=1)</p>
<p>Specify an iterable, and it will be used as the cached keys
&gt;&gt;&gt; cached = cached_keys(source, keys_cache=’bc’)
&gt;&gt;&gt; list(cached.items())  # notice that the order you get things is also ruled by the cache
[(‘b’, 2), (‘c’, 3)]</p>
<p>Specify a callable, and it will apply it to the existing keys to make your cache
&gt;&gt;&gt; list(cached_keys(source, keys_cache=sorted))
[‘a’, ‘b’, ‘c’]</p>
<p>You can use the callable keys_cache specification to filter as well!
Oh, and let’s demo the fact that if you don’t specify the store, it will make a store decorator for you:
&gt;&gt;&gt; cache_my_keys = cached_keys(keys_cache=lambda keys: list(filter(lambda k: k &gt;= ‘b’, keys)))
&gt;&gt;&gt; d = cache_my_keys(source)  # used as to transform an instance
&gt;&gt;&gt; list(d)
[‘c’, ‘b’]</p>
<p>Let’s use that same <cite>cache_my_keys</cite> to decorate a class instead:
&gt;&gt;&gt; cached_dict = cache_my_keys(dict)
&gt;&gt;&gt; d = cached_dict(c=3, b=2, a=1)
&gt;&gt;&gt; list(d)
[‘c’, ‘b’]</p>
<p>Note that there’s still an underlying store (dict) that has the data:
&gt;&gt;&gt; repr(d)  # repr isn’t wrapped, so you can still see your underlying dict
“{‘c’: 3, ‘b’: 2, ‘a’: 1}”</p>
<p>And yes, you can still add elements,
&gt;&gt;&gt; d[‘z’] = 26
&gt;&gt;&gt; list(d.items())
[(‘c’, 3), (‘b’, 2), (‘z’, 26)]</p>
<p>do bulk updates,
&gt;&gt;&gt; d.update({‘more’: ‘of this’}, more_of=’that’)
&gt;&gt;&gt; list(d.items())
[(‘c’, 3), (‘b’, 2), (‘z’, 26), (‘more’, ‘of this’), (‘more_of’, ‘that’)]</p>
<p>and delete…
&gt;&gt;&gt; del d[‘more’]
&gt;&gt;&gt; list(d.items())
[(‘c’, 3), (‘b’, 2), (‘z’, 26), (‘more_of’, ‘that’)]</p>
<p>But careful! Know what you’re doing if you try to get creative. Have a look at this:
&gt;&gt;&gt; d[‘a’] = 100  # add an ‘a’ item
&gt;&gt;&gt; d.update(and_more=’of that’)  # update to add yet another item
&gt;&gt;&gt; list(d.items())
[(‘c’, 3), (‘b’, 2), (‘z’, 26), (‘more_of’, ‘that’)]</p>
<p>Indeed: No ‘a’ or ‘and_more’.</p>
<p>Now… they were indeed added. Or to be more precise, the value of the already existing a was changed,
and a new (‘and_more’, ‘of that’) item was indeed added in the underlying store:
&gt;&gt;&gt; repr(d)
“{‘c’: 3, ‘b’: 2, ‘a’: 100, ‘z’: 26, ‘more_of’: ‘that’, ‘and_more’: ‘of that’}”</p>
<p>But you’re not seeing it.</p>
<p>Why?</p>
<p>Because you chose to use a callable keys_cache that doesn’t have an ‘update’ method.
When your _keys_cache attribute (the iterable cache) is not updatable itself, the
way updates work is that we iterate through the underlying store (where the updates actually took place),
and apply the keys_cache (callable) to that iterable.</p>
<p>So what happened here was that you have your new ‘a’ and ‘and_more’ items, but your cached version of the
store doesn’t see it because it’s filtered out. On the other hand, check out what happens if you have
an updateable cache.</p>
<p>Using <cite>set</cite> instead of <cite>list</cite>, after the <cite>filter</cite>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cache_my_keys</span> <span class="o">=</span> <span class="n">cached_keys</span><span class="p">(</span><span class="n">keys_cache</span><span class="o">=</span><span class="nb">set</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">cache_my_keys</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>  <span class="c1"># used as to transform an instance</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>  <span class="c1"># using sorted because a set&#39;s order is not always the same</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">and_more</span><span class="o">=</span><span class="s1">&#39;of that&#39;</span><span class="p">)</span>  <span class="c1"># update to add yet another item</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;a&#39;, 100), (&#39;and_more&#39;, &#39;of that&#39;), (&#39;b&#39;, 2), (&#39;c&#39;, 3)]</span>
</pre></div>
</div>
<p>This example was to illustrate a more subtle aspect of cached_keys. You would probably deal with
the filter concern in a different way in this case. But the rope is there – it’s your choice on how
to use it.</p>
<p>And here’s some more examples if that wasn’t enough!</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Lets cache the keys of a dict.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cached_dict</span> <span class="o">=</span> <span class="n">cached_keys</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">cached_dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># And you get a store that behaves as expected (but more speed and RAM)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>  <span class="c1"># whether you iterate with .keys(), .values(), or .items()</span>
<span class="go">[(&#39;a&#39;, 1), (&#39;b&#39;, 2), (&#39;c&#39;, 3)]</span>
</pre></div>
</div>
<p>This is where the keys are stored:
&gt;&gt;&gt; d._keys_cache
[‘a’, ‘b’, ‘c’]</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Let&#39;s demo the iter_to_container argument. The default is &quot;list&quot;, which will just consume the iter in order</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sorted_dict</span> <span class="o">=</span> <span class="n">cached_keys</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">keys_cache</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">sorted_dict</span><span class="p">({</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># keys will be in the order they were defined</span>
<span class="go">[&#39;b&#39;, &#39;a&#39;, &#39;c&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sorted_dict</span> <span class="o">=</span> <span class="n">cached_keys</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">keys_cache</span><span class="o">=</span><span class="nb">sorted</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">sorted_dict</span><span class="p">({</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># keys will be sorted</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sorted_dict</span> <span class="o">=</span> <span class="n">cached_keys</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">keys_cache</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">sorted_dict</span><span class="p">({</span><span class="s1">&#39;bbb&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;aa&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># keys will be sorted according to their length</span>
<span class="go">[&#39;c&#39;, &#39;aa&#39;, &#39;bbb&#39;]</span>
</pre></div>
</div>
<p>If you change the keys (adding new ones with __setitem__ or update, or removing with pop or popitem)
then the cache is recomputed (the first time you use an operation that iterates over keys)
&gt;&gt;&gt; d.update(d=4)  # let’s add an element (try d[‘d’] = 4 as well)
&gt;&gt;&gt; list(d)
[‘a’, ‘b’, ‘c’, ‘d’]
&gt;&gt;&gt; d[‘e’] = 5
&gt;&gt;&gt; list(d.items())  # whether you iterate with .keys(), .values(), or .items()
[(‘a’, 1), (‘b’, 2), (‘c’, 3), (‘d’, 4), (‘e’, 5)]</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@cached_keys</span>
<span class="gp">... </span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">yield from</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Note, could have also used this form: AA = cached_keys(A)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">[1, 2, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">_keys_cache</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span>  <span class="c1"># changing the cache, to prove that subsequent listing will read from there</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># proof:</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Let&#39;s demo the iter_to_container argument. The default is &quot;list&quot;, which will just consume the iter in order</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sorted_dict</span> <span class="o">=</span> <span class="n">cached_keys</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">keys_cache</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">sorted_dict</span><span class="p">({</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># keys will be in the order they were defined</span>
<span class="go">[&#39;b&#39;, &#39;a&#39;, &#39;c&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sorted_dict</span> <span class="o">=</span> <span class="n">cached_keys</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">keys_cache</span><span class="o">=</span><span class="nb">sorted</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">sorted_dict</span><span class="p">({</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># keys will be sorted</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sorted_dict</span> <span class="o">=</span> <span class="n">cached_keys</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">keys_cache</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">sorted_dict</span><span class="p">({</span><span class="s1">&#39;bbb&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;aa&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># keys will be sorted according to their length</span>
<span class="go">[&#39;c&#39;, &#39;aa&#39;, &#39;bbb&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.trans.catch_and_cache_error_keys">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">catch_and_cache_error_keys</code><span class="sig-paren">(</span><em class="sig-param">store=None</em>, <em class="sig-param">*</em>, <em class="sig-param">errors_caught=&lt;class 'Exception'&gt;</em>, <em class="sig-param">error_callback=None</em>, <em class="sig-param">use_cached_keys_after_completed_iter=True</em>, <em class="sig-param">__module__=None</em>, <em class="sig-param">__name__=None</em>, <em class="sig-param">__qualname__=None</em>, <em class="sig-param">__doc__=None</em>, <em class="sig-param">__annotations__=None</em>, <em class="sig-param">__defaults__=None</em>, <em class="sig-param">__kwdefaults__=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/trans.html#catch_and_cache_error_keys"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.catch_and_cache_error_keys" title="Permalink to this definition">¶</a></dt>
<dd><p>Store that will cache keys as they’re accessed, separating those that raised errors and those that didn’t.
Getting a key will still through an error, but the access attempts will be collected in an ._error_keys attribute.
Successfful attemps will be stored in _keys_cache.
Retrieval iteration (items() or values()) will on the other hand, skip the error (while still caching it).
If the iteration completes (and use_cached_keys_after_completed_iter), the use_cached_keys flag is turned on,
which will result in the store now getting it’s keys from the _keys_cache.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@catch_and_cache_error_keys</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">error_callback</span><span class="o">=</span><span class="k">lambda</span> <span class="n">store</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error with </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> key: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
<span class="gp">... </span><span class="k">class</span> <span class="nc">Blacklist</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">_black_list</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">}</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_black_list</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nope, that&#39;s from the black list!&quot;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Blacklist</span><span class="p">(</span><span class="n">black</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>  <span class="n">friday</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">frenzy</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[&#39;black&#39;, &#39;friday&#39;, &#39;frenzy&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">Error with black key: &quot;Nope, that&#39;s from the black list!&quot;</span>
<span class="go">[(&#39;friday&#39;, 20), (&#39;frenzy&#39;, 13)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># sorting to get consistent output</span>
<span class="go">[&#39;frenzy&#39;, &#39;friday&#39;]</span>
</pre></div>
</div>
<p>See that? First we had three keys, then we iterated and got only 2 items (fortunately,
we specified an <code class="docutils literal notranslate"><span class="pre">error_callback</span></code> so we ccould see that the iteration actually dropped a key).
That’s strange. And even stranger is the fact that when we list our keys again, we get only two.</p>
<p>You don’t like it? Neither do I. But
- It’s not a completely outrageous behavior – if you’re talking to live data, it</p>
<blockquote>
<div><p>often happens that you get more, or less, from one second to another.</p>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>This store isn’t meant to be long living, but rather meant to solve the problem of skiping</dt><dd><p>items that are problematic (for example, malformatted files), with a trace of
what was skipped and what’s valid (in case we need to iterate again and don’t want to
bear the hit of requesting values for keys we already know are problematic.</p>
</dd>
</dl>
</li>
</ul>
<p>Here’s a little peep of what is happening under the hood.
Meet <code class="docutils literal notranslate"><span class="pre">_keys_cache</span></code> and <code class="docutils literal notranslate"><span class="pre">_error_keys</span></code> sets (yes, unordered – so know it) that are meant
to acccumulate valid and problematic keys respectively.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Blacklist</span><span class="p">(</span><span class="n">black</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>  <span class="n">friday</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">frenzy</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[&#39;black&#39;, &#39;friday&#39;, &#39;frenzy&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">_keys_cache</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">_error_keys</span>
<span class="go">(set(), set())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;friday&#39;</span><span class="p">]</span>
<span class="go">20</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">_keys_cache</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">_error_keys</span>
<span class="go">({&#39;friday&#39;}, set())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="gr">KeyError</span>: <span class="n">&quot;Nope, that&#39;s from the black list!&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">_keys_cache</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">_error_keys</span>
<span class="go">({&#39;friday&#39;}, {&#39;black&#39;})</span>
</pre></div>
</div>
<p>But see that we still have the full list:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[&#39;black&#39;, &#39;friday&#39;, &#39;frenzy&#39;]</span>
</pre></div>
</div>
<p>Meet <code class="docutils literal notranslate"><span class="pre">use_cached_keys</span></code>: He’s the culprit. It’s a flag that indicates whether we should be
using the cached keys or not. Obviously, it’ll start off being <code class="docutils literal notranslate"><span class="pre">False</span></code>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">use_cached_keys</span>
<span class="go">False</span>
</pre></div>
</div>
<p>Now we could set it to <code class="docutils literal notranslate"><span class="pre">True</span></code> manually to change the mode.
But know that this switch happens automatically (UNLESS you specify otherwise by saying:
<code class="docutils literal notranslate"><span class="pre">use_cached_keys_after_completed_iter=False</span></code>) when ever you got through a
VALUE-PRODUCING iteration (i.e. entirely consuming <cite>items()</cite> or <cite>values()</cite>).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>  <span class="c1"># sorting to get consistent output</span>
<span class="go">Error with black key: &quot;Nope, that&#39;s from the black list!&quot;</span>
<span class="go">[13, 20]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.trans.filt_iter">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">filt_iter</code><span class="sig-paren">(</span><em class="sig-param">store=None</em>, <em class="sig-param">*</em>, <em class="sig-param">filt: Union[callable</em>, <em class="sig-param">collections.abc.Iterable] = &lt;function take_everything&gt;</em>, <em class="sig-param">name=None</em>, <em class="sig-param">__module__=None</em>, <em class="sig-param">__name__=None</em>, <em class="sig-param">__qualname__=None</em>, <em class="sig-param">__doc__=None</em>, <em class="sig-param">__annotations__=None</em>, <em class="sig-param">__defaults__=None</em>, <em class="sig-param">__kwdefaults__=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/trans.html#filt_iter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.filt_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a wrapper that will transform a store (class or instance thereof) into a sub-store (i.e. subset of keys).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filt</strong> – A callable or iterable:
callable: Boolean filter function. A func taking a key and and returns True iff the key should be included.
iterable: The collection of keys you want to filter “in”</p></li>
<li><p><strong>name</strong> – The name to give the wrapped class</p></li>
</ul>
</dd>
</dl>
<p>Returns: A wrapper (that then needs to be applied to a store instance or class.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">filtered_dict</span> <span class="o">=</span> <span class="n">filt_iter</span><span class="p">(</span><span class="n">filt</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)(</span><span class="nb">dict</span><span class="p">)</span>  <span class="c1"># keep only odd length keys</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">filtered_dict</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;bb&#39;</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="s1">&#39;ccc&#39;</span><span class="p">:</span> <span class="s1">&#39;a string&#39;</span><span class="p">,</span> <span class="s1">&#39;dddd&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]})</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[&#39;a&#39;, &#39;ccc&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;a&#39;</span> <span class="ow">in</span> <span class="n">s</span>  <span class="c1"># True because odd (length) key</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;bb&#39;</span> <span class="ow">in</span> <span class="n">s</span>  <span class="c1"># False because odd (length) key</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bb&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="go">[&#39;a&#39;, &#39;ccc&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="go">[1, &#39;a string&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;a&#39;, 1), (&#39;ccc&#39;, &#39;a string&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bb&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;a&#39;, 1), (&#39;ccc&#39;, &#39;a string&#39;), (&#39;x&#39;, 10)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">s</span><span class="p">[</span><span class="s1">&#39;xx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not an odd key&#39;</span>
<span class="gp">... </span>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This should have failed&quot;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">pass</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.trans.filtered_iter">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">filtered_iter</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">filt</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>callable<span class="p">, </span>collections.abc.Iterable<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">store</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">__module__</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/trans.html#filtered_iter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.filtered_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a wrapper that will transform a store (class or instance thereof) into a sub-store (i.e. subset of keys).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filt</strong> – A callable or iterable:
callable: Boolean filter function. A func taking a key and and returns True iff the key should be included.
iterable: The collection of keys you want to filter “in”</p></li>
<li><p><strong>name</strong> – The name to give the wrapped class</p></li>
</ul>
</dd>
</dl>
<p>Returns: A wrapper (that then needs to be applied to a store instance or class.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">filtered_dict</span> <span class="o">=</span> <span class="n">filtered_iter</span><span class="p">(</span><span class="n">filt</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)(</span><span class="nb">dict</span><span class="p">)</span>  <span class="c1"># keep only odd length keys</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">filtered_dict</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;bb&#39;</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="s1">&#39;ccc&#39;</span><span class="p">:</span> <span class="s1">&#39;a string&#39;</span><span class="p">,</span> <span class="s1">&#39;dddd&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]})</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[&#39;a&#39;, &#39;ccc&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;a&#39;</span> <span class="ow">in</span> <span class="n">s</span>  <span class="c1"># True because odd (length) key</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;bb&#39;</span> <span class="ow">in</span> <span class="n">s</span>  <span class="c1"># False because odd (length) key</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bb&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="go">[&#39;a&#39;, &#39;ccc&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="go">[1, &#39;a string&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;a&#39;, 1), (&#39;ccc&#39;, &#39;a string&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bb&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;a&#39;, 1), (&#39;ccc&#39;, &#39;a string&#39;), (&#39;x&#39;, 10)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">s</span><span class="p">[</span><span class="s1">&#39;xx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not an odd key&#39;</span>
<span class="gp">... </span>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This should have failed&quot;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">pass</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.trans.insert_aliases">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">insert_aliases</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">store</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">write</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">read</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">delete</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">list</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">count</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/trans.html#insert_aliases"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.insert_aliases" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert method aliases of CRUD operations of a store (class or instance).
If store is a class, you’ll get a copy of the class with those methods added.
If store is an instance, the methods will be added in place (no copy will be made).</p>
<p>Note: If an operation (write, read, delete, list, count) is not specified, no alias will be created for
that operation.</p>
<p>IMPORTANT NOTE: The signatures of the methods the aliases will point to will not change.
We say this because, you can call the write method “dump”, but you’ll have to use it as
<cite>store.dump(key, val)</cite>, not <cite>store.dump(val, key)</cite>, which is the signature you’re probably used to
(it’s the one used by json.dump or pickle.dump for example). If you want that familiar interface,
using the insert_load_dump_aliases function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store</strong> – The store to extend with aliases.</p></li>
<li><p><strong>write</strong> – Desired method name for __setitem__</p></li>
<li><p><strong>read</strong> – Desired method name for __getitem__</p></li>
<li><p><strong>delete</strong> – Desired method name for __delitem__</p></li>
<li><p><strong>list</strong> – Desired method name for __iter__</p></li>
<li><p><strong>count</strong> – Desired method name for __len__</p></li>
</ul>
</dd>
</dl>
<p>Returns: A store with the desired aliases.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Example of extending a class</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydict</span> <span class="o">=</span> <span class="n">insert_aliases</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="s1">&#39;dump&#39;</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="s1">&#39;rm&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="o">=</span><span class="s1">&#39;peek&#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="s1">&#39;size&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">mydict</span><span class="p">(</span><span class="n">true</span><span class="o">=</span><span class="s1">&#39;love&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;friends&#39;</span><span class="p">,</span> <span class="s1">&#39;forever&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span>
<span class="go">{&#39;true&#39;: &#39;love&#39;, &#39;friends&#39;: &#39;forever&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;true&#39;</span><span class="p">)</span>
<span class="go">&#39;love&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">peek</span><span class="p">())</span>
<span class="go">[&#39;true&#39;, &#39;friends&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">rm</span><span class="p">(</span><span class="s1">&#39;true&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span>
<span class="go">{&#39;friends&#39;: &#39;forever&#39;}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Example of extending an instance</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">UserDict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">UserDict</span><span class="p">(</span><span class="n">true</span><span class="o">=</span><span class="s1">&#39;love&#39;</span><span class="p">)</span>  <span class="c1"># make (and instance) of a UserDict (can&#39;t modify a dict instance)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># make aliases of note that you don&#39;t need</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">insert_aliases</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="s1">&#39;put&#39;</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="s1">&#39;retrieve&#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="s1">&#39;num_of_items&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;friends&#39;</span><span class="p">,</span> <span class="s1">&#39;forever&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span>
<span class="go">{&#39;true&#39;: &#39;love&#39;, &#39;friends&#39;: &#39;forever&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="s1">&#39;true&#39;</span><span class="p">)</span>
<span class="go">&#39;love&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">num_of_items</span><span class="p">()</span>
<span class="go">2</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.trans.insert_load_dump_aliases">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">insert_load_dump_aliases</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">store</span></em>, <em class="sig-param"><span class="n">delete</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">list</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">count</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/trans.html#insert_load_dump_aliases"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.insert_load_dump_aliases" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert load and dump methods, with familiar dump(obj, location) signature.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store</strong> – The store to extend with aliases.</p></li>
<li><p><strong>delete</strong> – Desired method name for __delitem__</p></li>
<li><p><strong>list</strong> – Desired method name for __iter__</p></li>
<li><p><strong>count</strong> – Desired method name for __len__</p></li>
</ul>
</dd>
</dl>
<p>Returns: A store with the desired aliases.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mydict</span> <span class="o">=</span> <span class="n">insert_load_dump_aliases</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">mydict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="s1">&#39;love&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span>
<span class="go">{&#39;true&#39;: &#39;love&#39;}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.trans.kv_wrap">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">kv_wrap</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">trans_obj</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/trans.html#kv_wrap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.kv_wrap" title="Permalink to this definition">¶</a></dt>
<dd><p>kv_wrap: A function that makes a wrapper (a decorator) that will get the wrappers from methods of the input object.</p>
<dl class="simple">
<dt>kv_wrap also has attributes:</dt><dd><p>outcoming_keys, ingoing_keys, outcoming_vals, ingoing_vals, and val_reads_wrt_to_keys</p>
</dd>
</dl>
<p>which will only add a single specific wrapper (specified as a function), when that’s what you need.</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.trans.kv_wrap_persister_cls">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">kv_wrap_persister_cls</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">persister_cls</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/trans.html#kv_wrap_persister_cls"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.kv_wrap_persister_cls" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a class that wraps a persister into a py2store.base.Store,</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>persister_cls</strong> – The persister class to wrap</p>
</dd>
</dl>
<p>Returns: A Store wrapping the persister (see py2store.base)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">kv_wrap_persister_cls</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;two&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;three&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;one&#39;, 1), (&#39;two&#39;, 2), (&#39;three&#39;, 3)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span>  <span class="c1"># looks like a dict, but is not:</span>
<span class="go">&lt;class &#39;abc.dictPWrapped&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;_obj_of_data&#39;</span><span class="p">)</span>  <span class="c1"># for example, it has this magic method</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># If you overwrite the _obj_of_data method, you&#39;ll transform outcomming values with it.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># For example, say the data you stored were minutes, but you want to get then in secs...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">_obj_of_data</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">data</span> <span class="o">*</span> <span class="mi">60</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;one&#39;, 60), (&#39;two&#39;, 120), (&#39;three&#39;, 180)]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># And if you want to have class that has this weird &quot;store minutes, retrieve seconds&quot;, you can do this:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">kv_wrap_persister_cls</span><span class="p">(</span><span class="nb">dict</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_obj_of_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">data</span> <span class="o">*</span> <span class="mi">60</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">B</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;one&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>  <span class="c1"># you can write several key-value pairs at once this way!</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;one&#39;, 60), (&#39;two&#39;, 120), (&#39;three&#39;, 180)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Warning! Advanced under-the-hood chat coming up.... Note this:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">{&#39;one&#39;: 1, &#39;two&#39;: 2, &#39;three&#39;: 3}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># What?!? Well, remember, printing an object calls the objects __str__, which usually calls __repr__</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># The wrapper doesn&#39;t wrap those methods, since they don&#39;t have consistent behaviors.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Here you&#39;re getting the __repr__ of the underlying dict store, without the key and value transforms.</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Say you wanted to transform the incoming minute-unit data, converting to secs BEFORE they were stored...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">kv_wrap_persister_cls</span><span class="p">(</span><span class="nb">dict</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_data_of_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">obj</span> <span class="o">*</span> <span class="mi">60</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">C</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">one</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">two</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">three</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># yet another way you can write multiple key-vals at once</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;one&#39;, 60), (&#39;two&#39;, 120), (&#39;three&#39;, 180)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>  <span class="c1"># but notice that unlike when we printed b, here the stored data is actually transformed!</span>
<span class="go">{&#39;one&#39;: 60, &#39;two&#39;: 120, &#39;three&#39;: 180}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Now, just to demonstrate key transformation, let&#39;s say that we need internal (stored) keys to be upper case,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># but external (the keys you see when listed) ones to be lower case, for some reason...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="n">kv_wrap_persister_cls</span><span class="p">(</span><span class="nb">dict</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="n">_data_of_obj</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="n">obj</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>  <span class="c1"># to demonstrated another way of doing this</span>
<span class="gp">... </span>    <span class="n">_key_of_id</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_id</span><span class="p">:</span> <span class="n">_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="c1"># note if you don&#39;t specify staticmethod, 1st arg must be self</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_id_of_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>  <span class="c1"># a function definition like you&#39;re used to</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">D</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;oNe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">TwO</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">tHrEE</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>  <span class="c1"># you see clean lower cased keys at the interface of the store</span>
<span class="go">[(&#39;one&#39;, 60), (&#39;two&#39;, 120), (&#39;three&#39;, 180)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># but internally, the keys are all upper case</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>  <span class="c1"># equivalent to print(d.store), so keys and values not wrapped (values were transformed before stored)</span>
<span class="go">{&#39;ONE&#39;: 60, &#39;TWO&#39;: 120, &#39;THREE&#39;: 180}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># On the other hand, careful, if you gave the data directly to D, you wouldn&#39;t get that.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">D</span><span class="p">({</span><span class="s1">&#39;one&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="go">{&#39;one&#39;: 1, &#39;two&#39;: 2, &#39;three&#39;: 3}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Thus is because when you construct a D with the dict, it initializes the dicts data with it directly</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># before the key/val transformers are in place to do their jobs.</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.trans.mk_kv_reader_from_kv_collection">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">mk_kv_reader_from_kv_collection</code><span class="sig-paren">(</span><em class="sig-param">kv_collection</em>, <em class="sig-param">name=None</em>, <em class="sig-param">getitem=&lt;function transparent_key_method&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/trans.html#mk_kv_reader_from_kv_collection"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.mk_kv_reader_from_kv_collection" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a KvReader class from a Collection class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kv_collection</strong> – The Collection class</p></li>
<li><p><strong>name</strong> – The name to give the KvReader class (by default, it will be kv_collection.__qualname__ + ‘Reader’)</p></li>
<li><p><strong>getitem</strong> – The method that will be assigned to __getitem__. Should have the (self, k) signature.
By default, getitem will be transparent_key_method, returning the key as is.
This default is useful when you want to delegate the actual getting to a _obj_of_data wrapper.</p></li>
</ul>
</dd>
</dl>
<p>Returns: A KvReader class that subclasses the input kv_collection</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.trans.mk_trans_obj">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">mk_trans_obj</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/trans.html#mk_trans_obj"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.mk_trans_obj" title="Permalink to this definition">¶</a></dt>
<dd><p>Convenience method to quickly make a trans_obj (just an object holding some trans functions</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.trans.mk_wrapper">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">mk_wrapper</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">wrap_cls</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/trans.html#mk_wrapper"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.mk_wrapper" title="Permalink to this definition">¶</a></dt>
<dd><p>You have a wrapper class and you want to make a wrapper out of it,
that is, a decorator factory with which you can make wrappers, like this:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">wrapper</span> <span class="pre">=</span> <span class="pre">mk_wrapper(wrap_cls)</span>
<span class="pre">`</span></code>
that you can then use to transform stores like thiis:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">MyStore</span> <span class="pre">=</span> <span class="pre">wrapper(**wrapper_kwargs)(StoreYouWantToTransform)</span>
<span class="pre">`</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>wrap_cls</strong> – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">RelPath</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_root_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_key_of_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_id</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">_id</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_root_length</span><span class="p">:]</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_id_of_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="n">k</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">relpath_wrap</span> <span class="o">=</span> <span class="n">mk_wrapper</span><span class="p">(</span><span class="n">RelPath</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">RelDict</span> <span class="o">=</span> <span class="n">relpath_wrap</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s1">&#39;foo/&#39;</span><span class="p">)(</span><span class="nb">dict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">RelDict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">42</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;{&#39;foo/bar&#39;: 42}&quot;</span>  <span class="c1"># reveals that actually, behind the scenes, there&#39;s a &quot;foo/&quot; prefix</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.trans.store_decorator">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">store_decorator</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/trans.html#store_decorator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.store_decorator" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper to make store decorators.</p>
<p>You provide a class-decorating function <code class="docutils literal notranslate"><span class="pre">func</span></code> that takes a store type (and possibly additional params)
and returns another decorated store type.</p>
<p><code class="docutils literal notranslate"><span class="pre">store_decorator</span></code> takes that <code class="docutils literal notranslate"><span class="pre">func</span></code> and provides an enhanced class decorator specialized for stores.
Namely it will:
- Add <code class="docutils literal notranslate"><span class="pre">__module__</span></code>, <code class="docutils literal notranslate"><span class="pre">__qualname__</span></code>, <code class="docutils literal notranslate"><span class="pre">__name__</span></code> and <code class="docutils literal notranslate"><span class="pre">__doc__</span></code> arguments to it
- Copy the aforementioned arguments to the decorated class, or copy the attributes of the original if not specified.
- Output a decorator that can be used in four different ways: a class/instance decorator/factory.</p>
<p>By class/instance decorator/factory we mean that if <code class="docutils literal notranslate"><span class="pre">A</span></code> is a class, <code class="docutils literal notranslate"><span class="pre">a</span></code> an instance of it,
and <code class="docutils literal notranslate"><span class="pre">deco</span></code> a decorator obtained with <code class="docutils literal notranslate"><span class="pre">store_decorator(func)</span></code>,
we can use <code class="docutils literal notranslate"><span class="pre">deco</span></code> to
- class decorator: decorate a class
- class decorator factory: make a function that decorates classes
- instance decorator: decorate an instance of a store
- instancce decorator factor: make a function that decorates instances of stores</p>
<p>For example, say we have the following <code class="docutils literal notranslate"><span class="pre">deco</span></code> that we made with <code class="docutils literal notranslate"><span class="pre">store_decorator</span></code>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@store_decorator</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">deco</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>    <span class="c1"># do stuff to cls, or a copy of it...</span>
<span class="gp">... </span>    <span class="bp">cls</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>  <span class="c1"># like this for example</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="bp">cls</span>
</pre></div>
</div>
<p>And a class that has nothing to it:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span> <span class="o">...</span>
</pre></div>
</div>
<p>Nammely, it doesn’t have an <code class="docutils literal notranslate"><span class="pre">x</span></code></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">hasattr</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="go">False</span>
</pre></div>
</div>
<p>We make a <code class="docutils literal notranslate"><span class="pre">decorated_A</span></code> with <code class="docutils literal notranslate"><span class="pre">deco</span></code> (class decorator example)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">deco</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="go">&lt;class &#39;trans.A&#39;&gt;</span>
</pre></div>
</div>
<p>and we see that we now have an <code class="docutils literal notranslate"><span class="pre">x</span></code> and it’s 42</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">hasattr</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="o">.</span><span class="n">x</span>
<span class="go">42</span>
</pre></div>
</div>
<p>But we could have also made a factory to decorate <code class="docutils literal notranslate"><span class="pre">A</span></code> and anything else that comes our way.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">paint_it_42</span> <span class="o">=</span> <span class="n">deco</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">decorated_A</span> <span class="o">=</span> <span class="n">paint_it_42</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">decorated_A</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="mi">42</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">B</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;destined to disappear&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">paint_it_42</span><span class="p">(</span><span class="n">B</span><span class="p">)</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="mi">42</span>
</pre></div>
</div>
<p>To be fair though, you’ll probably see the factory usage appear in the following form,
where the class is decorated at definition time.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@deco</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="gp">... </span><span class="k">class</span> <span class="nc">B</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">B</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="mi">42</span>
</pre></div>
</div>
<p>If your exists already, and you want to keep it as is (with the same name), you can
use subclassing to transform a copy of <code class="docutils literal notranslate"><span class="pre">A</span></code> instead, as below.
Also note in the following example, that <code class="docutils literal notranslate"><span class="pre">deco</span></code> was used without parentheses,
which is equivalent to <code class="docutils literal notranslate"><span class="pre">&#64;deco()</span></code>,
and yes, store_decorator makes that possible to, as long as your params have defaults</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@deco</span>
<span class="gp">... </span><span class="k">class</span> <span class="nc">decorated_A</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">decorated_A</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">A</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="mi">42</span>
</pre></div>
</div>
<p>Finally, you can also decorate instances:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">hasattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">deco</span><span class="p">(</span><span class="n">a</span><span class="p">);</span> <span class="k">assert</span> <span class="n">b</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="mi">1</span><span class="p">;</span> <span class="c1"># b has an x and it&#39;s 1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">deco</span><span class="p">()(</span><span class="n">a</span><span class="p">);</span> <span class="k">assert</span> <span class="n">b</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="mi">1</span><span class="p">;</span> <span class="c1"># b has an x and it&#39;s 1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">deco</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">42</span><span class="p">);</span> <span class="k">assert</span> <span class="n">b</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="mi">42</span>  <span class="c1"># b has an x and it&#39;s 42</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">deco</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">42</span><span class="p">)(</span><span class="n">a</span><span class="p">);</span> <span class="k">assert</span> <span class="n">b</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="mi">42</span><span class="p">;</span> <span class="c1"># b has an x and it&#39;s 42</span>
</pre></div>
</div>
<p>WARNING: Note though that the type of <code class="docutils literal notranslate"><span class="pre">b</span></code> is not the same type as <code class="docutils literal notranslate"><span class="pre">a</span></code>
&gt;&gt;&gt; isinstance(b, a.__class__)
False</p>
<p>No, <code class="docutils literal notranslate"><span class="pre">b</span></code> is an instance of a <code class="docutils literal notranslate"><span class="pre">py2store.base.Store</span></code>, which is a class containing an
instance of a store (here, <code class="docutils literal notranslate"><span class="pre">a</span></code>).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">&lt;class &#39;py2store.base.Store&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">store</span> <span class="o">==</span> <span class="n">a</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Now, here’s some more example, slightly closer to real usage</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store.trans</span> <span class="kn">import</span> <span class="n">store_decorator</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">signature</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">rm_deletion</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Deletions not allowed.&#39;</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">store</span><span class="p">,</span> <span class="s1">&#39;__name__&#39;</span><span class="p">,</span> <span class="s1">&#39;Something&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_w_sommething&#39;</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">store</span><span class="p">,</span> <span class="nb">type</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Should be a type, was </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">store</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">store</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="gp">... </span>    <span class="n">wrapped_store</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">store</span><span class="p">,),</span> <span class="p">{})</span>
<span class="gp">... </span>    <span class="n">wrapped_store</span><span class="o">.</span><span class="fm">__delitem__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="n">msg</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">wrapped_store</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">remove_deletion</span> <span class="o">=</span> <span class="n">store_decorator</span><span class="p">(</span><span class="n">rm_deletion</span><span class="p">)</span>
</pre></div>
</div>
<p>See how the signature of the wrapper has some extra inputs that were injected (__module__, __qualname__, etc.):</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">remove_deletion</span><span class="p">)))</span>
<span class="go">(store=None, *, msg=&#39;Deletions not allowed.&#39;, __module__=None, __name__=None, __qualname__=None, __doc__=None, __annotations__=None, __defaults__=None, __kwdefaults__=None)</span>
</pre></div>
</div>
<p>Using it as a class decorator factory (the most common way):</p>
<p>As a class decorator “factory”, without parameters (and without ()):</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">UserDict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@remove_deletion</span>
<span class="gp">... </span><span class="k">class</span> <span class="nc">WD</span><span class="p">(</span><span class="n">UserDict</span><span class="p">):</span>
<span class="gp">... </span>    <span class="s2">&quot;Here&#39;s the doc&quot;</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wd</span> <span class="o">=</span> <span class="n">WD</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">wd</span> <span class="o">==</span> <span class="n">UserDict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># same as far as dict comparison goes</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">wd</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Deletions not allowed.&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">wd</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">==</span> <span class="s2">&quot;Here&#39;s the doc&quot;</span>
</pre></div>
</div>
<p>As a class decorator “factory”, with parameters:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@remove_deletion</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;No way. I do not trust you!!&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">class</span> <span class="nc">WD</span><span class="p">(</span><span class="n">UserDict</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wd</span> <span class="o">=</span> <span class="n">WD</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">wd</span> <span class="o">==</span> <span class="n">UserDict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># same as far as dict comparison goes</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">wd</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;No way. I do not trust you!!&#39;</span>
</pre></div>
</div>
<p>The __doc__ is empty:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">WD</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">==</span> <span class="kc">None</span>
</pre></div>
</div>
<p>But we could specify a doc if we wanted to:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@remove_deletion</span><span class="p">(</span><span class="vm">__doc__</span><span class="o">=</span><span class="s2">&quot;Hi, I&#39;m a doc.&quot;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">class</span> <span class="nc">WD</span><span class="p">(</span><span class="n">UserDict</span><span class="p">):</span>
<span class="gp">... </span>    <span class="s2">&quot;This is the original doc, that will be overritten&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">WD</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">==</span> <span class="s2">&quot;Hi, I&#39;m a doc.&quot;</span>
</pre></div>
</div>
<p>The class decorations above are equivalent to the two following:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">WD</span> <span class="o">=</span> <span class="n">remove_deletion</span><span class="p">(</span><span class="n">UserDict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wd</span> <span class="o">=</span> <span class="n">WD</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">wd</span> <span class="o">==</span> <span class="n">UserDict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># same as far as dict comparison goes</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">wd</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Deletions not allowed.&#39;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">WD</span> <span class="o">=</span> <span class="n">remove_deletion</span><span class="p">(</span><span class="n">UserDict</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;No way. I do not trust you!!&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wd</span> <span class="o">=</span> <span class="n">WD</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">wd</span> <span class="o">==</span> <span class="n">UserDict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># same as far as dict comparison goes</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">wd</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;No way. I do not trust you!!&#39;</span>
</pre></div>
</div>
<p>But we can also decorate instances. In this case they will be wrapped in a Store class
before being passed on to the actual decorator.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">UserDict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wd</span> <span class="o">=</span> <span class="n">remove_deletion</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">wd</span> <span class="o">==</span> <span class="n">d</span>  <span class="c1"># same as far as dict comparison goes</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">wd</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Deletions not allowed.&#39;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">UserDict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wd</span> <span class="o">=</span> <span class="n">remove_deletion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;No way. I do not trust you!!&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">wd</span> <span class="o">==</span> <span class="n">d</span>  <span class="c1"># same as far as dict comparison goes</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">wd</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;No way. I do not trust you!!&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.trans.wrap_kvs">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">wrap_kvs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">store</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">key_of_id</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">id_of_key</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">obj_of_data</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">data_of_obj</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">preset</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">postget</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">__module__</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">outcoming_key_methods</span><span class="o">=</span><span class="default_value">()</span></em>, <em class="sig-param"><span class="n">outcoming_value_methods</span><span class="o">=</span><span class="default_value">()</span></em>, <em class="sig-param"><span class="n">ingoing_key_methods</span><span class="o">=</span><span class="default_value">()</span></em>, <em class="sig-param"><span class="n">ingoing_value_methods</span><span class="o">=</span><span class="default_value">()</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/trans.html#wrap_kvs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.wrap_kvs" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a Store that is wrapped with the given key/val transformers.</p>
<dl class="simple">
<dt>Naming convention:</dt><dd><dl class="simple">
<dt>Morphemes:</dt><dd><p>key: outer key
_id: inner key
obj: outer value
data: inner value</p>
</dd>
<dt>Grammar:</dt><dd><p>Y_of_X: means that you get a Y output when giving an X input. Also known as X_to_Y.</p>
</dd>
</dl>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store</strong> – Store class or instance</p></li>
<li><p><strong>name</strong> – Name to give the wrapper class</p></li>
<li><p><strong>key_of_id</strong> – The outcoming key transformation function.
Forms are <cite>k = key_of_id(_id)</cite> or <cite>k = key_of_id(self, _id)</cite></p></li>
<li><p><strong>id_of_key</strong> – The ingoing key transformation function.
Forms are <cite>_id = id_of_key(k)</cite> or <cite>_id = id_of_key(self, k)</cite></p></li>
<li><p><strong>obj_of_data</strong> – The outcoming val transformation function.
Forms are <cite>obj = obj_of_data(data)</cite> or <cite>obj = obj_of_data(self, data)</cite></p></li>
<li><p><strong>data_of_obj</strong> – The ingoing val transformation function.
Forms are <cite>data = data_of_obj(obj)</cite> or <cite>data = data_of_obj(self, obj)</cite></p></li>
<li><p><strong>preset</strong> – <p>A function that is called before doing a <cite>__setitem__</cite>.
The function is called with both <cite>k</cite> and <cite>v</cite> as inputs, and should output a transformed value.
The intent use is to do ingoing value transformations conditioned on the key.
For example, you may want to serialize an object depending on if you’re writing to a</p>
<blockquote>
<div><p>’.csv’, or ‘.json’, or ‘.pickle’ file.</p>
</div></blockquote>
<p>Forms are <cite>preset(k, obj)</cite> or <cite>preset(self, k, obj)</cite></p>
</p></li>
<li><p><strong>postget</strong> – A function that is called after the value <cite>v</cite> for a key <cite>k</cite> is be <cite>__getitem__</cite>.
The function is called with both <cite>k</cite> and <cite>v</cite> as inputs, and should output a transformed value.
The intent use is to do outcoming value transformations conditioned on the key.
We already have <cite>obj_of_data</cite> for outcoming value trans, but cannot condition it’s behavior on k.
For example, you may want to deserialize the bytes of a ‘.csv’, or ‘.json’, or ‘.pickle’ in different ways.
Forms are <cite>obj = postget(k, data)</cite> or <cite>obj = postget(self, k, data)</cite></p></li>
</ul>
</dd>
</dl>
<p>Returns:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">key_of_id</span><span class="p">(</span><span class="n">_id</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">_id</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">id_of_key</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">obj_of_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">data</span> <span class="o">-</span> <span class="mi">100</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">data_of_obj</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">obj</span> <span class="o">+</span> <span class="mi">100</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">wrap_kvs</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">key_of_id</span><span class="o">=</span><span class="n">key_of_id</span><span class="p">,</span> <span class="n">id_of_key</span><span class="o">=</span><span class="n">id_of_key</span><span class="p">,</span> <span class="n">obj_of_data</span><span class="o">=</span><span class="n">obj_of_data</span><span class="p">,</span> <span class="n">data_of_obj</span><span class="o">=</span><span class="n">data_of_obj</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;KEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>  <span class="c1"># repr is just the base class (dict) repr, so shows &quot;inside&quot; the store (lower case keys and +100)</span>
<span class="go">{&#39;key&#39;: 101}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># repr is just the base class (dict) repr, so shows &quot;inside&quot; the store (lower case keys and +100)</span>
<span class="go">{&#39;key&#39;: 102}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;kEy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>  <span class="c1"># repr is just the base class (dict) repr, so shows &quot;inside&quot; the store (lower case keys and +100)</span>
<span class="go">{&#39;key&#39;: 103}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># but from the point of view of the interface the keys are all upper case</span>
<span class="go">[&#39;KEY&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>  <span class="c1"># and the values are those we put there.</span>
<span class="go">[(&#39;KEY&#39;, 3)]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># And now this: Showing how to condition the value transform (like obj_of_data), but conditioned on key.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">wrap_kvs</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">postget</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;upper </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;lower </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">B</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="s1">&#39;BIG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;letters&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="s1">&#39;small&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;BIG&#39;, &#39;upper letters&#39;), (&#39;small&#39;, &#39;lower text&#39;)]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Let&#39;s try preset and postget. We&#39;ll wrap a dict and write the same list of lists object to</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># keys ending with .csv, .json, and .pkl, specifying the obvious extension-dependent</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># serialization/deserialization we want to associate with it.</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># First, some very simple csv transformation functions</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">to_csv</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">LoL</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">L</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">L</span><span class="p">),</span> <span class="n">LoL</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">from_csv</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">csv</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">),</span> <span class="n">csv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">LoL</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">],[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">from_csv</span><span class="p">(</span><span class="n">to_csv</span><span class="p">(</span><span class="n">LoL</span><span class="p">))</span> <span class="o">==</span> <span class="n">LoL</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">pickle</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">preset</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">to_csv</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">elif</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">elif</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.pkl&#39;</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">v</span>  <span class="c1"># as is</span>
<span class="gp">...</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">postget</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">from_csv</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">elif</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">elif</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.pkl&#39;</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">v</span>  <span class="c1"># as is</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydict</span> <span class="o">=</span> <span class="n">wrap_kvs</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">preset</span><span class="o">=</span><span class="n">preset</span><span class="p">,</span> <span class="n">postget</span><span class="o">=</span><span class="n">postget</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">],[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">mydict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;foo.csv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>  <span class="c1"># store the object as csv</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>  <span class="c1"># &quot;printing&quot; a dict by-passes the transformations, so we see the data in the &quot;raw&quot; format it is stored in.</span>
<span class="go">{&#39;foo.csv&#39;: &#39;a,b,c\\nd,e,f&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;foo.csv&#39;</span><span class="p">]</span>  <span class="c1"># but if we actually ask for the data, it deserializes to our original object</span>
<span class="go">[[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;], [&#39;d&#39;, &#39;e&#39;, &#39;f&#39;]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;bar.json&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>  <span class="c1"># store the object as json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>
<span class="go">{&#39;foo.csv&#39;: &#39;a,b,c\\nd,e,f&#39;, &#39;bar.json&#39;: &#39;[[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;], [&quot;d&quot;, &quot;e&quot;, &quot;f&quot;]]&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;bar.json&#39;</span><span class="p">]</span>
<span class="go">[[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;], [&#39;d&#39;, &#39;e&#39;, &#39;f&#39;]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;bar.json&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="s1">&#39;normal json&#39;</span><span class="p">}</span>  <span class="c1"># let&#39;s write a normal json instead.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>
<span class="go">{&#39;foo.csv&#39;: &#39;a,b,c\\nd,e,f&#39;, &#39;bar.json&#39;: &#39;{&quot;a&quot;: 1, &quot;b&quot;: [1, 2], &quot;c&quot;: &quot;normal json&quot;}&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;foo.csv&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;bar.json&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;foo.pkl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>  <span class="c1"># &#39;save&#39; obj as pickle</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;foo.pkl&#39;</span><span class="p">]</span>
<span class="go">[[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;], [&#39;d&#39;, &#39;e&#39;, &#39;f&#39;]]</span>
</pre></div>
</div>
<p># TODO: Add tests for outcoming_key_methods etc.</p>
</dd></dl>

</div>
<div class="section" id="module-py2store.key_mappers.str_utils">
<span id="py2store-key-mappers-str-utils"></span><h1>py2store.key_mappers.str_utils<a class="headerlink" href="#module-py2store.key_mappers.str_utils" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt id="py2store.key_mappers.str_utils.args_and_kwargs_indices">
<code class="sig-prename descclassname">py2store.key_mappers.str_utils.</code><code class="sig-name descname">args_and_kwargs_indices</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">format_string</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/str_utils.html#args_and_kwargs_indices"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.str_utils.args_and_kwargs_indices" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the sets of indices and names used in manual specification of format strings, or None, None if auto spec.
:param format_string: A format string (i.e. a string with {…} to mark parameter placement and formatting</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>None, None if format_string is an automatic specification
set_of_indices_used, set_of_fields_used if it is a manual specification</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">format_string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> (no 1) </span><span class="si">{2}</span><span class="s1">, </span><span class="si">{see}</span><span class="s1"> this, </span><span class="si">{0}</span><span class="s1"> is a duplicate (appeared before) and </span><span class="si">{name}</span><span class="s1"> is string-named&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">args_and_kwargs_indices</span><span class="p">(</span><span class="n">format_string</span><span class="p">)</span> <span class="o">==</span> <span class="p">({</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;see&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">format_string</span> <span class="o">=</span> <span class="s1">&#39;This is a format string with only automatic field specification: </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1"> etc.&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">args_and_kwargs_indices</span><span class="p">(</span><span class="n">format_string</span><span class="p">)</span>
<span class="go">(None, None)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.str_utils.auto_field_format_str">
<code class="sig-prename descclassname">py2store.key_mappers.str_utils.</code><code class="sig-name descname">auto_field_format_str</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">format_str</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/str_utils.html#auto_field_format_str"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.str_utils.auto_field_format_str" title="Permalink to this definition">¶</a></dt>
<dd><p>Get an auto field version of the format_str</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>format_str</strong> – A format string</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A transformed format_str that has no names {inside} {formatting} {braces}.</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">auto_field_format_str</span><span class="p">(</span><span class="s1">&#39;R/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{one}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">/</span><span class="si">{two}</span><span class="s1">/T&#39;</span><span class="p">)</span>
<span class="go">&#39;R/{}/{}/{}/{}/T&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.str_utils.compile_str_from_parsed">
<code class="sig-prename descclassname">py2store.key_mappers.str_utils.</code><code class="sig-name descname">compile_str_from_parsed</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">parsed</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/str_utils.html#compile_str_from_parsed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.str_utils.compile_str_from_parsed" title="Permalink to this definition">¶</a></dt>
<dd><p>The (quasi-)inverse of string.Formatter.parse.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>parsed</strong> – iterator of (literal_text, field_name, format_spec, conversion) tuples,</p></li>
<li><p><strong>yield by string.Formatter.parse</strong> (<em>as</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A format string that would produce such a parsed input.</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span>  <span class="s2">&quot;ROOT/</span><span class="si">{}</span><span class="s2">/</span><span class="si">{0!r}</span><span class="s2">/{1!i:format}/hello</span><span class="si">{:0.02f}</span><span class="s2">TAIL&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">compile_str_from_parsed</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">Formatter</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="o">==</span> <span class="n">s</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Or, if you want to see more details...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parsed</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">Formatter</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parsed</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="go">(&#39;ROOT/&#39;, &#39;&#39;, &#39;&#39;, None)</span>
<span class="go">(&#39;/&#39;, &#39;0&#39;, &#39;&#39;, &#39;r&#39;)</span>
<span class="go">(&#39;/&#39;, &#39;1&#39;, &#39;format&#39;, &#39;i&#39;)</span>
<span class="go">(&#39;/hello&#39;, &#39;&#39;, &#39;0.02f&#39;, None)</span>
<span class="go">(&#39;TAIL&#39;, None, None, None)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">compile_str_from_parsed</span><span class="p">(</span><span class="n">parsed</span><span class="p">)</span>
<span class="go">&#39;ROOT/{}/{0!r}/{1!i:format}/hello{:0.02f}TAIL&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.str_utils.format_params_in_str_format">
<code class="sig-prename descclassname">py2store.key_mappers.str_utils.</code><code class="sig-name descname">format_params_in_str_format</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">format_string</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/str_utils.html#format_params_in_str_format"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.str_utils.format_params_in_str_format" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the “parameter” indices/names of the format_string</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>format_string</strong> – A format string (i.e. a string with {…} to mark parameter placement and formatting</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list of parameter indices used in the format string, in the order they appear, with repetition.
Parameter indices could be integers, strings, or None (to denote “automatic field numbering”.</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">format_string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> (no 1) </span><span class="si">{2}</span><span class="s1">, and </span><span class="si">{0}</span><span class="s1"> is a duplicate, </span><span class="si">{}</span><span class="s1"> is unnamed and </span><span class="si">{name}</span><span class="s1"> is string-named&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">format_params_in_str_format</span><span class="p">(</span><span class="n">format_string</span><span class="p">)</span>
<span class="go">[0, 2, 0, None, &#39;name&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.str_utils.get_explicit_positions">
<code class="sig-prename descclassname">py2store.key_mappers.str_utils.</code><code class="sig-name descname">get_explicit_positions</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">parsed_str_format</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/str_utils.html#get_explicit_positions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.str_utils.get_explicit_positions" title="Permalink to this definition">¶</a></dt>
<dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parsed</span> <span class="o">=</span> <span class="n">parse_str_format</span><span class="p">(</span><span class="s2">&quot;all/</span><span class="si">{}</span><span class="s2">/is/</span><span class="si">{2}</span><span class="s2">/position/</span><span class="si">{except}{this}{0}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_explicit_positions</span><span class="p">(</span><span class="n">parsed</span><span class="p">)</span>
<span class="go">{0, 2}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.str_utils.is_automatic_format_params">
<code class="sig-prename descclassname">py2store.key_mappers.str_utils.</code><code class="sig-name descname">is_automatic_format_params</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">format_params</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/str_utils.html#is_automatic_format_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.str_utils.is_automatic_format_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Says if the format_params is from an automatic specification
See Also: is_manual_format_params and is_hybrid_format_params</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.str_utils.is_automatic_format_string">
<code class="sig-prename descclassname">py2store.key_mappers.str_utils.</code><code class="sig-name descname">is_automatic_format_string</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">format_string</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/str_utils.html#is_automatic_format_string"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.str_utils.is_automatic_format_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Says if the format_string is uses automatic specification
See Also: is_manual_format_params
&gt;&gt;&gt; is_automatic_format_string(‘Manual: indices: {1} {2}, named: {named} {fields}’)
False
&gt;&gt;&gt; is_automatic_format_string(‘Auto: only un-indexed and un-named: {} {}…’)
True
&gt;&gt;&gt; is_automatic_format_string(‘Hybrid: at least a {}, and a {0} or a {name}’)
False
&gt;&gt;&gt; is_manual_format_string(‘No formatting is both manual and automatic formatting!’)
True</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.str_utils.is_hybrid_format_params">
<code class="sig-prename descclassname">py2store.key_mappers.str_utils.</code><code class="sig-name descname">is_hybrid_format_params</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">format_params</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/str_utils.html#is_hybrid_format_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.str_utils.is_hybrid_format_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Says if the format_params is from a hybrid of auto and manual.
Note: Hybrid specifications are considered non-valid and can’t be formatted with format_string.format(…).
Yet, it can be useful for flexibility of expression (but will need to be resolved to be used).
See Also: is_manual_format_params and is_automatic_format_params</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.str_utils.is_hybrid_format_string">
<code class="sig-prename descclassname">py2store.key_mappers.str_utils.</code><code class="sig-name descname">is_hybrid_format_string</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">format_string</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/str_utils.html#is_hybrid_format_string"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.str_utils.is_hybrid_format_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Says if the format_params is from a hybrid of auto and manual.
Note: Hybrid specifications are considered non-valid and can’t be formatted with format_string.format(…).
Yet, it can be useful for flexibility of expression (but will need to be resolved to be used).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">is_hybrid_format_string</span><span class="p">(</span><span class="s1">&#39;Manual: indices: </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">, named: </span><span class="si">{named}</span><span class="s1"> </span><span class="si">{fields}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">is_hybrid_format_string</span><span class="p">(</span><span class="s1">&#39;Auto: only un-indexed and un-named: </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">...&#39;</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">is_hybrid_format_string</span><span class="p">(</span><span class="s1">&#39;Hybrid: at least a </span><span class="si">{}</span><span class="s1">, and a </span><span class="si">{0}</span><span class="s1"> or a </span><span class="si">{name}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">is_manual_format_string</span><span class="p">(</span><span class="s1">&#39;No formatting is both manual and automatic formatting (so hybrid is both)!&#39;</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.str_utils.is_manual_format_params">
<code class="sig-prename descclassname">py2store.key_mappers.str_utils.</code><code class="sig-name descname">is_manual_format_params</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">format_params</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/str_utils.html#is_manual_format_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.str_utils.is_manual_format_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Says if the format_params is from a manual specification
See Also: is_automatic_format_params</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.str_utils.is_manual_format_string">
<code class="sig-prename descclassname">py2store.key_mappers.str_utils.</code><code class="sig-name descname">is_manual_format_string</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">format_string</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/str_utils.html#is_manual_format_string"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.str_utils.is_manual_format_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Says if the format_string uses a manual specification
See Also: is_automatic_format_string and
&gt;&gt;&gt; is_manual_format_string(‘Manual: indices: {1} {2}, named: {named} {fields}’)
True
&gt;&gt;&gt; is_manual_format_string(‘Auto: only un-indexed and un-named: {} {}…’)
False
&gt;&gt;&gt; is_manual_format_string(‘Hybrid: at least a {}, and a {0} or a {name}’)
False
&gt;&gt;&gt; is_manual_format_string(‘No formatting is both manual and automatic formatting!’)
True</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.str_utils.manual_field_format_str">
<code class="sig-prename descclassname">py2store.key_mappers.str_utils.</code><code class="sig-name descname">manual_field_format_str</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">format_str</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/str_utils.html#manual_field_format_str"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.str_utils.manual_field_format_str" title="Permalink to this definition">¶</a></dt>
<dd><p>Get an auto field version of the format_str</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>format_str</strong> – A format string</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A transformed format_str that has no names {inside} {formatting} {braces}.</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">auto_field_format_str</span><span class="p">(</span><span class="s1">&#39;R/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{one}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">/</span><span class="si">{two}</span><span class="s1">/T&#39;</span><span class="p">)</span>
<span class="go">&#39;R/{}/{}/{}/{}/T&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.str_utils.n_format_params_in_str_format">
<code class="sig-prename descclassname">py2store.key_mappers.str_utils.</code><code class="sig-name descname">n_format_params_in_str_format</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">format_string</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/str_utils.html#n_format_params_in_str_format"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.str_utils.n_format_params_in_str_format" title="Permalink to this definition">¶</a></dt>
<dd><p>The number of parameters</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.str_utils.name_fields_in_format_str">
<code class="sig-prename descclassname">py2store.key_mappers.str_utils.</code><code class="sig-name descname">name_fields_in_format_str</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">format_str</span></em>, <em class="sig-param"><span class="n">field_names</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/str_utils.html#name_fields_in_format_str"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.str_utils.name_fields_in_format_str" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a manual field version of the format_str</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>format_str</strong> – A format string</p></li>
<li><p><strong>names</strong> – An iterable that produces enough strings to fill all of format_str fields</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A transformed format_str</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">name_fields_in_format_str</span><span class="p">(</span><span class="s1">&#39;R/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{one}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">/</span><span class="si">{two}</span><span class="s1">/T&#39;</span><span class="p">)</span>
<span class="go">&#39;R/{0}/{1}/{2}/{3}/T&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Note here that we use the field name to inject a field format as well</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">name_fields_in_format_str</span><span class="p">(</span><span class="s1">&#39;R/</span><span class="si">{foo}</span><span class="s1">/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">/T&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;42&#39;</span><span class="p">,</span> <span class="s1">&#39;hi:03.0f&#39;</span><span class="p">,</span> <span class="s1">&#39;world&#39;</span><span class="p">])</span>
<span class="go">&#39;R/{42}/{hi:03.0f}/{world}/T&#39;</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-py2store.key_mappers.tuples">
<span id="py2store-key-mappers-tuples"></span><h1>py2store.key_mappers.tuples<a class="headerlink" href="#module-py2store.key_mappers.tuples" title="Permalink to this headline">¶</a></h1>
<p>Tools to map tuple-structured keys.
That is, converting from any of the following kinds of keys:</p>
<blockquote>
<div><ul class="simple">
<li><p>tuples (or list-like)</p></li>
<li><p>dicts</p></li>
<li><p>formatted/templated strings</p></li>
<li><p>dsv (Delimiter-Separated Values)</p></li>
</ul>
</div></blockquote>
<dl class="py function">
<dt id="py2store.key_mappers.tuples.dsv_of_list">
<code class="sig-prename descclassname">py2store.key_mappers.tuples.</code><code class="sig-name descname">dsv_of_list</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">d</span></em>, <em class="sig-param"><span class="n">sep</span><span class="o">=</span><span class="default_value">','</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/tuples.html#dsv_of_list"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.tuples.dsv_of_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Converting a list of strings to a dsv (delimiter-separated values) string.</p>
<p>Note that unlike most key mappers, there is no schema imposing size here. If you wish to impose a size
validation, do so externally (we suggest using a decorator for that).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>d</strong> – A list of component strings</p></li>
<li><p><strong>sep</strong> – The delimiter text used to separate a string into a list of component strings</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The delimiter-separated values (dsv) string for the input tuple</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dsv_of_list</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="s1">&#39;fox&#39;</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="go">&#39;a brown fox&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dsv_of_list</span><span class="p">((</span><span class="s1">&#39;jumps&#39;</span><span class="p">,</span> <span class="s1">&#39;over&#39;</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>  <span class="c1"># for filepaths (and see that tuple inputs work too!)</span>
<span class="go">&#39;jumps/over&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dsv_of_list</span><span class="p">([</span><span class="s1">&#39;Sat&#39;</span><span class="p">,</span> <span class="s1">&#39;Jan&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;1983&#39;</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>  <span class="c1"># csv: the usual delimiter-separated values format</span>
<span class="go">&#39;Sat,Jan,1,1983&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dsv_of_list</span><span class="p">([</span><span class="s1">&#39;First&#39;</span><span class="p">,</span> <span class="s1">&#39;Last&#39;</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;:::&#39;</span><span class="p">)</span>  <span class="c1"># a longer delimiter</span>
<span class="go">&#39;First:::Last&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dsv_of_list</span><span class="p">([</span><span class="s1">&#39;singleton&#39;</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;@&#39;</span><span class="p">)</span>  <span class="c1"># when the list has only one element</span>
<span class="go">&#39;singleton&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dsv_of_list</span><span class="p">([],</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;@&#39;</span><span class="p">)</span>  <span class="c1"># when the list is empty</span>
<span class="go">&#39;&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.tuples.list_of_dsv">
<code class="sig-prename descclassname">py2store.key_mappers.tuples.</code><code class="sig-name descname">list_of_dsv</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">d</span></em>, <em class="sig-param"><span class="n">sep</span><span class="o">=</span><span class="default_value">','</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/tuples.html#list_of_dsv"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.tuples.list_of_dsv" title="Permalink to this definition">¶</a></dt>
<dd><p>Converting a dsv (delimiter-separated values) string to the list of it’s components.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>d</strong> – A (delimiter-separated values) string</p></li>
<li><p><strong>sep</strong> – The delimiter text used to separate the string into a list of component strings</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list of component strings corresponding to the input delimiter-separated values (dsv) string</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">list_of_dsv</span><span class="p">(</span><span class="s1">&#39;a brown fox&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="go">[&#39;a&#39;, &#39;brown&#39;, &#39;fox&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">tuple</span><span class="p">(</span><span class="n">list_of_dsv</span><span class="p">(</span><span class="s1">&#39;jumps/over&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>  <span class="c1"># for filepaths</span>
<span class="go">(&#39;jumps&#39;, &#39;over&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">list_of_dsv</span><span class="p">(</span><span class="s1">&#39;Sat,Jan,1,1983&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>  <span class="c1"># csv: the usual delimiter-separated values format</span>
<span class="go">[&#39;Sat&#39;, &#39;Jan&#39;, &#39;1&#39;, &#39;1983&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">list_of_dsv</span><span class="p">(</span><span class="s1">&#39;First:::Last&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;:::&#39;</span><span class="p">)</span>  <span class="c1"># a longer delimiter</span>
<span class="go">[&#39;First&#39;, &#39;Last&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">list_of_dsv</span><span class="p">(</span><span class="s1">&#39;singleton&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;@&#39;</span><span class="p">)</span>  <span class="c1"># when the list has only one element</span>
<span class="go">[&#39;singleton&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">list_of_dsv</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;@&#39;</span><span class="p">)</span>  <span class="c1"># when the string is empty</span>
<span class="go">[]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.tuples.mk_obj_of_str">
<code class="sig-prename descclassname">py2store.key_mappers.tuples.</code><code class="sig-name descname">mk_obj_of_str</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">constructor</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/tuples.html#mk_obj_of_str"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.tuples.mk_obj_of_str" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a function that transforms a string to an object. The factory making inverses of what mk_str_from_obj makes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>constructor</strong> – The function (or class) that will be used to make objects from the <a href="#id57"><span class="problematic" id="id58">**</span></a>kwargs parsed out of the
string.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A function factory.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.tuples.mk_str_of_obj">
<code class="sig-prename descclassname">py2store.key_mappers.tuples.</code><code class="sig-name descname">mk_str_of_obj</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">attrs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/tuples.html#mk_str_of_obj"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.tuples.mk_str_of_obj" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a function that transforms objects to strings, using specific attributes of object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>attrs</strong> – Attributes that should be read off of the object to make the parameters of the string</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A transformation function</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@dataclass</span>
<span class="gp">... </span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">foo</span><span class="p">:</span> <span class="nb">int</span>
<span class="gp">... </span>    <span class="n">bar</span><span class="p">:</span> <span class="nb">str</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="s1">&#39;rin&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">A(foo=0, bar=&#39;rin&#39;)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">str_from_obj</span> <span class="o">=</span> <span class="n">mk_str_of_obj</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">str_from_obj</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;ST</span><span class="si">{foo}</span><span class="s1">/</span><span class="si">{bar}</span><span class="s1">/G&#39;</span><span class="p">)</span>
<span class="go">&#39;ST0/rin/G&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.tuples.str_of_tuple">
<code class="sig-prename descclassname">py2store.key_mappers.tuples.</code><code class="sig-name descname">str_of_tuple</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">d</span></em>, <em class="sig-param"><span class="n">str_format</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/tuples.html#str_of_tuple"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.tuples.str_of_tuple" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert tuple to str.
It’s just str_format.format(<a href="#id59"><span class="problematic" id="id60">*</span></a>d). Why even write such a function?
(1) To have a consistent interface for key conversions
(2) We want a KeyValidationError to occur here
:param d: tuple if params to str_format
:param str_format: Auto fields format string. If you have manual fields, consider auto_field_format_str to convert.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>parametrized string</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">str_of_tuple</span><span class="p">((</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="s1">&#39;world&#39;</span><span class="p">),</span> <span class="s2">&quot;Well, </span><span class="si">{}</span><span class="s2"> dear </span><span class="si">{}</span><span class="s2">!&quot;</span><span class="p">)</span>
<span class="go">&#39;Well, hello dear world!&#39;</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-py2store.key_mappers.paths">
<span id="py2store-key-mappers-paths"></span><h1>py2store.key_mappers.paths<a class="headerlink" href="#module-py2store.key_mappers.paths" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.key_mappers.paths.KeyPath">
<em class="property">class </em><code class="sig-prename descclassname">py2store.key_mappers.paths.</code><code class="sig-name descname">KeyPath</code><span class="sig-paren">(</span><em class="sig-param">path_sep: str = '/'</em>, <em class="sig-param">_path_type: Union[type</em>, <em class="sig-param">callable] = &lt;class 'tuple'&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/paths.html#KeyPath"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.paths.KeyPath" title="Permalink to this definition">¶</a></dt>
<dd><p>A key mapper that converts from an iterable key (default tuple) to a string (given a path-separator str)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path_sep</strong> – The path separator (used to make string paths from iterable paths and visa versa</p></li>
<li><p><strong>_path_type</strong> – The type of the outcoming (inner) path. But really, any function to convert from a list to
the outer path type we want.</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Plays well with:</dt><dd><p>KeyPath</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">kp</span> <span class="o">=</span> <span class="n">KeyPath</span><span class="p">(</span><span class="n">path_sep</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kp</span><span class="o">.</span><span class="n">_key_of_id</span><span class="p">((</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">))</span>
<span class="go">&#39;a/b/c&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kp</span><span class="o">.</span><span class="n">_id_of_key</span><span class="p">(</span><span class="s1">&#39;a/b/c&#39;</span><span class="p">)</span>
<span class="go">(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kp</span> <span class="o">=</span> <span class="n">KeyPath</span><span class="p">(</span><span class="n">path_sep</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kp</span><span class="o">.</span><span class="n">_key_of_id</span><span class="p">((</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">))</span>
<span class="go">&#39;a.b.c&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kp</span><span class="o">.</span><span class="n">_id_of_key</span><span class="p">(</span><span class="s1">&#39;a.b.c&#39;</span><span class="p">)</span>
<span class="go">(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kp</span> <span class="o">=</span> <span class="n">KeyPath</span><span class="p">(</span><span class="n">path_sep</span><span class="o">=</span><span class="s1">&#39;:::&#39;</span><span class="p">,</span> <span class="n">_path_type</span><span class="o">=</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_id</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_id</span>
<span class="go">{&#39;a&#39;: None, &#39;b&#39;: None, &#39;c&#39;: None}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kp</span><span class="o">.</span><span class="n">_key_of_id</span><span class="p">(</span><span class="n">_id</span><span class="p">)</span>
<span class="go">&#39;a:::b:::c&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kp</span><span class="o">.</span><span class="n">_id_of_key</span><span class="p">(</span><span class="s1">&#39;a:::b:::c&#39;</span><span class="p">)</span>
<span class="go">{&#39;a&#39;: None, &#39;b&#39;: None, &#39;c&#39;: None}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.key_mappers.paths.PathGetMixin">
<em class="property">class </em><code class="sig-prename descclassname">py2store.key_mappers.paths.</code><code class="sig-name descname">PathGetMixin</code><a class="reference internal" href="_modules/py2store/key_mappers/paths.html#PathGetMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.paths.PathGetMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Mixin allows you to access nested stores through a path of keys.
That is, give you a path_store from a store, such that:
<a href="#id61"><span class="problematic" id="id62">``</span></a><a href="#id63"><span class="problematic" id="id64">`</span></a></p>
<blockquote>
<div><p>path_store[‘a’,’b’,’c’] == store[‘a’][‘b’][‘c’]</p>
</div></blockquote>
<p><a href="#id65"><span class="problematic" id="id66">``</span></a>`
The mixin will check if the key is of the path type (by default <cite>tuple</cite>), and if it is, it will iterate through
the path, recursively getting the elements.</p>
<dl class="simple">
<dt>Plays well with:</dt><dd><p>KeyPath</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">P</span><span class="p">(</span><span class="n">PathGetMixin</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">P</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">}}})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="go">{&#39;b&#39;: {&#39;c&#39;: 42}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="go">{&#39;c&#39;: 42}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span>
<span class="go">42</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store</span> <span class="kn">import</span> <span class="n">kv_wrap</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">P</span><span class="p">(</span><span class="n">PathGetMixin</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">PP</span> <span class="o">=</span> <span class="n">kv_wrap</span><span class="p">(</span><span class="n">KeyPath</span><span class="p">(</span><span class="n">path_sep</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">))(</span><span class="n">P</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">PP</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">}}})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a.b&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a.b.c&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">42</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="py2store.key_mappers.paths.PathKeyTypes">
<em class="property">class </em><code class="sig-prename descclassname">py2store.key_mappers.paths.</code><code class="sig-name descname">PathKeyTypes</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/paths.html#PathKeyTypes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.paths.PathKeyTypes" title="Permalink to this definition">¶</a></dt>
<dd><p>An enumeration.</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.key_mappers.paths.PrefixRelativizationMixin">
<em class="property">class </em><code class="sig-prename descclassname">py2store.key_mappers.paths.</code><code class="sig-name descname">PrefixRelativizationMixin</code><a class="reference internal" href="_modules/py2store/key_mappers/paths.html#PrefixRelativizationMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.paths.PrefixRelativizationMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Mixin that adds a intercepts the _id_of_key an _key_of_id methods, transforming absolute keys to relative ones.
Designed to work with string keys, where absolute and relative are relative to a _prefix attribute
(assumed to exist).
The cannonical use case is when keys are absolute file paths, but we want to identify data through relative paths.
Instead of referencing files through an absolute path such as</p>
<blockquote>
<div><p>/A/VERY/LONG/ROOT/FOLDER/the/file/we.want</p>
</div></blockquote>
<dl class="simple">
<dt>we can instead reference the file as</dt><dd><p>the/file/we.want</p>
</dd>
</dl>
<p>Note though, that PrefixRelativizationMixin can be used, not only for local paths,
but when ever a string reference is involved.
In fact, not only strings, but any key object that has a __len__, __add__, and subscripting.</p>
<p>When subclassed, should be placed before the class defining _id_of_key an _key_of_id.
Also, assumes that a (string) _prefix attribute will be available.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store.base</span> <span class="kn">import</span> <span class="n">Store</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">UserDict</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyStore</span><span class="p">(</span><span class="n">PrefixRelativizationMixin</span><span class="p">,</span> <span class="n">Store</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">_prefix</span><span class="o">=</span><span class="s1">&#39;/root/of/data/&#39;</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_prefix</span> <span class="o">=</span> <span class="n">_prefix</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">MyStore</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="nb">dict</span><span class="p">())</span>  <span class="c1"># using a dict as our store</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;too&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;much&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;too&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Everything looks normal, but are the actual keys behind the hood?</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">_id_of_key</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="go">&#39;/root/of/data/foo&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># see when iterating over s.items(), we get the interface view:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;foo&#39;, &#39;bar&#39;), (&#39;too&#39;, &#39;much&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># but if we ask the store we&#39;re actually delegating the storing to, we see what the keys actually are.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="go">dict_items([(&#39;/root/of/data/foo&#39;, &#39;bar&#39;), (&#39;/root/of/data/too&#39;, &#39;much&#39;)])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.paths.mk_relative_path_store">
<code class="sig-prename descclassname">py2store.key_mappers.paths.</code><code class="sig-name descname">mk_relative_path_store</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">store_cls</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">with_key_validation</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">prefix_attr</span><span class="o">=</span><span class="default_value">'_prefix'</span></em>, <em class="sig-param"><span class="n">__module__</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">__name__</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">__qualname__</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">__doc__</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">__annotations__</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">__defaults__</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">__kwdefaults__</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/paths.html#mk_relative_path_store"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.paths.mk_relative_path_store" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store_cls</strong> – The base store to wrap (subclass)</p></li>
<li><p><strong>name</strong> – The name of the new store (by default ‘RelPath’ + store_cls.__name__)</p></li>
<li><p><strong>with_key_validation</strong> – Whether keys should be validated upon access (store_cls must have an is_valid_key method</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Returns: A new class that uses relative paths (i.e. where _prefix is automatically added to incoming keys,</dt><dd><p>and the len(_prefix) first characters are removed from outgoing keys.</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># The dynamic way (if you try this at home, be aware of the pitfalls of the dynamic way</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># -- but don&#39;t just believe the static dogmas).</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">MyStore</span> <span class="o">=</span> <span class="n">mk_relative_path_store</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>  <span class="c1"># wrap our favorite store: A dict.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">MyStore</span><span class="p">()</span>  <span class="c1"># make such a store</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">_prefix</span> <span class="o">=</span> <span class="s1">&#39;/ROOT/&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">dict</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>  <span class="c1"># gives us what you would expect</span>
<span class="go">{&#39;foo&#39;: &#39;bar&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="c1"># but under the hood, the dict we wrapped actually contains the &#39;/ROOT/&#39; prefix</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">dict</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">store</span><span class="p">)</span>
<span class="go">{&#39;/ROOT/foo&#39;: &#39;bar&#39;}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># The static way: Make a class that will integrate the _prefix at construction time.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyStore</span><span class="p">(</span><span class="n">mk_relative_path_store</span><span class="p">(</span><span class="nb">dict</span><span class="p">)):</span>  <span class="c1"># Indeed, mk_relative_path_store(dict) is a class you can subclass</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_prefix</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_prefix</span> <span class="o">=</span> <span class="n">_prefix</span>
</pre></div>
</div>
<p>You can choose the name you want that prefix to have as an attribute (we’ll still make
a hidden ‘_prefix’ attribute for internal use, but at least you can have an attribute with the
name you want.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">MyRelStore</span> <span class="o">=</span> <span class="n">mk_relative_path_store</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">prefix_attr</span><span class="o">=</span><span class="s1">&#39;rootdir&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">MyRelStore</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">rootdir</span> <span class="o">=</span> <span class="s1">&#39;/ROOT/&#39;</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">dict</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>  <span class="c1"># gives us what you would expect</span>
<span class="go">{&#39;foo&#39;: &#39;bar&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="c1"># but under the hood, the dict we wrapped actually contains the &#39;/ROOT/&#39; prefix</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">dict</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">store</span><span class="p">)</span>
<span class="go">{&#39;/ROOT/foo&#39;: &#39;bar&#39;}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.paths.rel_path_wrap">
<code class="sig-prename descclassname">py2store.key_mappers.paths.</code><code class="sig-name descname">rel_path_wrap</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">o</span></em>, <em class="sig-param"><span class="n">_prefix</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/paths.html#rel_path_wrap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.paths.rel_path_wrap" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>o</strong> – An object to be wrapped</p></li>
<li><p><strong>_prefix</strong> – The _prefix to use for key wrapping (will remove it from outcoming keys and add to ingoing keys.</p></li>
</ul>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># The dynamic way (if you try this at home, be aware of the pitfalls of the dynamic way</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># -- but don&#39;t just believe the static dogmas).</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;/ROOT/of/every/thing&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span> <span class="s1">&#39;/ROOT/of/this/too&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dd</span> <span class="o">=</span> <span class="n">rel_path_wrap</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s1">&#39;/ROOT/of/&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">dict</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>  <span class="c1"># gives us what you would expect</span>
<span class="go">{&#39;every/thing&#39;: 42, &#39;this/too&#39;: 0, &#39;foo&#39;: &#39;bar&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="c1"># but under the hood, the dict we wrapped actually contains the &#39;/ROOT/&#39; prefix</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">dict</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">store</span><span class="p">)</span>
<span class="go">{&#39;/ROOT/of/every/thing&#39;: 42, &#39;/ROOT/of/this/too&#39;: 0, &#39;/ROOT/of/foo&#39;: &#39;bar&#39;}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># The static way: Make a class that will integrate the _prefix at construction time.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyStore</span><span class="p">(</span><span class="n">mk_relative_path_store</span><span class="p">(</span><span class="nb">dict</span><span class="p">)):</span>  <span class="c1"># Indeed, mk_relative_path_store(dict) is a class you can subclass</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_prefix</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_prefix</span> <span class="o">=</span> <span class="n">_prefix</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.paths.str_template_key_trans">
<code class="sig-prename descclassname">py2store.key_mappers.paths.</code><code class="sig-name descname">str_template_key_trans</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">template</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">key_type</span><span class="p">:</span> <span class="n"><a class="reference internal" href="#py2store.key_mappers.paths.PathKeyTypes" title="py2store.key_mappers.paths.PathKeyTypes">py2store.key_mappers.paths.PathKeyTypes</a></span></em>, <em class="sig-param"><span class="n">format_dict</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">process_kwargs</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">process_info_dict</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">named_tuple_type_name</span><span class="o">=</span><span class="default_value">'NamedTuple'</span></em>, <em class="sig-param"><span class="n">sep</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'/'</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/paths.html#str_template_key_trans"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.paths.str_template_key_trans" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a key trans object that translates from a string _id to a dict, tuple, or namedtuple key (and back)</p>
</dd></dl>

</div>
<div class="section" id="module-py2store.key_mappers.naming">
<span id="py2store-key-mappers-naming"></span><h1>py2store.key_mappers.naming<a class="headerlink" href="#module-py2store.key_mappers.naming" title="Permalink to this headline">¶</a></h1>
<p>This module is about generating, validating, and operating on (parametrized) fields (i.e. stings, e.g. paths).</p>
<dl class="py class">
<dt id="py2store.key_mappers.naming.BigDocTest">
<em class="property">class </em><code class="sig-prename descclassname">py2store.key_mappers.naming.</code><code class="sig-name descname">BigDocTest</code><a class="reference internal" href="_modules/py2store/key_mappers/naming.html#BigDocTest"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.naming.BigDocTest" title="Permalink to this definition">¶</a></dt>
<dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_name</span> <span class="o">=</span> <span class="n">BigDocTest</span><span class="o">.</span><span class="n">mk_e_naming</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u_name</span> <span class="o">=</span> <span class="n">BigDocTest</span><span class="o">.</span><span class="n">mk_u_naming</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_sref</span> <span class="o">=</span> <span class="s1">&#39;s3://bucket-GROUP/example/files/USER/SUBUSER/2017-01-24/1485272231982_1485261448469&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u_sref</span> <span class="o">=</span> <span class="s2">&quot;s3://uploads/GROUP/upload/files/USER/2017-01-24/SUBUSER/a_file.wav&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u_name_2</span> <span class="o">=</span> <span class="s2">&quot;s3://uploads/ANOTHER_GROUP/upload/files/ANOTHER_USER/2017-01-24/SUBUSER/a_file.wav&quot;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">####### is_valid(self, name): ######</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_name</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">e_sref</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_name</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">u_sref</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u_name</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">u_sref</span><span class="p">)</span>
<span class="go">True</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">####### is_valid_prefix(self, name): ######</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_name</span><span class="o">.</span><span class="n">is_valid_prefix</span><span class="p">(</span><span class="s1">&#39;s3://bucket-&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_name</span><span class="o">.</span><span class="n">is_valid_prefix</span><span class="p">(</span><span class="s1">&#39;s3://bucket-GROUP&#39;</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_name</span><span class="o">.</span><span class="n">is_valid_prefix</span><span class="p">(</span><span class="s1">&#39;s3://bucket-GROUP/example/&#39;</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_name</span><span class="o">.</span><span class="n">is_valid_prefix</span><span class="p">(</span><span class="s1">&#39;s3://bucket-GROUP/example/files&#39;</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_name</span><span class="o">.</span><span class="n">is_valid_prefix</span><span class="p">(</span><span class="s1">&#39;s3://bucket-GROUP/example/files/&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_name</span><span class="o">.</span><span class="n">is_valid_prefix</span><span class="p">(</span><span class="s1">&#39;s3://bucket-GROUP/example/files/USER/SUBUSER/2017-01-24/&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_name</span><span class="o">.</span><span class="n">is_valid_prefix</span><span class="p">(</span><span class="s1">&#39;s3://bucket-GROUP/example/files/USER/SUBUSER/2017-01-24/0_0&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">####### info_dict(self, name): ######</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_name</span><span class="o">.</span><span class="n">info_dict</span><span class="p">(</span><span class="n">e_sref</span><span class="p">)</span>  <span class="c1"># see that utc_ms args were cast to ints</span>
<span class="go">{&#39;group&#39;: &#39;GROUP&#39;, &#39;user&#39;: &#39;USER&#39;, &#39;subuser&#39;: &#39;SUBUSER&#39;, &#39;day&#39;: &#39;2017-01-24&#39;, &#39;s_ums&#39;: 1485272231982, &#39;e_ums&#39;: 1485261448469}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u_name</span><span class="o">.</span><span class="n">info_dict</span><span class="p">(</span><span class="n">u_sref</span><span class="p">)</span>  <span class="c1"># returns None (because self was made for example!</span>
<span class="go">{&#39;group&#39;: &#39;GROUP&#39;, &#39;user&#39;: &#39;USER&#39;, &#39;day&#39;: &#39;2017-01-24&#39;, &#39;subuser&#39;: &#39;SUBUSER&#39;, &#39;filename&#39;: &#39;a_file.wav&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># but with a u_name, it will work</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u_name</span><span class="o">.</span><span class="n">info_dict</span><span class="p">(</span><span class="n">u_sref</span><span class="p">)</span>
<span class="go">{&#39;group&#39;: &#39;GROUP&#39;, &#39;user&#39;: &#39;USER&#39;, &#39;day&#39;: &#39;2017-01-24&#39;, &#39;subuser&#39;: &#39;SUBUSER&#39;, &#39;filename&#39;: &#39;a_file.wav&#39;}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">####### extract(self, item, name): ######</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_name</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="n">e_sref</span><span class="p">)</span>
<span class="go">&#39;GROUP&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_name</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">e_sref</span><span class="p">)</span>
<span class="go">&#39;USER&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u_name</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="n">u_name_2</span><span class="p">)</span>
<span class="go">&#39;ANOTHER_GROUP&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u_name</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">u_name_2</span><span class="p">)</span>
<span class="go">&#39;ANOTHER_USER&#39;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">####### mk_prefix(self, *args, **kwargs): ######</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_name</span><span class="o">.</span><span class="n">mk_prefix</span><span class="p">()</span>
<span class="go">&#39;s3://bucket-&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_name</span><span class="o">.</span><span class="n">mk_prefix</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;GROUP&#39;</span><span class="p">)</span>
<span class="go">&#39;s3://bucket-GROUP/example/files/&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_name</span><span class="o">.</span><span class="n">mk_prefix</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;GROUP&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;USER&#39;</span><span class="p">)</span>
<span class="go">&#39;s3://bucket-GROUP/example/files/USER/&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_name</span><span class="o">.</span><span class="n">mk_prefix</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;GROUP&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;USER&#39;</span><span class="p">,</span> <span class="n">subuser</span><span class="o">=</span><span class="s1">&#39;SUBUSER&#39;</span><span class="p">)</span>
<span class="go">&#39;s3://bucket-GROUP/example/files/USER/SUBUSER/&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_name</span><span class="o">.</span><span class="n">mk_prefix</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;GROUP&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;USER&#39;</span><span class="p">,</span> <span class="n">subuser</span><span class="o">=</span><span class="s1">&#39;SUBUSER&#39;</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="s1">&#39;0000-00-00&#39;</span><span class="p">)</span>
<span class="go">&#39;s3://bucket-GROUP/example/files/USER/SUBUSER/0000-00-00/&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_name</span><span class="o">.</span><span class="n">mk_prefix</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;GROUP&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;USER&#39;</span><span class="p">,</span> <span class="n">subuser</span><span class="o">=</span><span class="s1">&#39;SUBUSER&#39;</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="s1">&#39;0000-00-00&#39;</span><span class="p">,</span>
<span class="gp">... </span><span class="n">s_ums</span><span class="o">=</span><span class="mi">1485272231982</span><span class="p">)</span>
<span class="go">&#39;s3://bucket-GROUP/example/files/USER/SUBUSER/0000-00-00/1485272231982_&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_name</span><span class="o">.</span><span class="n">mk_prefix</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;GROUP&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;USER&#39;</span><span class="p">,</span> <span class="n">subuser</span><span class="o">=</span><span class="s1">&#39;SUBUSER&#39;</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="s1">&#39;0000-00-00&#39;</span><span class="p">,</span>
<span class="gp">... </span><span class="n">s_ums</span><span class="o">=</span><span class="mi">1485272231982</span><span class="p">,</span> <span class="n">e_ums</span><span class="o">=</span><span class="mi">1485261448469</span><span class="p">)</span>
<span class="go">&#39;s3://bucket-GROUP/example/files/USER/SUBUSER/0000-00-00/1485272231982_1485261448469&#39;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u_name</span><span class="o">.</span><span class="n">mk_prefix</span><span class="p">()</span>
<span class="go">&#39;s3://uploads/&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u_name</span><span class="o">.</span><span class="n">mk_prefix</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;GROUP&#39;</span><span class="p">)</span>
<span class="go">&#39;s3://uploads/GROUP/upload/files/&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u_name</span><span class="o">.</span><span class="n">mk_prefix</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;GROUP&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;USER&#39;</span><span class="p">)</span>
<span class="go">&#39;s3://uploads/GROUP/upload/files/USER/&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u_name</span><span class="o">.</span><span class="n">mk_prefix</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;GROUP&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;USER&#39;</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="s1">&#39;DAY&#39;</span><span class="p">)</span>
<span class="go">&#39;s3://uploads/GROUP/upload/files/USER/DAY/&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u_name</span><span class="o">.</span><span class="n">mk_prefix</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;GROUP&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;USER&#39;</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="s1">&#39;DAY&#39;</span><span class="p">)</span>
<span class="go">&#39;s3://uploads/GROUP/upload/files/USER/DAY/&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u_name</span><span class="o">.</span><span class="n">mk_prefix</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;GROUP&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;USER&#39;</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="s1">&#39;DAY&#39;</span><span class="p">,</span> <span class="n">subuser</span><span class="o">=</span><span class="s1">&#39;SUBUSER&#39;</span><span class="p">)</span>
<span class="go">&#39;s3://uploads/GROUP/upload/files/USER/DAY/SUBUSER/&#39;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">####### mk(self, *args, **kwargs): ######</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_name</span><span class="o">.</span><span class="n">mk</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;GROUP&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;USER&#39;</span><span class="p">,</span> <span class="n">subuser</span><span class="o">=</span><span class="s1">&#39;SUBUSER&#39;</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="s1">&#39;0000-00-00&#39;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">s_ums</span><span class="o">=</span><span class="mi">1485272231982</span><span class="p">,</span> <span class="n">e_ums</span><span class="o">=</span><span class="mi">1485261448469</span><span class="p">)</span>
<span class="go">&#39;s3://bucket-GROUP/example/files/USER/SUBUSER/0000-00-00/1485272231982_1485261448469&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_name</span><span class="o">.</span><span class="n">mk</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;GROUP&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;USER&#39;</span><span class="p">,</span> <span class="n">subuser</span><span class="o">=</span><span class="s1">&#39;SUBUSER&#39;</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="s1">&#39;from_s_ums&#39;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">s_ums</span><span class="o">=</span><span class="mi">1485272231982</span><span class="p">,</span> <span class="n">e_ums</span><span class="o">=</span><span class="mi">1485261448469</span><span class="p">)</span>
<span class="go">&#39;s3://bucket-GROUP/example/files/USER/SUBUSER/2017-01-24/1485272231982_1485261448469&#39;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">####### replace_name_elements(self, *args, **kwargs): ######</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;s3://bucket-redrum/example/files/oopsy@domain.com/ozeip/2008-11-04/1225779243969_1225779246969&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_name</span><span class="o">.</span><span class="n">replace_name_elements</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;NEW_USER&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;NEW_GROUP&#39;</span><span class="p">)</span>
<span class="go">&#39;s3://bucket-NEW_GROUP/example/files/NEW_USER/ozeip/2008-11-04/1225779243969_1225779246969&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py attribute">
<dt id="py2store.key_mappers.naming.KeyMapNames">
<code class="sig-prename descclassname">py2store.key_mappers.naming.</code><code class="sig-name descname">KeyMapNames</code><a class="headerlink" href="#py2store.key_mappers.naming.KeyMapNames" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#py2store.key_mappers.naming.KeyMaps" title="py2store.key_mappers.naming.KeyMaps"><code class="xref py py-class docutils literal notranslate"><span class="pre">py2store.key_mappers.naming.KeyMaps</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt id="py2store.key_mappers.naming.KeyMaps">
<em class="property">class </em><code class="sig-prename descclassname">py2store.key_mappers.naming.</code><code class="sig-name descname">KeyMaps</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key_of_id</span></em>, <em class="sig-param"><span class="n">id_of_key</span></em><span class="sig-paren">)</span><a class="headerlink" href="#py2store.key_mappers.naming.KeyMaps" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py attribute">
<dt id="py2store.key_mappers.naming.KeyMaps.id_of_key">
<code class="sig-name descname">id_of_key</code><a class="headerlink" href="#py2store.key_mappers.naming.KeyMaps.id_of_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="py attribute">
<dt id="py2store.key_mappers.naming.KeyMaps.key_of_id">
<code class="sig-name descname">key_of_id</code><a class="headerlink" href="#py2store.key_mappers.naming.KeyMaps.key_of_id" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

</dd></dl>

<dl class="py attribute">
<dt id="py2store.key_mappers.naming.LinearNaming">
<code class="sig-prename descclassname">py2store.key_mappers.naming.</code><code class="sig-name descname">LinearNaming</code><a class="headerlink" href="#py2store.key_mappers.naming.LinearNaming" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#py2store.key_mappers.naming.StrTupleDictWithPrefix" title="py2store.key_mappers.naming.StrTupleDictWithPrefix"><code class="xref py py-class docutils literal notranslate"><span class="pre">py2store.key_mappers.naming.StrTupleDictWithPrefix</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt id="py2store.key_mappers.naming.ParametricKeyStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.key_mappers.naming.</code><code class="sig-name descname">ParametricKeyStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">store</span></em>, <em class="sig-param"><span class="n">keymap</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/naming.html#ParametricKeyStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.naming.ParametricKeyStore" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.key_mappers.naming.StoreWithDictKeys">
<em class="property">class </em><code class="sig-prename descclassname">py2store.key_mappers.naming.</code><code class="sig-name descname">StoreWithDictKeys</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">store</span></em>, <em class="sig-param"><span class="n">keymap</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/naming.html#StoreWithDictKeys"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.naming.StoreWithDictKeys" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.key_mappers.naming.StoreWithNamedTupleKeys">
<em class="property">class </em><code class="sig-prename descclassname">py2store.key_mappers.naming.</code><code class="sig-name descname">StoreWithNamedTupleKeys</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">store</span></em>, <em class="sig-param"><span class="n">keymap</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/naming.html#StoreWithNamedTupleKeys"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.naming.StoreWithNamedTupleKeys" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.key_mappers.naming.StoreWithTupleKeys">
<em class="property">class </em><code class="sig-prename descclassname">py2store.key_mappers.naming.</code><code class="sig-name descname">StoreWithTupleKeys</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">store</span></em>, <em class="sig-param"><span class="n">keymap</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/naming.html#StoreWithTupleKeys"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.naming.StoreWithTupleKeys" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.key_mappers.naming.StrTupleDictWithPrefix">
<em class="property">class </em><code class="sig-prename descclassname">py2store.key_mappers.naming.</code><code class="sig-name descname">StrTupleDictWithPrefix</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/naming.html#StrTupleDictWithPrefix"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.naming.StrTupleDictWithPrefix" title="Permalink to this definition">¶</a></dt>
<dd><p>Converting from and to strings, tuples, and dicts, but with partial “prefix” specs allowed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>template</strong> – The string format template</p></li>
<li><p><strong>format_dict</strong> – A {field_name: field_value_format_regex, …} dict</p></li>
<li><p><strong>process_kwargs</strong> – A function taking the field=value pairs and producing a dict of processed
{field: value,…} dict (where both fields and values could have been processed.
This is useful when we need to process (format, default, etc.) fields, or their values,
according to the other fields of values in the collection.
A specification of {field: function_to_process_this_value,…} wouldn’t allow the full powers
we are allowing here.</p></li>
<li><p><strong>process_info_dict</strong> – A sort of converse of format_dict.
This is a {field_name: field_conversion_func, …} dict that is used to convert info_dict values
before returning them.</p></li>
<li><p><strong>name_separator</strong> – Used</p></li>
</ul>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ln</span> <span class="o">=</span> <span class="n">StrTupleDictWithPrefix</span><span class="p">(</span><span class="s1">&#39;/home/</span><span class="si">{user}</span><span class="s1">/fav/</span><span class="si">{num}</span><span class="s1">.txt&#39;</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">format_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="s1">&#39;[^/]+&#39;</span><span class="p">,</span> <span class="s1">&#39;num&#39;</span><span class="p">:</span> <span class="s1">&#39;\d+&#39;</span><span class="p">},</span>
<span class="gp">... </span>                  <span class="n">process_info_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;num&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">},</span>
<span class="gp">... </span>                  <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;/&#39;</span>
<span class="gp">... </span>                 <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ln</span><span class="o">.</span><span class="n">mk</span><span class="p">(</span><span class="s1">&#39;USER&#39;</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>  <span class="c1"># making a string (with args or kwargs)</span>
<span class="go">&#39;/home/USER/fav/123.txt&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">####### prefix methods #######</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ln</span><span class="o">.</span><span class="n">is_valid_prefix</span><span class="p">(</span><span class="s1">&#39;/home/USER/fav/&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ln</span><span class="o">.</span><span class="n">is_valid_prefix</span><span class="p">(</span><span class="s1">&#39;/home/USER/fav/12&#39;</span><span class="p">)</span>  <span class="c1"># False because too long</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ln</span><span class="o">.</span><span class="n">is_valid_prefix</span><span class="p">(</span><span class="s1">&#39;/home/USER/fav&#39;</span><span class="p">)</span>  <span class="c1"># False because too short</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ln</span><span class="o">.</span><span class="n">is_valid_prefix</span><span class="p">(</span><span class="s1">&#39;/home/&#39;</span><span class="p">)</span>  <span class="c1"># True because just right</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ln</span><span class="o">.</span><span class="n">is_valid_prefix</span><span class="p">(</span><span class="s1">&#39;/home/USER/fav/123.txt&#39;</span><span class="p">)</span>  <span class="c1"># full path, so output same as is_valid() method</span>
<span class="go">True</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ln</span><span class="o">.</span><span class="n">mk_prefix</span><span class="p">(</span><span class="s1">&#39;ME&#39;</span><span class="p">)</span>
<span class="go">&#39;/home/ME/fav/&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ln</span><span class="o">.</span><span class="n">mk_prefix</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s1">&#39;YOU&#39;</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">456</span><span class="p">)</span>  <span class="c1"># full specification, so output same as same as mk() method</span>
<span class="go">&#39;/home/YOU/fav/456.txt&#39;</span>
</pre></div>
</div>
<dl class="py method">
<dt id="py2store.key_mappers.naming.StrTupleDictWithPrefix.is_valid_prefix">
<code class="sig-name descname">is_valid_prefix</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">s</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/naming.html#StrTupleDictWithPrefix.is_valid_prefix"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.naming.StrTupleDictWithPrefix.is_valid_prefix" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if name is a valid prefix.
:param s: a string (that might or might not be a valid prefix)
:return: True iff name is a valid prefix</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.naming.dict_to_namedtuple">
<code class="sig-prename descclassname">py2store.key_mappers.naming.</code><code class="sig-name descname">dict_to_namedtuple</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">d</span></em>, <em class="sig-param"><span class="n">namedtuple_obj</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/naming.html#dict_to_namedtuple"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.naming.dict_to_namedtuple" title="Permalink to this definition">¶</a></dt>
<dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">NT</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;MyTuple&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nt</span> <span class="o">=</span> <span class="n">NT</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nt</span>
<span class="go">MyTuple(foo=1, hello=42)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">namedtuple_to_dict</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>
<span class="go">{&#39;foo&#39;: 1, &#39;hello&#39;: 42}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dict_to_namedtuple</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="go">NamedTupleFromDict(foo=1, hello=42)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dict_to_namedtuple</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<span class="go">MyTuple(foo=1, hello=42)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.naming.get_fields_from_template">
<code class="sig-prename descclassname">py2store.key_mappers.naming.</code><code class="sig-name descname">get_fields_from_template</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">template</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/naming.html#get_fields_from_template"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.naming.get_fields_from_template" title="Permalink to this definition">¶</a></dt>
<dd><p>Get list from {item} items of template string
:param template: a “template” string (a string with {item} items
– the kind that is used to mark token for str.format)
:return: a list of the token items of the string, in the order they appear
&gt;&gt;&gt; get_fields_from_template(‘this{is}an{example}of{a}template’)
[‘is’, ‘example’, ‘a’]</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.naming.mk_kwargs_trans">
<code class="sig-prename descclassname">py2store.key_mappers.naming.</code><code class="sig-name descname">mk_kwargs_trans</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">**</span><span class="n">trans_func_for_key</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/naming.html#mk_kwargs_trans"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.naming.mk_kwargs_trans" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a dict transformer from functions that depends solely on keys (of the dict to be transformed)
Used to easily make process_kwargs and process_info_dict arguments for LinearNaming.</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.naming.mk_pattern_from_template_and_format_dict">
<code class="sig-prename descclassname">py2store.key_mappers.naming.</code><code class="sig-name descname">mk_pattern_from_template_and_format_dict</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">template</span></em>, <em class="sig-param"><span class="n">format_dict</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/naming.html#mk_pattern_from_template_and_format_dict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.naming.mk_pattern_from_template_and_format_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a compiled regex to match template</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>template</strong> – A format string</p></li>
<li><p><strong>format_dict</strong> – A dict whose keys are template fields and values are regex strings to capture them</p></li>
</ul>
</dd>
</dl>
<p>Returns: a compiled regex</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mk_pattern_from_template_and_format_dict</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{here}</span><span class="s1">/and/</span><span class="si">{there}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="go">re.compile(&#39;(?P&lt;here&gt;[^/]+)/and/(?P&lt;there&gt;[^/]+)&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">mk_pattern_from_template_and_format_dict</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{here}</span><span class="s1">/and/</span><span class="si">{there}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;there&#39;</span><span class="p">:</span> <span class="s1">&#39;\d+&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span>
<span class="go">re.compile(&#39;(?P&lt;here&gt;[^/]+)/and/(?P&lt;there&gt;\\d+)&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="go">&lt;class &#39;re.Pattern&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;HERE/and/1234&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
<span class="go">{&#39;here&#39;: &#39;HERE&#39;, &#39;there&#39;: &#39;1234&#39;}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.naming.mk_store_from_path_format_store_cls">
<code class="sig-prename descclassname">py2store.key_mappers.naming.</code><code class="sig-name descname">mk_store_from_path_format_store_cls</code><span class="sig-paren">(</span><em class="sig-param">store</em>, <em class="sig-param">subpath=''</em>, <em class="sig-param">store_cls_kwargs=None</em>, <em class="sig-param">key_type=&lt;function namedtuple&gt;</em>, <em class="sig-param">keymap=&lt;class 'py2store.key_mappers.naming.StrTupleDict'&gt;</em>, <em class="sig-param">keymap_kwargs=None</em>, <em class="sig-param">name=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/naming.html#mk_store_from_path_format_store_cls"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.naming.mk_store_from_path_format_store_cls" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrap a store (instance or class) that uses string keys to make it into a store that uses a specific key format.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store</strong> – The instance or class to wrap</p></li>
<li><p><strong>subpath</strong> – The subpath (defining the subset of the data pointed at by the URI</p></li>
<li><p><strong>store_cls_kwargs</strong> – # if store is a class, the kwargs that you would have given the store_cls to make itself</p></li>
<li><p><strong>key_type</strong> – The key type you want to interface with:
dict, tuple, namedtuple, str or ‘dict’, ‘tuple’, ‘namedtuple’, ‘str’</p></li>
<li><p><strong>keymap</strong> – # the keymap instance or class you want to use to map keys</p></li>
<li><p><strong>keymap_kwargs</strong> – # if keymap is a cls, the kwargs to give it (besides the subpath)</p></li>
<li><p><strong>name</strong> – The name to give the class the function will make here</p></li>
</ul>
</dd>
</dl>
<p>Returns: An instance of a wrapped class</p>
<p>Example:
<a href="#id67"><span class="problematic" id="id68">``</span></a>`
# Get a (sessiono,bt) indexed LocalJsonStore
s = mk_store_from_path_format_store_cls(LocalJsonStore,</p>
<blockquote>
<div><p>os.path.join(root_dir, ‘d’),
subpath=’{session}/d/{bt}’,
keymap_kwargs=dict(process_info_dict={‘session’: int, ‘bt’: int}))</p>
</div></blockquote>
<p><a href="#id69"><span class="problematic" id="id70">``</span></a><a href="#id71"><span class="problematic" id="id72">`</span></a></p>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.naming.mk_tupled_store_from_path_format_store_cls">
<code class="sig-prename descclassname">py2store.key_mappers.naming.</code><code class="sig-name descname">mk_tupled_store_from_path_format_store_cls</code><span class="sig-paren">(</span><em class="sig-param">store</em>, <em class="sig-param">subpath=''</em>, <em class="sig-param">store_cls_kwargs=None</em>, <em class="sig-param">key_type=&lt;function namedtuple&gt;</em>, <em class="sig-param">keymap=&lt;class 'py2store.key_mappers.naming.StrTupleDict'&gt;</em>, <em class="sig-param">keymap_kwargs=None</em>, <em class="sig-param">name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#py2store.key_mappers.naming.mk_tupled_store_from_path_format_store_cls" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrap a store (instance or class) that uses string keys to make it into a store that uses a specific key format.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store</strong> – The instance or class to wrap</p></li>
<li><p><strong>subpath</strong> – The subpath (defining the subset of the data pointed at by the URI</p></li>
<li><p><strong>store_cls_kwargs</strong> – # if store is a class, the kwargs that you would have given the store_cls to make itself</p></li>
<li><p><strong>key_type</strong> – The key type you want to interface with:
dict, tuple, namedtuple, str or ‘dict’, ‘tuple’, ‘namedtuple’, ‘str’</p></li>
<li><p><strong>keymap</strong> – # the keymap instance or class you want to use to map keys</p></li>
<li><p><strong>keymap_kwargs</strong> – # if keymap is a cls, the kwargs to give it (besides the subpath)</p></li>
<li><p><strong>name</strong> – The name to give the class the function will make here</p></li>
</ul>
</dd>
</dl>
<p>Returns: An instance of a wrapped class</p>
<p>Example:
<a href="#id73"><span class="problematic" id="id74">``</span></a>`
# Get a (sessiono,bt) indexed LocalJsonStore
s = mk_store_from_path_format_store_cls(LocalJsonStore,</p>
<blockquote>
<div><p>os.path.join(root_dir, ‘d’),
subpath=’{session}/d/{bt}’,
keymap_kwargs=dict(process_info_dict={‘session’: int, ‘bt’: int}))</p>
</div></blockquote>
<p><a href="#id75"><span class="problematic" id="id76">``</span></a><a href="#id77"><span class="problematic" id="id78">`</span></a></p>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.naming.namedtuple_to_dict">
<code class="sig-prename descclassname">py2store.key_mappers.naming.</code><code class="sig-name descname">namedtuple_to_dict</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">nt</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/naming.html#namedtuple_to_dict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.naming.namedtuple_to_dict" title="Permalink to this definition">¶</a></dt>
<dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">NT</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;MyTuple&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nt</span> <span class="o">=</span> <span class="n">NT</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nt</span>
<span class="go">MyTuple(foo=1, hello=42)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">namedtuple_to_dict</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>
<span class="go">{&#39;foo&#39;: 1, &#39;hello&#39;: 42}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.naming.update_fields_of_namedtuple">
<code class="sig-prename descclassname">py2store.key_mappers.naming.</code><code class="sig-name descname">update_fields_of_namedtuple</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">nt</span><span class="p">:</span> <span class="n">tuple</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">name_of_output_type</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">remove_fields</span><span class="o">=</span><span class="default_value">()</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/naming.html#update_fields_of_namedtuple"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.naming.update_fields_of_namedtuple" title="Permalink to this definition">¶</a></dt>
<dd><p>Replace fields of namedtuple
&gt;&gt;&gt; from collections import namedtuple
&gt;&gt;&gt; NT = namedtuple(‘NT’, (‘a’, ‘b’, ‘c’))
&gt;&gt;&gt; nt = NT(1,2,3)
&gt;&gt;&gt; nt
NT(a=1, b=2, c=3)
&gt;&gt;&gt; update_fields_of_namedtuple(nt, c=3000)  # replacing a single field
NT(a=1, b=2, c=3000)
&gt;&gt;&gt; update_fields_of_namedtuple(nt, c=3000, a=1000)  # replacing two fields
NT(a=1000, b=2, c=3000)
&gt;&gt;&gt; update_fields_of_namedtuple(nt, a=1000, c=3000)  # see that the original order doesn’t change
NT(a=1000, b=2, c=3000)
&gt;&gt;&gt; update_fields_of_namedtuple(nt, b=2000, d=’hello’)  # replacing one field and adding a new one
UpdatedNT(a=1, b=2000, c=3, d=’hello’)
&gt;&gt;&gt; # Now let’s try controlling the name of the output type, remove fields, and add new ones
&gt;&gt;&gt; update_fields_of_namedtuple(nt, name_of_output_type=’NewGuy’, remove_fields=(‘a’, ‘c’), hello=’world’)
NewGuy(b=2, hello=’world’)</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.key_mappers.naming.validate_kwargs">
<code class="sig-prename descclassname">py2store.key_mappers.naming.</code><code class="sig-name descname">validate_kwargs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">kwargs_to_validate</span></em>, <em class="sig-param"><span class="n">validation_dict</span></em>, <em class="sig-param"><span class="n">validation_funs</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">all_kwargs_should_be_in_validation_dict</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">ignore_misunderstood_validation_instructions</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/key_mappers/naming.html#validate_kwargs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.key_mappers.naming.validate_kwargs" title="Permalink to this definition">¶</a></dt>
<dd><p>Utility to validate a dict. It’s main use is to validate function arguments (expressing the validation checks
in validation_dict) by doing validate_kwargs(locals()), usually in the beginning of the function
(to avoid having more accumulated variables than we need in locals())
:param kwargs_to_validate: as the name implies…
:param validation_dict: A dict specifying what to validate. Keys are usually name of variables (when feeding</p>
<blockquote>
<div><p>locals()) and values are dicts, themselves specifying check:check_val pairs where check is a string that
points to a function (see validation_funs argument) and check_val is an object that the kwargs_to_validate
value will be checked against.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>validation_funs</strong> – A dict of check:check_function(val, check_val) where check_function is a function returning
True if val is valid (with respect to check_val).</p></li>
<li><p><strong>all_kwargs_should_be_in_validation_dict</strong> – If True, will raise an error if kwargs_to_validate contains
keys that are not in validation_dict.</p></li>
<li><p><strong>ignore_misunderstood_validation_instructions</strong> – If True, will raise an error if validation_dict contains
a key that is not in validation_funs (safer, since if you mistype a key in validation_dict, the function will
tell you so!</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>True if all the validations passed.</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">validation_dict</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;system&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s1">&#39;be in&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;darwin&#39;</span><span class="p">,</span> <span class="s1">&#39;linux&#39;</span><span class="p">}</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="s1">&#39;fv_version&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s1">&#39;be a&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s1">&#39;be at least&#39;</span><span class="p">:</span> <span class="mi">5</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">validate_kwargs</span><span class="p">({</span><span class="s1">&#39;system&#39;</span><span class="p">:</span> <span class="s1">&#39;darwin&#39;</span><span class="p">},</span> <span class="n">validation_dict</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">validate_kwargs</span><span class="p">({</span><span class="s1">&#39;system&#39;</span><span class="p">:</span> <span class="s1">&#39;windows&#39;</span><span class="p">},</span> <span class="n">validation_dict</span><span class="p">)</span>
<span class="gp">... </span><span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;system must be in&#39;</span><span class="p">)</span>  <span class="c1"># omitting the set because inconsistent order</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">validate_kwargs</span><span class="p">({</span><span class="s1">&#39;fv_version&#39;</span><span class="p">:</span> <span class="mf">9.9</span><span class="p">},</span> <span class="n">validation_dict</span><span class="p">)</span>
<span class="gp">... </span><span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="go">fv_version must be a &lt;class &#39;int&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">validate_kwargs</span><span class="p">({</span><span class="s1">&#39;fv_version&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">},</span> <span class="n">validation_dict</span><span class="p">)</span>
<span class="gp">... </span><span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="go">fv_version must be at least 5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">validate_kwargs</span><span class="p">({</span><span class="s1">&#39;fv_version&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">},</span> <span class="n">validation_dict</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-py2store.key_mappers">
<span id="py2store-key-mappers"></span><h1>py2store.key_mappers<a class="headerlink" href="#module-py2store.key_mappers" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.errors">
<span id="py2store-errors"></span><h1>py2store.errors<a class="headerlink" href="#module-py2store.errors" title="Permalink to this headline">¶</a></h1>
<dl class="py exception">
<dt id="py2store.errors.DeletionsNotAllowed">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.errors.</code><code class="sig-name descname">DeletionsNotAllowed</code><a class="reference internal" href="_modules/py2store/errors.html#DeletionsNotAllowed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.errors.DeletionsNotAllowed" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py exception">
<dt id="py2store.errors.IterationNotAllowed">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.errors.</code><code class="sig-name descname">IterationNotAllowed</code><a class="reference internal" href="_modules/py2store/errors.html#IterationNotAllowed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.errors.IterationNotAllowed" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py exception">
<dt id="py2store.errors.KeyValidationError">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.errors.</code><code class="sig-name descname">KeyValidationError</code><a class="reference internal" href="_modules/py2store/errors.html#KeyValidationError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.errors.KeyValidationError" title="Permalink to this definition">¶</a></dt>
<dd><p>Error to raise when a key is not valid</p>
</dd></dl>

<dl class="py exception">
<dt id="py2store.errors.NoSuchKeyError">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.errors.</code><code class="sig-name descname">NoSuchKeyError</code><a class="reference internal" href="_modules/py2store/errors.html#NoSuchKeyError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.errors.NoSuchKeyError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py exception">
<dt id="py2store.errors.OperationNotAllowed">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.errors.</code><code class="sig-name descname">OperationNotAllowed</code><a class="reference internal" href="_modules/py2store/errors.html#OperationNotAllowed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.errors.OperationNotAllowed" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py exception">
<dt id="py2store.errors.OverWritesNotAllowedError">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.errors.</code><code class="sig-name descname">OverWritesNotAllowedError</code><a class="reference internal" href="_modules/py2store/errors.html#OverWritesNotAllowedError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.errors.OverWritesNotAllowedError" title="Permalink to this definition">¶</a></dt>
<dd><p>Error to raise when a key is not valid</p>
</dd></dl>

<dl class="py exception">
<dt id="py2store.errors.ReadsNotAllowed">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.errors.</code><code class="sig-name descname">ReadsNotAllowed</code><a class="reference internal" href="_modules/py2store/errors.html#ReadsNotAllowed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.errors.ReadsNotAllowed" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py exception">
<dt id="py2store.errors.WritesNotAllowed">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.errors.</code><code class="sig-name descname">WritesNotAllowed</code><a class="reference internal" href="_modules/py2store/errors.html#WritesNotAllowed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.errors.WritesNotAllowed" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="py2store.errors.items_with_caught_exceptions">
<code class="sig-prename descclassname">py2store.errors.</code><code class="sig-name descname">items_with_caught_exceptions</code><span class="sig-paren">(</span><em class="sig-param">d: collections.abc.Mapping</em>, <em class="sig-param">callback=None</em>, <em class="sig-param">catch_exceptions=(&lt;class 'Exception'&gt;</em>, <em class="sig-param">)</em>, <em class="sig-param">yield_callback_output=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/errors.html#items_with_caught_exceptions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.errors.items_with_caught_exceptions" title="Permalink to this definition">¶</a></dt>
<dd><p>Do what Mapping.items() does, but catching exceptions when getting the values for a key.</p>
<p>Some time your <cite>store.items()</cite> is annoying because of some exceptions that happen
when you’re retrieving some value for some of the keys.</p>
<p>Yes, if that happens, it’s that something is wrong with your store, and yes,
if it’s a store that’s going to be used a lot, you really should build the right store
that doesn’t have that problem.</p>
<p>But now that we appeased the paranoid naysayers with that warning, let’s get to business:
Sometimes you just want to get through the hurdle to get the job done. Sometimes your store is good enough,
except for a few exceptions. Sometimes your store gets it’s keys from a large pool of possible keys
(e.g. github stores or kaggle stores, or any store created by a free-form search seed),
so you can’t really depend on the fact that all the keys given by your key iterator
will give you a value without exception
– especially if you slapped on a bunch of post-processing on the out-coming values.</p>
<p>So you can right a for loop to iterate over your keys, catch the exceptions, do something with it…</p>
<p>Or, in many cases, you can just use <cite>items_with_caught_exceptions</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>d</strong> – Any Mapping</p></li>
<li><p><strong>catch_exceptions</strong> – A tuple of exceptions that should be caught</p></li>
<li><p><strong>callback</strong> – <p>A function that will be called every time an exception is caught.
The signature of the callback function is required to be:</p>
<blockquote>
<div><p>k (key), e (error obj), d (mapping), i (index)</p>
</div></blockquote>
<p>but</p>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An (key, val) generator with exceptions caught</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Mapping</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Test</span><span class="p">(</span><span class="n">Mapping</span><span class="p">):</span>  <span class="c1"># a Mapping class that has keys 0..9, but raises of KeyError if the key is not even</span>
<span class="gp">... </span>    <span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">yield from</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">k</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="n">k</span>
<span class="gp">... </span>        <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Not even&#39;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">items_with_caught_exceptions</span><span class="p">(</span><span class="n">Test</span><span class="p">()))</span>
<span class="go">[(2, 2), (4, 4), (6, 6), (8, 8)]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">my_log</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">items_with_caught_exceptions</span><span class="p">(</span><span class="n">Test</span><span class="p">(),</span> <span class="n">callback</span><span class="o">=</span><span class="n">my_log</span><span class="p">))</span>
<span class="go">3 &#39;Not even&#39;</span>
<span class="go">5 &#39;Not even&#39;</span>
<span class="go">7 &#39;Not even&#39;</span>
<span class="go">9 &#39;Not even&#39;</span>
<span class="go">[(2, 2), (4, 4), (6, 6), (8, 8)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">my_other_log</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">items_with_caught_exceptions</span><span class="p">(</span><span class="n">Test</span><span class="p">(),</span> <span class="n">callback</span><span class="o">=</span><span class="n">my_other_log</span><span class="p">))</span>
<span class="go">1</span>
<span class="go">3</span>
<span class="go">5</span>
<span class="go">7</span>
<span class="go">[(2, 2), (4, 4), (6, 6), (8, 8)]</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-py2store.slib.s_configparser">
<span id="py2store-slib-s-configparser"></span><h1>py2store.slib.s_configparser<a class="headerlink" href="#module-py2store.slib.s_configparser" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="py2store.slib.s_configparser.ConfigReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.slib.s_configparser.</code><code class="sig-name descname">ConfigReader</code><span class="sig-paren">(</span><em class="sig-param">source</em>, <em class="sig-param">*</em>, <em class="sig-param">defaults=None</em>, <em class="sig-param">dict_type=&lt;class 'dict'&gt;</em>, <em class="sig-param">allow_no_value=False</em>, <em class="sig-param">target_kind=None</em>, <em class="sig-param">**more_config_parser_kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/slib/s_configparser.html#ConfigReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.slib.s_configparser.ConfigReader" title="Permalink to this definition">¶</a></dt>
<dd><p>A KvReader to read config files
&gt;&gt;&gt; from py2store.slib.s_configparser import ConfigReader
&gt;&gt;&gt;
&gt;&gt;&gt; # from a (pretend) file
&gt;&gt;&gt; from io import BytesIO, StringIO
&gt;&gt;&gt; file_content_bytes = b’’’
… [Paths]
… home_dir: /Users
… my_dir: %(home_dir)s/lumberjack
… my_pictures: %(my_dir)s/Pictures
…
… [Escape]
… gain: 80%%  # use a %% to escape the % sign (% is the only character that needs to be escaped)’’’
&gt;&gt;&gt; c = ConfigReader(file_content_bytes)  # get configs from the bytes
&gt;&gt;&gt; list(c)
[‘DEFAULT’, ‘Paths’, ‘Escape’]
&gt;&gt;&gt; ######## From a (pretend) file (pointer) ########
&gt;&gt;&gt; # Usually, you write your configs in a file and give ConfigReader the filepath, or open file pointer…
&gt;&gt;&gt; pretend_file_pointer = StringIO(file_content_bytes.decode())
&gt;&gt;&gt; c = ConfigReader(pretend_file_pointer)
&gt;&gt;&gt; list(c)
[‘DEFAULT’, ‘Paths’, ‘Escape’]
&gt;&gt;&gt; c[‘Paths’]  # gives you a configparser.Section object
&lt;Section: Paths&gt;
&gt;&gt;&gt; # A configparser.Section is a mapping. Let’s see the keys
&gt;&gt;&gt; list(c[‘Paths’])
[‘home_dir’, ‘my_dir’, ‘my_pictures’]
&gt;&gt;&gt; # here’s a quick way to see both keys and values. Note how the home_dir interpolation was performed!
&gt;&gt;&gt; dict(c[‘Paths’])
{‘home_dir’: ‘/Users’, ‘my_dir’: ‘/Users/lumberjack’, ‘my_pictures’: ‘/Users/lumberjack/Pictures’}
&gt;&gt;&gt;
&gt;&gt;&gt; ######## Get configs from a dict ########
&gt;&gt;&gt; config_dict = {‘section1’: {‘key1’: ‘value1’},
…                ‘section2’: {‘keyA’: ‘valueA’, ‘keyB’: ‘valueB’},
…                ‘section3’: {‘foo’: ‘x’, ‘bar’: ‘y’,’baz’: ‘z’}}
&gt;&gt;&gt; c = ConfigReader(config_dict)
&gt;&gt;&gt;
&gt;&gt;&gt; assert list(c) == [‘DEFAULT’, ‘section1’, ‘section2’, ‘section3’]
&gt;&gt;&gt; assert list(c[‘section3’]) == [‘foo’, ‘bar’, ‘baz’]
&gt;&gt;&gt;
&gt;&gt;&gt; ######## Get configs from a string ########
&gt;&gt;&gt; from py2store.slib.s_configparser import _test_config_str
&gt;&gt;&gt; c = ConfigReader(_test_config_str, allow_no_value=True)
&gt;&gt;&gt; list(c)
[‘DEFAULT’, ‘Simple Values’, ‘All Values Are Strings’, ‘Multiline Values’, ‘No Values’, ‘You can use comments’, ‘Sections Can Be Indented’]
&gt;&gt;&gt; list(c[‘Simple Values’])
[‘key’, ‘spaces in keys’, ‘spaces in values’, ‘spaces around the delimiter’, ‘you can also use’]</p>
<dl class="py method">
<dt id="py2store.slib.s_configparser.ConfigReader.persist">
<code class="sig-name descname">persist</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/slib/s_configparser.html#ConfigReader.persist"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.slib.s_configparser.ConfigReader.persist" title="Permalink to this definition">¶</a></dt>
<dd><p>Persists the data (if not in a context manager).
Persists means to call</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="py2store.slib.s_configparser.ConfigStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.slib.s_configparser.</code><code class="sig-name descname">ConfigStore</code><span class="sig-paren">(</span><em class="sig-param">source</em>, <em class="sig-param">*</em>, <em class="sig-param">defaults=None</em>, <em class="sig-param">dict_type=&lt;class 'dict'&gt;</em>, <em class="sig-param">allow_no_value=False</em>, <em class="sig-param">target_kind=None</em>, <em class="sig-param">**more_config_parser_kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/slib/s_configparser.html#ConfigStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.slib.s_configparser.ConfigStore" title="Permalink to this definition">¶</a></dt>
<dd><p>Persister (read, write, delete) for ini configs.</p>
<p>You can read ini formated configurations with ConfigStore (though if you want to
just read, you should use ConfigReader instead – since ConfigReader disables
write and delete operations.</p>
<p>See ConfigReader for more examples of how to use ConfigStore.
We’ll mainly focus on write and delete operations here.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store.slib.s_configparser</span> <span class="kn">import</span> <span class="n">ConfigStore</span><span class="p">,</span> <span class="n">ConfigReader</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ini_filepath</span> <span class="o">=</span> <span class="s1">&#39;config_store_test.ini&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">ini_filepath</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ini_filepath</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">ini_filepath</span><span class="p">)</span>  <span class="c1"># File doesn&#39;t exist</span>
<span class="go">False</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ConfigStore</span><span class="p">(</span><span class="n">ini_filepath</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># There&#39;s always a default (by default empty)</span>
<span class="go">[&#39;DEFAULT&#39;]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">ini_filepath</span><span class="p">)</span>  <span class="c1"># But the file still doesn&#39;t exist (the DEFAULT is virtual)</span>
<span class="go">False</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Now let&#39;s make a config</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;nothing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;special&#39;</span><span class="p">:</span> <span class="s1">&#39;about&#39;</span><span class="p">,</span> <span class="s1">&#39;number&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[&#39;DEFAULT&#39;, &#39;nothing&#39;]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">ini_filepath</span><span class="p">)</span>  <span class="c1"># But NOW the file exists (ConfigStore will automatically write to file)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;add&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;more&#39;</span><span class="p">:</span> <span class="s1">&#39;sections&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[&#39;DEFAULT&#39;, &#39;nothing&#39;, &#39;add&#39;]</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># and yes, that config can now be read</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config_reader</span> <span class="o">=</span> <span class="n">ConfigReader</span><span class="p">(</span><span class="n">ini_filepath</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">config_reader</span><span class="p">)</span>
<span class="go">[&#39;DEFAULT&#39;, &#39;nothing&#39;, &#39;add&#39;]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config_reader</span><span class="p">[</span><span class="s1">&#39;nothing&#39;</span><span class="p">]</span>
<span class="go">&lt;Section: nothing&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">dict</span><span class="p">(</span><span class="n">config_reader</span><span class="p">[</span><span class="s1">&#39;nothing&#39;</span><span class="p">])</span>  <span class="c1"># note that 42 is now a string (that&#39;s the ini format for you!)</span>
<span class="go">{&#39;special&#39;: &#39;about&#39;, &#39;number&#39;: &#39;42&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">dict</span><span class="p">(</span><span class="n">config_reader</span><span class="p">[</span><span class="s1">&#39;DEFAULT&#39;</span><span class="p">])</span>  <span class="c1"># and DEFAULT is empty</span>
<span class="go">{}</span>
</pre></div>
</div>
<p>You can delete sections
&gt;&gt;&gt; del s[‘add’]</p>
<p>But you’ll need to refresh your reader to see the effect.
&gt;&gt;&gt; list(config_reader)
[‘DEFAULT’, ‘nothing’, ‘add’]
&gt;&gt;&gt; config_reader = ConfigReader(ini_filepath)
&gt;&gt;&gt; list(config_reader)
[‘DEFAULT’, ‘nothing’]</p>
<p>You can use <cite>update</cite> to write several sections at the same time.
Note that existing sections will be completely overwritten.
&gt;&gt;&gt; s.update({‘nothing’: {‘like’: ‘you’}, ‘new_section’: {‘a’: ‘b’, ‘c’: ‘d’}})
&gt;&gt;&gt; ConfigReader(ini_filepath).to_dict()
{‘DEFAULT’: {}, ‘nothing’: {‘like’: ‘you’}, ‘new_section’: {‘a’: ‘b’, ‘c’: ‘d’}}</p>
<p><strong>Warning: On the other hand, updating a section will not persist the updates</strong></p>
<p>Updates are automatically persisted at the top level, as shown in the example above.
This means you can change a section entirely, but partial updates of a section
will not be persisted.</p>
<p>You’ll see the updated section in the store.
&gt;&gt;&gt; s[‘nothing’].update({‘something’: ‘else’})
&gt;&gt;&gt; dict(s[‘nothing’])
{‘like’: ‘you’, ‘something’: ‘else’}</p>
<p>But it’s not automatically persisted
&gt;&gt;&gt; dict(ConfigReader(ini_filepath)[‘nothing’])
{‘like’: ‘you’}</p>
<p>… unless you ask for it explicitly
&gt;&gt;&gt; s.persist()
&gt;&gt;&gt; dict(ConfigReader(ini_filepath)[‘nothing’])
{‘like’: ‘you’, ‘something’: ‘else’}</p>
<p># TODO: Could make section updates auto-persistent by wrapping configparser.SectionProxy</p>
<p>For your convenience, the ConfigStore is also a context manager, that will,
you guessed, persist stuff when (and only when) you exit it.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ConfigReader</span><span class="p">(</span><span class="n">ini_filepath</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="go">{&#39;DEFAULT&#39;: {}, &#39;nothing&#39;: {&#39;like&#39;: &#39;you&#39;, &#39;something&#39;: &#39;else&#39;}, &#39;new_section&#39;: {&#39;a&#39;: &#39;b&#39;, &#39;c&#39;: &#39;d&#39;}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">ConfigStore</span><span class="p">(</span><span class="n">ini_filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">del</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;new_section&#39;</span><span class="p">]</span>  <span class="c1"># that&#39;s usually immediately persisted. This time, it&#39;ll wait to be</span>
<span class="gp">... </span>    <span class="k">del</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;nothing&#39;</span><span class="p">][</span><span class="s1">&#39;something&#39;</span><span class="p">]</span>  <span class="c1"># delete the something field of nothing section</span>
<span class="gp">... </span>    <span class="n">s</span><span class="p">[</span><span class="s1">&#39;nothing&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;like&#39;</span><span class="p">:</span> <span class="s1">&#39;that&#39;</span><span class="p">,</span> <span class="s1">&#39;ever&#39;</span><span class="p">:</span> <span class="s1">&#39;happened&#39;</span><span class="p">})</span>  <span class="c1"># update &#39;like&#39; config and add an &#39;ever&#39; one</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ConfigReader</span><span class="p">(</span><span class="n">ini_filepath</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="go">{&#39;DEFAULT&#39;: {}, &#39;nothing&#39;: {&#39;like&#39;: &#39;that&#39;, &#39;ever&#39;: &#39;happened&#39;}}</span>
</pre></div>
</div>
<dl class="py class">
<dt id="py2store.slib.s_configparser.ConfigStore.BasicInterpolation">
<em class="property">class </em><code class="sig-name descname">BasicInterpolation</code><a class="headerlink" href="#py2store.slib.s_configparser.ConfigStore.BasicInterpolation" title="Permalink to this definition">¶</a></dt>
<dd><p>Interpolation as implemented in the classic ConfigParser.</p>
<p>The option values can contain format strings which refer to other values in
the same section, or values in the special default section.</p>
<p>For example:</p>
<blockquote>
<div><p>something: %(dir)s/whatever</p>
</div></blockquote>
<p>would resolve the “%(dir)s” to the value of dir.  All reference
expansions are done late, on demand. If a user needs to use a bare % in
a configuration file, she can escape it by writing %%. Other % usage
is considered a user error and raises <a href="#id79"><span class="problematic" id="id80">`</span></a>InterpolationSyntaxError’.</p>
<dl class="py method">
<dt id="py2store.slib.s_configparser.ConfigStore.BasicInterpolation.before_get">
<code class="sig-name descname">before_get</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">parser</span></em>, <em class="sig-param"><span class="n">section</span></em>, <em class="sig-param"><span class="n">option</span></em>, <em class="sig-param"><span class="n">value</span></em>, <em class="sig-param"><span class="n">defaults</span></em><span class="sig-paren">)</span><a class="headerlink" href="#py2store.slib.s_configparser.ConfigStore.BasicInterpolation.before_get" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="py2store.slib.s_configparser.ConfigStore.BasicInterpolation.before_set">
<code class="sig-name descname">before_set</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">parser</span></em>, <em class="sig-param"><span class="n">section</span></em>, <em class="sig-param"><span class="n">option</span></em>, <em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="headerlink" href="#py2store.slib.s_configparser.ConfigStore.BasicInterpolation.before_set" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="py2store.slib.s_configparser.ConfigStore.ExtendedInterpolation">
<em class="property">class </em><code class="sig-name descname">ExtendedInterpolation</code><a class="headerlink" href="#py2store.slib.s_configparser.ConfigStore.ExtendedInterpolation" title="Permalink to this definition">¶</a></dt>
<dd><p>Advanced variant of interpolation, supports the syntax used by
<a href="#id81"><span class="problematic" id="id82">`</span></a>zc.buildout’. Enables interpolation between sections.</p>
<dl class="py method">
<dt id="py2store.slib.s_configparser.ConfigStore.ExtendedInterpolation.before_get">
<code class="sig-name descname">before_get</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">parser</span></em>, <em class="sig-param"><span class="n">section</span></em>, <em class="sig-param"><span class="n">option</span></em>, <em class="sig-param"><span class="n">value</span></em>, <em class="sig-param"><span class="n">defaults</span></em><span class="sig-paren">)</span><a class="headerlink" href="#py2store.slib.s_configparser.ConfigStore.ExtendedInterpolation.before_get" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="py2store.slib.s_configparser.ConfigStore.ExtendedInterpolation.before_set">
<code class="sig-name descname">before_set</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">parser</span></em>, <em class="sig-param"><span class="n">section</span></em>, <em class="sig-param"><span class="n">option</span></em>, <em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="headerlink" href="#py2store.slib.s_configparser.ConfigStore.ExtendedInterpolation.before_set" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py method">
<dt id="py2store.slib.s_configparser.ConfigStore.persist">
<code class="sig-name descname">persist</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/slib/s_configparser.html#ConfigStore.persist"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.slib.s_configparser.ConfigStore.persist" title="Permalink to this definition">¶</a></dt>
<dd><p>Persists the data (if not in a context manager).
Persists means to call</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="py2store.slib.s_configparser.postprocess_ini_section_items">
<code class="sig-prename descclassname">py2store.slib.s_configparser.</code><code class="sig-name descname">postprocess_ini_section_items</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">items</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>Mapping<span class="p">, </span>Iterable<span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; Generator<a class="reference internal" href="_modules/py2store/slib/s_configparser.html#postprocess_ini_section_items"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.slib.s_configparser.postprocess_ini_section_items" title="Permalink to this definition">¶</a></dt>
<dd><p>Transform newline-separated string values into actual list of strings (assuming that intent)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">section_from_ini</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;aspyre&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;keywords&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">documentation</span><span class="se">\n\t</span><span class="s1">packaging</span><span class="se">\n\t</span><span class="s1">publishing&#39;</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">section_for_python</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">postprocess_ini_section_items</span><span class="p">(</span><span class="n">section_from_ini</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">section_for_python</span>
<span class="go">{&#39;name&#39;: &#39;aspyre&#39;, &#39;keywords&#39;: [&#39;documentation&#39;, &#39;packaging&#39;, &#39;publishing&#39;]}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="py2store.slib.s_configparser.preprocess_ini_section_items">
<code class="sig-prename descclassname">py2store.slib.s_configparser.</code><code class="sig-name descname">preprocess_ini_section_items</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">items</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>Mapping<span class="p">, </span>Iterable<span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; Generator<a class="reference internal" href="_modules/py2store/slib/s_configparser.html#preprocess_ini_section_items"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.slib.s_configparser.preprocess_ini_section_items" title="Permalink to this definition">¶</a></dt>
<dd><p>Transform list values into newline-separated strings, in view of writing the value to a ini formatted section
&gt;&gt;&gt; section = {
…     ‘name’: ‘aspyre’,
…     ‘keywords’: [‘documentation’, ‘packaging’, ‘publishing’]
… }
&gt;&gt;&gt; for_ini = dict(preprocess_ini_section_items(section))
&gt;&gt;&gt; print(‘keywords =’ + for_ini[‘keywords’])  # doctest: +NORMALIZE_WHITESPACE
keywords =</p>
<blockquote>
<div><p>documentation
packaging
publishing</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt id="py2store.slib.s_configparser.super_and_persist">
<code class="sig-prename descclassname">py2store.slib.s_configparser.</code><code class="sig-name descname">super_and_persist</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">super_cls</span></em>, <em class="sig-param"><span class="n">method_name</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/slib/s_configparser.html#super_and_persist"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.slib.s_configparser.super_and_persist" title="Permalink to this definition">¶</a></dt>
<dd><p>To be able to do this:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">__setitem__</span> <span class="pre">=</span> <span class="pre">super_and_persist(ConfigParser,</span> <span class="pre">'__setitem__')</span>
<span class="pre">__delitem__</span> <span class="pre">=</span> <span class="pre">super_and_persist(ConfigParser,</span> <span class="pre">'__delitem__')</span>
<span class="pre">`</span></code>
in your class definition block.</p>
<p>I thought I needed to wrap more method this way, but as it turns out, I might not,
so I prefer open code.</p>
</dd></dl>

</div>
<div class="section" id="module-py2store.slib">
<span id="py2store-slib"></span><h1>py2store.slib<a class="headerlink" href="#module-py2store.slib" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.slib.s_zipfile">
<span id="py2store-slib-s-zipfile"></span><h1>py2store.slib.s_zipfile<a class="headerlink" href="#module-py2store.slib.s_zipfile" title="Permalink to this headline">¶</a></h1>
<dl class="py exception">
<dt id="py2store.slib.s_zipfile.EmptyZipError">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.slib.s_zipfile.</code><code class="sig-name descname">EmptyZipError</code><a class="reference internal" href="_modules/py2store/slib/s_zipfile.html#EmptyZipError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.slib.s_zipfile.EmptyZipError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.slib.s_zipfile.FileStreamsOfZip">
<em class="property">class </em><code class="sig-prename descclassname">py2store.slib.s_zipfile.</code><code class="sig-name descname">FileStreamsOfZip</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">zip_file</span></em>, <em class="sig-param"><span class="n">prefix</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">open_kws</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/slib/s_zipfile.html#FileStreamsOfZip"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.slib.s_zipfile.FileStreamsOfZip" title="Permalink to this definition">¶</a></dt>
<dd><p>Like FilesOfZip, but object returns are file streams instead.
So you use it like this:</p>
<p><a href="#id83"><span class="problematic" id="id84">``</span></a>`
z = FileStreamsOfZip(rootdir)
with z[relpath] as fp:</p>
<blockquote>
<div><p>…  # do stuff with fp, like fp.readlines() or such…</p>
</div></blockquote>
<p><a href="#id85"><span class="problematic" id="id86">``</span></a><a href="#id87"><span class="problematic" id="id88">`</span></a></p>
</dd></dl>

<dl class="py class">
<dt id="py2store.slib.s_zipfile.FilesOfZip">
<em class="property">class </em><code class="sig-prename descclassname">py2store.slib.s_zipfile.</code><code class="sig-name descname">FilesOfZip</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">zip_file</span></em>, <em class="sig-param"><span class="n">prefix</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">open_kws</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/slib/s_zipfile.html#FilesOfZip"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.slib.s_zipfile.FilesOfZip" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="py2store.slib.s_zipfile.FlatZipFilesReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.slib.s_zipfile.</code><code class="sig-name descname">FlatZipFilesReader</code><span class="sig-paren">(</span><em class="sig-param">rootdir</em>, <em class="sig-param">subpath='.+\\.zip'</em>, <em class="sig-param">pattern_for_field=None</em>, <em class="sig-param">max_levels=0</em>, <em class="sig-param">zip_reader=&lt;class 'py2store.slib.s_zipfile.ZipReader'&gt;</em>, <em class="sig-param">**zip_reader_kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/slib/s_zipfile.html#FlatZipFilesReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.slib.s_zipfile.FlatZipFilesReader" title="Permalink to this definition">¶</a></dt>
<dd><p>Read the union of the contents of multiple zip files.
A local file reader whose keys are the zip filepaths of the rootdir and values are corresponding ZipReaders.</p>
</dd></dl>

<dl class="py exception">
<dt id="py2store.slib.s_zipfile.OverwriteNotAllowed">
<em class="property">exception </em><code class="sig-prename descclassname">py2store.slib.s_zipfile.</code><code class="sig-name descname">OverwriteNotAllowed</code><a class="reference internal" href="_modules/py2store/slib/s_zipfile.html#OverwriteNotAllowed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.slib.s_zipfile.OverwriteNotAllowed" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="py2store.slib.s_zipfile.ZipFileReader">
<code class="sig-prename descclassname">py2store.slib.s_zipfile.</code><code class="sig-name descname">ZipFileReader</code><a class="headerlink" href="#py2store.slib.s_zipfile.ZipFileReader" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#py2store.slib.s_zipfile.ZipFilesReader" title="py2store.slib.s_zipfile.ZipFilesReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">py2store.slib.s_zipfile.ZipFilesReader</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt id="py2store.slib.s_zipfile.ZipFileStreamsReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.slib.s_zipfile.</code><code class="sig-name descname">ZipFileStreamsReader</code><span class="sig-paren">(</span><em class="sig-param">rootdir</em>, <em class="sig-param">subpath='.+\\.zip'</em>, <em class="sig-param">pattern_for_field=None</em>, <em class="sig-param">max_levels=0</em>, <em class="sig-param">*</em>, <em class="sig-param">zip_reader=&lt;class 'py2store.slib.s_zipfile.FileStreamsOfZip'&gt;</em>, <em class="sig-param">**zip_reader_kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#py2store.slib.s_zipfile.ZipFileStreamsReader" title="Permalink to this definition">¶</a></dt>
<dd><p>Like ZipFilesReader, but objects returned are file streams instead.</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.slib.s_zipfile.ZipFilesReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.slib.s_zipfile.</code><code class="sig-name descname">ZipFilesReader</code><span class="sig-paren">(</span><em class="sig-param">rootdir</em>, <em class="sig-param">subpath='.+\\.zip'</em>, <em class="sig-param">pattern_for_field=None</em>, <em class="sig-param">max_levels=0</em>, <em class="sig-param">zip_reader=&lt;class 'py2store.slib.s_zipfile.ZipReader'&gt;</em>, <em class="sig-param">**zip_reader_kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/slib/s_zipfile.html#ZipFilesReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.slib.s_zipfile.ZipFilesReader" title="Permalink to this definition">¶</a></dt>
<dd><p>A local file reader whose keys are the zip filepaths of the rootdir and values are corresponding ZipReaders.</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.slib.s_zipfile.ZipFilesReaderAndBytesWriter">
<em class="property">class </em><code class="sig-prename descclassname">py2store.slib.s_zipfile.</code><code class="sig-name descname">ZipFilesReaderAndBytesWriter</code><span class="sig-paren">(</span><em class="sig-param">rootdir</em>, <em class="sig-param">subpath='.+\\.zip'</em>, <em class="sig-param">pattern_for_field=None</em>, <em class="sig-param">max_levels=0</em>, <em class="sig-param">zip_reader=&lt;class 'py2store.slib.s_zipfile.ZipReader'&gt;</em>, <em class="sig-param">**zip_reader_kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/slib/s_zipfile.html#ZipFilesReaderAndBytesWriter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.slib.s_zipfile.ZipFilesReaderAndBytesWriter" title="Permalink to this definition">¶</a></dt>
<dd><p>Like ZipFilesReader, but the ability to write bytes (assumed to be valid bytes of the zip format) to a key</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.slib.s_zipfile.ZipReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.slib.s_zipfile.</code><code class="sig-name descname">ZipReader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">zip_file</span></em>, <em class="sig-param"><span class="n">prefix</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">open_kws</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">file_info_filt</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/slib/s_zipfile.html#ZipReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.slib.s_zipfile.ZipReader" title="Permalink to this definition">¶</a></dt>
<dd><p>A KvReader to read the contents of a zip file.
Provides a KV perspective of <a class="reference external" href="https://docs.python.org/3/library/zipfile.html">https://docs.python.org/3/library/zipfile.html</a></p>
<p><code class="docutils literal notranslate"><span class="pre">ZipReader</span></code> has two value categories: Directories and Files.
Both categories are distinguishable by the keys, through the “ends with slash” convention.</p>
<p>When a file, the value return is bytes, as usual.</p>
<dl class="simple">
<dt>When a directory, the value returned is a <code class="docutils literal notranslate"><span class="pre">ZipReader</span></code> itself, with all params the same, except for the <code class="docutils literal notranslate"><span class="pre">prefix</span></code></dt><dd><p>which serves <cite>to specify the subfolder (that is, ``prefix`</cite> acts as a filter).</p>
</dd>
</dl>
<p>Note: If you get data zipped by a mac, you might get some junk along with it.
Namely <cite>__MACOSX</cite> folders <cite>.DS_Store</cite> files. I won’t rant about it, since others have.
But you might find it useful to remove them from view. One choice is to use <cite>py2store.trans.filt_iter</cite>
to get a filtered view of the zips contents. In most cases, this should do the job:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">#</span> <span class="pre">applied</span> <span class="pre">to</span> <span class="pre">store</span> <span class="pre">instance</span> <span class="pre">or</span> <span class="pre">class:</span>
<span class="pre">store</span> <span class="pre">=</span> <span class="pre">filt_iter(filt=lambda</span> <span class="pre">x:</span> <span class="pre">not</span> <span class="pre">x.startswith('__MACOSX')</span> <span class="pre">and</span> <span class="pre">'.DS_Store'</span> <span class="pre">not</span> <span class="pre">in</span> <span class="pre">x)(store)</span>
<span class="pre">`</span></code></p>
<p>Another option is just to remove these from the zip file once and for all. In unix-like systems:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">zip</span> <span class="pre">-d</span> <span class="pre">filename.zip</span> <span class="pre">__MACOSX/\*</span>
<span class="pre">zip</span> <span class="pre">-d</span> <span class="pre">filename.zip</span> <span class="pre">\*/.DS_Store</span>
<span class="pre">`</span></code></p>
<p class="rubric">Examples</p>
<p># &gt;&gt;&gt; s = ZipReader(‘/path/to/some_zip_file.zip’)
# &gt;&gt;&gt; len(s)
# 53432
# &gt;&gt;&gt; list(s)[:3]  # the first 3 elements (well… their keys)
# [‘odir/’, ‘odir/app/’, ‘odir/app/data/’]
# &gt;&gt;&gt; list(s)[-3:]  # the last 3 elements (well… their keys)
# [‘odir/app/data/audio/d/1574287049078391/m/Ctor.json’,
#  ‘odir/app/data/audio/d/1574287049078391/m/intensity.json’,
#  ‘odir/app/data/run/status.json’]
# &gt;&gt;&gt; # getting a file (note that by default, you get bytes, so need to decode)
# &gt;&gt;&gt; s[‘odir/app/data/run/status.json’].decode()
# b’{“test_phase_number”: 9, “test_phase”: “TestActions.IGNORE_TEST”, “session_id”: 0}’
# &gt;&gt;&gt; # when you ask for the contents for a key that’s a directory,
# &gt;&gt;&gt; # you get a ZipReader filtered for that prefix:
# &gt;&gt;&gt; s[‘odir/app/data/audio/’]
# ZipReader(‘/path/to/some_zip_file.zip’, ‘odir/app/data/audio/’, {}, &lt;function take_everything at 0x1538999e0&gt;)
# &gt;&gt;&gt; # Often, you only want files (not directories)
# &gt;&gt;&gt; # You can filter directories out using the file_info_filt argument
# &gt;&gt;&gt; s = ZipReader(‘/path/to/some_zip_file.zip’, file_info_filt=ZipReader.FILES_ONLY)
# &gt;&gt;&gt; len(s)  # compare to the 53432 above, that contained dirs too
# 53280
# &gt;&gt;&gt; list(s)[:3]  # first 3 keys are all files now
# [‘odir/app/data/plc/d/1574304926795633/d/1574305026895702’,
#  ‘odir/app/data/plc/d/1574304926795633/d/1574305276853053’,
#  ‘odir/app/data/plc/d/1574304926795633/d/1574305159343326’]
# &gt;&gt;&gt;
# &gt;&gt;&gt; # ZipReader.FILES_ONLY and ZipReader.DIRS_ONLY are just convenience filt functions
# &gt;&gt;&gt; # Really, you can provide any custom one yourself.
# &gt;&gt;&gt; # This filter function should take a ZipInfo object, and return True or False.
# &gt;&gt;&gt; # (<a class="reference external" href="https://docs.python.org/3/library/zipfile.html#zipfile.ZipInfo">https://docs.python.org/3/library/zipfile.html#zipfile.ZipInfo</a>)
# &gt;&gt;&gt;
# &gt;&gt;&gt; import re
# &gt;&gt;&gt; p = re.compile(‘audio.*.json$’)
# &gt;&gt;&gt; my_filt_func = lambda fileinfo: bool(p.search(fileinfo.filename))
# &gt;&gt;&gt; s = ZipReader(‘/Users/twhalen/Downloads/2019_11_21.zip’, file_info_filt=my_filt_func)
# &gt;&gt;&gt; len(s)
# 48
# &gt;&gt;&gt; list(s)[:3]
# [‘odir/app/data/audio/d/1574333557263758/m/Ctor.json’,
#  ‘odir/app/data/audio/d/1574333557263758/m/intensity.json’,
#  ‘odir/app/data/audio/d/1574288084739961/m/Ctor.json’]</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.slib.s_zipfile.ZipStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.slib.s_zipfile.</code><code class="sig-name descname">ZipStore</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">zip_filepath</span></em>, <em class="sig-param"><span class="n">compression</span><span class="o">=</span><span class="default_value">8</span></em>, <em class="sig-param"><span class="n">allow_overwrites</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">pwd</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/slib/s_zipfile.html#ZipStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.slib.s_zipfile.ZipStore" title="Permalink to this definition">¶</a></dt>
<dd><p>Zip read and writing.
When you want to read zips, there’s the <cite>FilesOfZip</cite>, <cite>ZipReader</cite>, or <cite>ZipFilesReader</cite> we know and love.</p>
<p>Sometimes though, you want to write to zips too. For this, we have <cite>ZipStore</cite>.</p>
<p>Since ZipStore can write to a zip, it’s read functionality is not going to assume static data,
and cache things, as your favorite zip readers did.
This, and the acrobatics need to disguise the weird zipfile into something more… key-value natural,
makes for a not so efficient store, out of the box.</p>
<dl class="simple">
<dt>I advise using one of the zip readers if all you need to do is read, or subclassing or</dt><dd><p>wrapping ZipStore with caching layers if it is appropriate to you.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="py2store.slib.s_zipfile.func_conjunction">
<code class="sig-prename descclassname">py2store.slib.s_zipfile.</code><code class="sig-name descname">func_conjunction</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func1</span></em>, <em class="sig-param"><span class="n">func2</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/slib/s_zipfile.html#func_conjunction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.slib.s_zipfile.func_conjunction" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a function that is equivalent to lambda x: func1(x) and func2(x)</p>
</dd></dl>

</div>
<div class="section" id="module-py2store.base">
<span id="py2store-base"></span><h1>py2store.base<a class="headerlink" href="#module-py2store.base" title="Permalink to this headline">¶</a></h1>
<p>Base classes for making stores.
In the language of the collections.abc module, a store is a MutableMapping that is configured to work with a specific
representation of keys, serialization of objects (python values), and persistence of the serialized data.</p>
<p>That is, stores offer the same interface as a dict, but where the actual implementation of writes, reads, and listing
are configurable.</p>
<p>Consider the following example. You’re store is meant to store waveforms as wav files on a remote server.
Say waveforms are represented in python as a tuple (wf, sr), where wf is a list of numbers and sr is the sample
rate, an int). The __setitem__ method will specify how to store bytes on a remote server, but you’ll need to specify
how to SERIALIZE (wf, sr) to the bytes that constitute that wav file: _data_of_obj specifies that.
You might also want to read those wav files back into a python (wf, sr) tuple. The __getitem__ method will get
you those bytes from the server, but the store will need to know how to DESERIALIZE those bytes back into a python
object: _obj_of_data specifies that</p>
<p>Further, say you’re storing these .wav files in /some/folder/on/the/server/, but you don’t want the store to use
these as the keys. For one, it’s annoying to type and harder to read. But more importantly, it’s an irrelevant
implementation detail that shouldn’t be exposed. THe _id_of_key and _key_of_id pair are what allow you to
add this key interface layer.</p>
<p>These key converters object serialization methods default to the identity (i.e. they return the input as is).
This means that you don’t have to implement these as all, and can choose to implement these concerns within
the storage methods themselves.</p>
<dl class="py class">
<dt id="py2store.base.Collection">
<em class="property">class </em><code class="sig-prename descclassname">py2store.base.</code><code class="sig-name descname">Collection</code><a class="reference internal" href="_modules/py2store/base.html#Collection"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.base.Collection" title="Permalink to this definition">¶</a></dt>
<dd><p>The same as collections.abc.Collection, with some modifications:
- Addition of a <code class="docutils literal notranslate"><span class="pre">head</span></code></p>
</dd></dl>

<dl class="py class">
<dt id="py2store.base.KeyValidationABC">
<em class="property">class </em><code class="sig-prename descclassname">py2store.base.</code><code class="sig-name descname">KeyValidationABC</code><a class="reference internal" href="_modules/py2store/base.html#KeyValidationABC"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.base.KeyValidationABC" title="Permalink to this definition">¶</a></dt>
<dd><p>An ABC for an object writer.
Single purpose: store an object under a given key.
How the object is serialized and or physically stored should be defined in a concrete subclass.</p>
</dd></dl>

<dl class="py class">
<dt id="py2store.base.KvPersister">
<em class="property">class </em><code class="sig-prename descclassname">py2store.base.</code><code class="sig-name descname">KvPersister</code><a class="reference internal" href="_modules/py2store/base.html#KvPersister"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.base.KvPersister" title="Permalink to this definition">¶</a></dt>
<dd><p>Acts as a MutableMapping abc, but disabling the clear and __reversed__ method,
and computing __len__ by iterating over all keys, and counting them.</p>
<p>Note that KvPersister is a MutableMapping, and as such, is dict-like.
But that doesn’t mean it’s a dict.</p>
<p>For instance, consider the following code:
<a href="#id89"><span class="problematic" id="id90">``</span></a><a href="#id91"><span class="problematic" id="id92">`</span></a></p>
<blockquote>
<div><p>s = SomeKvPersister()
s[‘a’][‘b’] = 3</p>
</div></blockquote>
<p><a href="#id93"><span class="problematic" id="id94">``</span></a>`
If <cite>s</cite> is a dict, this would have the effect of adding a (‘b’, 3) item under ‘a’.
But in the general case, this might
- fail, because the <cite>s[‘a’]</cite> doesn’t support sub-scripting (doesn’t have a <cite>__getitem__</cite>)
- or, worse, will pass silently but not actually persist the write as expected (e.g. LocalFileStore)</p>
<p>Another example: <cite>s.popitem()</cite> will pop a <cite>(k, v)</cite> pair off of the <cite>s</cite> store.
That is, retrieve the <cite>v</cite> for <cite>k</cite>, delete the entry for <cite>k</cite>, and return a <cite>(k, v)</cite>.
Note that unlike modern dicts which will return the last item that was stored</p>
<blockquote>
<div><p>– that is, LIFO (last-in, first-out) order – for KvPersisters,
there’s no assurance as to what item will be, since it will depend on the backend storage system
and/or how the persister was implemented.</p>
</div></blockquote>
<dl class="py method">
<dt id="py2store.base.KvPersister.clear">
<code class="sig-name descname">clear</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/base.html#KvPersister.clear"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.base.KvPersister.clear" title="Permalink to this definition">¶</a></dt>
<dd><p>The clear method is disabled to make dangerous difficult.
You don’t want to delete your whole DB
If you really want to delete all your data, you can do so by doing something like this:</p>
<blockquote>
<div><p><a href="#id95"><span class="problematic" id="id96">``</span></a>`
for k in self:</p>
<blockquote>
<div><dl class="simple">
<dt>try:</dt><dd><p>del self[k]</p>
</dd>
<dt>except KeyError:</dt><dd><p>pass</p>
</dd>
</dl>
</div></blockquote>
<p><a href="#id97"><span class="problematic" id="id98">``</span></a><a href="#id99"><span class="problematic" id="id100">`</span></a></p>
</div></blockquote>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="py2store.base.KvReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.base.</code><code class="sig-name descname">KvReader</code><a class="reference internal" href="_modules/py2store/base.html#KvReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.base.KvReader" title="Permalink to this definition">¶</a></dt>
<dd><p>Acts as a Mapping abc, but with default __len__ (implemented by counting keys)
and head method to get the first (k, v) item of the store</p>
</dd></dl>

<dl class="py attribute">
<dt id="py2store.base.KvStore">
<code class="sig-prename descclassname">py2store.base.</code><code class="sig-name descname">KvStore</code><a class="headerlink" href="#py2store.base.KvStore" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#py2store.base.Store" title="py2store.base.Store"><code class="xref py py-class docutils literal notranslate"><span class="pre">py2store.base.Store</span></code></a></p>
</dd></dl>

<dl class="py attribute">
<dt id="py2store.base.Persister">
<code class="sig-prename descclassname">py2store.base.</code><code class="sig-name descname">Persister</code><a class="headerlink" href="#py2store.base.Persister" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#py2store.base.KvPersister" title="py2store.base.KvPersister"><code class="xref py py-class docutils literal notranslate"><span class="pre">py2store.base.KvPersister</span></code></a></p>
</dd></dl>

<dl class="py attribute">
<dt id="py2store.base.Reader">
<code class="sig-prename descclassname">py2store.base.</code><code class="sig-name descname">Reader</code><a class="headerlink" href="#py2store.base.Reader" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#py2store.base.KvReader" title="py2store.base.KvReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">py2store.base.KvReader</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt id="py2store.base.Store">
<em class="property">class </em><code class="sig-prename descclassname">py2store.base.</code><code class="sig-name descname">Store</code><span class="sig-paren">(</span><em class="sig-param">store=&lt;class 'dict'&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/base.html#Store"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.base.Store" title="Permalink to this definition">¶</a></dt>
<dd><p>By store we mean key-value store. This could be files in a filesystem, objects in s3, or a database. Where and
how the content is stored should be specified, but StoreInterface offers a dict-like interface to this.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="fm">__getitem__</span> <span class="n">calls</span><span class="p">:</span> <span class="n">_id_of_key</span>                                       <span class="n">_obj_of_data</span>
<span class="fm">__setitem__</span> <span class="n">calls</span><span class="p">:</span> <span class="n">_id_of_key</span>                   <span class="n">_data_of_obj</span>
<span class="fm">__delitem__</span> <span class="n">calls</span><span class="p">:</span> <span class="n">_id_of_key</span>
<span class="fm">__iter__</span>    <span class="n">calls</span><span class="p">:</span>                  <span class="n">_key_of_id</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Default store: no key or value conversion ################################################</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Store</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">33</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">65</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="mi">33</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="mi">65</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="mi">33</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="mi">65</span><span class="p">)]</span>  <span class="c1"># see that the store contains the same thing</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">################################################################################################</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Now let&#39;s make stores that have a key and value conversion layer #############################</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># input keys will be upper cased, and output keys lower cased ##################################</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># input values (assumed int) will be converted to ascii string, and visa versa #################</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">################################################################################################</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">test_store</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">s</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">33</span>  <span class="c1"># write 33 to &#39;foo&#39;</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="s1">&#39;foo&#39;</span> <span class="ow">in</span> <span class="n">s</span>  <span class="c1"># __contains__ works</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="s1">&#39;no_such_key&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span>  <span class="c1"># __nin__ works</span>
<span class="gp">... </span>    <span class="n">s</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">65</span>  <span class="c1"># write 65 to &#39;bar&#39;</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>  <span class="c1"># there are indeed two elements</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">]</span>  <span class="c1"># these are the keys</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">]</span>  <span class="c1"># the keys() method works!</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">==</span> <span class="p">[</span><span class="mi">33</span><span class="p">,</span> <span class="mi">65</span><span class="p">]</span>  <span class="c1"># the values() method works!</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="mi">33</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="mi">65</span><span class="p">)]</span>  <span class="c1"># these are the items</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">&#39;FOO&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;BAR&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">)]</span>  <span class="c1"># but note the internal representation</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">33</span>  <span class="c1"># the get method works</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;no_such_key&#39;</span><span class="p">,</span> <span class="s1">&#39;something&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;something&#39;</span>  <span class="c1"># return a default value</span>
<span class="gp">... </span>    <span class="k">del</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">])</span>  <span class="c1"># you can delete an item given its key</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>  <span class="c1"># see, only one item left!</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="mi">65</span><span class="p">)]</span>  <span class="c1"># here it is</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># We can introduce this conversion layer in several ways. Here&#39;s a few... ######################</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># by subclassing ###############################################################################</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyStore</span><span class="p">(</span><span class="n">Store</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_id_of_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_key_of_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_id</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_data_of_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">chr</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_obj_of_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">MyStore</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="nb">dict</span><span class="p">())</span>  <span class="c1"># note that you don&#39;t need to specify dict(), since it&#39;s the default</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">test_store</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># by assigning functions to converters ##########################################################</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyStore</span><span class="p">(</span><span class="n">Store</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">_id_of_key</span><span class="p">,</span> <span class="n">_key_of_id</span><span class="p">,</span> <span class="n">_data_of_obj</span><span class="p">,</span> <span class="n">_obj_of_data</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_id_of_key</span> <span class="o">=</span> <span class="n">_id_of_key</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_key_of_id</span> <span class="o">=</span> <span class="n">_key_of_id</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_data_of_obj</span> <span class="o">=</span> <span class="n">_data_of_obj</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_obj_of_data</span> <span class="o">=</span> <span class="n">_obj_of_data</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">MyStore</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span>
<span class="gp">... </span>            <span class="n">_id_of_key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
<span class="gp">... </span>            <span class="n">_key_of_id</span><span class="o">=</span><span class="k">lambda</span> <span class="n">_id</span><span class="p">:</span> <span class="n">_id</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
<span class="gp">... </span>            <span class="n">_data_of_obj</span><span class="o">=</span><span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="nb">chr</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">_obj_of_data</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">test_store</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># using a Mixin class #############################################################################</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Mixin</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_id_of_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_key_of_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_id</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_data_of_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">chr</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_obj_of_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyStore</span><span class="p">(</span><span class="n">Mixin</span><span class="p">,</span> <span class="n">Store</span><span class="p">):</span>  <span class="c1"># note that the Mixin must come before Store in the mro</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">MyStore</span><span class="p">()</span>  <span class="c1"># no dict()? No, because default anyway</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">test_store</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># adding wrapper methods to an already made Store instance #########################################</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Store</span><span class="p">(</span><span class="nb">dict</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">_id_of_key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">_key_of_id</span><span class="o">=</span><span class="k">lambda</span> <span class="n">_id</span><span class="p">:</span> <span class="n">_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">_data_of_obj</span><span class="o">=</span><span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="nb">chr</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">_obj_of_data</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">test_store</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
<dl class="py method">
<dt id="py2store.base.Store.get">
<code class="sig-name descname">get</code><span class="sig-paren">(</span><em class="sig-param">k</em><span class="optional">[</span>, <em class="sig-param">d</em><span class="optional">]</span><span class="sig-paren">)</span> &#x2192; D[k] if k in D, else d.  d defaults to None.<a class="reference internal" href="_modules/py2store/base.html#Store.get"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.base.Store.get" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="py2store.base.Stream">
<em class="property">class </em><code class="sig-prename descclassname">py2store.base.</code><code class="sig-name descname">Stream</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">stream</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/base.html#Stream"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.base.Stream" title="Permalink to this definition">¶</a></dt>
<dd><p>A layer-able version of the stream interface</p>
<blockquote>
<div><p>__iter__    calls: _obj_of_data(map)
readlines   calls: _obj_of_data(though iter)
readline    calls: _obj_of_data</p>
</div></blockquote>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">src</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span>
<span class="gp">... </span><span class="sd">&#39;&#39;&#39;a, b, c</span>
<span class="gp">... </span><span class="sd">1,2, 3</span>
<span class="gp">... </span><span class="sd">4, 5,6</span>
<span class="gp">... </span><span class="sd">&#39;&#39;&#39;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store.base</span> <span class="kn">import</span> <span class="n">Stream</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyStream</span><span class="p">(</span><span class="n">Stream</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_obj_of_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stream</span> <span class="o">=</span> <span class="n">MyStream</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span> <span class="o">==</span> <span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">stream</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span> <span class="o">==</span> <span class="p">[]</span>  <span class="c1"># readlines should do the same as list(stream)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># oh!... but we consumed the stream already, so let&#39;s go back to the beginning</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">stream</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span> <span class="o">==</span> <span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">]]</span>  <span class="c1"># same as list(stream)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># reverse again</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">stream</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">stream</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Let’s add a filter! There’s two kinds you can use.
One that is applied to the line before the data is transformed by _obj_of_data,
and the other that is applied after (to the obj).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store.base</span> <span class="kn">import</span> <span class="n">Stream</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">src</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span>
<span class="gp">... </span>    <span class="sd">&#39;&#39;&#39;a, b, c</span>
<span class="gp">... </span><span class="sd">1,2, 3</span>
<span class="gp">... </span><span class="sd">4, 5,6</span>
<span class="gp">... </span><span class="sd">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyFilteredStream</span><span class="p">(</span><span class="n">MyStream</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_post_filt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">str</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">MyFilteredStream</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="p">[[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span> <span class="o">==</span> <span class="p">[[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">]]</span>  <span class="c1"># same as list(stream)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Recipes:
- _pre_iter: involving itertools.islice to skip header lines
- _pre_iter: involving enumerate to get line indices in stream iterator
- _pre_iter = functools.partial(map, line_pre_proc_func) to preprocess all lines with line_pre_proc_func
- _pre_iter: include filter before obj</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.base.has_kv_store_interface">
<code class="sig-prename descclassname">py2store.base.</code><code class="sig-name descname">has_kv_store_interface</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">o</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/base.html#has_kv_store_interface"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.base.has_kv_store_interface" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if object has the KvStore interface (that is, has the kv wrapper methods</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>o</strong> – object (class or instance)</p>
</dd>
</dl>
<p>Returns: True if kv has the four key (in/out) and value (in/out) transformation methods</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.base.kv_walk">
<code class="sig-prename descclassname">py2store.base.</code><code class="sig-name descname">kv_walk</code><span class="sig-paren">(</span><em class="sig-param">v: collections.abc.Mapping</em>, <em class="sig-param">yield_func=&lt;function asis&gt;</em>, <em class="sig-param">walk_filt=&lt;function val_is_mapping&gt;</em>, <em class="sig-param">pkv_to_pv=&lt;function tuple_keypath_and_val&gt;</em>, <em class="sig-param">p=()</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/base.html#kv_walk"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.base.kv_walk" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>v</strong> – </p></li>
<li><p><strong>yield_func</strong> – (pp, k, vv) -&gt; what ever you want the gen to yield</p></li>
<li><p><strong>walk_filt</strong> – (p, k, vv) -&gt; (bool) whether to explore the nested structure v further</p></li>
<li><p><strong>pkv_to_pv</strong> – (p, k, v) -&gt; (pp, vv)
where pp is a form of p + k (update of the path with the new node k)
and vv is the value that will be used by both walk_filt and yield_func</p></li>
<li><p><strong>p</strong> – The path to v</p></li>
</ul>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">kv_walk</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
<span class="go">[((&#39;a&#39;,), &#39;a&#39;, 1), ((&#39;b&#39;, &#39;c&#39;), &#39;c&#39;, 2), ((&#39;b&#39;, &#39;d&#39;), &#39;d&#39;, 3)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">kv_walk</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="p">)))</span>
<span class="go">[&#39;a&#39;, &#39;b.c&#39;, &#39;b.d&#39;]</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="py2store-selectors-mg-selectors">
<h1>py2store.selectors.mg_selectors<a class="headerlink" href="#py2store-selectors-mg-selectors" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="py2store-selectors-mongoquery">
<h1>py2store.selectors.mongoquery<a class="headerlink" href="#py2store-selectors-mongoquery" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="py2store-selectors">
<h1>py2store.selectors<a class="headerlink" href="#py2store-selectors" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="module-py2store.parse_format">
<span id="py2store-parse-format"></span><h1>py2store.parse_format<a class="headerlink" href="#module-py2store.parse_format" title="Permalink to this headline">¶</a></h1>
<p>Modified from <a class="reference external" href="https://github.com/r1chardj0n3s/parse">https://github.com/r1chardj0n3s/parse</a></p>
<p>Parse strings using a specification based on the Python format() syntax.</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">parse()</span></code> is the opposite of <code class="docutils literal notranslate"><span class="pre">format()</span></code></p>
</div></blockquote>
<p>From there it’s a simple thing to parse a string:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;It&#39;s </span><span class="si">{}</span><span class="s2">, I love it!&quot;</span><span class="p">,</span> <span class="s2">&quot;It&#39;s spam, I love it!&quot;</span><span class="p">)</span>
<span class="go">&lt;Result (&#39;spam&#39;,) {}&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&#39;spam&#39;</span>
</pre></div>
</div>
<p>Or to search a string for some pattern:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Age: </span><span class="si">{:d}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;Name: Rufus</span><span class="se">\n</span><span class="s1">Age: 42</span><span class="se">\n</span><span class="s1">Color: red</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="go">&lt;Result (42,) {}&gt;</span>
</pre></div>
</div>
<p>Or find all the occurrences of some pattern in a string:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">fixed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">findall</span><span class="p">(</span><span class="s2">&quot;&gt;</span><span class="si">{}</span><span class="s2">&lt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;p&gt;the &lt;b&gt;bold&lt;/b&gt; text&lt;/p&gt;&quot;</span><span class="p">))</span>
<span class="go">&#39;the bold text&#39;</span>
</pre></div>
</div>
<p>If you’re going to use the same pattern to match lots of strings you can
compile it once:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="s2">&quot;It&#39;s </span><span class="si">{}</span><span class="s2">, I love it!&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="go">&lt;Parser &quot;It&#39;s {}, I love it!&quot;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;It&#39;s spam, I love it!&quot;</span><span class="p">)</span>
<span class="go">&lt;Result (&#39;spam&#39;,) {}&gt;</span>
</pre></div>
</div>
<p>(“compile” is not exported for <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">*</span></code> usage as it would override the
built-in <code class="docutils literal notranslate"><span class="pre">compile()</span></code> function)</p>
<p>The default behaviour is to match strings case insensitively. You may match with
case by specifying <cite>case_sensitive=True</cite>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;SPAM&#39;</span><span class="p">,</span> <span class="s1">&#39;spam&#39;</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="section" id="format-syntax">
<h2>Format Syntax<a class="headerlink" href="#format-syntax" title="Permalink to this headline">¶</a></h2>
<p>A basic version of the <a class="reference external" href="http://docs.python.org/library/string.html#format-string-syntax">Format String Syntax</a> is supported with anonymous
(fixed-position), named and formatted fields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{[</span><span class="n">field</span> <span class="n">name</span><span class="p">]:[</span><span class="nb">format</span> <span class="n">spec</span><span class="p">]}</span>
</pre></div>
</div>
<p>Field names must be a valid Python identifiers, including dotted names;
element indexes imply dictionaries (see below for example).</p>
<p>Numbered fields are also not supported: the result of parsing will include
the parsed fields in the order they are parsed.</p>
<p>The conversion of fields to types other than strings is done based on the
type in the format specification, which mirrors the <code class="docutils literal notranslate"><span class="pre">format()</span></code> behaviour.
There are no “!” field conversions like <code class="docutils literal notranslate"><span class="pre">format()</span></code> has.</p>
<p>Some simple parse() format string examples:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;Bring me a </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;Bring me a shrubbery&quot;</span><span class="p">)</span>
<span class="go">&lt;Result (&#39;shrubbery&#39;,) {}&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="s2">&quot;The </span><span class="si">{}</span><span class="s2"> who say </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;The knights who say Ni!&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="go">&lt;Result (&#39;knights&#39;, &#39;Ni!&#39;) {}&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">fixed</span><span class="p">)</span>
<span class="go">(&#39;knights&#39;, &#39;Ni!&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="s2">&quot;Bring out the holy </span><span class="si">{item}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;Bring out the holy hand grenade&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="go">&lt;Result () {&#39;item&#39;: &#39;hand grenade&#39;}&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">named</span><span class="p">)</span>
<span class="go">{&#39;item&#39;: &#39;hand grenade&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">])</span>
<span class="go">hand grenade</span>
</pre></div>
</div>
<p>Dotted names and indexes are possible though the application must make
additional sense of the result:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="s2">&quot;Mmm, </span><span class="si">{food.type}</span><span class="s2">, I love it!&quot;</span><span class="p">,</span> <span class="s2">&quot;Mmm, spam, I love it!&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="go">&lt;Result () {&#39;food.type&#39;: &#39;spam&#39;}&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">named</span><span class="p">)</span>
<span class="go">{&#39;food.type&#39;: &#39;spam&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;food.type&#39;</span><span class="p">])</span>
<span class="go">spam</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="s2">&quot;My quest is </span><span class="si">{quest[name]}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;My quest is to seek the holy grail!&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="go">&lt;Result () {&#39;quest&#39;: {&#39;name&#39;: &#39;to seek the holy grail!&#39;}}&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;quest&#39;</span><span class="p">])</span>
<span class="go">{&#39;name&#39;: &#39;to seek the holy grail!&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;quest&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
<span class="go">to seek the holy grail!</span>
</pre></div>
</div>
<p>If the text you’re matching has braces in it you can match those by including
a double-brace <code class="docutils literal notranslate"><span class="pre">{{</span></code> or <code class="docutils literal notranslate"><span class="pre">}}</span></code> in your format string, just like format() does.</p>
</div>
<div class="section" id="format-specification">
<h2>Format Specification<a class="headerlink" href="#format-specification" title="Permalink to this headline">¶</a></h2>
<p>Most often a straight format-less <code class="docutils literal notranslate"><span class="pre">{}</span></code> will suffice where a more complex
format specification might have been used.</p>
<p>Most of <cite>format()</cite>’s <a class="reference external" href="http://docs.python.org/library/string.html#format-specification-mini-language">Format Specification Mini-Language</a> is supported:</p>
<blockquote>
<div><p>[[fill]align][0][width][.precision][type]</p>
</div></blockquote>
<p>The differences between <cite>parse()</cite> and <cite>format()</cite> are:</p>
<ul class="simple">
<li><p>The align operators will cause spaces (or specified fill character) to be
stripped from the parsed value. The width is not enforced; it just indicates
there may be whitespace or “0”s to strip.</p></li>
<li><p>Numeric parsing will automatically handle a “0b”, “0o” or “0x” prefix.
That is, the “#” format character is handled automatically by d, b, o
and x formats. For “d” any will be accepted, but for the others the correct
prefix must be present if at all.</p></li>
<li><p>Numeric sign is handled automatically.</p></li>
<li><p>The thousands separator is handled automatically if the “n” type is used.</p></li>
<li><p>The types supported are a slightly different mix to the format() types.  Some
format() types come directly over: “d”, “n”, “%”, “f”, “e”, “b”, “o” and “x”.
In addition some regular expression character group types “D”, “w”, “W”, “s”
and “S” are also available.</p></li>
<li><p>The “e” and “g” types are case-insensitive so there is not need for
the “E” or “G” types.</p></li>
</ul>
<table class="docutils align-default">
<colgroup>
<col style="width: 9%" />
<col style="width: 77%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Characters Matched</p></th>
<th class="head"><p>Output</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>w</p></td>
<td><p>Letters and underscore</p></td>
<td><p>str</p></td>
</tr>
<tr class="row-odd"><td><p>W</p></td>
<td><p>Non-letter and underscore</p></td>
<td><p>str</p></td>
</tr>
<tr class="row-even"><td><p>s</p></td>
<td><p>Whitespace</p></td>
<td><p>str</p></td>
</tr>
<tr class="row-odd"><td><p>S</p></td>
<td><p>Non-whitespace</p></td>
<td><p>str</p></td>
</tr>
<tr class="row-even"><td><p>d</p></td>
<td><p>Digits (effectively integer numbers)</p></td>
<td><p>int</p></td>
</tr>
<tr class="row-odd"><td><p>D</p></td>
<td><p>Non-digit</p></td>
<td><p>str</p></td>
</tr>
<tr class="row-even"><td><p>n</p></td>
<td><p>Numbers with thousands separators (, or .)</p></td>
<td><p>int</p></td>
</tr>
<tr class="row-odd"><td><p>%</p></td>
<td><p>Percentage (converted to value/100.0)</p></td>
<td><p>float</p></td>
</tr>
<tr class="row-even"><td><p>f</p></td>
<td><p>Fixed-point numbers</p></td>
<td><p>float</p></td>
</tr>
<tr class="row-odd"><td><p>F</p></td>
<td><p>Decimal numbers</p></td>
<td><p>Decimal</p></td>
</tr>
<tr class="row-even"><td><p>e</p></td>
<td><p>Floating-point numbers with exponent
e.g. 1.1e-10, NAN (all case insensitive)</p></td>
<td><p>float</p></td>
</tr>
<tr class="row-odd"><td><p>g</p></td>
<td><p>General number format (either d, f or e)</p></td>
<td><p>float</p></td>
</tr>
<tr class="row-even"><td><p>b</p></td>
<td><p>Binary numbers</p></td>
<td><p>int</p></td>
</tr>
<tr class="row-odd"><td><p>o</p></td>
<td><p>Octal numbers</p></td>
<td><p>int</p></td>
</tr>
<tr class="row-even"><td><p>x</p></td>
<td><p>Hexadecimal numbers (lower and upper case)</p></td>
<td><p>int</p></td>
</tr>
<tr class="row-odd"><td><p>ti</p></td>
<td><p>ISO 8601 format date/time
e.g. 1972-01-20T10:21:36Z (“T” and “Z”
optional)</p></td>
<td><p>datetime</p></td>
</tr>
<tr class="row-even"><td><p>te</p></td>
<td><p>RFC2822 e-mail format date/time
e.g. Mon, 20 Jan 1972 10:21:36 +1000</p></td>
<td><p>datetime</p></td>
</tr>
<tr class="row-odd"><td><p>tg</p></td>
<td><p>Global (day/month) format date/time
e.g. 20/1/1972 10:21:36 AM +1:00</p></td>
<td><p>datetime</p></td>
</tr>
<tr class="row-even"><td><p>ta</p></td>
<td><p>US (month/day) format date/time
e.g. 1/20/1972 10:21:36 PM +10:30</p></td>
<td><p>datetime</p></td>
</tr>
<tr class="row-odd"><td><p>tc</p></td>
<td><p>ctime() format date/time
e.g. Sun Sep 16 01:03:52 1973</p></td>
<td><p>datetime</p></td>
</tr>
<tr class="row-even"><td><p>th</p></td>
<td><p>HTTP log format date/time
e.g. 21/Nov/2011:00:07:11 +0000</p></td>
<td><p>datetime</p></td>
</tr>
<tr class="row-odd"><td><p>ts</p></td>
<td><p>Linux system log format date/time
e.g. Nov  9 03:37:44</p></td>
<td><p>datetime</p></td>
</tr>
<tr class="row-even"><td><p>tt</p></td>
<td><p>Time
e.g. 10:21:36 PM -5:30</p></td>
<td><p>time</p></td>
</tr>
</tbody>
</table>
<p>Some examples of typed parsing with <code class="docutils literal notranslate"><span class="pre">None</span></code> returned if the typing
does not match:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;Our </span><span class="si">{:d}</span><span class="s1"> {:w} are...&#39;</span><span class="p">,</span> <span class="s1">&#39;Our 3 weapons are...&#39;</span><span class="p">)</span>
<span class="go">&lt;Result (3, &#39;weapons&#39;) {}&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;Our </span><span class="si">{:d}</span><span class="s1"> {:w} are...&#39;</span><span class="p">,</span> <span class="s1">&#39;Our three weapons are...&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;Meet at {:tg}&#39;</span><span class="p">,</span> <span class="s1">&#39;Meet at 1/2/2011 11:00 PM&#39;</span><span class="p">)</span>
<span class="go">&lt;Result (datetime.datetime(2011, 2, 1, 23, 0),) {}&gt;</span>
</pre></div>
</div>
<p>And messing about with alignment:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;with </span><span class="si">{:&gt;}</span><span class="s1"> herring&#39;</span><span class="p">,</span> <span class="s1">&#39;with     a herring&#39;</span><span class="p">)</span>
<span class="go">&lt;Result (&#39;a&#39;,) {}&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;spam </span><span class="si">{:^}</span><span class="s1"> spam&#39;</span><span class="p">,</span> <span class="s1">&#39;spam    lovely     spam&#39;</span><span class="p">)</span>
<span class="go">&lt;Result (&#39;lovely&#39;,) {}&gt;</span>
</pre></div>
</div>
<p>Note that the “center” alignment does not test to make sure the value is
centered - it just strips leading and trailing whitespace.</p>
<p>Width and precision may be used to restrict the size of matched text
from the input. Width specifies a minimum size and precision specifies
a maximum. For example:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.2}{:.2}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;look&#39;</span><span class="p">)</span>           <span class="c1"># specifying precision</span>
<span class="go">&lt;Result (&#39;lo&#39;, &#39;ok&#39;) {}&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:4}{:4}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;look at that&#39;</span><span class="p">)</span>     <span class="c1"># specifying width</span>
<span class="go">&lt;Result (&#39;look&#39;, &#39;at that&#39;) {}&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:4}{:.4}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;look at that&#39;</span><span class="p">)</span>    <span class="c1"># specifying both</span>
<span class="go">&lt;Result (&#39;look at &#39;, &#39;that&#39;) {}&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:2d}{:2d}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;0440&#39;</span><span class="p">)</span>           <span class="c1"># parsing two contiguous numbers</span>
<span class="go">&lt;Result (4, 40) {}&gt;</span>
</pre></div>
</div>
<p>Some notes for the date and time types:</p>
<ul class="simple">
<li><p>the presence of the time part is optional (including ISO 8601, starting
at the “T”). A full datetime object will always be returned; the time
will be set to 00:00:00. You may also specify a time without seconds.</p></li>
<li><p>when a seconds amount is present in the input fractions will be parsed
to give microseconds.</p></li>
<li><p>except in ISO 8601 the day and month digits may be 0-padded.</p></li>
<li><p>the date separator for the tg and ta formats may be “-” or “/”.</p></li>
<li><p>named months (abbreviations or full names) may be used in the ta and tg
formats in place of numeric months.</p></li>
<li><p>as per RFC 2822 the e-mail format may omit the day (and comma), and the
seconds but nothing else.</p></li>
<li><p>hours greater than 12 will be happily accepted.</p></li>
<li><p>the AM/PM are optional, and if PM is found then 12 hours will be added
to the datetime object’s hours amount - even if the hour is greater
than 12 (for consistency.)</p></li>
<li><p>in ISO 8601 the “Z” (UTC) timezone part may be a numeric offset</p></li>
<li><p>timezones are specified as “+HH:MM” or “-HH:MM”. The hour may be one or two
digits (0-padded is OK.) Also, the “:” is optional.</p></li>
<li><p>the timezone is optional in all except the e-mail format (it defaults to
UTC.)</p></li>
<li><p>named timezones are not handled yet.</p></li>
</ul>
<p>Note: attempting to match too many datetime fields in a single parse() will
currently result in a resource allocation issue. A TooManyFields exception
will be raised in this instance. The current limit is about 15. It is hoped
that this limit will be removed one day.</p>
</div>
<div class="section" id="result-and-match-objects">
<h2>Result and Match Objects<a class="headerlink" href="#result-and-match-objects" title="Permalink to this headline">¶</a></h2>
<p>The result of a <code class="docutils literal notranslate"><span class="pre">parse()</span></code> and <code class="docutils literal notranslate"><span class="pre">search()</span></code> operation is either <code class="docutils literal notranslate"><span class="pre">None</span></code> (no match), a
<code class="docutils literal notranslate"><span class="pre">Result</span></code> instance or a <code class="docutils literal notranslate"><span class="pre">Match</span></code> instance if <code class="docutils literal notranslate"><span class="pre">evaluate_result</span></code> is False.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Result</span></code> instance has three attributes:</p>
<dl class="simple">
<dt>fixed</dt><dd><p>A tuple of the fixed-position, anonymous fields extracted from the input.</p>
</dd>
<dt>named</dt><dd><p>A dictionary of the named fields extracted from the input.</p>
</dd>
<dt>spans</dt><dd><p>A dictionary mapping the names and fixed position indices matched to a
2-tuple slice range of where the match occurred in the input.
The span does not include any stripped padding (alignment or width).</p>
</dd>
</dl>
<p>The <code class="docutils literal notranslate"><span class="pre">Match</span></code> instance has one method:</p>
<dl class="simple">
<dt>evaluate_result()</dt><dd><p>Generates and returns a <code class="docutils literal notranslate"><span class="pre">Result</span></code> instance for this <code class="docutils literal notranslate"><span class="pre">Match</span></code> object.</p>
</dd>
</dl>
</div>
<div class="section" id="custom-type-conversions">
<h2>Custom Type Conversions<a class="headerlink" href="#custom-type-conversions" title="Permalink to this headline">¶</a></h2>
<p>If you wish to have matched fields automatically converted to your own type you
may pass in a dictionary of type conversion information to <code class="docutils literal notranslate"><span class="pre">parse()</span></code> and
<code class="docutils literal notranslate"><span class="pre">compile()</span></code>.</p>
<p>The converter will be passed the field string matched. Whatever it returns
will be substituted in the <code class="docutils literal notranslate"><span class="pre">Result</span></code> instance for that field.</p>
<p>Your custom type conversions may override the builtin types if you supply one
with the same identifier.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">shouty</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
<span class="gp">... </span>   <span class="k">return</span> <span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;{:shouty} world&#39;</span><span class="p">,</span> <span class="s1">&#39;hello world&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">shouty</span><span class="o">=</span><span class="n">shouty</span><span class="p">))</span>
<span class="go">&lt;Result (&#39;HELLO&#39;,) {}&gt;</span>
</pre></div>
</div>
<p>If the type converter has the optional <code class="docutils literal notranslate"><span class="pre">pattern</span></code> attribute, it is used as
regular expression for better pattern matching (instead of the default one).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">parse_number</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="gp">... </span>   <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parse_number</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\d+&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;Answer: {number:Number}&#39;</span><span class="p">,</span> <span class="s1">&#39;Answer: 42&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Number</span><span class="o">=</span><span class="n">parse_number</span><span class="p">))</span>
<span class="go">&lt;Result () {&#39;number&#39;: 42}&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="s1">&#39;Answer: {:Number}&#39;</span><span class="p">,</span> <span class="s1">&#39;Answer: Alice&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Number</span><span class="o">=</span><span class="n">parse_number</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;MISMATCH&quot;</span>
</pre></div>
</div>
<p>You can also use the <code class="docutils literal notranslate"><span class="pre">with_pattern(pattern)</span></code> decorator to add this
information to a type converter function:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@with_pattern</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">parse_number</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="gp">... </span>   <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;Answer: {number:Number}&#39;</span><span class="p">,</span> <span class="s1">&#39;Answer: 42&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Number</span><span class="o">=</span><span class="n">parse_number</span><span class="p">))</span>
<span class="go">&lt;Result () {&#39;number&#39;: 42}&gt;</span>
</pre></div>
</div>
<p>A more complete example of a custom type might be:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">yesno_mapping</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s2">&quot;yes&quot;</span><span class="p">:</span>  <span class="kc">True</span><span class="p">,</span>   <span class="s2">&quot;no&quot;</span><span class="p">:</span>    <span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;on&quot;</span><span class="p">:</span>   <span class="kc">True</span><span class="p">,</span>   <span class="s2">&quot;off&quot;</span><span class="p">:</span>   <span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;true&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>   <span class="s2">&quot;false&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@with_pattern</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">yesno_mapping</span><span class="p">))</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">parse_yesno</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">yesno_mapping</span><span class="p">[</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
</pre></div>
</div>
<p>If the type converter <code class="docutils literal notranslate"><span class="pre">pattern</span></code> uses regex-grouping (with parenthesis),
you should indicate this by using the optional <code class="docutils literal notranslate"><span class="pre">regex_group_count</span></code> parameter
in the <code class="docutils literal notranslate"><span class="pre">with_pattern()</span></code> decorator:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@with_pattern</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;((\d+))&#39;</span><span class="p">,</span> <span class="n">regex_group_count</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">parse_number2</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="gp">... </span>   <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;Answer: {:Number2} {:Number2}&#39;</span><span class="p">,</span> <span class="s1">&#39;Answer: 42 43&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Number2</span><span class="o">=</span><span class="n">parse_number2</span><span class="p">))</span>
<span class="go">&lt;Result (42, 43) {}&gt;</span>
</pre></div>
</div>
<p>Otherwise, this may cause parsing problems with unnamed/fixed parameters.</p>
</div>
<div class="section" id="potential-gotchas">
<h2>Potential Gotchas<a class="headerlink" href="#potential-gotchas" title="Permalink to this headline">¶</a></h2>
<p><cite>parse()</cite> will always match the shortest text necessary (from left to right)
to fulfil the parse pattern, so for example:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pattern</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{dir1}</span><span class="s1">/</span><span class="si">{dir2}</span><span class="s1">&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;root/parent/subdir&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">parse</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">named</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;dir1&#39;, &#39;root&#39;), (&#39;dir2&#39;, &#39;parent/subdir&#39;)]</span>
</pre></div>
</div>
<p>So, even though <cite>{‘dir1’: ‘root/parent’, ‘dir2’: ‘subdir’}</cite> would also fit
the pattern, the actual match represents the shortest successful match for
<cite>dir1</cite>.</p>
<hr class="docutils" />
<p><strong>Version history (in brief)</strong>:</p>
<ul class="simple">
<li><p>1.9.0 We now honor precision and width specifiers when parsing numbers
and strings, allowing parsing of concatenated elements of fixed width
(thanks Julia Signell)</p></li>
<li><p>1.8.4 Add LICENSE file at request of packagers.
Correct handling of AM/PM to follow most common interpretation.
Correct parsing of hexadecimal that looks like a binary prefix.
Add ability to parse case sensitively.
Add parsing of numbers to Decimal with “F” (thanks John Vandenberg)</p></li>
<li><p>1.8.3 Add regex_group_count to with_pattern() decorator to support
user-defined types that contain brackets/parenthesis (thanks Jens Engel)</p></li>
<li><p>1.8.2 add documentation for including braces in format string</p></li>
<li><p>1.8.1 ensure bare hexadecimal digits are not matched</p></li>
<li><p>1.8.0 support manual control over result evaluation (thanks Timo Furrer)</p></li>
<li><p>1.7.0 parse dict fields (thanks Mark Visser) and adapted to allow
more than 100 re groups in Python 3.5+ (thanks David King)</p></li>
<li><p>1.6.6 parse Linux system log dates (thanks Alex Cowan)</p></li>
<li><p>1.6.5 handle precision in float format (thanks Levi Kilcher)</p></li>
<li><p>1.6.4 handle pipe “|” characters in parse string (thanks Martijn Pieters)</p></li>
<li><p>1.6.3 handle repeated instances of named fields, fix bug in PM time
overflow</p></li>
<li><p>1.6.2 fix logging to use local, not root logger (thanks Necku)</p></li>
<li><p>1.6.1 be more flexible regarding matched ISO datetimes and timezones in
general, fix bug in timezones without “:” and improve docs</p></li>
<li><p>1.6.0 add support for optional <code class="docutils literal notranslate"><span class="pre">pattern</span></code> attribute in user-defined types
(thanks Jens Engel)</p></li>
<li><p>1.5.3 fix handling of question marks</p></li>
<li><p>1.5.2 fix type conversion error with dotted names (thanks Sebastian Thiel)</p></li>
<li><p>1.5.1 implement handling of named datetime fields</p></li>
<li><p>1.5 add handling of dotted field names (thanks Sebastian Thiel)</p></li>
<li><p>1.4.1 fix parsing of “0” in int conversion (thanks James Rowe)</p></li>
<li><p>1.4 add __getitem__ convenience access on Result.</p></li>
<li><p>1.3.3 fix Python 2.5 setup.py issue.</p></li>
<li><p>1.3.2 fix Python 3.2 setup.py issue.</p></li>
<li><p>1.3.1 fix a couple of Python 3.2 compatibility issues.</p></li>
<li><p>1.3 added search() and findall(); removed compile() from <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">*</span></code>
export as it overwrites builtin.</p></li>
<li><p>1.2 added ability for custom and override type conversions to be
provided; some cleanup</p></li>
<li><p>1.1.9 to keep things simpler number sign is handled automatically;
significant robustification in the face of edge-case input.</p></li>
<li><p>1.1.8 allow “d” fields to have number base “0x” etc. prefixes;
fix up some field type interactions after stress-testing the parser;
implement “%” type.</p></li>
<li><p>1.1.7 Python 3 compatibility tweaks (2.5 to 2.7 and 3.2 are supported).</p></li>
<li><p>1.1.6 add “e” and “g” field types; removed redundant “h” and “X”;
removed need for explicit “#”.</p></li>
<li><p>1.1.5 accept textual dates in more places; Result now holds match span
positions.</p></li>
<li><p>1.1.4 fixes to some int type conversion; implemented “=” alignment; added
date/time parsing with a variety of formats handled.</p></li>
<li><p>1.1.3 type conversion is automatic based on specified field types. Also added
“f” and “n” types.</p></li>
<li><p>1.1.2 refactored, added compile() and limited <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">parse</span> <span class="pre">import</span> <span class="pre">*</span></code></p></li>
<li><p>1.1.1 documentation improvements</p></li>
<li><p>1.1.0 implemented more of the <a class="reference external" href="http://docs.python.org/library/string.html#format-specification-mini-language">Format Specification Mini-Language</a>
and removed the restriction on mixing fixed-position and named fields</p></li>
<li><p>1.0.0 initial release</p></li>
</ul>
<p>This code is copyright 2012-2017 Richard Jones &lt;<a class="reference external" href="mailto:richard&#37;&#52;&#48;python&#46;org">richard<span>&#64;</span>python<span>&#46;</span>org</a>&gt;
See the end of the source file for the license of use.</p>
<dl class="py function">
<dt id="py2store.parse_format.findall">
<code class="sig-prename descclassname">py2store.parse_format.</code><code class="sig-name descname">findall</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">format</span></em>, <em class="sig-param"><span class="n">string</span></em>, <em class="sig-param"><span class="n">pos</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">endpos</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">extra_types</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">evaluate_result</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">case_sensitive</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/parse_format.html#findall"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.parse_format.findall" title="Permalink to this definition">¶</a></dt>
<dd><p>Search “string” for all occurrences of “format”.</p>
<p>You will be returned an iterator that holds Result instances
for each format match found.</p>
<p>Optionally start the search at “pos” character index and limit the search
to a maximum index of endpos - equivalent to search(string[:endpos]).</p>
<p>If <code class="docutils literal notranslate"><span class="pre">evaluate_result</span></code> is True each returned Result instance has two attributes:</p>
<blockquote>
<div><p>.fixed - tuple of fixed-position values from the string
.named - dict of named values from the string</p>
</div></blockquote>
<p>If <code class="docutils literal notranslate"><span class="pre">evaluate_result</span></code> is False each returned value is a Match instance with one method:</p>
<blockquote>
<div><dl class="simple">
<dt>.evaluate_result() - This will return a Result instance like you would get</dt><dd><p>with <code class="docutils literal notranslate"><span class="pre">evaluate_result</span></code> set to True</p>
</dd>
</dl>
</div></blockquote>
<p>The default behaviour is to match strings case insensitively. You may match with
case by specifying case_sensitive=True.</p>
<p>If the format is invalid a ValueError will be raised.</p>
<p>See the module documentation for the use of “extra_types”.</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.parse_format.parse">
<code class="sig-prename descclassname">py2store.parse_format.</code><code class="sig-name descname">parse</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">format</span></em>, <em class="sig-param"><span class="n">string</span></em>, <em class="sig-param"><span class="n">extra_types</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">evaluate_result</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">case_sensitive</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/parse_format.html#parse"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.parse_format.parse" title="Permalink to this definition">¶</a></dt>
<dd><p>Using “format” attempt to pull values from “string”.</p>
<p>The format must match the string contents exactly. If the value
you’re looking for is instead just a part of the string use
search().</p>
<p>If <code class="docutils literal notranslate"><span class="pre">evaluate_result</span></code> is True the return value will be an Result instance with two attributes:</p>
<blockquote>
<div><p>.fixed - tuple of fixed-position values from the string
.named - dict of named values from the string</p>
</div></blockquote>
<p>If <code class="docutils literal notranslate"><span class="pre">evaluate_result</span></code> is False the return value will be a Match instance with one method:</p>
<blockquote>
<div><dl class="simple">
<dt>.evaluate_result() - This will return a Result instance like you would get</dt><dd><p>with <code class="docutils literal notranslate"><span class="pre">evaluate_result</span></code> set to True</p>
</dd>
</dl>
</div></blockquote>
<p>The default behaviour is to match strings case insensitively. You may match with
case by specifying case_sensitive=True.</p>
<p>If the format is invalid a ValueError will be raised.</p>
<p>See the module documentation for the use of “extra_types”.</p>
<p>In the case there is no match parse() will return None.</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.parse_format.search">
<code class="sig-prename descclassname">py2store.parse_format.</code><code class="sig-name descname">search</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">format</span></em>, <em class="sig-param"><span class="n">string</span></em>, <em class="sig-param"><span class="n">pos</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">endpos</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">extra_types</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">evaluate_result</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">case_sensitive</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/parse_format.html#search"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.parse_format.search" title="Permalink to this definition">¶</a></dt>
<dd><p>Search “string” for the first occurrence of “format”.</p>
<p>The format may occur anywhere within the string. If
instead you wish for the format to exactly match the string
use parse().</p>
<p>Optionally start the search at “pos” character index and limit the search
to a maximum index of endpos - equivalent to search(string[:endpos]).</p>
<p>If <code class="docutils literal notranslate"><span class="pre">evaluate_result</span></code> is True the return value will be an Result instance with two attributes:</p>
<blockquote>
<div><p>.fixed - tuple of fixed-position values from the string
.named - dict of named values from the string</p>
</div></blockquote>
<p>If <code class="docutils literal notranslate"><span class="pre">evaluate_result</span></code> is False the return value will be a Match instance with one method:</p>
<blockquote>
<div><dl class="simple">
<dt>.evaluate_result() - This will return a Result instance like you would get</dt><dd><p>with <code class="docutils literal notranslate"><span class="pre">evaluate_result</span></code> set to True</p>
</dd>
</dl>
</div></blockquote>
<p>The default behaviour is to match strings case insensitively. You may match with
case by specifying case_sensitive=True.</p>
<p>If the format is invalid a ValueError will be raised.</p>
<p>See the module documentation for the use of “extra_types”.</p>
<p>In the case there is no match parse() will return None.</p>
</dd></dl>

<dl class="py function">
<dt id="py2store.parse_format.with_pattern">
<code class="sig-prename descclassname">py2store.parse_format.</code><code class="sig-name descname">with_pattern</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">pattern</span></em>, <em class="sig-param"><span class="n">regex_group_count</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/parse_format.html#with_pattern"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.parse_format.with_pattern" title="Permalink to this definition">¶</a></dt>
<dd><p>Attach a regular expression pattern matcher to a custom type converter
function.</p>
<p>This annotates the type converter with the <code class="xref py py-attr docutils literal notranslate"><span class="pre">pattern</span></code> attribute.</p>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@with_pattern</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\d+&quot;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">parse_number</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
<p>is equivalent to:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">parse_number</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parse_number</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\d+&quot;</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pattern</strong> – regular expression pattern (as text)</p></li>
<li><p><strong>regex_group_count</strong> – Indicates how many regex-groups are in pattern.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>wrapped function</p>
</dd>
</dl>
</dd></dl>

</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">py2store</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">py2store.filesys</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.misc">py2store.misc</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.mixins">py2store.mixins</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.test.util">py2store.test.util</a></li>
<li class="toctree-l1"><a class="reference internal" href="#py2store-test-quick">py2store.test.quick</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.test">py2store.test</a></li>
<li class="toctree-l1"><a class="reference internal" href="#py2store-test-simple">py2store.test.simple</a></li>
<li class="toctree-l1"><a class="reference internal" href="#py2store-test-scrap">py2store.test.scrap</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.util">py2store.util</a></li>
<li class="toctree-l1"><a class="reference internal" href="#py2store-ext-docx">py2store.ext.docx</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.ext.gitlab">py2store.ext.gitlab</a></li>
<li class="toctree-l1"><a class="reference internal" href="#py2store-ext-hdf">py2store.ext.hdf</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.ext">py2store.ext</a></li>
<li class="toctree-l1"><a class="reference internal" href="#py2store-ext-matlab">py2store.ext.matlab</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.ext.kaggle">py2store.ext.kaggle</a></li>
<li class="toctree-l1"><a class="reference internal" href="#py2store-ext-module-imports">py2store.ext.module_imports</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.ext.audio">py2store.ext.audio</a></li>
<li class="toctree-l1"><a class="reference internal" href="#py2store-ext-github">py2store.ext.github</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.ext.dataframes">py2store.ext.dataframes</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.access">py2store.access</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.__init__">py2store.__init__</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.stores.s3_store">py2store.stores.s3_store</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.stores.delegation_stores">py2store.stores.delegation_stores</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.stores.sql_w_sqlalchemy">py2store.stores.sql_w_sqlalchemy</a></li>
<li class="toctree-l1"><a class="reference internal" href="#py2store-stores-arangodb-store">py2store.stores.arangodb_store</a></li>
<li class="toctree-l1"><a class="reference internal" href="#py2store-stores-dropbox-store">py2store.stores.dropbox_store</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.stores.local_store">py2store.stores.local_store</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.stores">py2store.stores</a></li>
<li class="toctree-l1"><a class="reference internal" href="#py2store-stores-couchdb-store">py2store.stores.couchdb_store</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.stores.mongo_store">py2store.stores.mongo_store</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.core">py2store.core</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.utils.uri_utils">py2store.utils.uri_utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.utils.explicit">py2store.utils.explicit</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.utils.timeseries_caching">py2store.utils.timeseries_caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="#py2store-utils-attr-dict-py-attr-dict">py2store.utils.attr_dict.py.attr_dict</a></li>
<li class="toctree-l1"><a class="reference internal" href="#py2store-utils-attr-dict-py">py2store.utils.attr_dict.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.utils.cumul_aggreg_write">py2store.utils.cumul_aggreg_write</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.utils">py2store.utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.utils.cache_descriptors">py2store.utils.cache_descriptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.utils.appendable">py2store.utils.appendable</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.utils.affine_conversion">py2store.utils.affine_conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.utils.signatures">py2store.utils.signatures</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.utils.sliceable">py2store.utils.sliceable</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.utils.mappify">py2store.utils.mappify</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.utils.glom">py2store.utils.glom</a></li>
<li class="toctree-l1"><a class="reference internal" href="#py2store-persisters-sql-w-odbc">py2store.persisters.sql_w_odbc</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.persisters.dynamodb_w_boto3">py2store.persisters.dynamodb_w_boto3</a></li>
<li class="toctree-l1"><a class="reference internal" href="#py2store-persisters-couchdb-w-couchdb">py2store.persisters.couchdb_w_couchdb</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.persisters.ftp_persister">py2store.persisters.ftp_persister</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.persisters.dropbox_w_urllib">py2store.persisters.dropbox_w_urllib</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.persisters._google_drive_in_progress">py2store.persisters._google_drive_in_progress</a></li>
<li class="toctree-l1"><a class="reference internal" href="#py2store-persisters-dropbox-w-dropbox">py2store.persisters.dropbox_w_dropbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="#py2store-persisters-redis-w-redis">py2store.persisters.redis_w_redis</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.persisters.sql_w_sqlalchemy">py2store.persisters.sql_w_sqlalchemy</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.persisters.new_s3">py2store.persisters.new_s3</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.persisters">py2store.persisters</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.persisters.dropbox_w_requests">py2store.persisters.dropbox_w_requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.persisters.w_aiofile">py2store.persisters.w_aiofile</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.persisters.local_files">py2store.persisters.local_files</a></li>
<li class="toctree-l1"><a class="reference internal" href="#py2store-persisters-arangodb-w-pyarango">py2store.persisters.arangodb_w_pyarango</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.persisters._cassandra_in_progress">py2store.persisters._cassandra_in_progress</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.persisters._couchdb_in_progress">py2store.persisters._couchdb_in_progress</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.persisters.s3_w_boto3">py2store.persisters.s3_w_boto3</a></li>
<li class="toctree-l1"><a class="reference internal" href="#py2store-persisters-postgres-w-psycopg2-in-progress">py2store.persisters._postgres_w_psycopg2_in_progress</a></li>
<li class="toctree-l1"><a class="reference internal" href="#py2store-persisters-ssh-persister">py2store.persisters.ssh_persister</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.persisters.mongo_w_pymongo">py2store.persisters.mongo_w_pymongo</a></li>
<li class="toctree-l1"><a class="reference internal" href="#py2store-persisters-googledrive-w-pydrive">py2store.persisters.googledrive_w_pydrive</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.sources">py2store.sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.dig">py2store.dig</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.serializers.pickled">py2store.serializers.pickled</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.serializers.jsonization">py2store.serializers.jsonization</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.serializers">py2store.serializers</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.serializers.sequential">py2store.serializers.sequential</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.serializers.regular_panel_data">py2store.serializers.regular_panel_data</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.serializers.audio">py2store.serializers.audio</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.caching">py2store.caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.scrap">py2store.scrap</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.scrap.new_gen_local">py2store.scrap.new_gen_local</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.examples.write_caches">py2store.examples.write_caches</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.examples">py2store.examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.examples.python_code_stats">py2store.examples.python_code_stats</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.examples.kv_walking">py2store.examples.kv_walking</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.my">py2store.my</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.my.grabbers">py2store.my.grabbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.trans">py2store.trans</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.key_mappers.str_utils">py2store.key_mappers.str_utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.key_mappers.tuples">py2store.key_mappers.tuples</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.key_mappers.paths">py2store.key_mappers.paths</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.key_mappers.naming">py2store.key_mappers.naming</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.key_mappers">py2store.key_mappers</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.errors">py2store.errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.slib.s_configparser">py2store.slib.s_configparser</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.slib">py2store.slib</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.slib.s_zipfile">py2store.slib.s_zipfile</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.base">py2store.base</a></li>
<li class="toctree-l1"><a class="reference internal" href="#py2store-selectors-mg-selectors">py2store.selectors.mg_selectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="#py2store-selectors-mongoquery">py2store.selectors.mongoquery</a></li>
<li class="toctree-l1"><a class="reference internal" href="#py2store-selectors">py2store.selectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-py2store.parse_format">py2store.parse_format</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#format-syntax">Format Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="#format-specification">Format Specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="#result-and-match-objects">Result and Match Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="#custom-type-conversions">Custom Type Conversions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#potential-gotchas">Potential Gotchas</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Welcome to Mock Module’s documentation!</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/test.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>