
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>&lt;no title&gt; &#8212; py2store 0.0.1 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <span class="target" id="module-py2store.base"></span><p>Base classes for making stores.
In the language of the collections.abc module, a store is a MutableMapping that is configured to work with a specific
representation of keys, serialization of objects (python values), and persistence of the serialized data.</p>
<p>That is, stores offer the same interface as a dict, but where the actual implementation of writes, reads, and listing
are configurable.</p>
<p>Consider the following example. You’re store is meant to store waveforms as wav files on a remote server.
Say waveforms are represented in python as a tuple (wf, sr), where wf is a list of numbers and sr is the sample
rate, an int). The __setitem__ method will specify how to store bytes on a remote server, but you’ll need to specify
how to SERIALIZE (wf, sr) to the bytes that constitute that wav file: _data_of_obj specifies that.
You might also want to read those wav files back into a python (wf, sr) tuple. The __getitem__ method will get
you those bytes from the server, but the store will need to know how to DESERIALIZE those bytes back into a python
object: _obj_of_data specifies that</p>
<p>Further, say you’re storing these .wav files in /some/folder/on/the/server/, but you don’t want the store to use
these as the keys. For one, it’s annoying to type and harder to read. But more importantly, it’s an irrelevant
implementation detail that shouldn’t be exposed. THe _id_of_key and _key_of_id pair are what allow you to
add this key interface layer.</p>
<p>These key converters object serialization methods default to the identity (i.e. they return the input as is).
This means that you don’t have to implement these as all, and can choose to implement these concerns within
the storage methods themselves.</p>
<dl class="class">
<dt id="py2store.base.KeyValidationABC">
<em class="property">class </em><code class="sig-prename descclassname">py2store.base.</code><code class="sig-name descname">KeyValidationABC</code><a class="reference internal" href="_modules/py2store/base.html#KeyValidationABC"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.base.KeyValidationABC" title="Permalink to this definition">¶</a></dt>
<dd><p>An ABC for an object writer.
Single purpose: store an object under a given key.
How the object is serialized and or physically stored should be defined in a concrete subclass.</p>
</dd></dl>

<dl class="attribute">
<dt id="py2store.base.KvPersister">
<code class="sig-prename descclassname">py2store.base.</code><code class="sig-name descname">KvPersister</code><a class="headerlink" href="#py2store.base.KvPersister" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#py2store.base.Persister" title="py2store.base.Persister"><code class="xref py py-class docutils literal notranslate"><span class="pre">py2store.base.Persister</span></code></a></p>
</dd></dl>

<dl class="class">
<dt id="py2store.base.KvReader">
<em class="property">class </em><code class="sig-prename descclassname">py2store.base.</code><code class="sig-name descname">KvReader</code><a class="reference internal" href="_modules/py2store/base.html#KvReader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.base.KvReader" title="Permalink to this definition">¶</a></dt>
<dd><p>Acts as a Mapping abc, but with default __len__ (implemented by counting keys)
and head method to get the first (k, v) item of the store</p>
</dd></dl>

<dl class="attribute">
<dt id="py2store.base.KvStore">
<code class="sig-prename descclassname">py2store.base.</code><code class="sig-name descname">KvStore</code><a class="headerlink" href="#py2store.base.KvStore" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#py2store.base.Store" title="py2store.base.Store"><code class="xref py py-class docutils literal notranslate"><span class="pre">py2store.base.Store</span></code></a></p>
</dd></dl>

<dl class="class">
<dt id="py2store.base.Persister">
<em class="property">class </em><code class="sig-prename descclassname">py2store.base.</code><code class="sig-name descname">Persister</code><a class="reference internal" href="_modules/py2store/base.html#Persister"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.base.Persister" title="Permalink to this definition">¶</a></dt>
<dd><p>Acts as a MutableMapping abc, but disabling the clear method, and computing __len__ by counting keys</p>
<dl class="method">
<dt id="py2store.base.Persister.clear">
<code class="sig-name descname">clear</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; None.  Remove all items from D.<a class="reference internal" href="_modules/py2store/base.html#Persister.clear"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.base.Persister.clear" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="attribute">
<dt id="py2store.base.Reader">
<code class="sig-prename descclassname">py2store.base.</code><code class="sig-name descname">Reader</code><a class="headerlink" href="#py2store.base.Reader" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#py2store.base.KvReader" title="py2store.base.KvReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">py2store.base.KvReader</span></code></a></p>
</dd></dl>

<dl class="class">
<dt id="py2store.base.Store">
<em class="property">class </em><code class="sig-prename descclassname">py2store.base.</code><code class="sig-name descname">Store</code><span class="sig-paren">(</span><em class="sig-param">store=&lt;class 'dict'&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/base.html#Store"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.base.Store" title="Permalink to this definition">¶</a></dt>
<dd><p>By store we mean key-value store. This could be files in a filesystem, objects in s3, or a database. Where and
how the content is stored should be specified, but StoreInterface offers a dict-like interface to this.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="fm">__getitem__</span> <span class="n">calls</span><span class="p">:</span> <span class="n">_id_of_key</span>                                       <span class="n">_obj_of_data</span>
<span class="fm">__setitem__</span> <span class="n">calls</span><span class="p">:</span> <span class="n">_id_of_key</span>                   <span class="n">_data_of_obj</span>
<span class="fm">__delitem__</span> <span class="n">calls</span><span class="p">:</span> <span class="n">_id_of_key</span>
<span class="fm">__iter__</span>    <span class="n">calls</span><span class="p">:</span>                  <span class="n">_key_of_id</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Default store: no key or value conversion ################################################</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Store</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">33</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">65</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="mi">33</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="mi">65</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="mi">33</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="mi">65</span><span class="p">)]</span>  <span class="c1"># see that the store contains the same thing</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">################################################################################################</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Now let&#39;s make stores that have a key and value conversion layer #############################</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># input keys will be upper cased, and output keys lower cased ##################################</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># input values (assumed int) will be converted to ascii string, and visa versa #################</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">################################################################################################</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">test_store</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">s</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">33</span>  <span class="c1"># write 33 to &#39;foo&#39;</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="s1">&#39;foo&#39;</span> <span class="ow">in</span> <span class="n">s</span>  <span class="c1"># __contains__ works</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="s1">&#39;no_such_key&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span>  <span class="c1"># __nin__ works</span>
<span class="gp">... </span>    <span class="n">s</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">65</span>  <span class="c1"># write 65 to &#39;bar&#39;</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>  <span class="c1"># there are indeed two elements</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">]</span>  <span class="c1"># these are the keys</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">]</span>  <span class="c1"># the keys() method works!</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">==</span> <span class="p">[</span><span class="mi">33</span><span class="p">,</span> <span class="mi">65</span><span class="p">]</span>  <span class="c1"># the values() method works!</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="mi">33</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="mi">65</span><span class="p">)]</span>  <span class="c1"># these are the items</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">&#39;FOO&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;BAR&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">)]</span>  <span class="c1"># but note the internal representation</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">33</span>  <span class="c1"># the get method works</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;no_such_key&#39;</span><span class="p">,</span> <span class="s1">&#39;something&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;something&#39;</span>  <span class="c1"># return a default value</span>
<span class="gp">... </span>    <span class="k">del</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">])</span>  <span class="c1"># you can delete an item given its key</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>  <span class="c1"># see, only one item left!</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="mi">65</span><span class="p">)]</span>  <span class="c1"># here it is</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># We can introduce this conversion layer in several ways. Here&#39;s a few... ######################</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># by subclassing ###############################################################################</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyStore</span><span class="p">(</span><span class="n">Store</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_id_of_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_key_of_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_id</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_data_of_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">chr</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_obj_of_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">MyStore</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="nb">dict</span><span class="p">())</span>  <span class="c1"># note that you don&#39;t need to specify dict(), since it&#39;s the default</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">test_store</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># by assigning functions to converters ##########################################################</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyStore</span><span class="p">(</span><span class="n">Store</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">_id_of_key</span><span class="p">,</span> <span class="n">_key_of_id</span><span class="p">,</span> <span class="n">_data_of_obj</span><span class="p">,</span> <span class="n">_obj_of_data</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_id_of_key</span> <span class="o">=</span> <span class="n">_id_of_key</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_key_of_id</span> <span class="o">=</span> <span class="n">_key_of_id</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_data_of_obj</span> <span class="o">=</span> <span class="n">_data_of_obj</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_obj_of_data</span> <span class="o">=</span> <span class="n">_obj_of_data</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">MyStore</span><span class="p">(</span><span class="nb">dict</span><span class="p">(),</span>
<span class="gp">... </span>            <span class="n">_id_of_key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
<span class="gp">... </span>            <span class="n">_key_of_id</span><span class="o">=</span><span class="k">lambda</span> <span class="n">_id</span><span class="p">:</span> <span class="n">_id</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
<span class="gp">... </span>            <span class="n">_data_of_obj</span><span class="o">=</span><span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="nb">chr</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">_obj_of_data</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">test_store</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># using a Mixin class #############################################################################</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Mixin</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_id_of_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_key_of_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_id</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_data_of_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">chr</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_obj_of_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyStore</span><span class="p">(</span><span class="n">Mixin</span><span class="p">,</span> <span class="n">Store</span><span class="p">):</span>  <span class="c1"># note that the Mixin must come before Store in the mro</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">MyStore</span><span class="p">()</span>  <span class="c1"># no dict()? No, because default anyway</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">test_store</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># adding wrapper methods to an already made Store instance #########################################</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Store</span><span class="p">(</span><span class="nb">dict</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">_id_of_key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">_key_of_id</span><span class="o">=</span><span class="k">lambda</span> <span class="n">_id</span><span class="p">:</span> <span class="n">_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">_data_of_obj</span><span class="o">=</span><span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="nb">chr</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">_obj_of_data</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">test_store</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="py2store.base.Store.clear">
<code class="sig-name descname">clear</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; None.  Remove all items from D.<a class="reference internal" href="_modules/py2store/base.html#Store.clear"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.base.Store.clear" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="py2store.base.Store.get">
<code class="sig-name descname">get</code><span class="sig-paren">(</span><em class="sig-param">k</em><span class="optional">[</span>, <em class="sig-param">d</em><span class="optional">]</span><span class="sig-paren">)</span> &#x2192; D[k] if k in D, else d.  d defaults to None.<a class="reference internal" href="_modules/py2store/base.html#Store.get"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.base.Store.get" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="py2store.base.has_kv_store_interface">
<code class="sig-prename descclassname">py2store.base.</code><code class="sig-name descname">has_kv_store_interface</code><span class="sig-paren">(</span><em class="sig-param">o</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/base.html#has_kv_store_interface"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.base.has_kv_store_interface" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if object has the KvStore interface (that is, has the kv wrapper methods</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>o</strong> – object (class or instance)</p>
</dd>
</dl>
<p>Returns: True if kv has the four key (in/out) and value (in/out) transformation methods</p>
</dd></dl>

<span class="target" id="module-py2store.core"></span><dl class="class">
<dt id="py2store.core.ExplicitKeys">
<em class="property">class </em><code class="sig-prename descclassname">py2store.core.</code><code class="sig-name descname">ExplicitKeys</code><span class="sig-paren">(</span><em class="sig-param">key_collection: collections.abc.Collection</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/core.html#ExplicitKeys"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.core.ExplicitKeys" title="Permalink to this definition">¶</a></dt>
<dd><p>py2store.base.Keys implementation that gets it’s keys explicitly from a collection given at initialization time.
The key_collection must be a collections.abc.Collection (such as list, tuple, set, etc.)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">keys</span> <span class="o">=</span> <span class="n">ExplicitKeys</span><span class="p">(</span><span class="n">key_collection</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;alice&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;foo&#39;</span> <span class="ow">in</span> <span class="n">keys</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;not there&#39;</span> <span class="ow">in</span> <span class="n">keys</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
<span class="go">[&#39;foo&#39;, &#39;bar&#39;, &#39;alice&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="py2store.core.ExplicitKeysStore">
<em class="property">class </em><code class="sig-prename descclassname">py2store.core.</code><code class="sig-name descname">ExplicitKeysStore</code><span class="sig-paren">(</span><em class="sig-param">store</em>, <em class="sig-param">key_collection</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/core.html#ExplicitKeysStore"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.core.ExplicitKeysStore" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrap a store (instance) so that it gets it’s keys from an explicit iterable of keys.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ss</span> <span class="o">=</span> <span class="n">ExplicitKeysStore</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>
<span class="go">[&#39;d&#39;, &#39;a&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ss</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="go">[4, 1]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ss</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="go">(&#39;d&#39;, 4)</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="py2store.core.ExplicitKeysWithPrefixRelativization">
<em class="property">class </em><code class="sig-prename descclassname">py2store.core.</code><code class="sig-name descname">ExplicitKeysWithPrefixRelativization</code><span class="sig-paren">(</span><em class="sig-param">key_collection</em>, <em class="sig-param">_prefix=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/core.html#ExplicitKeysWithPrefixRelativization"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.core.ExplicitKeysWithPrefixRelativization" title="Permalink to this definition">¶</a></dt>
<dd><p>py2store.base.Keys implementation that gets it’s keys explicitly from a collection given at initialization time.
The key_collection must be a collections.abc.Collection (such as list, tuple, set, etc.)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store.base</span> <span class="k">import</span> <span class="n">Store</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ExplicitKeysWithPrefixRelativization</span><span class="p">(</span><span class="n">key_collection</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;/root/of/foo&#39;</span><span class="p">,</span> <span class="s1">&#39;/root/of/bar&#39;</span><span class="p">,</span> <span class="s1">&#39;/root/for/alice&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">keys</span> <span class="o">=</span> <span class="n">Store</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;of/foo&#39;</span> <span class="ow">in</span> <span class="n">keys</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;not there&#39;</span> <span class="ow">in</span> <span class="n">keys</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
<span class="go">[&#39;of/foo&#39;, &#39;of/bar&#39;, &#39;for/alice&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="py2store.core.PrefixRelativization">
<em class="property">class </em><code class="sig-prename descclassname">py2store.core.</code><code class="sig-name descname">PrefixRelativization</code><span class="sig-paren">(</span><em class="sig-param">_prefix=''</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/core.html#PrefixRelativization"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.core.PrefixRelativization" title="Permalink to this definition">¶</a></dt>
<dd><p>A key wrap that allows one to interface with absolute paths through relative paths.
The original intent was for local files. Instead of referencing files through an absolute path such as</p>
<blockquote>
<div><p>/A/VERY/LONG/ROOT/FOLDER/the/file/we.want</p>
</div></blockquote>
<dl class="simple">
<dt>we can instead reference the file as</dt><dd><p>the/file/we.want</p>
</dd>
</dl>
<p>But PrefixRelativization can be used, not only for local paths, but when ever a string reference is involved.
In fact, not only strings, but any key object that has a __len__, __add__, and subscripting.</p>
</dd></dl>

<span class="target" id="module-py2store.trans"></span><dl class="function">
<dt id="py2store.trans.cache_iter">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">cache_iter</code><span class="sig-paren">(</span><em class="sig-param">store=None</em>, <em class="sig-param">iter_to_container=&lt;class 'list'&gt;</em>, <em class="sig-param">name=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/trans.html#cache_iter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.cache_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a class that wraps input class’s __iter__ becomes cached.</p>
<p>Quite often we have a lot of keys, that we get from a remote data source, and don’t want to have to ask for
them again and again, having them be fetched, sent over the network, etc.
So we need caching.</p>
<p>But this caching is not the typical read caching, since it’s __iter__ we want to cache, and that’s a generator.
So we’ll implement a store class decorator specialized for this.</p>
<p>The following decorator, when applied to a class (that has an __iter__), will perform the __iter__ code, consuming
all items of the generator and storing them in _iter_cache, and then will yield from there every subsequent call.</p>
<p>It is assumed, if you’re using the cache_iter transformation, that you’re dealing with static data
(or data that can be considered static for the life of the store – for example, when conducting analytics).
If you ever need to refresh the cache during the life of the store, you can to delete _iter_cache like this:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">del</span> <span class="pre">your_store._iter_cache</span>
<span class="pre">`</span></code>
Once you do that, the next time you try to ask something about the contents of the store, it will actually do
a live query again, as for the first time.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>collection_cls</strong> – The class to wrap (must have an __iter__)</p></li>
<li><p><strong>iter_to_container</strong> – The function that will be applied to existing __iter__() and assigned to cache.
The default is list. Another useful one is the sorted function.</p></li>
<li><p><strong>name</strong> – The name of the new class</p></li>
</ul>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@cache_iter</span>
<span class="gp">... </span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">yield from</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Note, could have also used this form: AA = cache_iter(A)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">[1, 2, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">_iter_cache</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span>  <span class="c1"># changing the cache, to prove that subsequent listing will read from there</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># proof:</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Let&#39;s demo the iter_to_container argument. The default is &quot;list&quot;, which will just consume the iter in order</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sorted_dict</span> <span class="o">=</span> <span class="n">cache_iter</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">iter_to_container</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">sorted_dict</span><span class="p">({</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># keys will be in the order they were defined</span>
<span class="go">[&#39;b&#39;, &#39;a&#39;, &#39;c&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sorted_dict</span> <span class="o">=</span> <span class="n">cache_iter</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">iter_to_container</span><span class="o">=</span><span class="nb">sorted</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">sorted_dict</span><span class="p">({</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># keys will be sorted</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sorted_dict</span> <span class="o">=</span> <span class="n">cache_iter</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">iter_to_container</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">sorted_dict</span><span class="p">({</span><span class="s1">&#39;bbb&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;aa&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># keys will be sorted according to their length</span>
<span class="go">[&#39;c&#39;, &#39;aa&#39;, &#39;bbb&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="py2store.trans.filtered_iter">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">filtered_iter</code><span class="sig-paren">(</span><em class="sig-param">filt: Union[callable, Iterable], name=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/trans.html#filtered_iter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.filtered_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a wrapper that will transform a store (class or instance thereof) into a sub-store (i.e. subset of keys).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filt</strong> – A callable or iterable:
callable: Boolean filter function. A func taking a key and and returns True iff the key should be included.
iterable: The collection of keys you want to filter “in”</p></li>
<li><p><strong>name</strong> – The name to give the wrapped class</p></li>
</ul>
</dd>
</dl>
<p>Returns: A wrapper (that then needs to be applied to a store instance or class.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">filtered_dict</span> <span class="o">=</span> <span class="n">filtered_iter</span><span class="p">(</span><span class="n">filt</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)(</span><span class="nb">dict</span><span class="p">)</span>  <span class="c1"># keep only odd length keys</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">filtered_dict</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;bb&#39;</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="s1">&#39;ccc&#39;</span><span class="p">:</span> <span class="s1">&#39;a string&#39;</span><span class="p">,</span> <span class="s1">&#39;dddd&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]})</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[&#39;a&#39;, &#39;ccc&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;a&#39;</span> <span class="ow">in</span> <span class="n">s</span>  <span class="c1"># True because odd (length) key</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;bb&#39;</span> <span class="ow">in</span> <span class="n">s</span>  <span class="c1"># False because odd (length) key</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bb&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="go">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="go">[&#39;a&#39;, &#39;ccc&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="go">[1, &#39;a string&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;a&#39;, 1), (&#39;ccc&#39;, &#39;a string&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bb&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;a&#39;, 1), (&#39;ccc&#39;, &#39;a string&#39;), (&#39;x&#39;, 10)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">s</span><span class="p">[</span><span class="s1">&#39;xx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not an odd key&#39;</span>
<span class="gp">... </span>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This should have failed&quot;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">pass</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="py2store.trans.insert_aliases">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">insert_aliases</code><span class="sig-paren">(</span><em class="sig-param">store</em>, <em class="sig-param">*</em>, <em class="sig-param">write=None</em>, <em class="sig-param">read=None</em>, <em class="sig-param">delete=None</em>, <em class="sig-param">list=None</em>, <em class="sig-param">count=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/trans.html#insert_aliases"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.insert_aliases" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert method aliases of CRUD operations of a store (class or instance).
If store is a class, you’ll get a copy of the class with those methods added.
If store is an instance, the methods will be added in place (no copy will be made).</p>
<p>Note: If an operation (write, read, delete, list, count) is not specified, no alias will be created for
that operation.</p>
<p>IMPORTANT NOTE: The signatures of the methods the aliases will point to will not change.
We say this because, you can call the write method “dump”, but you’ll have to use it as
<cite>store.dump(key, val)</cite>, not <cite>store.dump(val, key)</cite>, which is the signature you’re probably used to
(it’s the one used by json.dump or pickle.dump for example). If you want that familiar interface,
using the insert_load_dump_aliases function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store</strong> – The store to extend with aliases.</p></li>
<li><p><strong>write</strong> – Desired method name for __setitem__</p></li>
<li><p><strong>read</strong> – Desired method name for __getitem__</p></li>
<li><p><strong>delete</strong> – Desired method name for __delitem__</p></li>
<li><p><strong>list</strong> – Desired method name for __iter__</p></li>
<li><p><strong>count</strong> – Desired method name for __len__</p></li>
</ul>
</dd>
</dl>
<p>Returns: A store with the desired aliases.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Example of extending a class</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydict</span> <span class="o">=</span> <span class="n">insert_aliases</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="s1">&#39;dump&#39;</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="s1">&#39;rm&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="o">=</span><span class="s1">&#39;peek&#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="s1">&#39;size&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">mydict</span><span class="p">(</span><span class="n">true</span><span class="o">=</span><span class="s1">&#39;love&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;friends&#39;</span><span class="p">,</span> <span class="s1">&#39;forever&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span>
<span class="go">{&#39;true&#39;: &#39;love&#39;, &#39;friends&#39;: &#39;forever&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;true&#39;</span><span class="p">)</span>
<span class="go">&#39;love&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">peek</span><span class="p">())</span>
<span class="go">[&#39;true&#39;, &#39;friends&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">rm</span><span class="p">(</span><span class="s1">&#39;true&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span>
<span class="go">{&#39;friends&#39;: &#39;forever&#39;}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Example of extending an instance</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">UserDict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">UserDict</span><span class="p">(</span><span class="n">true</span><span class="o">=</span><span class="s1">&#39;love&#39;</span><span class="p">)</span>  <span class="c1"># make (and instance) of a UserDict (can&#39;t modify a dict instance)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># make aliases of note that you don&#39;t need</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">insert_aliases</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="s1">&#39;put&#39;</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="s1">&#39;retrieve&#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="s1">&#39;num_of_items&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;friends&#39;</span><span class="p">,</span> <span class="s1">&#39;forever&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span>
<span class="go">{&#39;true&#39;: &#39;love&#39;, &#39;friends&#39;: &#39;forever&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="s1">&#39;true&#39;</span><span class="p">)</span>
<span class="go">&#39;love&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">num_of_items</span><span class="p">()</span>
<span class="go">2</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="py2store.trans.insert_load_dump_aliases">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">insert_load_dump_aliases</code><span class="sig-paren">(</span><em class="sig-param">store</em>, <em class="sig-param">delete=None</em>, <em class="sig-param">list=None</em>, <em class="sig-param">count=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/trans.html#insert_load_dump_aliases"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.insert_load_dump_aliases" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert load and dump methods, with familiar dump(obj, location) signature.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store</strong> – The store to extend with aliases.</p></li>
<li><p><strong>delete</strong> – Desired method name for __delitem__</p></li>
<li><p><strong>list</strong> – Desired method name for __iter__</p></li>
<li><p><strong>count</strong> – Desired method name for __len__</p></li>
</ul>
</dd>
</dl>
<p>Returns: A store with the desired aliases.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mydict</span> <span class="o">=</span> <span class="n">insert_load_dump_aliases</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">mydict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="s1">&#39;love&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span>
<span class="go">{&#39;true&#39;: &#39;love&#39;}</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="py2store.trans.kv_wrap">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">kv_wrap</code><span class="sig-paren">(</span><em class="sig-param">trans_obj</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/trans.html#kv_wrap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.kv_wrap" title="Permalink to this definition">¶</a></dt>
<dd><p>kv_wrap: A function that makes a wrapper (a decorator) that will get the wrappers from methods of the input object.</p>
<dl class="simple">
<dt>kv_wrap also has attributes:</dt><dd><p>outcoming_keys, ingoing_keys, outcoming_vals, ingoing_vals, and val_reads_wrt_to_keys</p>
</dd>
</dl>
<p>which will only add a single specific wrapper (specified as a function), when that’s what you need.</p>
</dd></dl>

<dl class="function">
<dt id="py2store.trans.kv_wrap_persister_cls">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">kv_wrap_persister_cls</code><span class="sig-paren">(</span><em class="sig-param">persister_cls</em>, <em class="sig-param">name=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/trans.html#kv_wrap_persister_cls"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.kv_wrap_persister_cls" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a class that wraps a persister into a py2store.base.Store,</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>persister_cls</strong> – The persister class to wrap</p>
</dd>
</dl>
<p>Returns: A Store wrapping the persister (see py2store.base)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">kv_wrap_persister_cls</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;two&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;three&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;one&#39;, 1), (&#39;two&#39;, 2), (&#39;three&#39;, 3)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span>  <span class="c1"># looks like a dict, but is not:</span>
<span class="go">&lt;class &#39;abc.dictPWrapped&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;_obj_of_data&#39;</span><span class="p">)</span>  <span class="c1"># for example, it has this magic method</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># If you overwrite the _obj_of_data method, you&#39;ll transform outcomming values with it.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># For example, say the data you stored were minutes, but you want to get then in secs...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">_obj_of_data</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">data</span> <span class="o">*</span> <span class="mi">60</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;one&#39;, 60), (&#39;two&#39;, 120), (&#39;three&#39;, 180)]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># And if you want to have class that has this weird &quot;store minutes, retrieve seconds&quot;, you can do this:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">kv_wrap_persister_cls</span><span class="p">(</span><span class="nb">dict</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_obj_of_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">data</span> <span class="o">*</span> <span class="mi">60</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">B</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;one&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>  <span class="c1"># you can write several key-value pairs at once this way!</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;one&#39;, 60), (&#39;two&#39;, 120), (&#39;three&#39;, 180)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Warning! Advanced under-the-hood chat coming up.... Note this:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">{&#39;one&#39;: 1, &#39;two&#39;: 2, &#39;three&#39;: 3}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># What?!? Well, remember, printing an object calls the objects __str__, which usually calls __repr__</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># The wrapper doesn&#39;t wrap those methods, since they don&#39;t have consistent behaviors.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Here you&#39;re getting the __repr__ of the underlying dict store, without the key and value transforms.</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Say you wanted to transform the incoming minute-unit data, converting to secs BEFORE they were stored...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">kv_wrap_persister_cls</span><span class="p">(</span><span class="nb">dict</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_data_of_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">obj</span> <span class="o">*</span> <span class="mi">60</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">C</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">one</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">two</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">three</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># yet another way you can write multiple key-vals at once</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;one&#39;, 60), (&#39;two&#39;, 120), (&#39;three&#39;, 180)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>  <span class="c1"># but notice that unlike when we printed b, here the stored data is actually transformed!</span>
<span class="go">{&#39;one&#39;: 60, &#39;two&#39;: 120, &#39;three&#39;: 180}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Now, just to demonstrate key transformation, let&#39;s say that we need internal (stored) keys to be upper case,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># but external (the keys you see when listed) ones to be lower case, for some reason...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="n">kv_wrap_persister_cls</span><span class="p">(</span><span class="nb">dict</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="n">_data_of_obj</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="n">obj</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>  <span class="c1"># to demonstrated another way of doing this</span>
<span class="gp">... </span>    <span class="n">_key_of_id</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_id</span><span class="p">:</span> <span class="n">_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="c1"># note if you don&#39;t specify staticmethod, 1st arg must be self</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_id_of_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>  <span class="c1"># a function definition like you&#39;re used to</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">D</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;oNe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">TwO</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">tHrEE</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>  <span class="c1"># you see clean lower cased keys at the interface of the store</span>
<span class="go">[(&#39;one&#39;, 60), (&#39;two&#39;, 120), (&#39;three&#39;, 180)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># but internally, the keys are all upper case</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>  <span class="c1"># equivalent to print(d.store), so keys and values not wrapped (values were transformed before stored)</span>
<span class="go">{&#39;ONE&#39;: 60, &#39;TWO&#39;: 120, &#39;THREE&#39;: 180}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># On the other hand, careful, if you gave the data directly to D, you wouldn&#39;t get that.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">D</span><span class="p">({</span><span class="s1">&#39;one&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="go">{&#39;one&#39;: 1, &#39;two&#39;: 2, &#39;three&#39;: 3}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Thus is because when you construct a D with the dict, it initializes the dicts data with it directly</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># before the key/val transformers are in place to do their jobs.</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="py2store.trans.mk_kv_reader_from_kv_collection">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">mk_kv_reader_from_kv_collection</code><span class="sig-paren">(</span><em class="sig-param">kv_collection</em>, <em class="sig-param">name=None</em>, <em class="sig-param">getitem=&lt;function transparent_key_method&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/trans.html#mk_kv_reader_from_kv_collection"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.mk_kv_reader_from_kv_collection" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a KvReader class from a Collection class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kv_collection</strong> – The Collection class</p></li>
<li><p><strong>name</strong> – The name to give the KvReader class (by default, it will be kv_collection.__qualname__ + ‘Reader’)</p></li>
<li><p><strong>getitem</strong> – The method that will be assigned to __getitem__. Should have the (self, k) signature.
By default, getitem will be transparent_key_method, returning the key as is.
This default is useful when you want to delegate the actual getting to a _obj_of_data wrapper.</p></li>
</ul>
</dd>
</dl>
<p>Returns: A KvReader class that subclasses the input kv_collection</p>
</dd></dl>

<dl class="function">
<dt id="py2store.trans.mk_trans_obj">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">mk_trans_obj</code><span class="sig-paren">(</span><em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/trans.html#mk_trans_obj"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.mk_trans_obj" title="Permalink to this definition">¶</a></dt>
<dd><p>Convenience method to quickly make a trans_obj (just an object holding some trans functions</p>
</dd></dl>

<dl class="function">
<dt id="py2store.trans.wrap_kvs">
<code class="sig-prename descclassname">py2store.trans.</code><code class="sig-name descname">wrap_kvs</code><span class="sig-paren">(</span><em class="sig-param">store=None</em>, <em class="sig-param">name=None</em>, <em class="sig-param">*</em>, <em class="sig-param">key_of_id=None</em>, <em class="sig-param">id_of_key=None</em>, <em class="sig-param">obj_of_data=None</em>, <em class="sig-param">data_of_obj=None</em>, <em class="sig-param">preset=None</em>, <em class="sig-param">postget=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/trans.html#wrap_kvs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.trans.wrap_kvs" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a Store that is wrapped with the given key/val transformers.</p>
<dl class="simple">
<dt>Naming convention:</dt><dd><dl class="simple">
<dt>Morphemes:</dt><dd><p>key: outer key
_id: inner key
obj: outer value
data: inner value</p>
</dd>
<dt>Grammar:</dt><dd><p>Y_of_X: means that you get a Y output when giving an X input. Also known as X_to_Y.</p>
</dd>
</dl>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store</strong> – Store class or instance</p></li>
<li><p><strong>name</strong> – Name to give the wrapper class</p></li>
<li><p><strong>key_of_id</strong> – The outcoming key transformation function.
Forms are <cite>k = key_of_id(_id)</cite> or <cite>k = key_of_id(self, _id)</cite></p></li>
<li><p><strong>id_of_key</strong> – The ingoing key transformation function.
Forms are <cite>_id = id_of_key(k)</cite> or <cite>_id = id_of_key(self, k)</cite></p></li>
<li><p><strong>obj_of_data</strong> – The outcoming val transformation function.
Forms are <cite>obj = obj_of_data(data)</cite> or <cite>obj = obj_of_data(self, data)</cite></p></li>
<li><p><strong>data_of_obj</strong> – The ingoing val transformation function.
Forms are <cite>data = data_of_obj(obj)</cite> or <cite>data = data_of_obj(self, obj)</cite></p></li>
<li><p><strong>preset</strong> – <p>A function that is called before doing a <cite>__setitem__</cite>.
The function is called with both <cite>k</cite> and <cite>v</cite> as inputs, and should output a transformed value.
The intent use is to do ingoing value transformations conditioned on the key.
For example, you may want to serialize an object depending on if you’re writing to a</p>
<blockquote>
<div><p>’.csv’, or ‘.json’, or ‘.pickle’ file.</p>
</div></blockquote>
<p>Forms are <cite>preset(k, obj)</cite> or <cite>preset(self, k, obj)</cite></p>
</p></li>
<li><p><strong>postget</strong> – A function that is called after the value <cite>v</cite> for a key <cite>k</cite> is be <cite>__getitem__</cite>.
The function is called with both <cite>k</cite> and <cite>v</cite> as inputs, and should output a transformed value.
The intent use is to do outcoming value transformations conditioned on the key.
We already have <cite>obj_of_data</cite> for outcoming value trans, but cannot condition it’s behavior on k.
For example, you may want to deserialize the bytes of a ‘.csv’, or ‘.json’, or ‘.pickle’ in different ways.
Forms are <cite>obj = postget(k, data)</cite> or <cite>obj = postget(self, k, data)</cite></p></li>
</ul>
</dd>
</dl>
<p>Returns:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">key_of_id</span><span class="p">(</span><span class="n">_id</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">_id</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">id_of_key</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">obj_of_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">data</span> <span class="o">-</span> <span class="mi">100</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">data_of_obj</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">obj</span> <span class="o">+</span> <span class="mi">100</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">wrap_kvs</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">key_of_id</span><span class="o">=</span><span class="n">key_of_id</span><span class="p">,</span> <span class="n">id_of_key</span><span class="o">=</span><span class="n">id_of_key</span><span class="p">,</span> <span class="n">obj_of_data</span><span class="o">=</span><span class="n">obj_of_data</span><span class="p">,</span> <span class="n">data_of_obj</span><span class="o">=</span><span class="n">data_of_obj</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;KEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>  <span class="c1"># repr is just the base class (dict) repr, so shows &quot;inside&quot; the store (lower case keys and +100)</span>
<span class="go">{&#39;key&#39;: 101}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># repr is just the base class (dict) repr, so shows &quot;inside&quot; the store (lower case keys and +100)</span>
<span class="go">{&#39;key&#39;: 102}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;kEy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>  <span class="c1"># repr is just the base class (dict) repr, so shows &quot;inside&quot; the store (lower case keys and +100)</span>
<span class="go">{&#39;key&#39;: 103}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># but from the point of view of the interface the keys are all upper case</span>
<span class="go">[&#39;KEY&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>  <span class="c1"># and the values are those we put there.</span>
<span class="go">[(&#39;KEY&#39;, 3)]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># And now this: Showing how to condition the value transform (like obj_of_data), but conditioned on key.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">wrap_kvs</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">postget</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">f</span><span class="s1">&#39;upper </span><span class="si">{v}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="k">else</span> <span class="n">f</span><span class="s1">&#39;lower </span><span class="si">{v}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">B</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="s1">&#39;BIG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;letters&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="s1">&#39;small&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;BIG&#39;, &#39;upper letters&#39;), (&#39;small&#39;, &#39;lower text&#39;)]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Let&#39;s try preset and postget. We&#39;ll wrap a dict and write the same list of lists object to</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># keys ending with .csv, .json, and .pkl, specifying the obvious extension-dependent</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># serialization/deserialization we want to associate with it.</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># First, some very simple csv transformation functions</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">to_csv</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">LoL</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">L</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">L</span><span class="p">),</span> <span class="n">LoL</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">from_csv</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">csv</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">),</span> <span class="n">csv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">LoL</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">],[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">from_csv</span><span class="p">(</span><span class="n">to_csv</span><span class="p">(</span><span class="n">LoL</span><span class="p">))</span> <span class="o">==</span> <span class="n">LoL</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">pickle</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">preset</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">to_csv</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">elif</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">elif</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.pkl&#39;</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">v</span>  <span class="c1"># as is</span>
<span class="gp">...</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">postget</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">from_csv</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">elif</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">elif</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.pkl&#39;</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">v</span>  <span class="c1"># as is</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydict</span> <span class="o">=</span> <span class="n">wrap_kvs</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">preset</span><span class="o">=</span><span class="n">preset</span><span class="p">,</span> <span class="n">postget</span><span class="o">=</span><span class="n">postget</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">],[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">mydict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;foo.csv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>  <span class="c1"># store the object as csv</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>  <span class="c1"># &quot;printing&quot; a dict by-passes the transformations, so we see the data in the &quot;raw&quot; format it is stored in.</span>
<span class="go">{&#39;foo.csv&#39;: &#39;a,b,c\nd,e,f&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;foo.csv&#39;</span><span class="p">]</span>  <span class="c1"># but if we actually ask for the data, it deserializes to our original object</span>
<span class="go">[[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;], [&#39;d&#39;, &#39;e&#39;, &#39;f&#39;]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;bar.json&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>  <span class="c1"># store the object as json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>
<span class="go">{&#39;foo.csv&#39;: &#39;a,b,c\nd,e,f&#39;, &#39;bar.json&#39;: &#39;[[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;], [&quot;d&quot;, &quot;e&quot;, &quot;f&quot;]]&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;bar.json&#39;</span><span class="p">]</span>
<span class="go">[[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;], [&#39;d&#39;, &#39;e&#39;, &#39;f&#39;]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;bar.json&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="s1">&#39;normal json&#39;</span><span class="p">}</span>  <span class="c1"># let&#39;s write a normal json instead.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>
<span class="go">{&#39;foo.csv&#39;: &#39;a,b,c\nd,e,f&#39;, &#39;bar.json&#39;: &#39;{&quot;a&quot;: 1, &quot;b&quot;: [1, 2], &quot;c&quot;: &quot;normal json&quot;}&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;foo.csv&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;bar.json&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;foo.pkl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">)[:</span><span class="mi">49</span><span class="p">])</span>  <span class="c1"># see that it looks like bytes of a pickle, indeed!</span>
<span class="go">{&#39;foo.pkl&#39;: b&#39;\x80\x03]q\x00(]q\x01(X\x01\x00\x00</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;foo.pkl&#39;</span><span class="p">]</span>
<span class="go">[[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;], [&#39;d&#39;, &#39;e&#39;, &#39;f&#39;]]</span>
</pre></div>
</div>
</dd></dl>

<span class="target" id="module-py2store.dig"></span><span class="target" id="module-py2store.caching"></span><dl class="function">
<dt id="py2store.caching.mk_cached_store">
<code class="sig-prename descclassname">py2store.caching.</code><code class="sig-name descname">mk_cached_store</code><span class="sig-paren">(</span><em class="sig-param">store_cls_you_want_to_cache</em>, <em class="sig-param">caching_store=None</em>, <em class="sig-param">new_store_name=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/caching.html#mk_cached_store"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.caching.mk_cached_store" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store_cls_you_want_to_cache</strong> – The class of the store you want to cache</p></li>
<li><p><strong>caching_store</strong> – The store you want to use to cacheAnything with a __setitem__(k, v) and a __getitem__(k).
By default, it will use a dict</p></li>
</ul>
</dd>
</dl>
<p>Returns: A subclass of the input store_cls_you_want_to_cache, but with caching (to caching_store)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store.caching</span> <span class="k">import</span> <span class="n">mk_cached_store</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">time</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">SlowDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">sleep_s</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_s</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">SlowDict</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>  <span class="c1"># Wow! Takes a long time to get &#39;a&#39;</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cache</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CachedSlowDict</span> <span class="o">=</span> <span class="n">mk_cached_store</span><span class="p">(</span><span class="n">store_cls_you_want_to_cache</span><span class="o">=</span><span class="n">SlowDict</span><span class="p">,</span> <span class="n">caching_store</span><span class="o">=</span><span class="n">cache</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">CachedSlowDict</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;store: {list(s)}</span><span class="se">\n</span><span class="s2">cache: {list(cache)}&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="go">cache: []</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># This will take a LONG time because it&#39;s the first time we ask for &#39;a&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;store: {list(s)}</span><span class="se">\n</span><span class="s2">cache: {list(cache)}&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="go">cache: [&#39;a&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># This will take very little time because we have &#39;a&#39; in the cache</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;store: {list(s)}</span><span class="se">\n</span><span class="s2">cache: {list(cache)}&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="go">cache: [&#39;a&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># But we don&#39;t have &#39;b&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;store: {list(s)}</span><span class="se">\n</span><span class="s2">cache: {list(cache)}&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="go">cache: [&#39;a&#39;, &#39;b&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># But now we have &#39;b&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;store: {list(s)}</span><span class="se">\n</span><span class="s2">cache: {list(cache)}&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="go">cache: [&#39;a&#39;, &#39;b&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># and we can do things normally (like put stuff in the store)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;store: {list(s)}</span><span class="se">\n</span><span class="s2">cache: {list(cache)}&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;]</span>
<span class="go">cache: [&#39;a&#39;, &#39;b&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span>  <span class="c1"># if we ask for it again though, it will take time (the first time)</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;store: {list(s)}</span><span class="se">\n</span><span class="s2">cache: {list(cache)}&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;]</span>
<span class="go">cache: [&#39;a&#39;, &#39;b&#39;, &#39;d&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Of course, we could write &#39;d&#39; in the cache as well, to get it quicker,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># but that&#39;s another story: The story of write caches!</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># And by the way, your &quot;cache wrapped&quot; store hold a pointer to the cache it&#39;s using,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># so you can take a peep there if needed:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">_caching_store</span>
<span class="go">{&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;d&#39;: 4}</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="py2store.caching.mk_write_cached_store">
<code class="sig-prename descclassname">py2store.caching.</code><code class="sig-name descname">mk_write_cached_store</code><span class="sig-paren">(</span><em class="sig-param">store_cls_you_want_to_cache</em>, <em class="sig-param">w_cache=None</em>, <em class="sig-param">flush_cache_condition=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/caching.html#mk_write_cached_store"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.caching.mk_write_cached_store" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store_cls_you_want_to_cache</strong> – </p></li>
<li><p><strong>w_cache</strong> – </p></li>
<li><p><strong>flush_cache_condition</strong> – </p></li>
</ul>
</dd>
</dl>
<p>Returns:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store.caching</span> <span class="k">import</span> <span class="n">mk_write_cached_store</span><span class="p">,</span> <span class="n">ensure_clear_to_kv_store</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py2store</span> <span class="k">import</span> <span class="n">Store</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">print_state</span><span class="p">(</span><span class="n">store</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;store: </span><span class="si">{store}</span><span class="s2"> ----- store._w_cache: </span><span class="si">{store._w_cache}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyStore</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">MyCachedStore</span> <span class="o">=</span> <span class="n">mk_write_cached_store</span><span class="p">(</span><span class="n">MyStore</span><span class="p">,</span> <span class="n">w_cache</span><span class="o">=</span><span class="p">{})</span>  <span class="c1"># wrap MyStore with a (dict) write cache</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">MyCachedStore</span><span class="p">()</span>  <span class="c1"># make a MyCachedStore instance</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># print the contents (both store and cache), see that it&#39;s empty</span>
<span class="go">store: {} ----- store._w_cache: {}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;hello&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;world&#39;</span>  <span class="c1"># write &#39;world&#39; in &#39;hello&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># see that it hasn&#39;t been written</span>
<span class="go">store: {} ----- store._w_cache: {&#39;hello&#39;: &#39;world&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;ding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dong&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">store: {} ----- store._w_cache: {&#39;hello&#39;: &#39;world&#39;, &#39;ding&#39;: &#39;dong&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">flush_cache</span><span class="p">()</span>  <span class="c1"># manually flush the cache</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># note that store._w_cache is empty, but store has the data now</span>
<span class="go">store: {&#39;hello&#39;: &#39;world&#39;, &#39;ding&#39;: &#39;dong&#39;} ----- store._w_cache: {}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># But you usually want to use the store as a context manager</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">MyCachedStore</span> <span class="o">=</span> <span class="n">mk_write_cached_store</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">MyStore</span><span class="p">,</span> <span class="n">w_cache</span><span class="o">=</span><span class="p">{},</span>
<span class="gp">... </span>    <span class="n">flush_cache_condition</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">the_persistent_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">MyCachedStore</span><span class="p">(</span><span class="n">the_persistent_dict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">s</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===&gt; Before writing data:&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">s</span><span class="p">[</span><span class="s1">&#39;hello&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;world&#39;</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===&gt; Before exiting the with block:&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">===&gt; Before writing data:</span>
<span class="go">store: {} ----- store._w_cache: {}</span>
<span class="go">===&gt; Before exiting the with block:</span>
<span class="go">store: {} ----- store._w_cache: {&#39;hello&#39;: &#39;world&#39;}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===&gt; After exiting the with block:&quot;</span><span class="p">);</span> <span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># Note that the cache store flushed!</span>
<span class="go">===&gt; After exiting the with block:</span>
<span class="go">store: {&#39;hello&#39;: &#39;world&#39;} ----- store._w_cache: {}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Example of auto-flushing when there&#39;s at least two elements</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyStore</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">MyCachedStore</span> <span class="o">=</span> <span class="n">mk_write_cached_store</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">MyStore</span><span class="p">,</span> <span class="n">w_cache</span><span class="o">=</span><span class="p">{},</span>
<span class="gp">... </span>    <span class="n">flush_cache_condition</span><span class="o">=</span><span class="k">lambda</span> <span class="n">w_cache</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">w_cache</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">MyCachedStore</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">s</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">10</span>
<span class="gp">... </span>        <span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">store: {} ----- store._w_cache: {0: 0}</span>
<span class="go">store: {} ----- store._w_cache: {0: 0, 1: 10}</span>
<span class="go">store: {0: 0, 1: 10, 2: 20} ----- store._w_cache: {}</span>
<span class="go">store: {0: 0, 1: 10, 2: 20} ----- store._w_cache: {3: 30}</span>
<span class="go">store: {0: 0, 1: 10, 2: 20} ----- store._w_cache: {3: 30, 4: 40}</span>
<span class="go">store: {0: 0, 1: 10, 2: 20, 3: 30, 4: 40, 5: 50} ----- store._w_cache: {}</span>
<span class="go">store: {0: 0, 1: 10, 2: 20, 3: 30, 4: 40, 5: 50} ----- store._w_cache: {6: 60}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># There was still something left in the cache before exiting the with block. But now...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">store: {0: 0, 1: 10, 2: 20, 3: 30, 4: 40, 5: 50, 6: 60} ----- store._w_cache: {}</span>
</pre></div>
</div>
</dd></dl>

<span class="target" id="module-py2store.util"></span><dl class="class">
<dt id="py2store.util.DictAttr">
<em class="property">class </em><code class="sig-prename descclassname">py2store.util.</code><code class="sig-name descname">DictAttr</code><span class="sig-paren">(</span><em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/util.html#DictAttr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.util.DictAttr" title="Permalink to this definition">¶</a></dt>
<dd><p>Convenience class to hold Key-Val pairs with both a dict-like and struct-like interface.
The dict-like interface has just the basic get/set/del/iter/len
(all “dunders”: none visible as methods). There is no get, update, etc.
This is on purpose, so that the only visible attributes (those you get by tab-completion for instance)
are the those you injected.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">da</span> <span class="o">=</span> <span class="n">DictAttr</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">life</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">da</span><span class="o">.</span><span class="n">foo</span>
<span class="go">&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">da</span><span class="p">[</span><span class="s1">&#39;life&#39;</span><span class="p">]</span>
<span class="go">42</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">da</span><span class="o">.</span><span class="n">true</span> <span class="o">=</span> <span class="s1">&#39;love&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">da</span><span class="p">)</span>  <span class="c1"># count the number of fields</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">da</span><span class="p">[</span><span class="s1">&#39;friends&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;forever&#39;</span>  <span class="c1"># write as dict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">da</span><span class="o">.</span><span class="n">friends</span>  <span class="c1"># read as attribute</span>
<span class="go">&#39;forever&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">da</span><span class="p">)</span>  <span class="c1"># list fields (i.e. keys i.e. attributes)</span>
<span class="go">[&#39;foo&#39;, &#39;life&#39;, &#39;true&#39;, &#39;friends&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">da</span><span class="p">[</span><span class="s1">&#39;friends&#39;</span><span class="p">]</span>  <span class="c1"># delete as dict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">da</span><span class="o">.</span><span class="n">foo</span> <span class="c1"># delete as attribute</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">da</span><span class="p">)</span>
<span class="go">[&#39;life&#39;, &#39;true&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">da</span><span class="o">.</span><span class="n">_dict</span>  <span class="c1"># the hidden dict that is wrapped</span>
<span class="go">{&#39;life&#39;: 42, &#39;true&#39;: &#39;love&#39;}</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="py2store.util.fill_with_dflts">
<code class="sig-prename descclassname">py2store.util.</code><code class="sig-name descname">fill_with_dflts</code><span class="sig-paren">(</span><em class="sig-param">d</em>, <em class="sig-param">dflt_dict=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/util.html#fill_with_dflts"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.util.fill_with_dflts" title="Permalink to this definition">¶</a></dt>
<dd><p>Fed up with multiline handling of dict arguments?
Fed up of repeating the if d is None: d = {} lines ad nauseam (because defaults can’t be dicts as a default
because dicts are mutable blah blah, and the python kings don’t seem to think a mutable dict is useful enough)?
Well, my favorite solution would be a built-in handling of the problem of complex/smart defaults,
that is visible in the code and in the docs. But for now, here’s one of the tricks I use.</p>
<p>Main use is to handle defaults of function arguments. Say you have a function <cite>func(d=None)</cite> and you want
<cite>d</cite> to be a dict that has at least the keys <cite>foo</cite> and <cite>bar</cite> with default values 7 and 42 respectively.
Then, in the beginning of your function code you’ll say:</p>
<blockquote>
<div><p>d = fill_with_dflts(d, {‘a’: 7, ‘b’: 42})</p>
</div></blockquote>
<p>See examples to know how to use it.</p>
<p>ATTENTION: A shallow copy of the dict is made. Know how that affects you (or not).
ATTENTION: This is not recursive: It won’t be filling any nested fields with defaults.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>d</strong> – The dict you want to “fill”</p></li>
<li><p><strong>dflt_dict</strong> – What to fill it with (a {k: v, …} dict where if k is missing in d, you’ll get a new field k, with
value v.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>val entries (if the key was missing in d).</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>a dict with the new key</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fill_with_dflts</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="go">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fill_with_dflts</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">})</span>
<span class="go">{&#39;a&#39;: 7, &#39;b&#39;: 42}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fill_with_dflts</span><span class="p">({},</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">})</span>
<span class="go">{&#39;a&#39;: 7, &#39;b&#39;: 42}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fill_with_dflts</span><span class="p">({</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">})</span>
<span class="go">{&#39;a&#39;: 7, &#39;b&#39;: 1000}</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="py2store.util.groupby">
<code class="sig-prename descclassname">py2store.util.</code><code class="sig-name descname">groupby</code><span class="sig-paren">(</span><em class="sig-param">items: Iterable[Any], key: Callable[[Any], Hashable]</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/util.html#groupby"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.util.groupby" title="Permalink to this definition">¶</a></dt>
<dd><p>Groups items according to group keys updated from those items through the given (<a href="#id1"><span class="problematic" id="id2">item_to_</span></a>)key function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>items</strong> – iterable of items</p></li>
<li><p><strong>key</strong> – The function that computes a key from an item. Needs to return</p></li>
</ul>
</dd>
</dl>
<p>Returns: A dict of {group_key: items_in_that_group, …}</p>
</dd></dl>

<dl class="class">
<dt id="py2store.util.lazyprop">
<em class="property">class </em><code class="sig-prename descclassname">py2store.util.</code><code class="sig-name descname">lazyprop</code><span class="sig-paren">(</span><em class="sig-param">func</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/util.html#lazyprop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.util.lazyprop" title="Permalink to this definition">¶</a></dt>
<dd><p>A descriptor implementation of lazyprop (cached property).
Made based on David Beazley’s “Python Cookbook” book and enhanced with boltons.cacheutils ideas.
It’s
&gt;&gt;&gt; class Test:
…     def __init__(self, a):
…         self.a = a
…     &#64;lazyprop
…     def len(self):
…         print(‘generating “len”’)
…         return len(self.a)
&gt;&gt;&gt; t = Test([0, 1, 2, 3, 4])
&gt;&gt;&gt; t.__dict__
{‘a’: [0, 1, 2, 3, 4]}
&gt;&gt;&gt; t.len
generating “len”
5
&gt;&gt;&gt; t.__dict__
{‘a’: [0, 1, 2, 3, 4], ‘len’: 5}
&gt;&gt;&gt; t.len
5
&gt;&gt;&gt; # But careful when using lazyprop that no one will change the value of a without deleting the property first
&gt;&gt;&gt; t.a = [0, 1, 2]  # if we change a…
&gt;&gt;&gt; t.len  # … we still get the old cached value of len
5
&gt;&gt;&gt; del t.len  # if we delete the len prop
&gt;&gt;&gt; t.len  # … then len being recomputed again
generating “len”
3</p>
</dd></dl>

<dl class="class">
<dt id="py2store.util.lazyprop_w_sentinel">
<em class="property">class </em><code class="sig-prename descclassname">py2store.util.</code><code class="sig-name descname">lazyprop_w_sentinel</code><span class="sig-paren">(</span><em class="sig-param">func</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/util.html#lazyprop_w_sentinel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.util.lazyprop_w_sentinel" title="Permalink to this definition">¶</a></dt>
<dd><p>A descriptor implementation of lazyprop (cached property).
Inserts a <cite>self.func.__name__ + ‘__cache_active’</cite> attribute</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Test</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
<span class="gp">... </span>    <span class="nd">@lazyprop_w_sentinel</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;generating &quot;len&quot;&#39;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">Test</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lazyprop_w_sentinel</span><span class="o">.</span><span class="n">cache_is_active</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s1">&#39;len&#39;</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="vm">__dict__</span>  <span class="c1"># let&#39;s look under the hood</span>
<span class="go">{&#39;a&#39;: [0, 1, 2, 3, 4]}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">len</span>
<span class="go">generating &quot;len&quot;</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lazyprop_w_sentinel</span><span class="o">.</span><span class="n">cache_is_active</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s1">&#39;len&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">len</span>  <span class="c1"># notice there&#39;s no &#39;generating &quot;len&quot;&#39; print this time!</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="vm">__dict__</span>  <span class="c1"># let&#39;s look under the hood</span>
<span class="go">{&#39;a&#39;: [0, 1, 2, 3, 4], &#39;len&#39;: 5, &#39;sentinel_of__len&#39;: True}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># But careful when using lazyprop that no one will change the value of a without deleting the property first</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># if we change a...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">len</span>  <span class="c1"># ... we still get the old cached value of len</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">t</span><span class="o">.</span><span class="n">len</span>  <span class="c1"># if we delete the len prop</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">len</span>  <span class="c1"># ... then len being recomputed again</span>
<span class="go">generating &quot;len&quot;</span>
<span class="go">3</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="py2store.util.max_common_prefix">
<code class="sig-prename descclassname">py2store.util.</code><code class="sig-name descname">max_common_prefix</code><span class="sig-paren">(</span><em class="sig-param">a</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/util.html#max_common_prefix"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.util.max_common_prefix" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a list of strings (or other sliceable sequences), returns the longest common prefix
:param a: list-like of strings
:return: the smallest common prefix of all strings in a</p>
</dd></dl>

<dl class="function">
<dt id="py2store.util.regroupby">
<code class="sig-prename descclassname">py2store.util.</code><code class="sig-name descname">regroupby</code><span class="sig-paren">(</span><em class="sig-param">items</em>, <em class="sig-param">*key_funcs</em>, <em class="sig-param">**named_key_funcs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py2store/util.html#regroupby"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.util.regroupby" title="Permalink to this definition">¶</a></dt>
<dd><p>REcursive groupby. Applies the groupby function recursively, using a sequence of key functions.</p>
</dd></dl>

<dl class="function">
<dt id="py2store.util.str_to_var_str">
<code class="sig-prename descclassname">py2store.util.</code><code class="sig-name descname">str_to_var_str</code><span class="sig-paren">(</span><em class="sig-param">s: str</em><span class="sig-paren">)</span> &#x2192; str<a class="reference internal" href="_modules/py2store/util.html#str_to_var_str"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#py2store.util.str_to_var_str" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a valid python variable string from the input string.
Left untouched if already valid.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">str_to_var_str</span><span class="p">(</span><span class="s1">&#39;this_is_a_valid_var_name&#39;</span><span class="p">)</span>
<span class="go">&#39;this_is_a_valid_var_name&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">str_to_var_str</span><span class="p">(</span><span class="s1">&#39;not valid  #)*(&amp;434&#39;</span><span class="p">)</span>
<span class="go">&#39;not_valid_______434&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">str_to_var_str</span><span class="p">(</span><span class="s1">&#39;99_ballons&#39;</span><span class="p">)</span>
<span class="go">&#39;_99_ballons&#39;</span>
</pre></div>
</div>
</dd></dl>



          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">py2store</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Thor.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/other.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>